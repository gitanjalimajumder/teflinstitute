(window.webpackJsonp=window.webpackJsonp||[]).push([[42],{Md7T:function(e,t,n){"use strict";n.r(t),n.d(t,"AddonBlogLazyModule",(function(){return G}));var o=n("fXoL"),i=n("tyNb"),r=n("L3Fv"),c=n("mrSG"),a=n("SJTA"),s=n("5pQw"),d=n("YyYz"),l=n("kWmn"),g=n("4pns"),_=n("D7J2"),m=n("pHTc"),u=n("9+EE"),h=n("3LXp"),f=n("vuGA"),p=n("mvS9"),E=n("bFG1"),b=n("8vmT"),I=n("TEn/"),y=n("C1x5"),P=n("nt/U"),M=n("PgjG"),v=n("ofXK"),x=n("xpMl"),L=n("3Pt+"),T=n("r8G5"),A=n("FeAf"),B=n("hMzs"),D=n("vSVd"),w=n("1Rj0"),O=n("5450"),V=n("iSJP"),z=n("3CSS"),C=n("sYmb"),U=n("Cg42"),k=n("lAaw");function AddonBlogEntriesPage_ion_item_16_Template(e,t){if(1&e){const e=o.Fc();o.Ec(0,"ion-item"),o.Ec(1,"ion-label"),o.pd(2),o.Pc(3,"translate"),o.Dc(),o.Ec(4,"ion-toggle",11),o.Mc("ngModelChange",(function AddonBlogEntriesPage_ion_item_16_Template_ion_toggle_ngModelChange_4_listener(t){o.fd(e);return o.Oc().onlyMyEntries=t}))("ionChange",(function AddonBlogEntriesPage_ion_item_16_Template_ion_toggle_ionChange_4_listener(){o.fd(e);const t=o.Oc();return t.onlyMyEntriesToggleChanged(t.onlyMyEntries)})),o.Dc(),o.Dc()}if(2&e){const e=o.Oc();o.lc(2),o.qd(o.Qc(3,2,"addon.blog.showonlyyourentries")),o.lc(2),o.Vc("ngModel",e.onlyMyEntries)}}function AddonBlogEntriesPage_core_empty_box_17_Template(e,t){1&e&&(o.zc(0,"core-empty-box",12),o.Pc(1,"translate")),2&e&&o.Vc("message",o.Qc(1,1,"addon.blog.noentriesyet"))}function AddonBlogEntriesPage_ng_container_18_ion_card_1_ion_item_19_Template(e,t){if(1&e&&(o.Ec(0,"ion-item",13),o.Ec(1,"ion-label"),o.Ec(2,"div",0),o.pd(3),o.Pc(4,"translate"),o.Dc(),o.zc(5,"core-tag-list",24),o.Dc(),o.Dc()),2&e){const e=o.Oc(2).$implicit;o.lc(3),o.rd("",o.Qc(4,2,"core.tag.tags"),":"),o.lc(2),o.Vc("tags",e.tags)}}function AddonBlogEntriesPage_ng_container_18_ion_card_1_core_comments_20_Template(e,t){if(1&e&&o.zc(0,"core-comments",25),2&e){const e=o.Oc(2).$implicit,t=o.Oc();o.Vc("component",t.component)("itemId",e.id)("instanceId",e.userid)("showItem",!0)}}function AddonBlogEntriesPage_ng_container_18_ion_card_1_core_file_21_Template(e,t){if(1&e&&o.zc(0,"core-file",26),2&e){const e=t.$implicit,n=o.Oc(2).$implicit,i=o.Oc();o.Vc("file",e)("component",i.component)("componentId",n.id)}}function AddonBlogEntriesPage_ng_container_18_ion_card_1_ion_item_22_Template(e,t){if(1&e&&(o.Ec(0,"ion-item",27),o.Ec(1,"ion-label"),o.pd(2),o.Pc(3,"translate"),o.Dc(),o.Dc()),2&e){const e=o.Oc(2).$implicit;o.Vc("href",e.uniquehash),o.lc(2),o.qd(o.Qc(3,2,"addon.blog.linktooriginalentry"))}}function AddonBlogEntriesPage_ng_container_18_ion_card_1_div_23_Template(e,t){if(1&e&&(o.Ec(0,"div",28),o.Ec(1,"ion-note"),o.zc(2,"ion-icon",29),o.Pc(3,"translate"),o.pd(4),o.Pc(5,"coreTimeAgo"),o.Dc(),o.Dc()),2&e){const e=o.Oc(2).$implicit;o.lc(2),o.mc("aria-label",o.Qc(3,2,"core.lastmodified")),o.lc(2),o.rd(" ",o.Qc(5,4,e.lastmodified)," ")}}function AddonBlogEntriesPage_ng_container_18_ion_card_1_Template(e,t){if(1&e&&(o.Ec(0,"ion-card"),o.Ec(1,"ion-item",13),o.zc(2,"core-user-avatar",14),o.Ec(3,"ion-label"),o.Ec(4,"div",15),o.Ec(5,"h2"),o.zc(6,"core-format-text",16),o.Dc(),o.Ec(7,"ion-note",17),o.pd(8),o.Pc(9,"translate"),o.Dc(),o.Dc(),o.Ec(10,"div",15),o.pd(11),o.Ec(12,"ion-note",17),o.pd(13),o.Pc(14,"coreDateDayOrTime"),o.Dc(),o.Dc(),o.Dc(),o.Dc(),o.Ec(15,"ion-card-content"),o.Ec(16,"ion-item",13),o.Ec(17,"ion-label"),o.zc(18,"core-format-text",18),o.Dc(),o.Dc(),o.nd(19,AddonBlogEntriesPage_ng_container_18_ion_card_1_ion_item_19_Template,6,4,"ion-item",19),o.nd(20,AddonBlogEntriesPage_ng_container_18_ion_card_1_core_comments_20_Template,1,4,"core-comments",20),o.nd(21,AddonBlogEntriesPage_ng_container_18_ion_card_1_core_file_21_Template,1,3,"core-file",21),o.nd(22,AddonBlogEntriesPage_ng_container_18_ion_card_1_ion_item_22_Template,4,4,"ion-item",22),o.Dc(),o.nd(23,AddonBlogEntriesPage_ng_container_18_ion_card_1_div_23_Template,6,6,"div",23),o.Dc()),2&e){const e=o.Oc().$implicit,t=o.Oc();o.lc(2),o.Vc("user",e.user)("courseId",e.courseid),o.lc(4),o.Vc("text",e.subject)("contextLevel",t.contextLevel)("contextInstanceId",t.contextInstanceId),o.lc(2),o.rd(" ",o.Qc(9,18,"addon.blog."+e.publishTranslated)," "),o.lc(3),o.rd(" ",e.user&&e.user.fullname," "),o.lc(2),o.rd(" ",o.Qc(14,20,e.created)," "),o.lc(5),o.Vc("text",e.summary)("component",t.component)("componentId",e.id)("contextLevel",t.contextLevel)("contextInstanceId",t.contextInstanceId),o.lc(1),o.Vc("ngIf",t.tagsEnabled&&e.tags&&e.tags.length>0),o.lc(1),o.Vc("ngIf",t.commentsEnabled),o.lc(1),o.Vc("ngForOf",e.attachmentfiles),o.lc(1),o.Vc("ngIf",e.uniquehash),o.lc(1),o.Vc("ngIf",e.lastmodified>e.created)}}function AddonBlogEntriesPage_ng_container_18_Template(e,t){if(1&e&&(o.Cc(0),o.nd(1,AddonBlogEntriesPage_ng_container_18_ion_card_1_Template,24,22,"ion-card",7),o.Bc()),2&e){const e=t.$implicit,n=o.Oc();o.lc(1),o.Vc("ngIf",!n.onlyMyEntries||e.userid==n.currentUserId)}}let R=(()=>{class AddonBlogEntriesPage{constructor(){this.title="",this.filter={},this.pageLoaded=0,this.userPageLoaded=0,this.canLoadMoreEntries=!1,this.canLoadMoreUserEntries=!0,this.loaded=!1,this.canLoadMore=!1,this.loadMoreError=!1,this.entries=[],this.showMyEntriesToggle=!1,this.onlyMyEntries=!1,this.component=a.b.COMPONENT,this.commentsEnabled=!1,this.tagsEnabled=!1,this.contextLevel="system",this.contextInstanceId=0,this.currentUserId=u.b.getCurrentSiteUserId(),this.siteHomeId=u.b.getCurrentSiteHomeId(),this.logView=b.a.once((()=>Object(c.a)(this,void 0,void 0,(function*(){yield E.a.ignoreErrors(a.a.logView(this.filter)),_.a.logEvent({type:_.b.VIEW_ITEM_LIST,ws:"core_blog_view_entries",name:this.title,data:Object.assign(Object.assign({},this.filter),{category:"blog"}),url:p.a.addParamsToUrl("/blog/index.php",Object.assign(Object.assign({},this.filter),{modid:this.filter.cmid,cmid:void 0}))})}))))}ngOnInit(){return Object(c.a)(this,void 0,void 0,(function*(){const e=m.a.getRouteNumberParam("userId"),t=m.a.getRouteNumberParam("courseId"),n=m.a.getRouteNumberParam("cmId"),o=m.a.getRouteNumberParam("entryId"),i=m.a.getRouteNumberParam("groupId"),r=m.a.getRouteNumberParam("tagId");this.title=e||t||n||o||i||r?"addon.blog.blogentries":"addon.blog.siteblogheading",e&&(this.filter.userid=e),t&&(this.filter.courseid=t),n&&(this.filter.cmid=n),o&&(this.filter.entryid=o),i&&(this.filter.groupid=i),r&&(this.filter.tagid=r),this.showMyEntriesToggle=!e&&!this.filter.entryid,!e||t||n?t&&t!=this.siteHomeId?(this.contextLevel="course",this.contextInstanceId=t):(this.contextLevel="system",this.contextInstanceId=0):(this.contextLevel="user",this.contextInstanceId=e),this.commentsEnabled=!s.a.areCommentsDisabledInSite(),this.tagsEnabled=l.a.areTagsAvailableInSite();(new d.a).treatLink(),yield this.fetchEntries()}))}fetchEntries(e=!1){return Object(c.a)(this,void 0,void 0,(function*(){this.loadMoreError=!1,e&&(this.pageLoaded=0,this.userPageLoaded=0);const t=this.onlyMyEntries?this.userPageLoaded:this.pageLoaded;try{const n=yield a.a.getEntries(this.filter,t),o=n.entries.map((e=>Object(c.a)(this,void 0,void 0,(function*(){switch(e.publishstate){case"draft":e.publishTranslated="publishtonoone";break;case"site":e.publishTranslated="publishtosite";break;case"public":e.publishTranslated="publishtoworld";break;default:e.publishTranslated="privacy:unknown"}e.moduleid||e.coursemoduleid?(e.contextLevel="module",e.contextInstanceId=e.moduleid||e.coursemoduleid):e.courseid?(e.contextLevel="course",e.contextInstanceId=e.courseid):(e.contextLevel="user",e.contextInstanceId=e.userid),e.summary=f.b.replacePluginfileUrls(e.summary,e.summaryfiles||[]),e.user=yield E.a.ignoreErrors(g.a.getProfile(e.userid,e.courseid,!0))}))));if(this.entries=e?n.entries:E.a.uniqueArray(this.entries.concat(n.entries),"id").sort(((e,t)=>t.created-e.created)),this.onlyMyEntries){const e=this.entries.filter((e=>e.userid==this.currentUserId)).length;this.canLoadMoreUserEntries=n.totalentries>e,this.canLoadMore=this.canLoadMoreUserEntries,this.userPageLoaded++}else this.canLoadMoreEntries=n.totalentries>this.entries.length,this.canLoadMore=this.canLoadMoreEntries,this.pageLoaded++;yield Promise.all(o),this.logView()}catch(e){h.a.showErrorModalDefault(e,"addon.blog.errorloadentries",!0),this.loadMoreError=!0}finally{this.loaded=!0}}))}onlyMyEntriesToggleChanged(e){if(this.canLoadMore=e?this.canLoadMoreUserEntries:this.canLoadMoreEntries,!e)return delete this.filter.userid,void 0;const t=this.entries.filter((e=>e.userid==this.currentUserId)).length;this.userPageLoaded=Math.floor(t/a.b.ENTRIES_PER_PAGE),this.filter.userid=this.currentUserId,0==t&&this.canLoadMoreUserEntries&&this.loadMore()}loadMore(e){return this.fetchEntries().finally((()=>{e&&e()}))}refresh(e){const t=this.entries.map((e=>s.a.invalidateCommentsData("user",e.userid,this.component,e.id,"format_blog")));t.push(a.a.invalidateEntries(this.filter)),this.showMyEntriesToggle&&(this.filter.userid=this.currentUserId,t.push(a.a.invalidateEntries(this.filter)),this.onlyMyEntries||delete this.filter.userid),E.a.allPromises(t).finally((()=>{this.fetchEntries(!0).finally((()=>{e&&(null==e?void 0:e.complete())}))}))}}return AddonBlogEntriesPage.ɵfac=function AddonBlogEntriesPage_Factory(e){return new(e||AddonBlogEntriesPage)},AddonBlogEntriesPage.ɵcmp=o.sc({type:AddonBlogEntriesPage,selectors:[["page-addon-blog-entries"]],decls:20,vars:16,consts:[["slot","start"],[3,"text"],["slot","end"],[1,"limited-width"],["slot","fixed",3,"disabled","ionRefresh"],[3,"pullingText"],[3,"hideUntil"],[4,"ngIf"],["icon","far-newspaper",3,"message",4,"ngIf"],[4,"ngFor","ngForOf"],[3,"enabled","error","action"],[3,"ngModel","ngModelChange","ionChange"],["icon","far-newspaper",3,"message"],[1,"ion-text-wrap"],["slot","start",3,"user","courseId"],[1,"flex-row","ion-justify-content-between","ion-align-items-center"],[3,"text","contextLevel","contextInstanceId"],[1,"ion-text-end"],[3,"text","component","componentId","contextLevel","contextInstanceId"],["class","ion-text-wrap",4,"ngIf"],["area","format_blog","contextLevel","user",3,"component","itemId","instanceId","showItem",4,"ngIf"],[3,"file","component","componentId",4,"ngFor","ngForOf"],["core-link","","detail","true",3,"href",4,"ngIf"],["class","ion-text-center ion-margin-bottom",4,"ngIf"],[3,"tags"],["area","format_blog","contextLevel","user",3,"component","itemId","instanceId","showItem"],[3,"file","component","componentId"],["core-link","","detail","true",3,"href"],[1,"ion-text-center","ion-margin-bottom"],["name","fas-clock"]],template:function AddonBlogEntriesPage_Template(e,t){1&e&&(o.Ec(0,"ion-header"),o.Ec(1,"ion-toolbar"),o.Ec(2,"ion-buttons",0),o.zc(3,"ion-back-button",1),o.Pc(4,"translate"),o.Dc(),o.Ec(5,"ion-title"),o.Ec(6,"h1"),o.pd(7),o.Pc(8,"translate"),o.Dc(),o.Dc(),o.Ec(9,"ion-buttons",2),o.zc(10,"core-user-menu-button"),o.Dc(),o.Dc(),o.Dc(),o.Ec(11,"ion-content",3),o.Ec(12,"ion-refresher",4),o.Mc("ionRefresh",(function AddonBlogEntriesPage_Template_ion_refresher_ionRefresh_12_listener(e){return t.refresh(e.target)})),o.zc(13,"ion-refresher-content",5),o.Pc(14,"translate"),o.Dc(),o.Ec(15,"core-loading",6),o.nd(16,AddonBlogEntriesPage_ion_item_16_Template,5,4,"ion-item",7),o.nd(17,AddonBlogEntriesPage_core_empty_box_17_Template,2,3,"core-empty-box",8),o.nd(18,AddonBlogEntriesPage_ng_container_18_Template,2,1,"ng-container",9),o.Ec(19,"core-infinite-loading",10),o.Mc("action",(function AddonBlogEntriesPage_Template_core_infinite_loading_action_19_listener(e){return t.loadMore(e)})),o.Dc(),o.Dc(),o.Dc()),2&e&&(o.lc(3),o.Vc("text",o.Qc(4,10,"core.back")),o.lc(4),o.qd(o.Qc(8,12,t.title)),o.lc(5),o.Vc("disabled",!t.loaded),o.lc(1),o.Wc("pullingText",o.Qc(14,14,"core.pulltorefresh")),o.lc(2),o.Vc("hideUntil",t.loaded),o.lc(1),o.Vc("ngIf",t.showMyEntriesToggle),o.lc(1),o.Vc("ngIf",t.entries&&0==t.entries.length),o.lc(1),o.Vc("ngForOf",t.entries),o.lc(1),o.Vc("enabled",t.canLoadMore)("error",t.loadMoreError))},directives:[I.C,I.Ab,I.m,I.h,I.i,I.yb,y.a,P.a,I.v,I.bb,I.cb,M.a,v.t,v.s,x.a,I.I,I.O,I.zb,I.d,L.r,L.u,T.a,I.n,A.a,B.a,I.W,I.o,D.a,w.a,O.a,V.a,I.D,z.a],pipes:[C.d,U.a,k.a],encapsulation:2}),AddonBlogEntriesPage})();var j=n("rGK3"),F=n("yQkb"),Q=n("wG2S"),S=n("KZF4"),N=n("dQ3M");function buildRoutes(e){return[...Object(Q.b)(e,{data:{mainMenuTabRoot:S.b.PAGE_NAME},component:R})]}let G=(()=>{class AddonBlogLazyModule{}return AddonBlogLazyModule.ɵmod=o.wc({type:AddonBlogLazyModule}),AddonBlogLazyModule.ɵinj=o.vc({factory:function AddonBlogLazyModule_Factory(e){return new(e||AddonBlogLazyModule)},providers:[{provide:i.g,multi:!0,deps:[o.x],useFactory:buildRoutes}],imports:[[r.a,j.a,F.a,N.a],i.m]}),AddonBlogLazyModule})();void(("undefined"==typeof ngJitMode||ngJitMode)&&o.kd(G,{declarations:[R],imports:[r.a,j.a,F.a,N.a],exports:[i.m]}))}}]);