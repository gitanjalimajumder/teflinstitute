(window.webpackJsonp=window.webpackJsonp||[]).push([[70],{QeBL:function(e,t,o){"use strict";o.r(t),o.d(t,"AddonNotesLazyModule",(function(){return $}));var n=o("L3Fv"),c=o("tyNb"),s=o("rGK3"),i=o("yQkb"),a=o("mrSG"),r=o("BaYo"),d=o("mYSf"),l=o("yqEV"),_=o("+c6a"),u=o("VS9b"),h=o("MUy3"),f=o("4pns"),p=o("TEn/"),g=o("D7J2"),m=o("pHTc"),I=o("9+EE"),N=o("3LXp"),y=o("vuGA"),b=o("mvS9"),D=o("bFG1"),L=o("j3ag"),P=o("fjkH"),A=o("8vmT"),v=o("fXoL"),E=o("ACV2"),O=o("ACYt"),T=o("3CSS"),w=o("fQ68"),V=o("8/N+"),C=o("nt/U"),x=o("PgjG"),M=o("ofXK"),k=o("rf3J"),z=o("FeAf"),Q=o("r8G5"),S=o("hMzs"),G=o("yNDK"),j=o("sYmb"),U=o("Cg42");function AddonNotesListPage_ion_item_24_Template(e,t){if(1&e&&(v.Ec(0,"ion-item",19),v.zc(1,"core-user-avatar",20),v.Ec(2,"ion-label"),v.Ec(3,"p",21),v.pd(4),v.Dc(),v.Dc(),v.Dc()),2&e){const e=v.Oc();v.lc(1),v.Vc("user",e.user)("courseId",e.courseId)("linkProfile",!1),v.lc(3),v.qd(e.user.fullname)}}const _c0=function(e){return{$a:e}};function AddonNotesListPage_ion_card_35_Template(e,t){1&e&&(v.Ec(0,"ion-card",22),v.Ec(1,"ion-item"),v.zc(2,"ion-icon",23),v.Ec(3,"ion-label"),v.pd(4),v.Pc(5,"translate"),v.Pc(6,"lowercase"),v.Pc(7,"translate"),v.Dc(),v.Dc(),v.Dc()),2&e&&(v.lc(4),v.rd(" ",v.Rc(5,1,"core.thereisdatatosync",v.ad(8,_c0,v.Qc(6,4,v.Qc(7,6,"addon.notes.notes"))))," "))}function AddonNotesListPage_core_empty_box_36_Template(e,t){1&e&&(v.zc(0,"core-empty-box",24),v.Pc(1,"translate")),2&e&&v.Vc("message",v.Qc(1,1,"addon.notes.nonotes"))}function AddonNotesListPage_ng_container_37_ion_card_1_core_user_avatar_2_Template(e,t){if(1&e&&v.zc(0,"core-user-avatar",31),2&e){const e=v.Oc().$implicit,t=v.Oc(2);v.Vc("user",e)("courseId",t.courseId)}}function AddonNotesListPage_ng_container_37_ion_card_1_p_4_Template(e,t){if(1&e&&(v.Ec(0,"p",21),v.pd(1),v.Dc()),2&e){const e=v.Oc().$implicit;v.lc(1),v.qd(e.userfullname)}}function AddonNotesListPage_ng_container_37_ion_card_1_p_5_Template(e,t){if(1&e&&(v.Ec(0,"p",2),v.Ec(1,"span",19),v.pd(2),v.Pc(3,"coreDateDayOrTime"),v.Dc(),v.Dc()),2&e){const e=v.Oc().$implicit;v.lc(2),v.qd(v.Qc(3,1,e.lastmodified))}}function AddonNotesListPage_ng_container_37_ion_card_1_p_6_Template(e,t){1&e&&(v.Ec(0,"p",2),v.zc(1,"ion-icon",32),v.Ec(2,"span",19),v.pd(3),v.Pc(4,"translate"),v.Dc(),v.Dc()),2&e&&(v.lc(3),v.rd(" ",v.Qc(4,1,"core.notsent")," "))}function AddonNotesListPage_ng_container_37_ion_card_1_p_7_Template(e,t){1&e&&(v.Ec(0,"p",2),v.zc(1,"ion-icon",33),v.Ec(2,"span",19),v.pd(3),v.Pc(4,"translate"),v.Dc(),v.Dc()),2&e&&(v.lc(3),v.rd(" ",v.Qc(4,1,"core.deletedoffline")," "))}function AddonNotesListPage_ng_container_37_ion_card_1_ion_button_8_Template(e,t){if(1&e){const e=v.Fc();v.Ec(0,"ion-button",34),v.Mc("click",(function AddonNotesListPage_ng_container_37_ion_card_1_ion_button_8_Template_ion_button_click_0_listener(t){v.fd(e);const o=v.Oc().$implicit;return v.Oc(2).undoDeleteNote(t,o)})),v.Pc(1,"translate"),v.zc(2,"ion-icon",35),v.Dc()}2&e&&v.mc("aria-label",v.Qc(1,1,"core.restore"))}function AddonNotesListPage_ng_container_37_ion_card_1_ion_button_9_Template(e,t){if(1&e){const e=v.Fc();v.Ec(0,"ion-button",34),v.Mc("click",(function AddonNotesListPage_ng_container_37_ion_card_1_ion_button_9_Template_ion_button_click_0_listener(t){v.fd(e);const o=v.Oc().$implicit;return v.Oc(2).deleteNote(t,o)})),v.Pc(1,"translate"),v.zc(2,"ion-icon",36),v.Dc()}2&e&&(v.Vc("@coreSlideInOut","fromRight"),v.mc("aria-label",v.Qc(1,2,"core.delete")))}function AddonNotesListPage_ng_container_37_ion_card_1_Template(e,t){if(1&e&&(v.Ec(0,"ion-card"),v.Ec(1,"ion-item",19),v.nd(2,AddonNotesListPage_ng_container_37_ion_card_1_core_user_avatar_2_Template,1,2,"core-user-avatar",26),v.Ec(3,"ion-label"),v.nd(4,AddonNotesListPage_ng_container_37_ion_card_1_p_4_Template,2,1,"p",27),v.nd(5,AddonNotesListPage_ng_container_37_ion_card_1_p_5_Template,4,3,"p",28),v.Dc(),v.nd(6,AddonNotesListPage_ng_container_37_ion_card_1_p_6_Template,5,3,"p",28),v.nd(7,AddonNotesListPage_ng_container_37_ion_card_1_p_7_Template,5,3,"p",28),v.nd(8,AddonNotesListPage_ng_container_37_ion_card_1_ion_button_8_Template,3,3,"ion-button",29),v.nd(9,AddonNotesListPage_ng_container_37_ion_card_1_ion_button_9_Template,3,4,"ion-button",29),v.Dc(),v.Ec(10,"ion-item",19),v.Ec(11,"ion-label"),v.zc(12,"core-format-text",30),v.Dc(),v.Dc(),v.Dc()),2&e){const e=t.$implicit,o=v.Oc(2);v.lc(2),v.Vc("ngIf",!o.userId),v.lc(2),v.Vc("ngIf",!o.userId),v.lc(1),v.Vc("ngIf",!e.deleted&&!e.offline),v.lc(1),v.Vc("ngIf",e.offline),v.lc(1),v.Vc("ngIf",e.deleted),v.lc(1),v.Vc("ngIf",e.deleted),v.lc(1),v.Vc("ngIf",o.showDelete&&!e.deleted&&("personal"!=o.type||e.usermodified==o.currentUserId)),v.lc(3),v.Vc("text",e.content)("filter",!1)}}function AddonNotesListPage_ng_container_37_Template(e,t){if(1&e&&(v.Cc(0),v.nd(1,AddonNotesListPage_ng_container_37_ion_card_1_Template,13,9,"ion-card",25),v.Bc()),2&e){const e=v.Oc();v.lc(1),v.Vc("ngForOf",e.notes)}}function AddonNotesListPage_ion_fab_38_Template(e,t){if(1&e){const e=v.Fc();v.Ec(0,"ion-fab",37),v.Ec(1,"ion-fab-button",38),v.Mc("click",(function AddonNotesListPage_ion_fab_38_Template_ion_fab_button_click_1_listener(t){v.fd(e);return v.Oc().addNote(t)})),v.Pc(2,"translate"),v.zc(3,"ion-icon",39),v.Ec(4,"span",40),v.pd(5),v.Pc(6,"translate"),v.Dc(),v.Dc(),v.Dc()}2&e&&(v.lc(1),v.mc("aria-label",v.Qc(2,2,"addon.notes.addnewnote")),v.lc(4),v.qd(v.Qc(6,4,"addon.notes.addnewnote")))}let F=(()=>{class AddonNotesListPage{constructor(){this.type="course",this.refreshIcon=r.a.ICON_LOADING,this.syncIcon=r.a.ICON_LOADING,this.notes=[],this.hasOffline=!1,this.notesLoaded=!1,this.showDelete=!1,this.canDeleteNotes=!1,this.logView=A.a.once((()=>this.performLogView()));try{this.courseId=m.a.getRequiredRouteNumberParam("courseId"),this.userId=m.a.getRouteNumberParam("userId")}catch(e){return N.a.showErrorModal(e),m.a.back(),void 0}this.syncObserver=P.b.on(u.b.AUTO_SYNCED,(e=>{var t;e.courseId==this.courseId&&(this.showSyncWarnings(e.warnings),this.notesLoaded=!1,this.refreshIcon=r.a.ICON_LOADING,this.syncIcon=r.a.ICON_LOADING,null===(t=this.content)||void 0===t||t.scrollToTop(),this.fetchNotes(!1))}),I.b.getCurrentSiteId()),this.currentUserId=I.b.getCurrentSiteUserId()}ngOnInit(){return Object(a.a)(this,void 0,void 0,(function*(){yield this.fetchNotes(!0)}))}fetchNotes(e=!1,t=!1){return Object(a.a)(this,void 0,void 0,(function*(){e&&(yield this.syncNotes(t));try{const e=(yield l.a.getNotes(this.courseId,this.userId))[this.type+"notes"]||[];e.forEach((e=>{e.content=y.b.decodeHTML(e.content)})),yield l.a.setOfflineDeletedNotes(e,this.courseId),this.hasOffline=e.some((e=>e.offline||e.deleted)),this.userId?(this.notes=e,this.user=yield f.a.getProfile(this.userId,this.courseId,!0)):this.notes=yield l.a.getNotesUserData(e),this.logView()}catch(e){N.a.showErrorModal(e)}finally{let e=this.notes&&this.notes.length>0;e&&"personal"==this.type&&(e=!!this.notes.find((e=>e.usermodified==this.currentUserId))),this.canDeleteNotes=e,this.notesLoaded=!0,this.refreshIcon=r.a.ICON_REFRESH,this.syncIcon=r.a.ICON_SYNC}}))}refreshNotes(e,t){this.refreshIcon=r.a.ICON_LOADING,this.syncIcon=r.a.ICON_LOADING,l.a.invalidateNotes(this.courseId,this.userId).finally((()=>{this.fetchNotes(!0,e).finally((()=>{t&&(null==t?void 0:t.complete())}))}))}typeChanged(e){return Object(a.a)(this,void 0,void 0,(function*(){this.type=e,this.notesLoaded=!1,this.refreshIcon=r.a.ICON_LOADING,this.syncIcon=r.a.ICON_LOADING,yield this.fetchNotes(!0)}))}addNote(e){return Object(a.a)(this,void 0,void 0,(function*(){e.preventDefault(),e.stopPropagation(),this.logViewAdd();const t=yield N.a.openModal({component:d.a,componentProps:{userId:this.userId,courseId:this.courseId,type:this.type}});void 0!==t&&(t.sent&&t.type?(t.type!=this.type&&(this.type=t.type,this.notesLoaded=!1),this.refreshNotes(!1)):t.type&&t.type!=this.type&&this.typeChanged(t.type))}))}deleteNote(e,t){return Object(a.a)(this,void 0,void 0,(function*(){e.preventDefault(),e.stopPropagation();try{this.logViewDelete(t),yield N.a.showDeleteConfirm("addon.notes.deleteconfirm");try{yield l.a.deleteNote(t,this.courseId),this.showDelete=!1,this.refreshNotes(!1),N.a.showToast("addon.notes.eventnotedeleted",!0,N.c.LONG)}catch(e){N.a.showErrorModalDefault(e,"Delete note failed.")}}catch(e){}}))}undoDeleteNote(e,t){return Object(a.a)(this,void 0,void 0,(function*(){e.preventDefault(),e.stopPropagation(),yield _.a.undoDeleteNote(t.id),this.refreshNotes(!1)}))}toggleDelete(){this.showDelete=!this.showDelete}syncNotes(e){return Object(a.a)(this,void 0,void 0,(function*(){try{const e=yield u.a.syncNotes(this.courseId);this.showSyncWarnings(e.warnings)}catch(t){e&&N.a.showErrorModalDefault(t,"core.errorsync",!0)}}))}showSyncWarnings(e){const t=y.b.buildMessage(e);t&&N.a.showAlert(void 0,t)}performLogView(){return Object(a.a)(this,void 0,void 0,(function*(){yield D.a.ignoreErrors(l.a.logView(this.courseId,this.userId)),g.a.logEvent({type:g.b.VIEW_ITEM_LIST,ws:"core_notes_view_notes",name:L.I.instant("addon.notes.notes"),data:{courseid:this.courseId,userid:this.userId||0,category:"notes"},url:b.a.addParamsToUrl("/notes/index.php",{user:this.userId,course:this.courseId!==I.b.getCurrentSiteHomeId()?this.courseId:void 0})})}))}logViewAdd(){return Object(a.a)(this,void 0,void 0,(function*(){g.a.logEvent({type:g.b.VIEW_ITEM,ws:"core_notes_create_notes",name:L.I.instant("addon.notes.notes"),data:{courseid:this.courseId,userid:this.userId||0,category:"notes"},url:b.a.addParamsToUrl("/notes/edit.php",{courseid:this.courseId,userid:this.userId,publishstate:"personal"===this.type?"draft":"course"===this.type?"public":"site"})})}))}logViewDelete(e){return Object(a.a)(this,void 0,void 0,(function*(){e.id&&g.a.logEvent({type:g.b.VIEW_ITEM,ws:"core_notes_delete_notes",name:L.I.instant("addon.notes.notes"),data:{id:e.id,category:"notes"},url:`/notes/delete.php?id=${e.id}`})}))}ngOnDestroy(){this.syncObserver&&this.syncObserver.off()}}return AddonNotesListPage.ɵfac=function AddonNotesListPage_Factory(e){return new(e||AddonNotesListPage)},AddonNotesListPage.ɵcmp=v.sc({type:AddonNotesListPage,selectors:[["page-addon-notes-list-page"]],viewQuery:function AddonNotesListPage_Query(e,t){var o;(1&e&&v.ud(p.v,!0),2&e)&&(v.dd(o=v.Nc())&&(t.content=o.first))},decls:39,vars:44,consts:[["slot","start"],[3,"text"],["slot","end"],["slot","end","fill","clear",3,"hidden","click"],["name","fas-pen","slot","icon-only","aria-hidden","true"],[3,"hidden","priority","content","iconAction","closeOnClick","action"],[1,"limited-width"],["slot","fixed",3,"disabled","ionRefresh"],[3,"pullingText"],[3,"hideUntil"],["class","ion-text-wrap",4,"ngIf"],[3,"selection","onChange"],["value","site",1,"ion-text-wrap"],["value","course",1,"ion-text-wrap"],["value","personal",1,"ion-text-wrap"],["class","core-warning-card",4,"ngIf"],["icon","fas-receipt",3,"message",4,"ngIf"],[4,"ngIf"],["slot","fixed","core-fab","","vertical","bottom","horizontal","end",4,"ngIf"],[1,"ion-text-wrap"],["slot","start",3,"user","courseId","linkProfile"],[1,"item-heading"],[1,"core-warning-card"],["name","fas-triangle-exclamation","slot","start","aria-hidden","true"],["icon","fas-receipt",3,"message"],[4,"ngFor","ngForOf"],["slot","start",3,"user","courseId",4,"ngIf"],["class","item-heading",4,"ngIf"],["slot","end",4,"ngIf"],["slot","end","fill","clear","color","danger",3,"click",4,"ngIf"],[3,"text","filter"],["slot","start",3,"user","courseId"],["name","fas-clock","aria-hidden","true"],["name","fas-trash","aria-hidden","true"],["slot","end","fill","clear","color","danger",3,"click"],["name","fas-rotate-left","slot","icon-only","aria-hidden","true"],["name","fas-trash","slot","icon-only","aria-hidden","true"],["slot","fixed","core-fab","","vertical","bottom","horizontal","end"],[3,"click"],["name","fas-plus","aria-hidden","true"],[1,"sr-only"]],template:function AddonNotesListPage_Template(e,t){1&e&&(v.Ec(0,"ion-header"),v.Ec(1,"ion-toolbar"),v.Ec(2,"ion-buttons",0),v.zc(3,"ion-back-button",1),v.Pc(4,"translate"),v.Dc(),v.Ec(5,"ion-title"),v.Ec(6,"h1"),v.pd(7),v.Pc(8,"translate"),v.Dc(),v.Dc(),v.zc(9,"ion-buttons",2),v.Dc(),v.Dc(),v.Ec(10,"core-navbar-buttons",2),v.Ec(11,"ion-button",3),v.Mc("click",(function AddonNotesListPage_Template_ion_button_click_11_listener(){return t.toggleDelete()})),v.Pc(12,"translate"),v.zc(13,"ion-icon",4),v.Dc(),v.Ec(14,"core-context-menu"),v.Ec(15,"core-context-menu-item",5),v.Mc("action",(function AddonNotesListPage_Template_core_context_menu_item_action_15_listener(){return t.refreshNotes(!1)})),v.Pc(16,"translate"),v.Dc(),v.Ec(17,"core-context-menu-item",5),v.Mc("action",(function AddonNotesListPage_Template_core_context_menu_item_action_17_listener(){return t.refreshNotes(!0)})),v.Pc(18,"translate"),v.Dc(),v.Dc(),v.Dc(),v.Ec(19,"ion-content",6),v.Ec(20,"ion-refresher",7),v.Mc("ionRefresh",(function AddonNotesListPage_Template_ion_refresher_ionRefresh_20_listener(e){return t.refreshNotes(!1,e.target)})),v.zc(21,"ion-refresher-content",8),v.Pc(22,"translate"),v.Dc(),v.Ec(23,"core-loading",9),v.nd(24,AddonNotesListPage_ion_item_24_Template,5,4,"ion-item",10),v.Ec(25,"core-combobox",11),v.Mc("onChange",(function AddonNotesListPage_Template_core_combobox_onChange_25_listener(e){return t.typeChanged(e)})),v.Ec(26,"ion-select-option",12),v.pd(27),v.Pc(28,"translate"),v.Dc(),v.Ec(29,"ion-select-option",13),v.pd(30),v.Pc(31,"translate"),v.Dc(),v.Ec(32,"ion-select-option",14),v.pd(33),v.Pc(34,"translate"),v.Dc(),v.Dc(),v.nd(35,AddonNotesListPage_ion_card_35_Template,8,10,"ion-card",15),v.nd(36,AddonNotesListPage_core_empty_box_36_Template,2,3,"core-empty-box",16),v.nd(37,AddonNotesListPage_ng_container_37_Template,2,1,"ng-container",17),v.Dc(),v.nd(38,AddonNotesListPage_ion_fab_38_Template,7,6,"ion-fab",18),v.Dc()),2&e&&(v.lc(3),v.Vc("text",v.Qc(4,26,"core.back")),v.lc(4),v.qd(v.Qc(8,28,"addon.notes.notes")),v.lc(4),v.Vc("hidden",!t.canDeleteNotes),v.mc("aria-label",v.Qc(12,30,"core.toggledelete")),v.lc(4),v.Vc("hidden",!(t.notesLoaded&&!t.hasOffline))("priority",100)("content",v.Qc(16,32,"core.refresh"))("iconAction",t.refreshIcon)("closeOnClick",!0),v.lc(2),v.Vc("hidden",!(t.notesLoaded&&t.hasOffline))("priority",100)("content",v.Qc(18,34,"core.settings.synchronizenow"))("iconAction",t.syncIcon)("closeOnClick",!1),v.lc(3),v.Vc("disabled",!t.notesLoaded),v.lc(1),v.Wc("pullingText",v.Qc(22,36,"core.pulltorefresh")),v.lc(2),v.Vc("hideUntil",t.notesLoaded),v.lc(1),v.Vc("ngIf",t.user),v.lc(1),v.Vc("selection",t.type),v.lc(2),v.rd(" ",v.Qc(28,38,"addon.notes.sitenotes")," "),v.lc(3),v.rd(" ",v.Qc(31,40,"addon.notes.coursenotes")," "),v.lc(3),v.rd(" ",v.Qc(34,42,"addon.notes.personalnotes")," "),v.lc(2),v.Vc("ngIf",t.hasOffline),v.lc(1),v.Vc("ngIf",t.notes&&0==t.notes.length),v.lc(1),v.Vc("ngIf",t.notes&&t.notes.length>0),v.lc(1),v.Vc("ngIf",t.userId&&t.notesLoaded))},directives:[p.C,p.Ab,p.m,p.h,p.i,p.yb,E.a,O.a,p.l,p.D,T.a,w.a,V.a,C.a,p.v,p.bb,p.cb,x.a,M.t,k.a,p.mb,p.I,z.a,p.O,p.n,Q.a,M.s,S.a,p.x,G.a,p.y],pipes:[j.d,M.p,U.a],encapsulation:2,data:{animation:[h.a.SLIDE_IN_OUT]}}),AddonNotesListPage})();const R=[{path:"",component:F}];let $=(()=>{class AddonNotesLazyModule{}return AddonNotesLazyModule.ɵmod=v.wc({type:AddonNotesLazyModule}),AddonNotesLazyModule.ɵinj=v.vc({factory:function AddonNotesLazyModule_Factory(e){return new(e||AddonNotesLazyModule)},imports:[[c.m.forChild(R),n.a,s.a,i.a],c.m]}),AddonNotesLazyModule})();void(("undefined"==typeof ngJitMode||ngJitMode)&&v.kd($,{declarations:[F],imports:[c.m,n.a,s.a,i.a],exports:[c.m]}))}}]);