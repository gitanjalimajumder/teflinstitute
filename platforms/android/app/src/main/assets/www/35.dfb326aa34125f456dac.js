(window.webpackJsonp=window.webpackJsonp||[]).push([[35],{Cjie:function(e,t,n){"use strict";n.r(t),n.d(t,"AddonCalendarLazyModule",(function(){return Oe}));var a=n("L3Fv"),i=n("9Xwr"),o=n("mrSG"),c=n("GGba"),r=n("fjkH"),d=n("9+EE"),l=n("3LXp"),s=n("Q98t"),m=n("SmTL"),_=n("Lc7R"),u=n("n6RP"),h=n("+lfu"),v=n("Xzvb"),f=n("ZSwf"),g=n("kLT3"),p=n("f0Wu"),E=n.n(p),b=n("j3ag"),y=n("pHTc"),C=n("bFG1"),D=n("BaYo"),I=n("xQjX"),P=n("MpCO"),O=n("+0Ti"),T=n("baaQ"),A=n("CvRw");class events_source_AddonCalendarEventsSource extends A.a{constructor(e){super(),this.events=[],this.DATE=e}setEvents(e){this.events=e}loadPageItems(){return Object(o.a)(this,void 0,void 0,(function*(){return{items:this.events.slice(0)}}))}getItemPath(e){return e.id.toString()}getItemQueryParams(){return{date:this.DATE}}}var x=n("D7J2"),V=n("mvS9"),w=n("8vmT"),S=n("fXoL"),M=n("TEn/"),N=n("ACYt"),k=n("3CSS"),Q=n("fQ68"),L=n("ofXK"),R=n("8/N+"),z=n("nt/U"),F=n("PgjG"),j=n("r8G5"),q=n("hMzs"),U=n("eAud"),G=n("yNDK"),B=n("sYmb");function AddonCalendarDayPage_core_context_menu_item_14_Template(e,t){if(1&e){const e=S.Fc();S.Ec(0,"core-context-menu-item",20),S.Mc("action",(function AddonCalendarDayPage_core_context_menu_item_14_Template_core_context_menu_item_action_0_listener(){S.fd(e);return S.Oc().goToCurrentDay()})),S.Pc(1,"translate"),S.Dc()}2&e&&S.Vc("priority",900)("content",S.Qc(1,2,"addon.calendar.today"))}const _c0=function(e){return{$a:e}};function AddonCalendarDayPage_ng_template_37_ion_card_1_Template(e,t){1&e&&(S.Ec(0,"ion-card",24),S.Ec(1,"ion-item"),S.zc(2,"ion-icon",25),S.Ec(3,"ion-label"),S.pd(4),S.Pc(5,"translate"),S.Pc(6,"translate"),S.Dc(),S.Dc(),S.Dc()),2&e&&(S.lc(4),S.qd(S.Rc(5,1,"core.hasdatatosync",S.ad(6,_c0,S.Qc(6,4,"core.day")))))}function AddonCalendarDayPage_ng_template_37_core_empty_box_2_Template(e,t){1&e&&(S.zc(0,"core-empty-box",26),S.Pc(1,"translate")),2&e&&S.Vc("message",S.Qc(1,1,"addon.calendar.noevents"))}function AddonCalendarDayPage_ng_template_37_ion_list_3_ng_container_1_core_mod_icon_3_Template(e,t){if(1&e&&S.zc(0,"core-mod-icon",38),2&e){const e=S.Oc().$implicit;S.Vc("modicon",e.moduleIcon)("showAlt",!1)("modname",e.modulename)("componentId",e.instance)("purpose",e.purpose)}}function AddonCalendarDayPage_ng_template_37_ion_list_3_ng_container_1_ion_icon_4_Template(e,t){if(1&e&&S.zc(0,"ion-icon",39),2&e){const e=S.Oc().$implicit;S.Vc("name",e.eventIcon)}}function AddonCalendarDayPage_ng_template_37_ion_list_3_ng_container_1_span_9_Template(e,t){if(1&e&&(S.Ec(0,"span",32),S.pd(1),S.Dc()),2&e){const e=S.Oc().$implicit;S.lc(1),S.qd(e.iconTitle)}}function AddonCalendarDayPage_ng_template_37_ion_list_3_ng_container_1_ion_note_14_Template(e,t){1&e&&(S.Ec(0,"ion-note",2),S.zc(1,"ion-icon",40),S.Ec(2,"span",41),S.pd(3),S.Pc(4,"translate"),S.Dc(),S.Dc()),2&e&&(S.lc(3),S.qd(S.Qc(4,1,"core.notsent")))}function AddonCalendarDayPage_ng_template_37_ion_list_3_ng_container_1_ion_note_15_Template(e,t){1&e&&(S.Ec(0,"ion-note",2),S.zc(1,"ion-icon",42),S.Ec(2,"span",41),S.pd(3),S.Pc(4,"translate"),S.Dc(),S.Dc()),2&e&&(S.lc(3),S.qd(S.Qc(4,1,"core.deletedoffline")))}const _c1=function(e){return[e]};function AddonCalendarDayPage_ng_template_37_ion_list_3_ng_container_1_Template(e,t){if(1&e){const e=S.Fc();S.Cc(0),S.Ec(1,"ion-card"),S.Ec(2,"ion-item",29),S.Mc("click",(function AddonCalendarDayPage_ng_template_37_ion_list_3_ng_container_1_Template_ion_item_click_2_listener(){S.fd(e);const n=t.$implicit,a=S.Oc(2).item;return S.Oc().gotoEvent(n.id,a)})),S.nd(3,AddonCalendarDayPage_ng_template_37_ion_list_3_ng_container_1_core_mod_icon_3_Template,1,5,"core-mod-icon",30),S.nd(4,AddonCalendarDayPage_ng_template_37_ion_list_3_ng_container_1_ion_icon_4_Template,1,1,"ion-icon",31),S.Ec(5,"ion-label"),S.Ec(6,"span",32),S.pd(7),S.Pc(8,"translate"),S.nd(9,AddonCalendarDayPage_ng_template_37_ion_list_3_ng_container_1_span_9_Template,2,1,"span",33),S.Dc(),S.Ec(10,"p",34),S.zc(11,"core-format-text",35),S.Dc(),S.Ec(12,"p"),S.zc(13,"core-format-text",36),S.Dc(),S.Dc(),S.nd(14,AddonCalendarDayPage_ng_template_37_ion_list_3_ng_container_1_ion_note_14_Template,5,3,"ion-note",37),S.nd(15,AddonCalendarDayPage_ng_template_37_ion_list_3_ng_container_1_ion_note_15_Template,5,3,"ion-note",37),S.Dc(),S.Dc(),S.Bc()}if(2&e){const e=t.$implicit;S.lc(2),S.qc("item-dimmed",e.ispast),S.Vc("ngClass",S.ad(18,_c1,"addon-calendar-eventtype-"+e.eventtype))("detail",!1),S.mc("aria-label",e.name),S.lc(1),S.Vc("ngIf",e.moduleIcon),S.lc(1),S.Vc("ngIf",e.eventIcon&&!e.moduleIcon),S.lc(3),S.rd(" ",S.Qc(8,16,"addon.calendar.type"+e.formattedType)," "),S.lc(2),S.Vc("ngIf",e.moduleIcon&&e.iconTitle),S.lc(2),S.Vc("text",e.name)("contextLevel",e.contextLevel)("contextInstanceId",e.contextInstanceId),S.lc(2),S.Vc("text",e.formattedtime)("filter",!1),S.lc(1),S.Vc("ngIf",e.offline&&!e.deleted),S.lc(1),S.Vc("ngIf",e.deleted)}}function AddonCalendarDayPage_ng_template_37_ion_list_3_Template(e,t){if(1&e&&(S.Ec(0,"ion-list",27),S.nd(1,AddonCalendarDayPage_ng_template_37_ion_list_3_ng_container_1_Template,16,20,"ng-container",28),S.Dc()),2&e){const e=S.Oc().item;S.lc(1),S.Vc("ngForOf",e.filteredEvents)}}function AddonCalendarDayPage_ng_template_37_Template(e,t){if(1&e&&(S.Ec(0,"core-loading",9),S.nd(1,AddonCalendarDayPage_ng_template_37_ion_card_1_Template,7,8,"ion-card",21),S.nd(2,AddonCalendarDayPage_ng_template_37_core_empty_box_2_Template,2,3,"core-empty-box",22),S.nd(3,AddonCalendarDayPage_ng_template_37_ion_list_3_Template,2,1,"ion-list",23),S.Dc()),2&e){const e=t.item;S.Vc("hideUntil",e.loaded),S.lc(1),S.Vc("ngIf",e.hasOffline),S.lc(1),S.Vc("ngIf",!e.filteredEvents||!e.filteredEvents.length),S.lc(1),S.Vc("ngIf",e.filteredEvents&&e.filteredEvents.length)}}function AddonCalendarDayPage_ion_fab_38_Template(e,t){if(1&e){const e=S.Fc();S.Ec(0,"ion-fab",43),S.Ec(1,"ion-fab-button",44),S.Mc("click",(function AddonCalendarDayPage_ion_fab_38_Template_ion_fab_button_click_1_listener(){S.fd(e);return S.Oc().openEdit()})),S.Pc(2,"translate"),S.zc(3,"ion-icon",45),S.Ec(4,"span",32),S.pd(5),S.Pc(6,"translate"),S.Dc(),S.Dc(),S.Dc()}2&e&&(S.lc(1),S.mc("aria-label",S.Qc(2,2,"addon.calendar.newevent")),S.lc(4),S.qd(S.Qc(6,4,"addon.calendar.newevent")))}let $=(()=>{class AddonCalendarDayPage{constructor(){this.loaded=!1,this.isOnline=!1,this.syncIcon=D.a.ICON_LOADING,this.filter={filtered:!1,courseId:void 0,categoryId:void 0,course:!0,group:!0,site:!0,user:!0,category:!0},this.currentSiteId=d.b.getCurrentSiteId(),this.newEventObserver=r.b.on(m.c.NEW_EVENT_EVENT,(e=>{var t;e&&e.eventId&&(null===(t=this.manager)||void 0===t?void 0:t.getSource().markAllItemsUnloaded(),this.refreshData(!0,!0))}),this.currentSiteId),this.discardedObserver=r.b.on(m.c.NEW_EVENT_DISCARDED_EVENT,(()=>{var e;null===(e=this.manager)||void 0===e?void 0:e.getSource().markAllItemsUnloaded(),this.refreshData(!0,!0)}),this.currentSiteId),this.editEventObserver=r.b.on(m.c.EDIT_EVENT_EVENT,(e=>{var t;e&&e.eventId&&(null===(t=this.manager)||void 0===t?void 0:t.getSource().markAllItemsUnloaded(),this.refreshData(!0,!0))}),this.currentSiteId),this.syncObserver=r.b.on(h.b.AUTO_SYNCED,(()=>{var e;null===(e=this.manager)||void 0===e?void 0:e.getSource().markAllItemsUnloaded(),this.refreshData(!1,!0)}),this.currentSiteId),this.manualSyncObserver=r.b.on(h.b.MANUAL_SYNCED,(e=>{var t,n;const a=null===(t=this.manager)||void 0===t?void 0:t.getSelectedItem();!e||"day"==e.source&&a&&e.moment&&a.moment.isSame(e.moment,"day")||(null===(n=this.manager)||void 0===n?void 0:n.getSource().markAllItemsUnloaded(),this.refreshData(!1,!0))}),this.currentSiteId),this.deleteEventObserver=r.b.on(m.c.DELETED_EVENT_EVENT,(e=>{var t,n;e&&!e.sent?null===(t=this.manager)||void 0===t?void 0:t.getSource().markAsDeleted(e.eventId,!0):(null===(n=this.manager)||void 0===n?void 0:n.getSource().markAllItemsUnloaded(),this.refreshData(!1,!0))}),this.currentSiteId),this.undeleteEventObserver=r.b.on(m.c.UNDELETED_EVENT_EVENT,(e=>{var t;e&&e.eventId&&(null===(t=this.manager)||void 0===t?void 0:t.getSource().markAsDeleted(e.eventId,!1))}),this.currentSiteId),this.filterChangedObserver=r.b.on(m.c.FILTER_CHANGED_EVENT,(e=>Object(o.a)(this,void 0,void 0,(function*(){var t,n;this.filter=e,yield null===(t=this.manager)||void 0===t?void 0:t.getSource().loadCanCreate(this.filter.courseId),null===(n=this.manager)||void 0===n||n.getSource().filterAllDayEvents(this.filter)})))),this.onlineObserver=c.a.onChange().subscribe((()=>{b.z.run((()=>{this.isOnline=c.a.isOnline()}))})),this.logView=w.a.once((()=>{var e;const t=null===(e=this.manager)||void 0===e?void 0:e.getSelectedItem();if(!t)return;const n={course:this.filter.courseId,time:t.moment.unix()};x.a.logEvent({type:x.b.VIEW_ITEM_LIST,ws:"core_calendar_get_calendar_day_view",name:b.I.instant("addon.calendar.dayviewtitle",{$a:this.periodName}),data:Object.assign(Object.assign({},n),{category:"calendar"}),url:V.a.addParamsToUrl("/calendar/view.php?view=day",n)})}))}ngOnInit(){const e=[];C.a.enumKeys(m.b).forEach((t=>{var n;const a=m.b[t];this.filter[t]=null===(n=y.a.getRouteBooleanParam(t))||void 0===n||n,e.push(a)})),this.filter.courseId=y.a.getRouteNumberParam("courseId"),this.filter.categoryId=y.a.getRouteNumberParam("categoryId"),this.filter.filtered=void 0!==this.filter.courseId||e.some((e=>!this.filter[e]));const t=y.a.getRouteNumberParam("month"),n=new day_AddonCalendarDaySlidesItemsManagerSource(this,E()({year:y.a.getRouteNumberParam("year"),month:t?t-1:void 0,date:y.a.getRouteNumberParam("day")}).startOf("day"));this.manager=new I.a(n),this.managerUnsubscribe=this.manager.addListener({onSelectedItemUpdated:e=>{this.onDayViewed(e)}}),this.fetchData(!0)}get canCreate(){var e;return(null===(e=this.manager)||void 0===e?void 0:e.getSource().canCreate)||!1}get timeFormat(){var e;return(null===(e=this.manager)||void 0===e?void 0:e.getSource().timeFormat)||"core.strftimetime"}fetchData(e){var t,n,a;return Object(o.a)(this,void 0,void 0,(function*(){this.syncIcon=D.a.ICON_LOADING,this.isOnline=c.a.isOnline(),e&&(yield this.sync());try{yield null===(t=this.manager)||void 0===t?void 0:t.getSource().fetchData(this.filter.courseId),yield null===(n=this.manager)||void 0===n?void 0:n.getSource().load(null===(a=this.manager)||void 0===a?void 0:a.getSelectedItem()),this.logView()}catch(e){l.a.showErrorModalDefault(e,"addon.calendar.errorloadevents",!0)}this.loaded=!0,this.syncIcon=D.a.ICON_SYNC}))}onDayViewed(e){this.periodName=s.a.userDate(1e3*e.moment.unix(),"core.strftimedaydate")}doRefresh(e,t){return Object(o.a)(this,void 0,void 0,(function*(){this.loaded&&(yield this.refreshData(!0).finally((()=>{null==e?void 0:e.complete(),t&&t()})))}))}refreshData(e,t){var n,a;return Object(o.a)(this,void 0,void 0,(function*(){this.syncIcon=D.a.ICON_LOADING;const i=(null===(n=this.manager)||void 0===n?void 0:n.getSelectedItem())||null;yield null===(a=this.manager)||void 0===a?void 0:a.getSource().invalidateContent(i,!t),yield this.fetchData(e)}))}sync(e){var t,n;return Object(o.a)(this,void 0,void 0,(function*(){try{const e=yield h.a.syncEvents();if(e.warnings&&e.warnings.length&&l.a.showAlert(void 0,e.warnings[0]),e.updated){const a=null===(t=this.manager)||void 0===t?void 0:t.getSelectedItem();e.source="day",e.moment=null==a?void 0:a.moment,null===(n=this.manager)||void 0===n||n.getSource().markAllItemsUnloaded(),r.b.trigger(h.b.MANUAL_SYNCED,e,this.currentSiteId)}}catch(t){e&&l.a.showErrorModalDefault(t,"core.errorsync",!0)}}))}selectedDayIsCurrent(){var e,t;return!!(null===(t=null===(e=this.manager)||void 0===e?void 0:e.getSelectedItem())||void 0===t?void 0:t.isCurrentDay)}gotoEvent(e,t){y.a.navigateToSitePath(`/calendar/event/${e}`,{params:{date:t.moment.format("MMDDY")}})}openFilter(){var e;return Object(o.a)(this,void 0,void 0,(function*(){yield l.a.openSideModal({component:g.a,componentProps:{courses:null===(e=this.manager)||void 0===e?void 0:e.getSource().courses,filter:this.filter}})}))}openEdit(e){var t;const n={};if(!e){e=0;const a=null===(t=this.manager)||void 0===t?void 0:t.getSelectedItem();if(a){const e=E()();n.timestamp=1e3*a.moment.clone().set({hour:e.hour(),minute:e.minute()}).unix()}}this.filter.courseId&&(n.courseId=this.filter.courseId),y.a.navigateToSitePath(`/calendar/edit/${e}`,{params:n})}selectedDayHasOffline(){var e;const t=null===(e=this.manager)||void 0===e?void 0:e.getSelectedItem();return!!(null==t?void 0:t.hasOffline)}goToCurrentDay(){return Object(o.a)(this,void 0,void 0,(function*(){const e=this.manager,t=this.slides;if(!e||!t)return;const n={moment:E()()};this.loaded=!1;try{yield e.getSource().loadItem(n),t.slideToItem(n)}catch(e){l.a.showErrorModalDefault(e,"addon.calendar.errorloadevents",!0)}finally{this.loaded=!0}}))}loadNext(){var e;return Object(o.a)(this,void 0,void 0,(function*(){null===(e=this.slides)||void 0===e?void 0:e.slideNext()}))}loadPrevious(){var e;return Object(o.a)(this,void 0,void 0,(function*(){null===(e=this.slides)||void 0===e?void 0:e.slidePrev()}))}ngOnDestroy(){var e,t,n,a,i,o,c,r,d,l,s,m;null===(e=this.newEventObserver)||void 0===e?void 0:e.off(),null===(t=this.discardedObserver)||void 0===t||t.off(),null===(n=this.editEventObserver)||void 0===n||n.off(),null===(a=this.deleteEventObserver)||void 0===a||a.off(),null===(i=this.undeleteEventObserver)||void 0===i||i.off(),null===(o=this.syncObserver)||void 0===o||o.off(),null===(c=this.manualSyncObserver)||void 0===c||c.off(),null===(r=this.onlineObserver)||void 0===r||r.unsubscribe(),null===(d=this.filterChangedObserver)||void 0===d||d.off(),null===(l=this.manager)||void 0===l||l.getSource().forgetRelatedSources(),null===(s=this.manager)||void 0===s||s.destroy(),null===(m=this.managerUnsubscribe)||void 0===m||m.call(this),delete this.manager}}return AddonCalendarDayPage.ɵfac=function AddonCalendarDayPage_Factory(e){return new(e||AddonCalendarDayPage)},AddonCalendarDayPage.ɵcmp=S.sc({type:AddonCalendarDayPage,selectors:[["page-addon-calendar-day"]],viewQuery:function AddonCalendarDayPage_Query(e,t){var n;(1&e&&S.ud(P.a,!0),2&e)&&(S.dd(n=S.Nc())&&(t.slides=n.first))},decls:39,vars:31,consts:[["slot","start"],[3,"text"],["slot","end"],["fill","clear",3,"click"],["slot","icon-only","name","fas-filter","aria-hidden","true"],["iconAction","fas-calendar-day",3,"priority","content","action",4,"ngIf"],[3,"hidden","priority","content","iconAction","closeOnClick","action"],["slot","fixed",3,"disabled","ionRefresh"],[3,"pullingText"],[3,"hideUntil"],[1,"core-swipe-slides-container"],[1,"ion-no-padding","safe-area-padding"],[1,"ion-align-items-center"],[1,"ion-text-start"],["name","fas-chevron-left","slot","icon-only","aria-hidden","true"],[1,"ion-text-center","addon-calendar-period"],[1,"ion-text-end"],["name","fas-chevron-right","slot","icon-only","aria-hidden","true"],[3,"manager"],["slot","fixed","core-fab","","vertical","bottom","horizontal","end",4,"ngIf"],["iconAction","fas-calendar-day",3,"priority","content","action"],["class","core-warning-card list-item-limited-width",4,"ngIf"],["icon","fas-calendar",3,"message",4,"ngIf"],["class","list-item-limited-width",4,"ngIf"],[1,"core-warning-card","list-item-limited-width"],["name","fas-triangle-exclamation","slot","start","aria-hidden","true"],["icon","fas-calendar",3,"message"],[1,"list-item-limited-width"],[4,"ngFor","ngForOf"],["button","",1,"addon-calendar-event","ion-text-wrap",3,"ngClass","detail","click"],["slot","start",3,"modicon","showAlt","modname","componentId","purpose",4,"ngIf"],["slot","start","aria-hidden","true",3,"name",4,"ngIf"],[1,"sr-only"],["class","sr-only",4,"ngIf"],[1,"item-heading"],[3,"text","contextLevel","contextInstanceId"],[3,"text","filter"],["slot","end",4,"ngIf"],["slot","start",3,"modicon","showAlt","modname","componentId","purpose"],["slot","start","aria-hidden","true",3,"name"],["name","fas-clock","aria-hidden","true"],[1,"ion-text-wrap"],["name","fas-trash","aria-hidden","true"],["slot","fixed","core-fab","","vertical","bottom","horizontal","end"],[3,"click"],["name","fas-plus","aria-hidden","true"]],template:function AddonCalendarDayPage_Template(e,t){1&e&&(S.Ec(0,"ion-header"),S.Ec(1,"ion-toolbar"),S.Ec(2,"ion-buttons",0),S.zc(3,"ion-back-button",1),S.Pc(4,"translate"),S.Dc(),S.Ec(5,"ion-title"),S.Ec(6,"h1"),S.pd(7),S.Pc(8,"translate"),S.Dc(),S.Dc(),S.Ec(9,"ion-buttons",2),S.Ec(10,"ion-button",3),S.Mc("click",(function AddonCalendarDayPage_Template_ion_button_click_10_listener(){return t.openFilter()})),S.Pc(11,"translate"),S.zc(12,"ion-icon",4),S.Dc(),S.Ec(13,"core-context-menu"),S.nd(14,AddonCalendarDayPage_core_context_menu_item_14_Template,2,4,"core-context-menu-item",5),S.Ec(15,"core-context-menu-item",6),S.Mc("action",(function AddonCalendarDayPage_Template_core_context_menu_item_action_15_listener(e){return t.doRefresh(void 0,e)})),S.Pc(16,"translate"),S.Dc(),S.Dc(),S.Dc(),S.Dc(),S.Dc(),S.Ec(17,"ion-content"),S.Ec(18,"ion-refresher",7),S.Mc("ionRefresh",(function AddonCalendarDayPage_Template_ion_refresher_ionRefresh_18_listener(e){return t.doRefresh(e.target)})),S.zc(19,"ion-refresher-content",8),S.Pc(20,"translate"),S.Dc(),S.Ec(21,"core-loading",9),S.Ec(22,"div",10),S.Ec(23,"ion-grid",11),S.Ec(24,"ion-row",12),S.Ec(25,"ion-col",13),S.Ec(26,"ion-button",3),S.Mc("click",(function AddonCalendarDayPage_Template_ion_button_click_26_listener(){return t.loadPrevious()})),S.Pc(27,"translate"),S.zc(28,"ion-icon",14),S.Dc(),S.Dc(),S.Ec(29,"ion-col",15),S.Ec(30,"h2"),S.pd(31),S.Dc(),S.Dc(),S.Ec(32,"ion-col",16),S.Ec(33,"ion-button",3),S.Mc("click",(function AddonCalendarDayPage_Template_ion_button_click_33_listener(){return t.loadNext()})),S.Pc(34,"translate"),S.zc(35,"ion-icon",17),S.Dc(),S.Dc(),S.Dc(),S.Dc(),S.Ec(36,"core-swipe-slides",18),S.nd(37,AddonCalendarDayPage_ng_template_37_Template,4,4,"ng-template"),S.Dc(),S.Dc(),S.Dc(),S.nd(38,AddonCalendarDayPage_ion_fab_38_Template,7,6,"ion-fab",19),S.Dc()),2&e&&(S.lc(3),S.Vc("text",S.Qc(4,17,"core.back")),S.lc(4),S.qd(S.Qc(8,19,"addon.calendar.calendarevents")),S.lc(3),S.mc("aria-label",S.Qc(11,21,"core.filter")),S.lc(4),S.Vc("ngIf",!t.selectedDayIsCurrent()),S.lc(1),S.Vc("hidden",!t.loaded||!t.selectedDayHasOffline()||!t.isOnline)("priority",400)("content",S.Qc(16,23,"core.settings.synchronizenow"))("iconAction",t.syncIcon)("closeOnClick",!1),S.lc(3),S.Vc("disabled",!t.loaded),S.lc(1),S.Wc("pullingText",S.Qc(20,25,"core.pulltorefresh")),S.lc(2),S.Vc("hideUntil",t.loaded),S.lc(5),S.mc("aria-label",S.Qc(27,27,"addon.calendar.dayprev")),S.lc(5),S.qd(t.periodName),S.lc(2),S.mc("aria-label",S.Qc(34,29,"addon.calendar.daynext")),S.lc(3),S.Vc("manager",t.manager),S.lc(2),S.Vc("ngIf",t.canCreate&&t.loaded))},directives:[M.C,M.Ab,M.m,M.h,M.i,M.yb,N.a,M.l,M.D,k.a,Q.a,L.t,R.a,z.a,M.v,M.bb,M.cb,F.a,M.B,M.hb,M.u,P.a,M.n,M.I,M.O,j.a,M.P,L.s,L.q,q.a,U.a,M.W,M.x,G.a,M.y],pipes:[B.d],styles:["[_nghost-%COMP%]{--addon-calendar-blank-day-background-color:var(--light)}[_nghost-%COMP%]   .item.addon-calendar-event[_ngcontent-%COMP%] > ion-icon[_ngcontent-%COMP%]{color:#fff;border-radius:50%;padding:.7rem;--margin-vertical:12px;--margin-end:12px;margin-top:var(--margin-vertical);margin-bottom:var(--margin-vertical);margin-right:var(--margin-end)}@supports ((-webkit-margin-start:0) or (margin-inline-start:0)) or (-webkit-margin-start:0){[_nghost-%COMP%]   .item.addon-calendar-event[_ngcontent-%COMP%] > ion-icon[_ngcontent-%COMP%]{margin-right:unset;-webkit-margin-end:var(--margin-end);margin-inline-end:var(--margin-end)}}[_nghost-%COMP%]   .item.addon-calendar-event.addon-calendar-eventtype-category[_ngcontent-%COMP%] > ion-icon[_ngcontent-%COMP%]{background-color:#8e24aa}[_nghost-%COMP%]   .item.addon-calendar-event.addon-calendar-eventtype-course[_ngcontent-%COMP%] > ion-icon[_ngcontent-%COMP%]{background-color:#ca3120}[_nghost-%COMP%]   .item.addon-calendar-event.addon-calendar-eventtype-group[_ngcontent-%COMP%] > ion-icon[_ngcontent-%COMP%]{background-color:#f0ad4e}[_nghost-%COMP%]   .item.addon-calendar-event.addon-calendar-eventtype-user[_ngcontent-%COMP%] > ion-icon[_ngcontent-%COMP%]{background-color:#0f6cbf}[_nghost-%COMP%]   .item.addon-calendar-event.addon-calendar-eventtype-site[_ngcontent-%COMP%] > ion-icon[_ngcontent-%COMP%]{background-color:#357a32}","[_nghost-%COMP%]   .core-swipe-slides-container[_ngcontent-%COMP%]   ion-grid[_ngcontent-%COMP%]{flex:none;width:100%}[_nghost-%COMP%]   .addon-calendar-period[_ngcontent-%COMP%]{flex-grow:3}[_nghost-%COMP%]   .addon-calendar-period[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{margin-top:10px;font-size:1.2rem}"]}),AddonCalendarDayPage})();class day_AddonCalendarDaySlidesItemsManagerSource extends O.a{constructor(e,t){super({moment:t}),this.courses=[],this.eventsSources=new Set,this.offlineEvents={},this.offlineEditedEventsIds=[],this.canCreate=!1,this.sendLog=!0,this.dayPage=e}fetchData(e){return Object(o.a)(this,void 0,void 0,(function*(){yield Promise.all([this.loadCourses(e),this.loadCanCreate(e),this.loadCategories(),this.loadOfflineEvents(),this.loadOfflineDeletedEvents(),this.loadTimeFormat()])}))}filterAllDayEvents(e){var t;null===(t=this.getItems())||void 0===t?void 0:t.forEach((t=>this.filterEvents(t,e)))}filterEvents(e,t){e.filteredEvents=u.b.getFilteredEvents(e.events||[],t,this.categories||{}),this.rememberEventsList(e)}loadCourses(e){return Object(o.a)(this,void 0,void 0,(function*(){const t=yield f.b.getCoursesForPopover(e);this.courses=t.courses}))}loadCanCreate(e){return Object(o.a)(this,void 0,void 0,(function*(){this.canCreate=yield u.b.canEditEvents(e)}))}loadCategories(){return Object(o.a)(this,void 0,void 0,(function*(){if(!this.categories)try{const e=yield v.a.getCategories(0,!0);this.categories=C.a.arrayToObject(e,"id")}catch(e){}}))}loadOfflineEvents(){return Object(o.a)(this,void 0,void 0,(function*(){const e=yield _.a.getAllEditedEvents();this.offlineEvents=u.b.classifyIntoMonths(e),this.offlineEditedEventsIds=e.filter((e=>e.id>0)).map((e=>e.id))}))}loadOfflineDeletedEvents(){return Object(o.a)(this,void 0,void 0,(function*(){const e=yield _.a.getAllDeletedEventsIds();this.deletedEvents=new Set(e)}))}loadTimeFormat(){return Object(o.a)(this,void 0,void 0,(function*(){this.timeFormat=yield m.a.getCalendarTimeFormat()}))}getItemId(e){return u.b.getDayId(e.moment)}getPreviousItem(e){return{moment:e.moment.clone().subtract(1,"day")}}getNextItem(e){return{moment:e.moment.clone().add(1,"day")}}loadItemData(e,t=!1){return Object(o.a)(this,void 0,void 0,(function*(){const n=Object.assign(Object.assign({},e),{hasOffline:!1,events:[],onlineEvents:[],filteredEvents:[],isCurrentDay:e.moment.isSame(E()(),"day"),isPastDay:e.moment.isBefore(E()(),"day")});if(t)return n;let a;try{a=yield m.a.getDayEvents(e.moment.year(),e.moment.month()+1,e.moment.date()),n.onlineEvents=yield Promise.all(a.events.map((e=>u.b.formatEventData(e))))}catch(e){if(c.a.isOnline())throw e}n.events=this.mergeEvents(n),this.filterEvents(n,this.dayPage.filter);const i=1e3*e.moment.unix(),r=s.a.timestamp(),d=n.events.map((e=>Object(o.a)(this,void 0,void 0,(function*(){e.ispast=n.isPastDay||n.isCurrentDay&&this.isEventPast(e,r),e.formattedtime=yield m.a.formatEventTime(e,this.dayPage.timeFormat,!0,i)}))));return yield Promise.all(d),n}))}isEventPast(e,t){return e.timestart+e.timeduration<t}mergeEvents(e){var t,n,a;if(e.hasOffline=!1,!Object.keys(this.offlineEvents).length&&!(null===(t=this.deletedEvents)||void 0===t?void 0:t.size))return e.onlineEvents||[];const i=this.offlineEvents[u.b.getMonthId(e.moment)],o=i&&i[e.moment.date()];let c=e.onlineEvents||[];return(null===(n=this.deletedEvents)||void 0===n?void 0:n.size)&&c.forEach((t=>{var n;t.deleted=null===(n=this.deletedEvents)||void 0===n?void 0:n.has(t.id),t.deleted&&(e.hasOffline=!0)})),this.offlineEditedEventsIds.length&&(c=c.filter((e=>-1==this.offlineEditedEventsIds.indexOf(e.id))),c.length!=(null===(a=e.onlineEvents)||void 0===a?void 0:a.length)&&(e.hasOffline=!0)),o&&o.length&&(e.hasOffline=!0,c=u.b.sortEvents(c.concat(o))),c}invalidateContent(e,t){return Object(o.a)(this,void 0,void 0,(function*(){const n=[];t&&e&&n.push(m.a.invalidateDayEvents(e.moment.year(),e.moment.month()+1,e.moment.date())),n.push(m.a.invalidateAllowedEventTypes()),n.push(v.a.invalidateCategories(0,!0)),n.push(m.a.invalidateTimeFormat()),this.categories=void 0,this.sendLog=!0,e&&(e.dirty=!0),yield Promise.all(n)}))}markAsDeleted(e,t){var n,a,i;null===(n=this.getItems())||void 0===n?void 0:n.some((n=>{var a,i,o,c;const r=null===(a=n.onlineEvents)||void 0===a?void 0:a.find((t=>t.id==e));return!!r&&(r.deleted=t,n.hasOffline=!!t||((null===(i=n.events)||void 0===i?void 0:i.length)!=(null===(o=n.onlineEvents)||void 0===o?void 0:o.length)||(null===(c=n.events)||void 0===c?void 0:c.some((e=>e.deleted||e.offline)))),!0)})),t?null===(a=this.deletedEvents)||void 0===a||a.add(e):null===(i=this.deletedEvents)||void 0===i||i.delete(e)}forgetRelatedSources(){for(const e of this.eventsSources)T.a.removeReference(e,this)}rememberEventsList(e){var t;return Object(o.a)(this,void 0,void 0,(function*(){const n=T.a.getOrCreateSource(events_source_AddonCalendarEventsSource,[e.moment.format("MMDDY")]);this.eventsSources.has(n)||(this.eventsSources.add(n),T.a.addReference(n,this)),n.setEvents(null!==(t=e.filteredEvents)&&void 0!==t?t:[]),yield n.reload()}))}}var Y=n("3Pt+"),H=n("mWdr"),W=n("uT8i"),J=n("N5Lt"),X=n("D2MD"),K=n("93ts"),Z=n("4reR"),ee=n("Pwmz"),te=n("9Pp1"),ne=n("nvXB"),ae=n("FasJ"),ie=n("FTxb"),oe=n("3jOR");const ce=["editEventForm"];function AddonCalendarEditEventPage_form_14_p_23_Template(e,t){if(1&e&&(S.Ec(0,"p",28),S.pd(1),S.Pc(2,"translate"),S.Dc()),2&e){const e=S.Oc(2);S.lc(1),S.qd(S.Qc(2,1,e.eventTypes[0].name))}}function AddonCalendarEditEventPage_form_14_ion_select_24_ion_select_option_3_Template(e,t){if(1&e&&(S.Ec(0,"ion-select-option",31),S.pd(1),S.Pc(2,"translate"),S.Dc()),2&e){const e=t.$implicit;S.Vc("value",e.value),S.lc(1),S.rd(" ",S.Qc(2,2,e.name)," ")}}const edit_event_c1=function(e){return{header:e}};function AddonCalendarEditEventPage_form_14_ion_select_24_Template(e,t){if(1&e&&(S.Ec(0,"ion-select",29),S.Pc(1,"translate"),S.Pc(2,"translate"),S.nd(3,AddonCalendarEditEventPage_form_14_ion_select_24_ion_select_option_3_Template,3,4,"ion-select-option",30),S.Dc()),2&e){const e=S.Oc(2);S.Vc("cancelText",S.Qc(1,3,"core.cancel"))("interfaceOptions",S.ad(7,edit_event_c1,S.Qc(2,5,"addon.calendar.eventkind"))),S.lc(3),S.Vc("ngForOf",e.eventTypes)}}function AddonCalendarEditEventPage_form_14_ion_item_25_ion_select_option_9_Template(e,t){if(1&e&&(S.Ec(0,"ion-select-option",31),S.pd(1),S.Dc()),2&e){const e=t.$implicit;S.Vc("value",e.id),S.lc(1),S.rd(" ",e.name," ")}}function AddonCalendarEditEventPage_form_14_ion_item_25_Template(e,t){if(1&e&&(S.Ec(0,"ion-item",9),S.Ec(1,"ion-label"),S.Ec(2,"p",11),S.pd(3),S.Pc(4,"translate"),S.Dc(),S.Dc(),S.Ec(5,"ion-select",32),S.Pc(6,"translate"),S.Pc(7,"translate"),S.Pc(8,"translate"),S.nd(9,AddonCalendarEditEventPage_form_14_ion_item_25_ion_select_option_9_Template,2,2,"ion-select-option",30),S.Dc(),S.Dc()),2&e){const e=S.Oc(2);S.lc(2),S.Vc("core-mark-required",!0),S.lc(1),S.qd(S.Qc(4,6,"core.category")),S.lc(2),S.Vc("placeholder",S.Qc(6,8,"core.noselection"))("cancelText",S.Qc(7,10,"core.cancel"))("interfaceOptions",S.ad(14,edit_event_c1,S.Qc(8,12,"core.category"))),S.lc(4),S.Vc("ngForOf",e.categories)}}function AddonCalendarEditEventPage_form_14_ion_item_26_ion_select_option_9_Template(e,t){if(1&e&&(S.Ec(0,"ion-select-option",31),S.pd(1),S.Dc()),2&e){const e=t.$implicit;S.Vc("value",e.id),S.lc(1),S.qd(e.fullname)}}function AddonCalendarEditEventPage_form_14_ion_item_26_Template(e,t){if(1&e&&(S.Ec(0,"ion-item",9),S.Ec(1,"ion-label"),S.Ec(2,"p",11),S.pd(3),S.Pc(4,"translate"),S.Dc(),S.Dc(),S.Ec(5,"ion-select",33),S.Pc(6,"translate"),S.Pc(7,"translate"),S.Pc(8,"translate"),S.nd(9,AddonCalendarEditEventPage_form_14_ion_item_26_ion_select_option_9_Template,2,2,"ion-select-option",30),S.Dc(),S.Dc()),2&e){const e=S.Oc(2);S.lc(2),S.Vc("core-mark-required",!0),S.lc(1),S.qd(S.Qc(4,6,"core.course")),S.lc(2),S.Vc("placeholder",S.Qc(6,8,"core.noselection"))("cancelText",S.Qc(7,10,"core.cancel"))("interfaceOptions",S.ad(14,edit_event_c1,S.Qc(8,12,"core.course"))),S.lc(4),S.Vc("ngForOf",e.courses)}}function AddonCalendarEditEventPage_form_14_ng_container_27_ion_select_option_10_Template(e,t){if(1&e&&(S.Ec(0,"ion-select-option",31),S.pd(1),S.Dc()),2&e){const e=t.$implicit;S.Vc("value",e.id),S.lc(1),S.rd(" ",e.fullname," ")}}function AddonCalendarEditEventPage_form_14_ng_container_27_ion_item_11_Template(e,t){1&e&&(S.Ec(0,"ion-item",37),S.Ec(1,"ion-label"),S.Ec(2,"p"),S.pd(3),S.Pc(4,"translate"),S.Dc(),S.Dc(),S.Dc()),2&e&&(S.lc(3),S.qd(S.Qc(4,1,"core.coursenogroups")))}function AddonCalendarEditEventPage_form_14_ng_container_27_ion_item_12_ion_select_option_9_Template(e,t){if(1&e&&(S.Ec(0,"ion-select-option",31),S.pd(1),S.Dc()),2&e){const e=t.$implicit;S.Vc("value",e.id),S.lc(1),S.qd(e.name)}}function AddonCalendarEditEventPage_form_14_ng_container_27_ion_item_12_Template(e,t){if(1&e&&(S.Ec(0,"ion-item",38),S.Ec(1,"ion-label"),S.Ec(2,"p",11),S.pd(3),S.Pc(4,"translate"),S.Dc(),S.Dc(),S.Ec(5,"ion-select",39),S.Pc(6,"translate"),S.Pc(7,"translate"),S.Pc(8,"translate"),S.nd(9,AddonCalendarEditEventPage_form_14_ng_container_27_ion_item_12_ion_select_option_9_Template,2,2,"ion-select-option",30),S.Dc(),S.Dc()),2&e){const e=S.Oc(3);S.lc(2),S.Vc("core-mark-required",!0),S.lc(1),S.qd(S.Qc(4,6,"core.group")),S.lc(2),S.Vc("placeholder",S.Qc(6,8,"core.noselection"))("cancelText",S.Qc(7,10,"core.cancel"))("interfaceOptions",S.ad(14,edit_event_c1,S.Qc(8,12,"core.group"))),S.lc(4),S.Vc("ngForOf",e.groups)}}function AddonCalendarEditEventPage_form_14_ng_container_27_ion_item_13_ion_spinner_2_Template(e,t){1&e&&(S.zc(0,"ion-spinner"),S.Pc(1,"translate")),2&e&&S.mc("aria-label",S.Qc(1,1,"core.loading"))}function AddonCalendarEditEventPage_form_14_ng_container_27_ion_item_13_Template(e,t){if(1&e&&(S.Ec(0,"ion-item",9),S.Ec(1,"ion-label"),S.nd(2,AddonCalendarEditEventPage_form_14_ng_container_27_ion_item_13_ion_spinner_2_Template,2,3,"ion-spinner",19),S.Dc(),S.Dc()),2&e){const e=S.Oc(3);S.lc(2),S.Vc("ngIf",e.loadingGroups)}}function AddonCalendarEditEventPage_form_14_ng_container_27_Template(e,t){if(1&e){const e=S.Fc();S.Cc(0),S.Ec(1,"ion-item",9),S.Ec(2,"ion-label"),S.Ec(3,"p",11),S.pd(4),S.Pc(5,"translate"),S.Dc(),S.Dc(),S.Ec(6,"ion-select",34),S.Mc("ionChange",(function AddonCalendarEditEventPage_form_14_ng_container_27_Template_ion_select_ionChange_6_listener(){S.fd(e);return S.Oc(2).groupCourseSelected()})),S.Pc(7,"translate"),S.Pc(8,"translate"),S.Pc(9,"translate"),S.nd(10,AddonCalendarEditEventPage_form_14_ng_container_27_ion_select_option_10_Template,2,2,"ion-select-option",30),S.Dc(),S.Dc(),S.nd(11,AddonCalendarEditEventPage_form_14_ng_container_27_ion_item_11_Template,5,3,"ion-item",35),S.nd(12,AddonCalendarEditEventPage_form_14_ng_container_27_ion_item_12_Template,10,16,"ion-item",36),S.nd(13,AddonCalendarEditEventPage_form_14_ng_container_27_ion_item_13_Template,3,1,"ion-item",18),S.Bc()}if(2&e){const e=S.Oc(2);S.lc(3),S.Vc("core-mark-required",!0),S.lc(1),S.qd(S.Qc(5,9,"core.course")),S.lc(2),S.Vc("placeholder",S.Qc(7,11,"core.noselection"))("cancelText",S.Qc(8,13,"core.cancel"))("interfaceOptions",S.ad(17,edit_event_c1,S.Qc(9,15,"core.course"))),S.lc(4),S.Vc("ngForOf",e.courses),S.lc(1),S.Vc("ngIf",!e.loadingGroups&&e.courseGroupSet&&!e.groups.length),S.lc(1),S.Vc("ngIf",!e.loadingGroups&&e.groups.length>0),S.lc(1),S.Vc("ngIf",e.loadingGroups)}}function AddonCalendarEditEventPage_form_14_ng_container_28_ion_item_9_Template(e,t){if(1&e){const e=S.Fc();S.Ec(0,"ion-item",9),S.Ec(1,"ion-label"),S.Ec(2,"p"),S.pd(3),S.Dc(),S.Dc(),S.Ec(4,"ion-button",41),S.Mc("click",(function AddonCalendarEditEventPage_form_14_ng_container_28_ion_item_9_Template_ion_button_click_4_listener(){S.fd(e);const n=t.$implicit;return S.Oc(3).removeReminder(n)})),S.Pc(5,"translate"),S.zc(6,"ion-icon",44),S.Dc(),S.Dc()}if(2&e){const e=t.$implicit;S.lc(3),S.qd(e.label),S.lc(1),S.mc("aria-label",S.Qc(5,2,"core.delete"))}}function AddonCalendarEditEventPage_form_14_ng_container_28_Template(e,t){if(1&e){const e=S.Fc();S.Cc(0),S.Ec(1,"ion-item-divider",40),S.Ec(2,"ion-label"),S.Ec(3,"p",23),S.pd(4),S.Pc(5,"translate"),S.Dc(),S.Dc(),S.Ec(6,"ion-button",41),S.Mc("click",(function AddonCalendarEditEventPage_form_14_ng_container_28_Template_ion_button_click_6_listener(){S.fd(e);return S.Oc(2).addReminder()})),S.Pc(7,"translate"),S.zc(8,"ion-icon",42),S.Dc(),S.Dc(),S.nd(9,AddonCalendarEditEventPage_form_14_ng_container_28_ion_item_9_Template,7,4,"ion-item",43),S.Bc()}if(2&e){const e=S.Oc(2);S.lc(4),S.qd(S.Qc(5,3,"addon.calendar.reminders")),S.lc(2),S.mc("aria-label",S.Qc(7,5,"addon.calendar.setnewreminder")),S.lc(3),S.Vc("ngForOf",e.reminders)}}function AddonCalendarEditEventPage_form_14_ion_item_48_Template(e,t){if(1&e&&(S.Ec(0,"ion-item"),S.zc(1,"ion-label",10),S.zc(2,"ion-datetime",45),S.Pc(3,"translate"),S.Dc()),2&e){const e=S.Oc(2);S.lc(2),S.Vc("max",e.maxDate)("min",e.minDate)("placeholder",S.Qc(3,5,"addon.calendar.durationuntil"))("displayFormat",e.dateFormat)("displayTimezone",e.displayTimezone)}}function AddonCalendarEditEventPage_form_14_ion_item_55_Template(e,t){1&e&&(S.Ec(0,"ion-item"),S.Ec(1,"ion-label",46),S.pd(2),S.Pc(3,"translate"),S.Dc(),S.zc(4,"ion-input",47),S.Pc(5,"translate"),S.Dc()),2&e&&(S.lc(2),S.qd(S.Qc(3,2,"addon.calendar.durationminutes")),S.lc(2),S.Vc("placeholder",S.Qc(5,4,"addon.calendar.durationminutes")))}function AddonCalendarEditEventPage_form_14_ng_container_56_Template(e,t){if(1&e&&(S.Cc(0),S.Ec(1,"ion-item",48),S.Ec(2,"ion-label"),S.Ec(3,"p",23),S.pd(4),S.Pc(5,"translate"),S.Dc(),S.Dc(),S.zc(6,"ion-checkbox",49),S.Dc(),S.Ec(7,"ion-item",9),S.Ec(8,"ion-label",10),S.Ec(9,"p",23),S.pd(10),S.Pc(11,"translate"),S.Dc(),S.Dc(),S.zc(12,"ion-input",50),S.Dc(),S.Bc()),2&e){const e=S.Oc(2);S.lc(4),S.qd(S.Qc(5,3,"addon.calendar.repeatevent")),S.lc(6),S.qd(S.Qc(11,5,"addon.calendar.repeatweeksl")),S.lc(2),S.Vc("disabled",!e.form.controls.repeat.value)}}const _c2=function(e){return{$a:e}};function AddonCalendarEditEventPage_form_14_div_57_Template(e,t){if(1&e&&(S.Ec(0,"div",20),S.Ec(1,"ion-radio-group",51),S.Ec(2,"ion-item-divider",22),S.Ec(3,"ion-label"),S.Ec(4,"p",23),S.pd(5),S.Pc(6,"translate"),S.Dc(),S.Dc(),S.Dc(),S.Ec(7,"ion-item"),S.Ec(8,"ion-label"),S.Ec(9,"p"),S.pd(10),S.Pc(11,"translate"),S.Dc(),S.Dc(),S.zc(12,"ion-radio",52),S.Dc(),S.Ec(13,"ion-item"),S.Ec(14,"ion-label"),S.Ec(15,"p"),S.pd(16),S.Pc(17,"translate"),S.Dc(),S.Dc(),S.zc(18,"ion-radio",53),S.Dc(),S.Dc(),S.Dc()),2&e){const e=S.Oc(2);S.lc(5),S.qd(S.Qc(6,3,"addon.calendar.repeatedevents")),S.lc(5),S.qd(S.Rc(11,5,"addon.calendar.repeateditall",S.ad(10,_c2,e.otherEventsCount))),S.lc(6),S.qd(S.Qc(17,8,"addon.calendar.repeateditthis"))}}function AddonCalendarEditEventPage_form_14_Template(e,t){if(1&e&&(S.Ec(0,"form",7,8),S.Ec(2,"ion-item",9),S.Ec(3,"ion-label",10),S.Ec(4,"p",11),S.pd(5),S.Pc(6,"translate"),S.Dc(),S.Dc(),S.zc(7,"ion-input",12),S.Pc(8,"translate"),S.zc(9,"core-input-errors",13),S.Dc(),S.Ec(10,"ion-item",9),S.Ec(11,"ion-label",10),S.Ec(12,"p",11),S.pd(13),S.Pc(14,"translate"),S.Dc(),S.Dc(),S.zc(15,"ion-datetime",14),S.Pc(16,"translate"),S.zc(17,"core-input-errors",13),S.Dc(),S.Ec(18,"ion-item",15),S.Ec(19,"ion-label"),S.Ec(20,"p",11),S.pd(21),S.Pc(22,"translate"),S.Dc(),S.Dc(),S.nd(23,AddonCalendarEditEventPage_form_14_p_23_Template,3,3,"p",16),S.nd(24,AddonCalendarEditEventPage_form_14_ion_select_24_Template,4,9,"ion-select",17),S.Dc(),S.nd(25,AddonCalendarEditEventPage_form_14_ion_item_25_Template,10,16,"ion-item",18),S.nd(26,AddonCalendarEditEventPage_form_14_ion_item_26_Template,10,16,"ion-item",18),S.nd(27,AddonCalendarEditEventPage_form_14_ng_container_27_Template,14,19,"ng-container",19),S.nd(28,AddonCalendarEditEventPage_form_14_ng_container_28_Template,10,7,"ng-container",19),S.Ec(29,"div",20),S.Ec(30,"ion-radio-group",21),S.Ec(31,"ion-item-divider",22),S.Ec(32,"ion-label"),S.Ec(33,"p",23),S.pd(34),S.Pc(35,"translate"),S.Dc(),S.Dc(),S.Dc(),S.Ec(36,"ion-item"),S.Ec(37,"ion-label"),S.Ec(38,"p"),S.pd(39),S.Pc(40,"translate"),S.Dc(),S.Dc(),S.zc(41,"ion-radio",24),S.Dc(),S.Ec(42,"ion-item"),S.Ec(43,"ion-label"),S.Ec(44,"p"),S.pd(45),S.Pc(46,"translate"),S.Dc(),S.Dc(),S.zc(47,"ion-radio",24),S.Dc(),S.nd(48,AddonCalendarEditEventPage_form_14_ion_item_48_Template,4,7,"ion-item",19),S.Ec(49,"ion-item"),S.Ec(50,"ion-label"),S.Ec(51,"p"),S.pd(52),S.Pc(53,"translate"),S.Dc(),S.Dc(),S.zc(54,"ion-radio",24),S.Dc(),S.nd(55,AddonCalendarEditEventPage_form_14_ion_item_55_Template,6,6,"ion-item",19),S.Dc(),S.Dc(),S.nd(56,AddonCalendarEditEventPage_form_14_ng_container_56_Template,13,7,"ng-container",19),S.nd(57,AddonCalendarEditEventPage_form_14_div_57_Template,19,12,"div",25),S.Ec(58,"ion-item",9),S.Ec(59,"ion-label",10),S.Ec(60,"p",23),S.pd(61),S.Pc(62,"translate"),S.Dc(),S.Dc(),S.zc(63,"core-rich-text-editor",26),S.Pc(64,"translate"),S.Pc(65,"translate"),S.Dc(),S.Ec(66,"ion-item",9),S.Ec(67,"ion-label",10),S.Ec(68,"p",23),S.pd(69),S.Pc(70,"translate"),S.Dc(),S.Dc(),S.zc(71,"ion-input",27),S.Pc(72,"translate"),S.Dc(),S.Dc()),2&e){const e=S.Oc();S.Vc("formGroup",e.form),S.lc(4),S.Vc("core-mark-required",!0),S.lc(1),S.qd(S.Qc(6,43,"addon.calendar.eventname")),S.lc(2),S.Vc("placeholder",S.Qc(8,45,"addon.calendar.eventname")),S.lc(2),S.Vc("control",e.form.controls.name)("errorMessages",e.errors),S.lc(3),S.Vc("core-mark-required",!0),S.lc(1),S.qd(S.Qc(14,47,"core.date")),S.lc(2),S.Vc("placeholder",S.Qc(16,49,"core.date"))("displayFormat",e.dateFormat)("max",e.maxDate)("min",e.minDate)("displayTimezone",e.displayTimezone),S.lc(2),S.Vc("control",e.form.controls.timestart)("errorMessages",e.errors),S.lc(3),S.Vc("core-mark-required",!0),S.lc(1),S.qd(S.Qc(22,51,"addon.calendar.eventkind")),S.lc(2),S.Vc("ngIf",1==e.eventTypes.length),S.lc(1),S.Vc("ngIf",e.eventTypes.length>1),S.lc(1),S.Vc("ngIf","category"==e.typeControl.value),S.lc(1),S.Vc("ngIf","course"==e.typeControl.value),S.lc(1),S.Vc("ngIf","group"==e.typeControl.value),S.lc(1),S.Vc("ngIf",e.remindersEnabled&&!e.eventId),S.lc(6),S.qd(S.Qc(35,53,"addon.calendar.eventduration")),S.lc(5),S.qd(S.Qc(40,55,"addon.calendar.durationnone")),S.lc(2),S.Vc("value",0),S.lc(4),S.qd(S.Qc(46,57,"addon.calendar.durationuntil")),S.lc(2),S.Vc("value",1),S.lc(1),S.Vc("ngIf",1===e.form.controls.duration.value),S.lc(4),S.qd(S.Qc(53,59,"addon.calendar.durationminutes")),S.lc(2),S.Vc("value",2),S.lc(1),S.Vc("ngIf",2===e.form.controls.duration.value),S.lc(1),S.Vc("ngIf",!e.eventId||e.eventId<0),S.lc(1),S.Vc("ngIf",e.eventRepeatId),S.lc(4),S.qd(S.Qc(62,61,"core.description")),S.lc(2),S.Vc("control",e.descriptionControl)("placeholder",S.Qc(65,65,"core.description"))("component",e.component)("componentId",e.eventId)("autoSave",!1),S.mc("aria-label",S.Qc(64,63,"core.description")),S.lc(6),S.qd(S.Qc(70,67,"core.location")),S.lc(2),S.Vc("placeholder",S.Qc(72,69,"core.location"))}}function AddonCalendarEditEventPage_div_15_Template(e,t){if(1&e){const e=S.Fc();S.Ec(0,"div",54),S.Ec(1,"div",55),S.Ec(2,"ion-button",56),S.Mc("click",(function AddonCalendarEditEventPage_div_15_Template_ion_button_click_2_listener(){S.fd(e);return S.Oc().submit()})),S.pd(3),S.Pc(4,"translate"),S.Dc(),S.Dc(),S.Dc()}if(2&e){const e=S.Oc();S.lc(2),S.Vc("disabled",!e.form.valid),S.lc(1),S.rd(" ",S.Qc(4,2,"core.save")," ")}}let re=(()=>{class AddonCalendarEditEventPage{constructor(e){this.fb=e,this.title="addon.calendar.newevent",this.component=m.c.COMPONENT,this.loaded=!1,this.hasOffline=!1,this.eventTypes=[],this.categories=[],this.courses=[],this.groups=[],this.loadingGroups=!1,this.courseGroupSet=!1,this.error=!1,this.otherEventsCount=0,this.remindersEnabled=!1,this.reminders=[],this.types={},this.showAll=!1,this.isDestroyed=!1,this.gotEventData=!1,this.currentSite=d.b.getRequiredCurrentSite(),this.remindersEnabled=ee.a.isEnabled(),this.errors={required:b.I.instant("core.required")},this.dateFormat=s.a.convertPHPToMoment(b.I.instant("core.strftimedatetimeshort")).replace(/[[\]]/g,""),this.displayTimezone=ne.b.getForcedTimezone(),this.form=new Y.j({}),this.typeControl=this.fb.control("",Y.F.required),this.groupControl=this.fb.control(""),this.descriptionControl=this.fb.control(""),this.form.addControl("name",this.fb.control("",Y.F.required)),this.form.addControl("eventtype",this.typeControl),this.form.addControl("categoryid",this.fb.control("")),this.form.addControl("groupcourseid",this.fb.control("")),this.form.addControl("groupid",this.groupControl),this.form.addControl("description",this.descriptionControl),this.form.addControl("location",this.fb.control("")),this.form.addControl("duration",this.fb.control(0)),this.form.addControl("timedurationminutes",this.fb.control("")),this.form.addControl("repeat",this.fb.control(!1)),this.form.addControl("repeats",this.fb.control("1")),this.form.addControl("repeateditall",this.fb.control(1)),this.maxDate=s.a.getDatetimeDefaultMax(),this.minDate=s.a.getDatetimeDefaultMin()}ngOnInit(){this.eventId=y.a.getRouteNumberParam("eventId")||void 0,this.courseId=y.a.getRouteNumberParam("courseId")||0,this.title=this.eventId?"addon.calendar.editevent":"addon.calendar.newevent";const e=y.a.getRouteNumberParam("timestamp"),t=s.a.toDatetimeFormat(e);this.form.addControl("timestart",this.fb.control(t,Y.F.required)),this.form.addControl("timedurationuntil",this.fb.control(t)),this.form.addControl("courseid",this.fb.control(this.courseId)),this.initReminders(),this.fetchData().finally((()=>{this.originalData=C.a.clone(this.form.value),this.loaded=!0}))}fetchData(){return Object(o.a)(this,void 0,void 0,(function*(){this.error=!1;try{const[e,t]=yield Promise.all([m.a.getAllowedEventTypes(this.courseId),C.a.ignoreErrors(m.a.getAccessInformation(this.courseId),{canmanageentries:!1,canmanageownentries:!1,canmanagegroupentries:!1})]);this.types=e;const n=[],a=u.b.getEventTypeOptions(this.types);if(!a.length)throw new K.a(b.I.instant("addon.calendar.nopermissiontoupdatecalendar"));if(this.eventId&&!this.gotEventData){const e=this.eventId;n.push(h.a.waitForSync(h.b.SYNC_ID).then((()=>Object(o.a)(this,void 0,void 0,(function*(){let t;!this.isDestroyed&&this.eventId&&W.a.blockOperation(m.c.COMPONENT,e);try{t=yield _.a.getEvent(e),this.hasOffline=!0}catch(e){this.hasOffline=!1}if(e>0){const n=yield m.a.getEventById(e);t||(t=n),this.eventRepeatId=null==n?void 0:n.repeatid,this.eventRepeatId&&(this.otherEventsCount=n.eventcount?n.eventcount-1:0)}if(this.gotEventData=!0,t)return this.loadEventData(t,this.hasOffline)})))))}this.types.category&&n.push(this.fetchCategories()),this.showAll=C.a.isTrueOrOne(this.currentSite.getStoredConfig("calendar_adminseesall"))&&t.canmanageentries,(this.types.course||this.types.groups)&&n.push(this.fetchCourses()),yield Promise.all(n),this.typeControl.value||this.typeControl.setValue(this.types.course?m.b.COURSE:a[0].value),this.eventTypes=a}catch(e){l.a.showErrorModalDefault(e,"Error getting data."),this.error=!0}}))}fetchCategories(){return Object(o.a)(this,void 0,void 0,(function*(){this.categories=yield v.a.getCategories(0,!0)}))}fetchCourses(){return Object(o.a)(this,void 0,void 0,(function*(){let e=yield this.showAll?v.a.getCoursesByField():v.a.getUserCourses();if(e.length<0)return this.courses=[],void 0;const courseFillFullname=e=>Object(o.a)(this,void 0,void 0,(function*(){try{const t=yield X.a.getFiltersAndFormatText(e.fullname,"course",e.id);e.fullname=t.text}catch(e){}}));if(this.showAll){const t=d.b.getCurrentSiteHomeId();e=("contacts"in e[0],e.filter((e=>e.id!=t)))}"contacts"in e[0],yield Promise.all(e.map(courseFillFullname)),this.courses=e.sort(((e,t)=>{const n=e.fullname.toLowerCase(),a=t.fullname.toLowerCase();return n.localeCompare(a)}))}))}loadEventData(e,t){var n;return Object(o.a)(this,void 0,void 0,(function*(){if(!e)return;const a=e,i=e,o=t?a.courseid:null===(n=i.course)||void 0===n?void 0:n.id;this.form.controls.name.setValue(e.name),this.form.controls.timestart.setValue(s.a.toDatetimeFormat(1e3*e.timestart)),this.form.controls.eventtype.setValue(e.eventtype),this.form.controls.categoryid.setValue(e.categoryid||""),this.form.controls.courseid.setValue(o||""),this.form.controls.groupcourseid.setValue(o||""),this.form.controls.groupid.setValue(e.groupid||""),this.form.controls.description.setValue(e.description),this.form.controls.location.setValue(e.location),t?(this.form.controls.duration.setValue(a.duration),this.form.controls.timedurationuntil.setValue(s.a.toDatetimeFormat(1e3*(a.timedurationuntil||0)||Date.now())),this.form.controls.timedurationminutes.setValue(a.timedurationminutes||""),this.form.controls.repeat.setValue(!!a.repeat),this.form.controls.repeats.setValue(a.repeats||"1"),this.form.controls.repeateditall.setValue(a.repeateditall||1)):(i.timeduration>0?(this.form.controls.duration.setValue(1),this.form.controls.timedurationuntil.setValue(s.a.toDatetimeFormat(1e3*(i.timestart+i.timeduration)))):(this.form.controls.duration.setValue(0),this.form.controls.timedurationuntil.setValue(s.a.toDatetimeFormat())),this.form.controls.timedurationminutes.setValue(""),this.form.controls.repeat.setValue(!!i.repeatid),this.form.controls.repeats.setValue(i.eventcount||"1"),this.form.controls.repeateditall.setValue(1)),e.eventtype==m.b.GROUP&&o&&(yield this.loadGroups(o))}))}refreshData(e){const t=[m.a.invalidateAccessInformation(this.courseId),m.a.invalidateAllowedEventTypes(this.courseId)];this.types&&(this.types.category&&t.push(v.a.invalidateCategories(0,!0)),(this.types.course||this.types.groups)&&t.push(this.showAll?v.a.invalidateCoursesByField():v.a.invalidateUserCourses())),Promise.all(t).finally((()=>{this.fetchData().finally((()=>{null==e?void 0:e.complete()}))}))}groupCourseSelected(){return Object(o.a)(this,void 0,void 0,(function*(){const e=this.form.controls.groupcourseid.value;if(!e)return;const t=yield l.a.showModalLoading();try{yield this.loadGroups(e),this.groupControl.setValue("")}catch(e){l.a.showErrorModalDefault(e,"Error getting data.")}t.dismiss()}))}loadGroups(e){return Object(o.a)(this,void 0,void 0,(function*(){this.loadingGroups=!0;try{this.groups=yield H.a.getUserGroupsInCourse(e),this.courseGroupSet=!0}finally{this.loadingGroups=!1}}))}selectDuration(e){this.form.controls.duration.setValue(e)}submit(){return Object(o.a)(this,void 0,void 0,(function*(){const e=this.form.value,t=E()(e.timestart).unix(),n=E()(e.timedurationuntil).unix(),a=parseInt(e.timedurationminutes||"",10);let i;if((e.eventtype!==m.b.COURSE||e.courseid)&&(e.eventtype!==m.b.GROUP||e.groupcourseid)?e.eventtype!==m.b.GROUP||e.groupid?e.eventtype!==m.b.CATEGORY||e.categoryid?1===e.duration&&t>n?i="addon.calendar.invalidtimedurationuntil":2===e.duration&&(isNaN(a)||a<1)&&(i="addon.calendar.invalidtimedurationminutes"):i="core.selectacategory":i="core.selectagroup":i="core.selectacourse",i)return l.a.showErrorModal(b.I.instant(i)),void 0;const o={name:e.name,eventtype:e.eventtype,timestart:t,description:{text:e.description||"",format:1,itemid:0},location:e.location,duration:e.duration,repeat:e.repeat};e.eventtype==m.b.COURSE?o.courseid=e.courseid:e.eventtype==m.b.GROUP?(o.groupcourseid=e.groupcourseid,o.groupid=e.groupid):e.eventtype==m.b.CATEGORY&&(o.categoryid=e.categoryid),1==e.duration?o.timedurationuntil=n:2==e.duration&&(o.timedurationminutes=e.timedurationminutes),e.repeat&&(o.repeats=Number(e.repeats)),this.eventRepeatId&&(o.repeatid=this.eventRepeatId,o.repeateditall=e.repeateditall);const c=yield l.a.showModalLoading("core.sending",!0);let r;try{const t=yield m.a.submitEvent(this.eventId,o,{reminders:this.eventId?[]:this.reminders});if(r=t.event,Z.a.triggerFormSubmittedEvent(this.formElement,t.sent,this.currentSite.getId()),t.sent){const n=e.repeat?e.repeats:o.repeateditall&&this.otherEventsCount?this.otherEventsCount+1:1;try{yield u.b.refreshAfterChangeEvent(t.event,n)}catch(e){}}this.returnToList(r)}catch(i){l.a.showErrorModalDefault(i,"Error sending data.")}c.dismiss()}))}returnToList(e){this.unblockSync(),this.eventId&&this.eventId>0?r.b.trigger(m.c.EDIT_EVENT_EVENT,{eventId:this.eventId},this.currentSite.getId()):r.b.trigger(m.c.NEW_EVENT_EVENT,{eventId:e.id,oldEventId:this.eventId},this.currentSite.getId()),this.originalData=void 0,y.a.back()}canLeave(){return Object(o.a)(this,void 0,void 0,(function*(){return u.b.hasEventDataChanged(this.form.value,this.originalData)&&(yield l.a.showConfirm(b.I.instant("core.confirmcanceledit"))),Z.a.triggerFormCancelledEvent(this.formElement,this.currentSite.getId()),!0}))}unblockSync(){this.eventId&&W.a.unblockOperation(m.c.COMPONENT,this.eventId)}initReminders(){return Object(o.a)(this,void 0,void 0,(function*(){if(!this.remindersEnabled||this.eventId)return;const e=yield ee.a.getDefaultNotificationTime(this.currentSite.getId());if(e===ee.b.DISABLED)return;const t=ee.b.convertSecondsToValueAndUnit(e);this.reminders.push({value:t.value,unit:t.unit,label:ee.a.getUnitValueLabel(t.value,t.unit,!0)})}))}addReminder(){return Object(o.a)(this,void 0,void 0,(function*(){const e=s.a.convertToTimestamp(this.form.value.timestart,!0),t=yield l.a.openPopover({component:te.a,componentProps:{eventTime:e}});if(void 0===t)return;const n=ee.b.convertSecondsToValueAndUnit(t.timeBefore);this.reminders.push({time:t.timeBefore,value:n.value,unit:n.unit,label:ee.a.getUnitValueLabel(n.value,n.unit)})}))}removeReminder(e){const t=this.reminders.indexOf(e);-1!==t&&this.reminders.splice(t,1)}ngOnDestroy(){this.unblockSync(),this.isDestroyed=!0}}return AddonCalendarEditEventPage.ɵfac=function AddonCalendarEditEventPage_Factory(e){return new(e||AddonCalendarEditEventPage)(S.yc(Y.f))},AddonCalendarEditEventPage.ɵcmp=S.sc({type:AddonCalendarEditEventPage,selectors:[["page-addon-calendar-edit-event"]],viewQuery:function AddonCalendarEditEventPage_Query(e,t){var n;(1&e&&(S.ud(J.a,!0),S.ud(ce,!0)),2&e)&&(S.dd(n=S.Nc())&&(t.descriptionEditor=n.first),S.dd(n=S.Nc())&&(t.formElement=n.first))},decls:16,vars:13,consts:[["slot","start"],[3,"text"],["slot","fixed",3,"disabled","ionRefresh"],[3,"pullingText"],[3,"hideUntil"],[3,"formGroup",4,"ngIf"],["collapsible-footer","","appearOnBottom","","slot","fixed",4,"ngIf"],[3,"formGroup"],["editEventForm",""],[1,"ion-text-wrap"],["position","stacked"],[1,"item-heading",3,"core-mark-required"],["type","text","name","name","formControlName","name",3,"placeholder"],[3,"control","errorMessages"],["formControlName","timestart",3,"placeholder","displayFormat","max","min","displayTimezone"],[1,"ion-text-wrap","addon-calendar-eventtype-container"],["slot","end",4,"ngIf"],["formControlName","eventtype","interface","action-sheet",3,"cancelText","interfaceOptions",4,"ngIf"],["class","ion-text-wrap",4,"ngIf"],[4,"ngIf"],[1,"ion-text-wrap","addon-calendar-radio-container"],["formControlName","duration"],[1,"addon-calendar-radio-title"],[1,"item-heading"],["slot","end",3,"value"],["class","ion-text-wrap addon-calendar-radio-container",4,"ngIf"],["name","description",3,"control","placeholder","component","componentId","autoSave"],["type","text","name","location","formControlName","location",3,"placeholder"],["slot","end"],["formControlName","eventtype","interface","action-sheet",3,"cancelText","interfaceOptions"],[3,"value",4,"ngFor","ngForOf"],[3,"value"],["formControlName","categoryid","interface","action-sheet",3,"placeholder","cancelText","interfaceOptions"],["formControlName","courseid","interface","action-sheet",3,"placeholder","cancelText","interfaceOptions"],["formControlName","groupcourseid","interface","action-sheet",3,"placeholder","cancelText","interfaceOptions","ionChange"],["class","ion-text-wrap core-danger-item",4,"ngIf"],["class","ion-text-wrap core-edit-set-group",4,"ngIf"],[1,"ion-text-wrap","core-danger-item"],[1,"ion-text-wrap","core-edit-set-group"],["formControlName","groupid","interface","action-sheet",3,"placeholder","cancelText","interfaceOptions"],[1,"addon-calendar-reminders-title"],["fill","clear","slot","end",3,"click"],["name","fas-plus","slot","icon-only","aria-hidden","true"],["class","ion-text-wrap",4,"ngFor","ngForOf"],["name","fas-trash","color","danger","slot","icon-only","aria-hidden","true"],["formControlName","timedurationuntil",3,"max","min","placeholder","displayFormat","displayTimezone"],[1,"sr-only"],["type","number","name","timedurationminutes","slot","end","formControlName","timedurationminutes",3,"placeholder"],[1,"ion-text-wrap","divider"],["slot","end","formControlName","repeat"],["type","number","name","repeats","formControlName","repeats",3,"disabled"],["formControlName","repeateditall"],["slot","end","value","1"],["slot","end","value","0"],["collapsible-footer","","appearOnBottom","","slot","fixed"],[1,"list-item-limited-width","adaptable-buttons-row"],["expand","block","type","submit",1,"ion-margin","ion-text-wrap",3,"disabled","click"]],template:function AddonCalendarEditEventPage_Template(e,t){1&e&&(S.Ec(0,"ion-header"),S.Ec(1,"ion-toolbar"),S.Ec(2,"ion-buttons",0),S.zc(3,"ion-back-button",1),S.Pc(4,"translate"),S.Dc(),S.Ec(5,"ion-title"),S.Ec(6,"h1"),S.pd(7),S.Pc(8,"translate"),S.Dc(),S.Dc(),S.Dc(),S.Dc(),S.Ec(9,"ion-content"),S.Ec(10,"ion-refresher",2),S.Mc("ionRefresh",(function AddonCalendarEditEventPage_Template_ion_refresher_ionRefresh_10_listener(e){return t.refreshData(e.target)})),S.zc(11,"ion-refresher-content",3),S.Pc(12,"translate"),S.Dc(),S.Ec(13,"core-loading",4),S.nd(14,AddonCalendarEditEventPage_form_14_Template,73,71,"form",5),S.nd(15,AddonCalendarEditEventPage_div_15_Template,5,4,"div",6),S.Dc(),S.Dc()),2&e&&(S.lc(3),S.Vc("text",S.Qc(4,7,"core.back")),S.lc(4),S.qd(S.Qc(8,9,t.title)),S.lc(3),S.Vc("disabled",!t.loaded),S.lc(1),S.Wc("pullingText",S.Qc(12,11,"core.pulltorefresh")),S.lc(2),S.Vc("hideUntil",t.loaded),S.lc(1),S.Vc("ngIf",!t.error),S.lc(1),S.Vc("ngIf",t.loaded&&!t.error))},directives:[M.C,M.Ab,M.m,M.h,M.i,M.yb,z.a,M.v,M.bb,M.cb,F.a,L.t,Y.H,Y.s,Y.k,M.I,M.O,ae.a,M.H,M.Pb,Y.r,Y.i,ie.a,M.w,M.Ob,M.Z,M.J,M.Y,M.Mb,J.a,M.lb,L.s,M.mb,M.qb,N.a,M.l,M.D,k.a,M.Jb,M.s,M.d,oe.a],pipes:[B.d],styles:["[_nghost-%COMP%]   .addon-calendar-eventtype-container.item-select-disabled[_ngcontent-%COMP%]   ion-label[_ngcontent-%COMP%], [_nghost-%COMP%]   .addon-calendar-eventtype-container.item-select-disabled[_ngcontent-%COMP%]   ion-select[_ngcontent-%COMP%]{opacity:1}[_nghost-%COMP%]   .addon-calendar-eventtype-container.item-select-disabled[_ngcontent-%COMP%]   ion-select[_ngcontent-%COMP%]::part(icon){display:none}"]}),AddonCalendarEditEventPage})();var de=n("vuGA"),le=n("ULAo"),se=n("eoiU"),me=n("tyNb"),_e=n("4JiN"),ue=n("OZH1"),he=n("iSJP");function AddonCalendarEventPage_h1_6_Template(e,t){if(1&e&&(S.Ec(0,"h1"),S.zc(1,"core-format-text",13),S.Dc()),2&e){const e=S.Oc();S.lc(1),S.Vc("text",e.event.name)("contextLevel",e.event.contextLevel)("contextInstanceId",e.event.contextInstanceId)}}function AddonCalendarEventPage_ion_list_22_core_mod_icon_2_Template(e,t){if(1&e&&S.zc(0,"core-mod-icon",27),2&e){const e=S.Oc(2);S.Vc("modicon",e.event.moduleIcon)("showAlt",!1)("modname",e.event.modulename)("componentId",e.event.instance)("purpose",e.event.purpose)}}function AddonCalendarEventPage_ion_list_22_ion_icon_3_Template(e,t){if(1&e&&S.zc(0,"ion-icon",28),2&e){const e=S.Oc(2);S.Vc("name",e.event.eventIcon)}}function AddonCalendarEventPage_ion_list_22_span_8_Template(e,t){if(1&e&&(S.Ec(0,"span",17),S.pd(1),S.Dc()),2&e){const e=S.Oc(2);S.lc(1),S.qd(e.event.iconTitle)}}const event_c0=function(e){return{$a:e}};function AddonCalendarEventPage_ion_list_22_ion_card_11_Template(e,t){1&e&&(S.Ec(0,"ion-card",29),S.Ec(1,"ion-item"),S.zc(2,"ion-icon",30),S.Ec(3,"ion-label"),S.pd(4),S.Pc(5,"translate"),S.Pc(6,"translate"),S.Dc(),S.Dc(),S.Dc()),2&e&&(S.lc(4),S.qd(S.Rc(5,1,"core.hasdatatosync",S.ad(6,event_c0,S.Qc(6,4,"addon.calendar.calendarevent")))))}function AddonCalendarEventPage_ion_list_22_ion_note_18_Template(e,t){1&e&&(S.Ec(0,"ion-note",4),S.zc(1,"ion-icon",31),S.pd(2),S.Pc(3,"translate"),S.Dc()),2&e&&(S.lc(2),S.rd(" ",S.Qc(3,1,"core.deletedoffline")," "))}function AddonCalendarEventPage_ion_list_22_ion_item_27_Template(e,t){if(1&e&&(S.Ec(0,"ion-item",32),S.Ec(1,"ion-label"),S.Ec(2,"p",21),S.pd(3),S.Pc(4,"translate"),S.Dc(),S.Ec(5,"p"),S.zc(6,"core-format-text",33),S.Dc(),S.Dc(),S.Dc()),2&e){const e=S.Oc(2);S.Vc("href",e.courseUrl),S.lc(3),S.qd(S.Qc(4,4,"core.course")),S.lc(3),S.Vc("text",e.courseName)("contextInstanceId",e.courseId)}}function AddonCalendarEventPage_ion_list_22_ion_item_28_Template(e,t){if(1&e&&(S.Ec(0,"ion-item",34),S.Ec(1,"ion-label"),S.Ec(2,"p",21),S.pd(3),S.Pc(4,"translate"),S.Dc(),S.Ec(5,"p"),S.zc(6,"core-format-text",33),S.Dc(),S.Dc(),S.Dc()),2&e){const e=S.Oc(2);S.lc(3),S.qd(S.Qc(4,3,"core.group")),S.lc(3),S.Vc("text",e.groupName)("contextInstanceId",e.event.courseid)}}function AddonCalendarEventPage_ion_list_22_ion_item_29_Template(e,t){if(1&e&&(S.Ec(0,"ion-item",20),S.Ec(1,"ion-label"),S.Ec(2,"p",21),S.pd(3),S.Pc(4,"translate"),S.Dc(),S.Ec(5,"p"),S.zc(6,"core-format-text",35),S.Dc(),S.Dc(),S.Dc()),2&e){const e=S.Oc(2);S.lc(3),S.qd(S.Qc(4,3,"core.category")),S.lc(3),S.Vc("text",e.categoryPath)("contextInstanceId",e.event.categoryid)}}function AddonCalendarEventPage_ion_list_22_ion_item_30_Template(e,t){if(1&e&&(S.Ec(0,"ion-item",20),S.Ec(1,"ion-label"),S.Ec(2,"p",21),S.pd(3),S.Pc(4,"translate"),S.Dc(),S.Ec(5,"p"),S.zc(6,"core-format-text",13),S.Dc(),S.Dc(),S.Dc()),2&e){const e=S.Oc(2);S.lc(3),S.qd(S.Qc(4,4,"core.description")),S.lc(3),S.Vc("text",e.event.description)("contextLevel",e.event.contextLevel)("contextInstanceId",e.event.contextInstanceId)}}function AddonCalendarEventPage_ion_list_22_ion_item_31_Template(e,t){if(1&e&&(S.Ec(0,"ion-item",20),S.Ec(1,"ion-label"),S.Ec(2,"p",21),S.pd(3),S.Pc(4,"translate"),S.Dc(),S.Ec(5,"p"),S.Ec(6,"a",36),S.zc(7,"core-format-text",13),S.Dc(),S.Dc(),S.Dc(),S.Dc()),2&e){const e=S.Oc(2);S.lc(3),S.qd(S.Qc(4,5,"core.location")),S.lc(3),S.Vc("href",e.event.encodedLocation,S.id),S.lc(1),S.Vc("text",e.event.location)("contextLevel",e.event.contextLevel)("contextInstanceId",e.event.contextInstanceId)}}function AddonCalendarEventPage_ion_list_22_ion_item_32_Template(e,t){if(1&e&&(S.Ec(0,"ion-item"),S.Ec(1,"ion-label"),S.Ec(2,"ion-button",37),S.pd(3),S.Pc(4,"translate"),S.Dc(),S.Dc(),S.Dc()),2&e){const e=S.Oc(2);S.lc(2),S.Vc("href",e.moduleUrl),S.lc(1),S.rd(" ",S.Qc(4,2,"addon.calendar.gotoactivity")," ")}}const event_c1=function(e){return[e]};function AddonCalendarEventPage_ion_list_22_Template(e,t){if(1&e&&(S.Ec(0,"ion-list"),S.Ec(1,"ion-item",14),S.nd(2,AddonCalendarEventPage_ion_list_22_core_mod_icon_2_Template,1,5,"core-mod-icon",15),S.nd(3,AddonCalendarEventPage_ion_list_22_ion_icon_3_Template,1,1,"ion-icon",16),S.Ec(4,"ion-label"),S.Ec(5,"span",17),S.pd(6),S.Pc(7,"translate"),S.nd(8,AddonCalendarEventPage_ion_list_22_span_8_Template,2,1,"span",18),S.Dc(),S.Ec(9,"h1"),S.zc(10,"core-format-text",13),S.Dc(),S.Dc(),S.Dc(),S.nd(11,AddonCalendarEventPage_ion_list_22_ion_card_11_Template,7,8,"ion-card",19),S.Ec(12,"ion-item",20),S.Ec(13,"ion-label"),S.Ec(14,"p",21),S.pd(15),S.Pc(16,"translate"),S.Dc(),S.zc(17,"core-format-text",22),S.Dc(),S.nd(18,AddonCalendarEventPage_ion_list_22_ion_note_18_Template,4,3,"ion-note",23),S.Dc(),S.Ec(19,"ion-item"),S.Ec(20,"ion-label"),S.Ec(21,"p",21),S.pd(22),S.Pc(23,"translate"),S.Dc(),S.Ec(24,"p"),S.pd(25),S.Pc(26,"translate"),S.Dc(),S.Dc(),S.Dc(),S.nd(27,AddonCalendarEventPage_ion_list_22_ion_item_27_Template,7,6,"ion-item",24),S.nd(28,AddonCalendarEventPage_ion_list_22_ion_item_28_Template,7,5,"ion-item",25),S.nd(29,AddonCalendarEventPage_ion_list_22_ion_item_29_Template,7,5,"ion-item",26),S.nd(30,AddonCalendarEventPage_ion_list_22_ion_item_30_Template,7,6,"ion-item",26),S.nd(31,AddonCalendarEventPage_ion_list_22_ion_item_31_Template,8,7,"ion-item",26),S.nd(32,AddonCalendarEventPage_ion_list_22_ion_item_32_Template,5,4,"ion-item",3),S.Dc()),2&e){const e=S.Oc();S.lc(1),S.Vc("ngClass",S.ad(29,event_c1,"addon-calendar-eventtype-"+e.event.eventtype)),S.lc(1),S.Vc("ngIf",e.event.moduleIcon),S.lc(1),S.Vc("ngIf",e.event.eventIcon&&!e.event.moduleIcon),S.lc(3),S.rd(" ",S.Qc(7,21,"addon.calendar.type"+e.event.formattedType)," "),S.lc(2),S.Vc("ngIf",e.event.moduleIcon&&e.event.iconTitle),S.lc(2),S.Vc("text",e.event.name)("contextLevel",e.event.contextLevel)("contextInstanceId",e.event.contextInstanceId),S.lc(1),S.Vc("ngIf",e.hasOffline||e.event.deleted),S.lc(4),S.qd(S.Qc(16,23,"addon.calendar.when")),S.lc(2),S.Vc("text",e.event.formattedtime)("filter",!1),S.lc(1),S.Vc("ngIf",e.event.deleted),S.lc(4),S.qd(S.Qc(23,25,"addon.calendar.eventtype")),S.lc(3),S.qd(S.Qc(26,27,"addon.calendar.type"+e.event.formattedType)),S.lc(2),S.Vc("ngIf",e.courseName),S.lc(1),S.Vc("ngIf",e.groupName),S.lc(1),S.Vc("ngIf",e.categoryPath),S.lc(1),S.Vc("ngIf",e.event.description),S.lc(1),S.Vc("ngIf",e.event.location),S.lc(1),S.Vc("ngIf",e.moduleUrl)}}function AddonCalendarEventPage_ion_card_23_ng_container_6_ion_item_1_p_4_Template(e,t){if(1&e&&(S.Ec(0,"p"),S.pd(1),S.Dc()),2&e){const e=S.Oc(2).$implicit;S.lc(1),S.qd(e.sublabel)}}function AddonCalendarEventPage_ion_card_23_ng_container_6_ion_item_1_Template(e,t){if(1&e){const e=S.Fc();S.Ec(0,"ion-item",20),S.Ec(1,"ion-label"),S.Ec(2,"p",21),S.pd(3),S.Dc(),S.nd(4,AddonCalendarEventPage_ion_card_23_ng_container_6_ion_item_1_p_4_Template,2,1,"p",3),S.Dc(),S.Ec(5,"ion-button",40),S.Mc("click",(function AddonCalendarEventPage_ion_card_23_ng_container_6_ion_item_1_Template_ion_button_click_5_listener(t){S.fd(e);const n=S.Oc().$implicit;return S.Oc(2).deleteReminder(n.id,t)})),S.Pc(6,"translate"),S.zc(7,"ion-icon",41),S.Dc(),S.Dc()}if(2&e){const e=S.Oc().$implicit,t=S.Oc(2);S.qc("item-dimmed",e.timestamp<=t.currentTime),S.lc(3),S.qd(e.label),S.lc(1),S.Vc("ngIf",e.sublabel),S.lc(1),S.mc("aria-label",S.Qc(6,5,"core.delete"))}}function AddonCalendarEventPage_ion_card_23_ng_container_6_Template(e,t){if(1&e&&(S.Cc(0),S.nd(1,AddonCalendarEventPage_ion_card_23_ng_container_6_ion_item_1_Template,8,7,"ion-item",39),S.Bc()),2&e){const e=t.$implicit;S.lc(1),S.Vc("ngIf",e.timestamp>0)}}function AddonCalendarEventPage_ion_card_23_ng_container_7_Template(e,t){if(1&e){const e=S.Fc();S.Cc(0),S.Ec(1,"ion-item"),S.Ec(2,"ion-label"),S.Ec(3,"ion-button",42),S.Mc("click",(function AddonCalendarEventPage_ion_card_23_ng_container_7_Template_ion_button_click_3_listener(){S.fd(e);return S.Oc(2).addReminder()})),S.pd(4),S.Pc(5,"translate"),S.Dc(),S.Dc(),S.Dc(),S.Bc()}2&e&&(S.lc(4),S.rd(" ",S.Qc(5,1,"addon.calendar.setnewreminder")," "))}function AddonCalendarEventPage_ion_card_23_Template(e,t){if(1&e&&(S.Ec(0,"ion-card"),S.Ec(1,"ion-item"),S.Ec(2,"ion-label"),S.Ec(3,"h2"),S.pd(4),S.Pc(5,"translate"),S.Dc(),S.Dc(),S.Dc(),S.nd(6,AddonCalendarEventPage_ion_card_23_ng_container_6_Template,2,1,"ng-container",38),S.nd(7,AddonCalendarEventPage_ion_card_23_ng_container_7_Template,6,3,"ng-container",3),S.Dc()),2&e){const e=S.Oc();S.lc(4),S.qd(S.Qc(5,3,"addon.calendar.reminders")),S.lc(2),S.Vc("ngForOf",e.reminders),S.lc(1),S.Vc("ngIf",e.event.timestart>e.currentTime)}}let ve=(()=>{class AddonCalendarEventPage{constructor(e){this.route=e,this.eventLoaded=!1,this.courseName="",this.courseUrl="",this.remindersEnabled=!1,this.moduleUrl="",this.categoryPath="",this.currentTime=-1,this.reminders=[],this.canEdit=!1,this.hasOffline=!1,this.isOnline=!1,this.syncIcon=D.a.ICON_LOADING,this.remindersEnabled=ee.a.isEnabled(),this.siteHomeId=d.b.getCurrentSiteHomeId(),this.currentSiteId=d.b.getCurrentSiteId(),this.canEdit=m.a.canEditEventsInSite(),this.editEventObserver=r.b.on(m.c.EDIT_EVENT_EVENT,(e=>{e&&e.eventId===this.eventId&&(this.eventLoaded=!1,this.refreshEvent(!0,!1))}),this.currentSiteId),this.newEventObserver=r.b.on(m.c.NEW_EVENT_EVENT,(e=>{this.eventId<0&&e&&(e.eventId===this.eventId||e.oldEventId===this.eventId)&&(this.eventId=e.eventId,this.eventLoaded=!1,this.refreshEvent(!0,!1))}),this.currentSiteId),this.syncObserver=r.b.on(h.b.AUTO_SYNCED,(e=>this.checkSyncResult(!1,e)),this.currentSiteId),this.manualSyncObserver=r.b.on(h.b.MANUAL_SYNCED,(e=>this.checkSyncResult(!0,e)),this.currentSiteId),this.onlineObserver=c.a.onChange().subscribe((()=>{b.z.run((()=>{this.isOnline=c.a.isOnline()}))})),this.defaultTimeChangedObserver=r.b.on(ee.b.DEFAULT_NOTIFICATION_TIME_CHANGED,(()=>{this.loadReminders()}),this.currentSiteId),this.currentTime=s.a.timestamp(),this.updateCurrentTime=window.setInterval((()=>{this.currentTime=s.a.timestamp()}),5e3)}loadReminders(){return Object(o.a)(this,void 0,void 0,(function*(){this.remindersEnabled&&this.event&&(this.reminders=yield u.b.getEventReminders(this.eventId,this.event.timestart,this.currentSiteId))}))}ngOnInit(){return Object(o.a)(this,void 0,void 0,(function*(){try{this.eventId=y.a.getRequiredRouteNumberParam("id")}catch(e){return l.a.showErrorModal(e),y.a.back(),void 0}this.syncIcon=D.a.ICON_LOADING,yield this.initializeSwipeManager(),yield this.fetchEvent()}))}fetchEvent(e=!1,t=!1){return Object(o.a)(this,void 0,void 0,(function*(){if(this.isOnline=c.a.isOnline(),e){if(yield this.syncEvents(t))return}try{if(this.eventId>=0){const e=yield m.a.getEventById(this.eventId);this.event=yield u.b.formatEventData(e)}try{const e=u.b.formatOfflineEventData(yield _.a.getEvent(this.eventId));this.hasOffline=!0,this.event=Object.assign(this.event||{},e)}catch(e){if(this.hasOffline=!1,this.eventId<0)return l.a.showErrorModal("Event not found."),y.a.back(),void 0}if(!this.event)return;if(this.loadReminders(),this.categoryPath="",this.courseName="",this.courseUrl="",this.moduleUrl="",this.event.moduleIcon){const e=le.a.translateModuleName(this.event.modulename||"");-1===e.indexOf("core.mod_")&&(this.event.modulename=e),this.moduleUrl=this.event.url||""}const e=[],t=this.event,n=this.event.courseid;n!=this.siteHomeId&&this.event.course&&(this.courseId=this.event.course.id,this.courseName=this.event.course.fullname,this.courseUrl=this.event.course.viewurl),n&&this.event.groupid&&(this.groupName=t.groupname),this.event.iscategoryevent&&this.event.category&&(this.categoryPath=this.event.category.nestedname),this.event.location&&(this.event.location=de.b.decodeHTML(this.event.location),this.event.encodedLocation=de.b.buildAddressURL(this.event.location)),e.push(_.a.isEventDeleted(this.eventId).then((e=>{t.deleted=e}))),e.push(m.a.getCalendarTimeFormat().then((e=>Object(o.a)(this,void 0,void 0,(function*(){t.formattedtime=yield m.a.formatEventTime(t,e)}))))),yield Promise.all(e)}catch(e){l.a.showErrorModalDefault(e,"addon.calendar.errorloadevent",!0)}this.eventLoaded=!0,this.syncIcon=D.a.ICON_SYNC}))}initializeSwipeManager(){return Object(o.a)(this,void 0,void 0,(function*(){const e=y.a.getRouteParam("date"),t=e&&T.a.getSource(events_source_AddonCalendarEventsSource,[e]);t&&(this.events=new event_AddonCalendarEventsSwipeItemsManager(t),yield this.events.start())}))}syncEvents(e=!1){return Object(o.a)(this,void 0,void 0,(function*(){let t=!1;try{const e=yield h.a.syncEvents();e.warnings&&e.warnings.length&&l.a.showAlert(void 0,e.warnings[0]),e.deleted&&-1!=e.deleted.indexOf(this.eventId)?t=!0:this.eventId<0&&e.offlineIdMap[this.eventId]&&(this.eventId=e.offlineIdMap[this.eventId]),e.updated&&(e.source="event",r.b.trigger(h.b.MANUAL_SYNCED,e,this.currentSiteId))}catch(t){e&&l.a.showErrorModalDefault(t,"core.errorsync",!0)}return t}))}addReminder(){return Object(o.a)(this,void 0,void 0,(function*(){if(!this.event||!this.event.id)return;const e=yield l.a.openPopover({component:te.a,componentProps:{eventTime:this.event.timestart}});void 0!==e&&(yield m.a.addEventReminder(this.event,e.timeBefore,this.currentSiteId),yield this.loadReminders())}))}deleteReminder(e,t){return Object(o.a)(this,void 0,void 0,(function*(){t.preventDefault(),t.stopPropagation();try{yield l.a.showDeleteConfirm();const t=yield l.a.showModalLoading("core.deleting",!0);try{yield ee.a.removeReminder(e),yield this.loadReminders()}catch(e){l.a.showErrorModalDefault(e,"Error deleting reminder")}finally{t.dismiss()}}catch(e){}}))}doRefresh(e,t,n=!1){return Object(o.a)(this,void 0,void 0,(function*(){this.eventLoaded&&(yield this.refreshEvent(!0,n).finally((()=>{null==e?void 0:e.complete(),t&&t()})))}))}refreshEvent(e=!1,t=!1){return Object(o.a)(this,void 0,void 0,(function*(){this.syncIcon=D.a.ICON_LOADING;const n=[];this.eventId>0&&n.push(m.a.invalidateEvent(this.eventId)),n.push(m.a.invalidateTimeFormat()),yield C.a.allPromisesIgnoringErrors(n),yield this.fetchEvent(e,t)}))}openEdit(){y.a.navigateToSitePath(`/calendar/edit/${this.eventId}`)}deleteEvent(){return Object(o.a)(this,void 0,void 0,(function*(){if(!this.event)return;const e=b.I.instant("addon.calendar.deleteevent"),t={};let n;this.event.eventcount>1?(n=b.I.instant("addon.calendar.confirmeventseriesdelete",{$a:{name:this.event.name,count:this.event.eventcount}}),t.inputs=[{type:"radio",name:"deleteall",checked:!0,value:!1,label:b.I.instant("addon.calendar.deleteoneevent")},{type:"radio",name:"deleteall",checked:!1,value:!0,label:b.I.instant("addon.calendar.deleteallevents")}]):n=b.I.instant("addon.calendar.confirmeventdelete",{$a:this.event.name});let a=!1;try{a=yield l.a.showConfirm(n,e,void 0,void 0,t)}catch(e){return}const i=yield l.a.showModalLoading("core.sending",!0);try{let e=!1;if(this.event.id<0?yield _.a.deleteEvent(this.event.id):e=yield m.a.deleteEvent(this.event.id,this.event.name,a),e)try{yield u.b.refreshAfterChangeEvent(this.event,a?this.event.eventcount:1)}catch(e){}this.event.id<0?r.b.trigger(m.c.NEW_EVENT_DISCARDED_EVENT,{},d.b.getCurrentSiteId()):r.b.trigger(m.c.DELETED_EVENT_EVENT,{eventId:this.eventId,sent:e},d.b.getCurrentSiteId()),e||this.event.id<0?(l.a.showToast("addon.calendar.eventcalendareventdeleted",!0,l.c.LONG),y.a.back()):this.event.deleted=!0}catch(e){l.a.showErrorModalDefault(e,"Error deleting event.")}i.dismiss()}))}undoDelete(){return Object(o.a)(this,void 0,void 0,(function*(){if(!this.event)return;const e=yield l.a.showModalLoading("core.sending",!0);try{yield _.a.unmarkDeleted(this.event.id),r.b.trigger(m.c.UNDELETED_EVENT_EVENT,{eventId:this.eventId},d.b.getCurrentSiteId()),this.event.deleted=!1}catch(e){l.a.showErrorModalDefault(e,"Error undeleting event.")}e.dismiss()}))}checkSyncResult(e,t){if(t)if(t.deleted&&-1!=t.deleted.indexOf(this.eventId))l.a.showToast("addon.calendar.eventcalendareventdeleted",!0,l.c.LONG),y.a.back();else if(t.events&&(!e||"event"!=t.source))if(this.eventId<0)t.offlineIdMap[this.eventId]&&(this.eventId=t.offlineIdMap[this.eventId],this.eventLoaded=!1,this.refreshEvent());else{t.events.find((e=>e.id==this.eventId))&&(this.eventLoaded=!1,this.refreshEvent())}}ngOnDestroy(){var e;this.editEventObserver.off(),this.syncObserver.off(),this.manualSyncObserver.off(),this.onlineObserver.unsubscribe(),this.newEventObserver.off(),null===(e=this.events)||void 0===e||e.destroy(),clearInterval(this.updateCurrentTime)}}return AddonCalendarEventPage.ɵfac=function AddonCalendarEventPage_Factory(e){return new(e||AddonCalendarEventPage)(S.yc(me.a))},AddonCalendarEventPage.ɵcmp=S.sc({type:AddonCalendarEventPage,selectors:[["page-addon-calendar-event"]],decls:24,vars:34,consts:[["collapsible",""],["slot","start"],[3,"text"],[4,"ngIf"],["slot","end"],[3,"hidden","priority","content","iconAction","closeOnClick","action"],["iconAction","fas-pen",3,"hidden","priority","content","action"],["iconAction","fas-trash",3,"hidden","priority","content","action"],["iconAction","fas-rotate-left",3,"hidden","priority","content","action"],[3,"core-swipe-navigation"],["slot","fixed",3,"disabled","ionRefresh"],[3,"pullingText"],[3,"hideUntil"],[3,"text","contextLevel","contextInstanceId"],["collapsible","",1,"ion-text-wrap","addon-calendar-event",3,"ngClass"],["slot","start",3,"modicon","showAlt","modname","componentId","purpose",4,"ngIf"],["aria-hidden","true","slot","start",3,"name",4,"ngIf"],[1,"sr-only"],["class","sr-only",4,"ngIf"],["class","core-warning-card",4,"ngIf"],[1,"ion-text-wrap"],[1,"item-heading"],[3,"text","filter"],["slot","end",4,"ngIf"],["class","ion-text-wrap","core-link","","capture","true",3,"href",4,"ngIf"],["class","ion-text-wrap core-groupname",4,"ngIf"],["class","ion-text-wrap",4,"ngIf"],["slot","start",3,"modicon","showAlt","modname","componentId","purpose"],["aria-hidden","true","slot","start",3,"name"],[1,"core-warning-card"],["name","fas-triangle-exclamation","slot","start","aria-hidden","true"],["name","fas-trash","aria-hidden","true"],["core-link","","capture","true",1,"ion-text-wrap",3,"href"],["contextLevel","course",3,"text","contextInstanceId"],[1,"ion-text-wrap","core-groupname"],["contextLevel","coursecat",3,"text","contextInstanceId"],["core-link","","auto-login","no",3,"href"],["expand","block","core-link","","capture","true",3,"href"],[4,"ngFor","ngForOf"],["class","ion-text-wrap",3,"item-dimmed",4,"ngIf"],["fill","clear","slot","end",3,"click"],["name","fas-trash","color","danger","slot","icon-only","aria-hidden","true"],["expand","block",3,"click"]],template:function AddonCalendarEventPage_Template(e,t){1&e&&(S.Ec(0,"ion-header",0),S.Ec(1,"ion-toolbar"),S.Ec(2,"ion-buttons",1),S.zc(3,"ion-back-button",2),S.Pc(4,"translate"),S.Dc(),S.Ec(5,"ion-title"),S.nd(6,AddonCalendarEventPage_h1_6_Template,2,3,"h1",3),S.Dc(),S.Ec(7,"ion-buttons",4),S.Ec(8,"core-context-menu"),S.Ec(9,"core-context-menu-item",5),S.Mc("action",(function AddonCalendarEventPage_Template_core_context_menu_item_action_9_listener(e){return t.doRefresh(void 0,e,!0)})),S.Pc(10,"translate"),S.Dc(),S.Ec(11,"core-context-menu-item",6),S.Mc("action",(function AddonCalendarEventPage_Template_core_context_menu_item_action_11_listener(){return t.openEdit()})),S.Pc(12,"translate"),S.Dc(),S.Ec(13,"core-context-menu-item",7),S.Mc("action",(function AddonCalendarEventPage_Template_core_context_menu_item_action_13_listener(){return t.deleteEvent()})),S.Pc(14,"translate"),S.Dc(),S.Ec(15,"core-context-menu-item",8),S.Mc("action",(function AddonCalendarEventPage_Template_core_context_menu_item_action_15_listener(){return t.undoDelete()})),S.Pc(16,"translate"),S.Dc(),S.Dc(),S.Dc(),S.Dc(),S.Dc(),S.Ec(17,"ion-content",9),S.Ec(18,"ion-refresher",10),S.Mc("ionRefresh",(function AddonCalendarEventPage_Template_ion_refresher_ionRefresh_18_listener(e){return t.doRefresh(e.target)})),S.zc(19,"ion-refresher-content",11),S.Pc(20,"translate"),S.Dc(),S.Ec(21,"core-loading",12),S.nd(22,AddonCalendarEventPage_ion_list_22_Template,33,31,"ion-list",3),S.nd(23,AddonCalendarEventPage_ion_card_23_Template,8,5,"ion-card",3),S.Dc(),S.Dc()),2&e&&(S.lc(3),S.Vc("text",S.Qc(4,22,"core.back")),S.lc(3),S.Vc("ngIf",t.event),S.lc(3),S.Vc("hidden",!t.eventLoaded||!t.hasOffline&&t.event&&!t.event.deleted||!t.isOnline)("priority",400)("content",S.Qc(10,24,"core.settings.synchronizenow"))("iconAction",t.syncIcon)("closeOnClick",!1),S.lc(2),S.Vc("hidden",!t.event||!t.event.canedit||t.event.deleted||!t.canEdit&&t.event.id>0)("priority",300)("content",S.Qc(12,26,"core.edit")),S.lc(2),S.Vc("hidden",!t.event||!t.event.candelete||t.event.deleted)("priority",200)("content",S.Qc(14,28,"core.delete")),S.lc(2),S.Vc("hidden",!t.event||!t.event.deleted)("priority",200)("content",S.Qc(16,30,"core.restore")),S.lc(2),S.Vc("core-swipe-navigation",t.events),S.lc(1),S.Vc("disabled",!t.eventLoaded),S.lc(1),S.Wc("pullingText",S.Qc(20,32,"core.pulltorefresh")),S.lc(2),S.Vc("hideUntil",t.eventLoaded),S.lc(1),S.Vc("ngIf",t.event),S.lc(1),S.Vc("ngIf",t.remindersEnabled&&t.event))},directives:[M.C,_e.b,M.Ab,M.m,M.h,M.i,M.yb,L.t,Q.a,R.a,z.a,M.v,ue.a,M.bb,M.cb,F.a,q.a,M.P,M.I,L.q,M.O,U.a,M.D,k.a,M.n,M.W,he.a,N.a,M.l,L.s],pipes:[B.d],styles:["[_nghost-%COMP%]{--addon-calendar-blank-day-background-color:var(--light)}[_nghost-%COMP%]   .item.addon-calendar-event[_ngcontent-%COMP%] > ion-icon[_ngcontent-%COMP%]{color:#fff;border-radius:50%;padding:.7rem;--margin-vertical:12px;--margin-end:12px;margin-top:var(--margin-vertical);margin-bottom:var(--margin-vertical);margin-right:var(--margin-end)}@supports ((-webkit-margin-start:0) or (margin-inline-start:0)) or (-webkit-margin-start:0){[_nghost-%COMP%]   .item.addon-calendar-event[_ngcontent-%COMP%] > ion-icon[_ngcontent-%COMP%]{margin-right:unset;-webkit-margin-end:var(--margin-end);margin-inline-end:var(--margin-end)}}[_nghost-%COMP%]   .item.addon-calendar-event.addon-calendar-eventtype-category[_ngcontent-%COMP%] > ion-icon[_ngcontent-%COMP%]{background-color:#8e24aa}[_nghost-%COMP%]   .item.addon-calendar-event.addon-calendar-eventtype-course[_ngcontent-%COMP%] > ion-icon[_ngcontent-%COMP%]{background-color:#ca3120}[_nghost-%COMP%]   .item.addon-calendar-event.addon-calendar-eventtype-group[_ngcontent-%COMP%] > ion-icon[_ngcontent-%COMP%]{background-color:#f0ad4e}[_nghost-%COMP%]   .item.addon-calendar-event.addon-calendar-eventtype-user[_ngcontent-%COMP%] > ion-icon[_ngcontent-%COMP%]{background-color:#0f6cbf}[_nghost-%COMP%]   .item.addon-calendar-event.addon-calendar-eventtype-site[_ngcontent-%COMP%] > ion-icon[_ngcontent-%COMP%]{background-color:#357a32}","[_nghost-%COMP%]   ion-card[_ngcontent-%COMP%]   ion-note[_ngcontent-%COMP%]{font-size:1.6rem}"]}),AddonCalendarEventPage})();class event_AddonCalendarEventsSwipeItemsManager extends se.a{getSelectedItemPathFromRoute(e){return e.params.id}}var fe=n("Yxfl"),ge=n("cD/T"),pe=n("YyYz"),Ee=n("C1x5");function AddonCalendarIndexPage_core_context_menu_item_14_Template(e,t){if(1&e){const e=S.Fc();S.Ec(0,"core-context-menu-item",15),S.Mc("action",(function AddonCalendarIndexPage_core_context_menu_item_14_Template_core_context_menu_item_action_0_listener(){S.fd(e);return S.Oc().toggleDisplay()})),S.Pc(1,"translate"),S.Dc()}2&e&&S.Vc("priority",800)("content",S.Qc(1,2,"addon.calendar.upcomingevents"))}function AddonCalendarIndexPage_core_context_menu_item_15_Template(e,t){if(1&e){const e=S.Fc();S.Ec(0,"core-context-menu-item",16),S.Mc("action",(function AddonCalendarIndexPage_core_context_menu_item_15_Template_core_context_menu_item_action_0_listener(){S.fd(e);return S.Oc().toggleDisplay()})),S.Pc(1,"translate"),S.Dc()}2&e&&S.Vc("priority",800)("content",S.Qc(1,2,"addon.calendar.monthlyview"))}const index_c0=function(e){return{$a:e}};function AddonCalendarIndexPage_ion_card_25_Template(e,t){1&e&&(S.Ec(0,"ion-card",17),S.Ec(1,"ion-item"),S.zc(2,"ion-icon",18),S.Ec(3,"ion-label"),S.pd(4),S.Pc(5,"translate"),S.Pc(6,"translate"),S.Dc(),S.Dc(),S.Dc()),2&e&&(S.lc(4),S.qd(S.Rc(5,1,"core.hasdatatosync",S.ad(6,index_c0,S.Qc(6,4,"addon.calendar.calendar")))))}function AddonCalendarIndexPage_addon_calendar_upcoming_events_27_Template(e,t){if(1&e){const e=S.Fc();S.Ec(0,"addon-calendar-upcoming-events",19),S.Mc("onEventClicked",(function AddonCalendarIndexPage_addon_calendar_upcoming_events_27_Template_addon_calendar_upcoming_events_onEventClicked_0_listener(t){S.fd(e);return S.Oc().gotoEvent(t)})),S.Dc()}if(2&e){const e=S.Oc();S.Vc("hidden",e.showCalendar)("filter",e.filter)}}function AddonCalendarIndexPage_ion_fab_28_Template(e,t){if(1&e){const e=S.Fc();S.Ec(0,"ion-fab",20),S.Ec(1,"ion-fab-button",21),S.Mc("click",(function AddonCalendarIndexPage_ion_fab_28_Template_ion_fab_button_click_1_listener(){S.fd(e);return S.Oc().openEdit()})),S.Pc(2,"translate"),S.zc(3,"ion-icon",22),S.Ec(4,"span",23),S.pd(5),S.Pc(6,"translate"),S.Dc(),S.Dc(),S.Dc()}2&e&&(S.lc(1),S.mc("aria-label",S.Qc(2,2,"addon.calendar.newevent")),S.lc(4),S.qd(S.Qc(6,4,"addon.calendar.newevent")))}let be=(()=>{class AddonCalendarIndexPage{constructor(e){this.route=e,this.canCreate=!1,this.courses=[],this.loaded=!1,this.hasOffline=!1,this.isOnline=!1,this.syncIcon=D.a.ICON_LOADING,this.showCalendar=!0,this.loadUpcoming=!1,this.filter={filtered:!1,courseId:void 0,categoryId:void 0,course:!0,group:!0,site:!0,user:!0,category:!0},this.currentSiteId=d.b.getCurrentSiteId(),this.newEventObserver=r.b.on(m.c.NEW_EVENT_EVENT,(e=>{e&&e.eventId&&(this.loaded=!1,this.refreshData(!0,!1,!0))}),this.currentSiteId),this.discardedObserver=r.b.on(m.c.NEW_EVENT_DISCARDED_EVENT,(()=>{this.loaded=!1,this.refreshData(!0,!1,!0)}),this.currentSiteId),this.editEventObserver=r.b.on(m.c.EDIT_EVENT_EVENT,(e=>{e&&e.eventId&&(this.loaded=!1,this.refreshData(!0,!1,!0))}),this.currentSiteId),this.syncObserver=r.b.on(h.b.AUTO_SYNCED,(()=>{this.loaded=!1,this.refreshData(!1,!1,!0)}),this.currentSiteId),this.manualSyncObserver=r.b.on(h.b.MANUAL_SYNCED,(e=>{e&&"index"!=e.source&&(this.loaded=!1,this.refreshData(!1,!1,!0))}),this.currentSiteId),this.deleteEventObserver=r.b.on(m.c.DELETED_EVENT_EVENT,(()=>{this.loaded=!1,this.refreshData(!1,!1,!0)}),this.currentSiteId),this.undeleteEventObserver=r.b.on(m.c.UNDELETED_EVENT_EVENT,(()=>Object(o.a)(this,void 0,void 0,(function*(){this.hasOffline=yield _.a.hasOfflineData()}))),this.currentSiteId),this.filterChangedObserver=r.b.on(m.c.FILTER_CHANGED_EVENT,(e=>Object(o.a)(this,void 0,void 0,(function*(){this.filter=e,this.canCreate=yield u.b.canEditEvents(this.filter.courseId)})))),this.onlineObserver=c.a.onChange().subscribe((()=>{b.z.run((()=>{this.isOnline=c.a.isOnline()}))}))}ngOnInit(){this.loadUpcoming=!!y.a.getRouteBooleanParam("upcoming"),this.showCalendar=!this.loadUpcoming,this.route.queryParams.subscribe((()=>Object(o.a)(this,void 0,void 0,(function*(){this.filter.courseId=y.a.getRouteNumberParam("courseId"),this.year=y.a.getRouteNumberParam("year"),this.month=y.a.getRouteNumberParam("month"),this.filter.filtered=!!this.filter.courseId,this.fetchData(!0,!1),void 0!==this.year&&void 0!==this.month&&this.calendarComponent&&this.calendarComponent.viewMonth(this.month,this.year)}))));(new pe.a).treatLink()}fetchData(e,t){return Object(o.a)(this,void 0,void 0,(function*(){if(this.syncIcon=D.a.ICON_LOADING,this.isOnline=c.a.isOnline(),e)try{const e=yield h.a.syncEvents();e.warnings&&e.warnings.length&&l.a.showAlert(void 0,e.warnings[0]),e.updated&&(e.source="index",r.b.trigger(h.b.MANUAL_SYNCED,e,this.currentSiteId))}catch(e){t&&l.a.showErrorModalDefault(e,"core.errorsync",!0)}try{const e=[];this.hasOffline=!1,e.push(f.b.getCoursesForPopover(this.filter.courseId).then((e=>{this.courses=e.courses}))),e.push(u.b.canEditEvents(this.filter.courseId).then((e=>{this.canCreate=e}))),e.push(_.a.hasOfflineData().then((e=>{this.hasOffline=e}))),yield Promise.all(e)}catch(e){l.a.showErrorModalDefault(e,"addon.calendar.errorloadevents",!0)}this.loaded=!0,this.syncIcon=D.a.ICON_SYNC}))}doRefresh(e,t,n){return Object(o.a)(this,void 0,void 0,(function*(){this.loaded&&(yield this.refreshData(!0,n).finally((()=>{null==e?void 0:e.complete(),t&&t()})))}))}refreshData(e=!1,t=!1,n=!1){return Object(o.a)(this,void 0,void 0,(function*(){this.syncIcon=D.a.ICON_LOADING;const a=[];a.push(m.a.invalidateAllowedEventTypes()),this.showCalendar&&this.calendarComponent?a.push(this.calendarComponent.refreshData(n)):!this.showCalendar&&this.upcomingEventsComponent&&a.push(this.upcomingEventsComponent.refreshData()),yield Promise.all(a).finally((()=>this.fetchData(e,t)))}))}gotoEvent(e){y.a.navigateToSitePath(`/calendar/event/${e}`)}gotoDay(e){const t={day:e.day,month:e.month,year:e.year};Object.keys(this.filter).forEach((e=>{t[e]=this.filter[e]})),y.a.navigateToSitePath("/calendar/day",{params:t})}openFilter(){return Object(o.a)(this,void 0,void 0,(function*(){yield l.a.openSideModal({component:g.a,componentProps:{courses:this.courses,filter:this.filter}})}))}openEdit(e){const t={};e=e||0,this.filter.courseId&&(t.courseId=this.filter.courseId),y.a.navigateToSitePath(`/calendar/edit/${e}`,{params:t})}openSettings(){y.a.navigateToSitePath("/calendar/calendar-settings")}toggleDisplay(){this.showCalendar=!this.showCalendar,this.showCalendar||(this.loadUpcoming=!0)}ngOnDestroy(){var e,t,n,a,i,o,c,r,d;null===(e=this.newEventObserver)||void 0===e?void 0:e.off(),null===(t=this.discardedObserver)||void 0===t||t.off(),null===(n=this.editEventObserver)||void 0===n||n.off(),null===(a=this.deleteEventObserver)||void 0===a||a.off(),null===(i=this.undeleteEventObserver)||void 0===i||i.off(),null===(o=this.syncObserver)||void 0===o||o.off(),null===(c=this.manualSyncObserver)||void 0===c||c.off(),null===(r=this.filterChangedObserver)||void 0===r||r.off(),null===(d=this.onlineObserver)||void 0===d||d.unsubscribe()}}return AddonCalendarIndexPage.ɵfac=function AddonCalendarIndexPage_Factory(e){return new(e||AddonCalendarIndexPage)(S.yc(me.a))},AddonCalendarIndexPage.ɵcmp=S.sc({type:AddonCalendarIndexPage,selectors:[["page-addon-calendar-index"]],viewQuery:function AddonCalendarIndexPage_Query(e,t){var n;(1&e&&(S.ud(fe.a,!0),S.ud(ge.a,!0)),2&e)&&(S.dd(n=S.Nc())&&(t.calendarComponent=n.first),S.dd(n=S.Nc())&&(t.upcomingEventsComponent=n.first))},decls:29,vars:34,consts:[["slot","start"],[3,"text"],["slot","end"],["fill","clear",3,"click"],["slot","icon-only","name","fas-filter","aria-hidden","true"],["iconAction","fas-table-list",3,"priority","content","action",4,"ngIf"],["iconAction","fas-calendar-days",3,"priority","content","action",4,"ngIf"],["iconAction","fas-gears",3,"priority","content","action"],[3,"hidden","priority","content","iconAction","closeOnClick","action"],["slot","fixed",3,"disabled","ionRefresh"],[3,"pullingText"],["class","core-warning-card",4,"ngIf"],[3,"hidden","initialYear","initialMonth","filter","displayNavButtons","onEventClicked","onDayClicked"],[3,"hidden","filter","onEventClicked",4,"ngIf"],["slot","fixed","core-fab","","vertical","bottom","horizontal","end",4,"ngIf"],["iconAction","fas-table-list",3,"priority","content","action"],["iconAction","fas-calendar-days",3,"priority","content","action"],[1,"core-warning-card"],["name","fas-triangle-exclamation","slot","start","aria-hidden","true"],[3,"hidden","filter","onEventClicked"],["slot","fixed","core-fab","","vertical","bottom","horizontal","end"],[3,"click"],["name","fas-plus","aria-hidden","true"],[1,"sr-only"]],template:function AddonCalendarIndexPage_Template(e,t){1&e&&(S.Ec(0,"ion-header"),S.Ec(1,"ion-toolbar"),S.Ec(2,"ion-buttons",0),S.zc(3,"ion-back-button",1),S.Pc(4,"translate"),S.Dc(),S.Ec(5,"ion-title"),S.Ec(6,"h1"),S.pd(7),S.Pc(8,"translate"),S.Dc(),S.Dc(),S.Ec(9,"ion-buttons",2),S.Ec(10,"ion-button",3),S.Mc("click",(function AddonCalendarIndexPage_Template_ion_button_click_10_listener(){return t.openFilter()})),S.Pc(11,"translate"),S.zc(12,"ion-icon",4),S.Dc(),S.Ec(13,"core-context-menu"),S.nd(14,AddonCalendarIndexPage_core_context_menu_item_14_Template,2,4,"core-context-menu-item",5),S.nd(15,AddonCalendarIndexPage_core_context_menu_item_15_Template,2,4,"core-context-menu-item",6),S.Ec(16,"core-context-menu-item",7),S.Mc("action",(function AddonCalendarIndexPage_Template_core_context_menu_item_action_16_listener(){return t.openSettings()})),S.Pc(17,"translate"),S.Dc(),S.Ec(18,"core-context-menu-item",8),S.Mc("action",(function AddonCalendarIndexPage_Template_core_context_menu_item_action_18_listener(e){return t.doRefresh(void 0,e,!0)})),S.Pc(19,"translate"),S.Dc(),S.Dc(),S.zc(20,"core-user-menu-button"),S.Dc(),S.Dc(),S.Dc(),S.Ec(21,"ion-content"),S.Ec(22,"ion-refresher",9),S.Mc("ionRefresh",(function AddonCalendarIndexPage_Template_ion_refresher_ionRefresh_22_listener(e){return t.doRefresh(e.target)})),S.zc(23,"ion-refresher-content",10),S.Pc(24,"translate"),S.Dc(),S.nd(25,AddonCalendarIndexPage_ion_card_25_Template,7,8,"ion-card",11),S.Ec(26,"addon-calendar-calendar",12),S.Mc("onEventClicked",(function AddonCalendarIndexPage_Template_addon_calendar_calendar_onEventClicked_26_listener(e){return t.gotoEvent(e)}))("onDayClicked",(function AddonCalendarIndexPage_Template_addon_calendar_calendar_onDayClicked_26_listener(e){return t.gotoDay(e)})),S.Dc(),S.nd(27,AddonCalendarIndexPage_addon_calendar_upcoming_events_27_Template,1,2,"addon-calendar-upcoming-events",13),S.nd(28,AddonCalendarIndexPage_ion_fab_28_Template,7,6,"ion-fab",14),S.Dc()),2&e&&(S.lc(3),S.Vc("text",S.Qc(4,22,"core.back")),S.lc(4),S.qd(S.Qc(8,24,t.showCalendar?"addon.calendar.calendarevents":"addon.calendar.upcomingevents")),S.lc(3),S.mc("aria-label",S.Qc(11,26,"core.filter")),S.lc(4),S.Vc("ngIf",t.showCalendar),S.lc(1),S.Vc("ngIf",!t.showCalendar),S.lc(1),S.Vc("priority",600)("content",S.Qc(17,28,"core.settings.settings")),S.lc(2),S.Vc("hidden",!t.loaded||!t.hasOffline||!t.isOnline)("priority",400)("content",S.Qc(19,30,"core.settings.synchronizenow"))("iconAction",t.syncIcon)("closeOnClick",!1),S.lc(4),S.Vc("disabled",!t.loaded),S.lc(1),S.Wc("pullingText",S.Qc(24,32,"core.pulltorefresh")),S.lc(2),S.Vc("ngIf",t.hasOffline),S.lc(1),S.Vc("hidden",!t.showCalendar)("initialYear",t.year)("initialMonth",t.month)("filter",t.filter)("displayNavButtons",t.showCalendar),S.lc(1),S.Vc("ngIf",t.loadUpcoming),S.lc(1),S.Vc("ngIf",t.canCreate))},directives:[M.C,M.Ab,M.m,M.h,M.i,M.yb,N.a,M.l,M.D,k.a,Q.a,L.t,R.a,Ee.a,z.a,M.v,M.bb,M.cb,fe.a,M.n,M.I,M.O,ge.a,M.x,G.a,M.y],pipes:[B.d],encapsulation:2}),AddonCalendarIndexPage})();function AddonCalendarSettingsPage_ion_item_11_Template(e,t){if(1&e){const e=S.Fc();S.Ec(0,"ion-item"),S.Ec(1,"ion-label"),S.pd(2),S.Pc(3,"translate"),S.Dc(),S.Ec(4,"ion-select",3),S.Mc("ngModelChange",(function AddonCalendarSettingsPage_ion_item_11_Template_ion_select_ngModelChange_4_listener(t){S.fd(e);return S.Oc().defaultTimeLabel=t}))("click",(function AddonCalendarSettingsPage_ion_item_11_Template_ion_select_click_4_listener(t){S.fd(e);return S.Oc().changeDefaultTime(t)})),S.Ec(5,"ion-select-option",4),S.pd(6),S.Dc(),S.Dc(),S.Dc()}if(2&e){const e=S.Oc();S.lc(2),S.qd(S.Qc(3,4,"addon.calendar.defaultnotificationtime")),S.lc(2),S.Vc("ngModel",e.defaultTimeLabel),S.lc(1),S.Vc("value",e.defaultTimeLabel),S.lc(1),S.qd(e.defaultTimeLabel)}}let ye=(()=>{class AddonCalendarSettingsPage{constructor(){this.defaultTimeLabel=""}ngOnInit(){return Object(o.a)(this,void 0,void 0,(function*(){this.updateDefaultTimeLabel()}))}changeDefaultTime(e){var t;return Object(o.a)(this,void 0,void 0,(function*(){e.stopPropagation(),e.stopImmediatePropagation(),e.preventDefault();const n=yield l.a.openPopover({component:te.a,componentProps:{initialValue:this.defaultTime,noReminderLabel:"core.settings.disabled"},event:e});void 0!==n&&(yield ee.a.setDefaultNotificationTime(null!==(t=n.timeBefore)&&void 0!==t?t:ee.b.DISABLED),this.updateDefaultTimeLabel())}))}updateDefaultTimeLabel(){return Object(o.a)(this,void 0,void 0,(function*(){this.defaultTime=yield ee.a.getDefaultNotificationTime();const e=ee.b.convertSecondsToValueAndUnit(this.defaultTime);this.defaultTimeLabel=ee.a.getUnitValueLabel(e.value,e.unit)}))}}return AddonCalendarSettingsPage.ɵfac=function AddonCalendarSettingsPage_Factory(e){return new(e||AddonCalendarSettingsPage)},AddonCalendarSettingsPage.ɵcmp=S.sc({type:AddonCalendarSettingsPage,selectors:[["page-addon-calendar-settings"]],decls:12,vars:7,consts:[["slot","start"],[3,"text"],[4,"ngIf"],[3,"ngModel","ngModelChange","click"],[3,"value"]],template:function AddonCalendarSettingsPage_Template(e,t){1&e&&(S.Ec(0,"ion-header"),S.Ec(1,"ion-toolbar"),S.Ec(2,"ion-buttons",0),S.zc(3,"ion-back-button",1),S.Pc(4,"translate"),S.Dc(),S.Ec(5,"ion-title"),S.Ec(6,"h1"),S.pd(7),S.Pc(8,"translate"),S.Dc(),S.Dc(),S.Dc(),S.Dc(),S.Ec(9,"ion-content"),S.Ec(10,"ion-list"),S.nd(11,AddonCalendarSettingsPage_ion_item_11_Template,7,6,"ion-item",2),S.Dc(),S.Dc()),2&e&&(S.lc(3),S.Vc("text",S.Qc(4,3,"core.back")),S.lc(4),S.qd(S.Qc(8,5,"core.settings.settings")),S.lc(4),S.Vc("ngIf",t.defaultTimeLabel))},directives:[M.C,M.Ab,M.m,M.h,M.i,M.yb,z.a,M.v,M.P,L.t,M.I,M.O,M.lb,M.Ob,Y.r,Y.u,M.mb],pipes:[B.d],encapsulation:2}),AddonCalendarSettingsPage})();var Ce=n("ekpb"),De=n("dQ3M"),Ie=n("wG2S"),Pe=n("tETG");function buildRoutes(e){return[{path:"index",data:{mainMenuTabRoot:Pe.b.PAGE_NAME},component:be},{path:"calendar-settings",component:ye},{path:"day",component:$},{path:"event/:id",component:ve},{path:"edit/:eventId",component:re},...Object(Ie.b)(e,{redirectTo:"index",pathMatch:"full"})]}let Oe=(()=>{class AddonCalendarLazyModule{}return AddonCalendarLazyModule.ɵmod=S.wc({type:AddonCalendarLazyModule}),AddonCalendarLazyModule.ɵinj=S.vc({factory:function AddonCalendarLazyModule_Factory(e){return new(e||AddonCalendarLazyModule)},providers:[{provide:me.g,multi:!0,deps:[S.x],useFactory:buildRoutes}],imports:[[a.a,i.a,De.a,Ce.a],me.m]}),AddonCalendarLazyModule})();void(("undefined"==typeof ngJitMode||ngJitMode)&&S.kd(Oe,{declarations:[$,re,ve,be,ye],imports:[a.a,i.a,De.a,Ce.a],exports:[me.m]}))},eoiU:function(e,t,n){"use strict";n.d(t,"a",(function(){return CoreSwipeNavigationItemsManager}));var a=n("mrSG"),i=n("pHTc"),o=n("CtbY");class CoreSwipeNavigationItemsManager extends o.a{start(){return Object(a.a)(this,void 0,void 0,(function*(){this.updateSelectedItem()}))}navigateToNextItem(){return Object(a.a)(this,void 0,void 0,(function*(){yield this.navigateToItemBy(1,"forward")}))}navigateToPreviousItem(){return Object(a.a)(this,void 0,void 0,(function*(){yield this.navigateToItemBy(-1,"back")}))}hasNextItem(){return Object(a.a)(this,void 0,void 0,(function*(){return!!(yield this.getItemBy(1))}))}hasPreviousItem(){return Object(a.a)(this,void 0,void 0,(function*(){return!!(yield this.getItemBy(-1))}))}getCurrentPageRoute(){return i.a.getCurrentRoute()}getSelectedItemPathFromRoute(e){const t=[];for(;e&&(t.push(...e.url),e.firstChild);)e=e.firstChild;return t.map((e=>e.path)).join("/").replace(/\/+/,"/").trim()||null}navigateToItemBy(e,t){return Object(a.a)(this,void 0,void 0,(function*(){const n=yield this.getItemBy(e);n&&(yield this.navigateToItem(n,{animationDirection:t,replace:!0}))}))}getItemBy(e){var t;return Object(a.a)(this,void 0,void 0,(function*(){const n=this.getSource().getItems(),a=null!==(t=this.selectedItem&&(null==n?void 0:n.indexOf(this.selectedItem)))&&void 0!==t?t:-1;if(-1===a||null===n)return null;const i=e>0?1:-1;let o=a,c=0;for(;c!==e;){if(o+=i,o<0)return null;if(o>=n.length)break;this.skipItemInSwipe(n[o])||(c+=i)}return c===e?n[o]:this.getSource().isCompleted()?null:(yield this.getSource().load(),this.getItemBy(e))}))}skipItemInSwipe(e){return!1}}}}]);