(window.webpackJsonp=window.webpackJsonp||[]).push([[3,68],{EyWp:function(e,t,s){"use strict";s.r(t),s.d(t,"AddonModWorkshopOfflineProvider",(function(){return l})),s.d(t,"AddonModWorkshopOffline",(function(){return g}));var i=s("mrSG"),o=s("EmGO"),n=s("9+EE"),r=s("vuGA"),d=s("Q98t"),a=s("j3ag"),c=s("qgEA"),u=s("jtJJ"),h=s("fXoL");let l=(()=>{class AddonModWorkshopOfflineProvider{getAllWorkshops(e){return Object(i.a)(this,void 0,void 0,(function*(){const t=yield Promise.all([this.getAllSubmissions(e),this.getAllAssessments(e),this.getAllEvaluateSubmissions(e),this.getAllEvaluateAssessments(e)]),s={};return t.forEach((e=>{e.forEach((e=>{s[e.workshopid]=e.workshopid}))})),Object.values(s)}))}hasWorkshopOfflineData(e,t){return Object(i.a)(this,void 0,void 0,(function*(){try{return(yield Promise.all([this.getSubmissions(e,t),this.getAssessments(e,t),this.getEvaluateSubmissions(e,t),this.getEvaluateAssessments(e,t)])).some((e=>e&&e.length))}catch(e){return!1}}))}deleteSubmissionAction(e,t,s){return Object(i.a)(this,void 0,void 0,(function*(){const i=yield n.b.getSite(s),o={workshopid:e,action:t};yield i.getDb().deleteRecords(u.e,o)}))}deleteAllSubmissionActions(e,t){return Object(i.a)(this,void 0,void 0,(function*(){const s=yield n.b.getSite(t),i={workshopid:e};yield s.getDb().deleteRecords(u.e,i)}))}getAllSubmissions(e){return Object(i.a)(this,void 0,void 0,(function*(){const t=yield n.b.getSite(e);return(yield t.getDb().getRecords(u.e)).map((e=>this.parseSubmissionRecord(e)))}))}getSubmissions(e,t){return Object(i.a)(this,void 0,void 0,(function*(){const s=yield n.b.getSite(t),i={workshopid:e};return(yield s.getDb().getRecords(u.e,i)).map((e=>this.parseSubmissionRecord(e)))}))}getSubmissionAction(e,t,s){return Object(i.a)(this,void 0,void 0,(function*(){const i=yield n.b.getSite(s),o={workshopid:e,action:t},r=yield i.getDb().getRecord(u.e,o);return this.parseSubmissionRecord(r)}))}saveSubmission(e,t,s,o,r,a=0,c,h){return Object(i.a)(this,void 0,void 0,(function*(){const i=yield n.b.getSite(h),l=d.a.timestamp(),g={workshopid:e,courseid:t,title:s,content:o,attachmentsid:JSON.stringify(r),action:c,submissionid:a,timemodified:l};yield i.getDb().insertRecord(u.e,g)}))}parseSubmissionRecord(e){return Object.assign(Object.assign({},e),{attachmentsid:r.b.parseJSON(e.attachmentsid)})}deleteAssessment(e,t,s){return Object(i.a)(this,void 0,void 0,(function*(){const i=yield n.b.getSite(s),o={workshopid:e,assessmentid:t};yield i.getDb().deleteRecords(u.b,o)}))}getAllAssessments(e){return Object(i.a)(this,void 0,void 0,(function*(){const t=yield n.b.getSite(e);return(yield t.getDb().getRecords(u.b)).map((e=>this.parseAssessmentRecord(e)))}))}getAssessments(e,t){return Object(i.a)(this,void 0,void 0,(function*(){const s=yield n.b.getSite(t),i={workshopid:e};return(yield s.getDb().getRecords(u.b,i)).map((e=>this.parseAssessmentRecord(e)))}))}getAssessment(e,t,s){return Object(i.a)(this,void 0,void 0,(function*(){const i=yield n.b.getSite(s),o={workshopid:e,assessmentid:t},r=yield i.getDb().getRecord(u.b,o);return this.parseAssessmentRecord(r)}))}saveAssessment(e,t,s,o,r){return Object(i.a)(this,void 0,void 0,(function*(){const i=yield n.b.getSite(r),a={workshopid:e,courseid:s,inputdata:JSON.stringify(o),assessmentid:t,timemodified:d.a.timestamp()};yield i.getDb().insertRecord(u.b,a)}))}parseAssessmentRecord(e){return Object.assign(Object.assign({},e),{inputdata:r.b.parseJSON(e.inputdata)})}deleteEvaluateSubmission(e,t,s){return Object(i.a)(this,void 0,void 0,(function*(){const i={workshopid:e,submissionid:t},o=yield n.b.getSite(s);yield o.getDb().deleteRecords(u.d,i)}))}getAllEvaluateSubmissions(e){return Object(i.a)(this,void 0,void 0,(function*(){const t=yield n.b.getSite(e);return(yield t.getDb().getRecords(u.d)).map((e=>this.parseEvaluateSubmissionRecord(e)))}))}getEvaluateSubmissions(e,t){return Object(i.a)(this,void 0,void 0,(function*(){const s=yield n.b.getSite(t),i={workshopid:e};return(yield s.getDb().getRecords(u.d,i)).map((e=>this.parseEvaluateSubmissionRecord(e)))}))}getEvaluateSubmission(e,t,s){return Object(i.a)(this,void 0,void 0,(function*(){const i=yield n.b.getSite(s),o={workshopid:e,submissionid:t},r=yield i.getDb().getRecord(u.d,o);return this.parseEvaluateSubmissionRecord(r)}))}saveEvaluateSubmission(e,t,s,o="",r,a,c){return Object(i.a)(this,void 0,void 0,(function*(){const i=yield n.b.getSite(c),h={workshopid:e,courseid:s,submissionid:t,timemodified:d.a.timestamp(),feedbacktext:o,published:Number(r),gradeover:JSON.stringify(a)};yield i.getDb().insertRecord(u.d,h)}))}parseEvaluateSubmissionRecord(e){return Object.assign(Object.assign({},e),{published:Boolean(e.published),gradeover:r.b.parseJSON(e.gradeover)})}deleteEvaluateAssessment(e,t,s){return Object(i.a)(this,void 0,void 0,(function*(){const i=yield n.b.getSite(s),o={workshopid:e,assessmentid:t};yield i.getDb().deleteRecords(u.c,o)}))}getAllEvaluateAssessments(e){return Object(i.a)(this,void 0,void 0,(function*(){const t=yield n.b.getSite(e);return(yield t.getDb().getRecords(u.c)).map((e=>this.parseEvaluateAssessmentRecord(e)))}))}getEvaluateAssessments(e,t){return Object(i.a)(this,void 0,void 0,(function*(){const s=yield n.b.getSite(t),i={workshopid:e};return(yield s.getDb().getRecords(u.c,i)).map((e=>this.parseEvaluateAssessmentRecord(e)))}))}getEvaluateAssessment(e,t,s){return Object(i.a)(this,void 0,void 0,(function*(){const i=yield n.b.getSite(s),o={workshopid:e,assessmentid:t},r=yield i.getDb().getRecord(u.c,o);return this.parseEvaluateAssessmentRecord(r)}))}saveEvaluateAssessment(e,t,s,o,r=0,a,c){return Object(i.a)(this,void 0,void 0,(function*(){const i=yield n.b.getSite(c),h={workshopid:e,courseid:s,assessmentid:t,timemodified:d.a.timestamp(),feedbacktext:o||"",weight:r,gradinggradeover:JSON.stringify(a)};yield i.getDb().insertRecord(u.c,h)}))}parseEvaluateAssessmentRecord(e){return Object.assign(Object.assign({},e),{gradinggradeover:r.b.parseJSON(e.gradinggradeover)})}getWorkshopFolder(e,t){return Object(i.a)(this,void 0,void 0,(function*(){const s=yield n.b.getSite(t),i=o.a.getSiteFolder(s.getId());return c.a.concatenatePaths(i,"offlineworkshop/"+e+"/")}))}getSubmissionFolder(e,t){return Object(i.a)(this,void 0,void 0,(function*(){const s=yield this.getWorkshopFolder(e,t);return c.a.concatenatePaths(s,"submission")}))}getAssessmentFolder(e,t,s){return Object(i.a)(this,void 0,void 0,(function*(){let i=yield this.getWorkshopFolder(e,s);return i+="assessment/",c.a.concatenatePaths(i,String(t))}))}}return AddonModWorkshopOfflineProvider.ɵfac=function AddonModWorkshopOfflineProvider_Factory(e){return new(e||AddonModWorkshopOfflineProvider)},AddonModWorkshopOfflineProvider.ɵprov=h.uc({token:AddonModWorkshopOfflineProvider,factory:AddonModWorkshopOfflineProvider.ɵfac,providedIn:"root"}),AddonModWorkshopOfflineProvider})();const g=Object(a.M)(l)},i1f9:function(e,t,s){"use strict";s.r(t),s.d(t,"AddonModWorkshopPhase",(function(){return S})),s.d(t,"AddonModWorkshopSubmissionType",(function(){return p})),s.d(t,"AddonModWorkshopExampleMode",(function(){return y})),s.d(t,"AddonModWorkshopAction",(function(){return f})),s.d(t,"AddonModWorkshopAssessmentMode",(function(){return A})),s.d(t,"AddonModWorkshopOverallFeedbackMode",(function(){return O})),s.d(t,"AddonModWorkshopProvider",(function(){return E})),s.d(t,"AddonModWorkshop",(function(){return k}));var i=s("mrSG"),o=s("93ts"),n=s("kxYv"),r=s("TmfO"),d=s("GGba"),a=s("9+EE"),c=s("vuGA"),u=s("bFG1"),h=s("JFK0"),l=s("j3ag"),g=s("EyWp"),b=s("DJrq"),m=s("fXoL");const v="mmaModWorkshop:";var S=function(e){return e[e.PHASE_SETUP=10]="PHASE_SETUP",e[e.PHASE_SUBMISSION=20]="PHASE_SUBMISSION",e[e.PHASE_ASSESSMENT=30]="PHASE_ASSESSMENT",e[e.PHASE_EVALUATION=40]="PHASE_EVALUATION",e[e.PHASE_CLOSED=50]="PHASE_CLOSED",e}({}),p=function(e){return e[e.SUBMISSION_TYPE_DISABLED=0]="SUBMISSION_TYPE_DISABLED",e[e.SUBMISSION_TYPE_AVAILABLE=1]="SUBMISSION_TYPE_AVAILABLE",e[e.SUBMISSION_TYPE_REQUIRED=2]="SUBMISSION_TYPE_REQUIRED",e}({}),y=function(e){return e[e.EXAMPLES_VOLUNTARY=0]="EXAMPLES_VOLUNTARY",e[e.EXAMPLES_BEFORE_SUBMISSION=1]="EXAMPLES_BEFORE_SUBMISSION",e[e.EXAMPLES_BEFORE_ASSESSMENT=2]="EXAMPLES_BEFORE_ASSESSMENT",e}({}),f=function(e){return e.ADD="add",e.DELETE="delete",e.UPDATE="update",e}({}),A=function(e){return e.ASSESSMENT="assessment",e.PREVIEW="preview",e}({}),O=function(e){return e[e.DISABLED=0]="DISABLED",e[e.ENABLED_OPTIONAL=1]="ENABLED_OPTIONAL",e[e.ENABLED_REQUIRED=2]="ENABLED_REQUIRED",e}({});let E=(()=>{class AddonModWorkshopProvider{getWorkshopDataCacheKey(e){return v+"workshop:"+e}getWorkshopDataPrefixCacheKey(e){return v+e}getWorkshopAccessInformationDataCacheKey(e){return this.getWorkshopDataPrefixCacheKey(e)+":access"}getUserPlanDataCacheKey(e){return this.getWorkshopDataPrefixCacheKey(e)+":userplan"}getSubmissionsDataCacheKey(e,t=0,s=0){return this.getWorkshopDataPrefixCacheKey(e)+":submissions:"+t+":"+s}getSubmissionDataCacheKey(e,t){return this.getWorkshopDataPrefixCacheKey(e)+":submission:"+t}getGradesDataCacheKey(e){return this.getWorkshopDataPrefixCacheKey(e)+":grades"}getGradesReportDataCacheKey(e,t=0){return this.getWorkshopDataPrefixCacheKey(e)+":report:"+t}getSubmissionAssessmentsDataCacheKey(e,t){return this.getWorkshopDataPrefixCacheKey(e)+":assessments:"+t}getReviewerAssessmentsDataCacheKey(e,t=0){return this.getWorkshopDataPrefixCacheKey(e)+":reviewerassessments:"+t}getAssessmentDataCacheKey(e,t){return this.getWorkshopDataPrefixCacheKey(e)+":assessment:"+t}getAssessmentFormDataCacheKey(e,t,s="assessment"){return this.getWorkshopDataPrefixCacheKey(e)+":assessmentsform:"+t+":"+s}getWorkshopByKey(e,t,s,r={}){return Object(i.a)(this,void 0,void 0,(function*(){const i=yield a.b.getSite(r.siteId),d={courseids:[e]},c=Object.assign({cacheKey:this.getWorkshopDataCacheKey(e),updateFrequency:n.a.FREQUENCY_RARELY,component:b.a},a.b.getReadingStrategyPreSets(r.readingStrategy)),u=(yield i.read("mod_workshop_get_workshops_by_courses",d,c)).workshops.find((e=>e[t]==s));if(!u)throw new o.a(l.I.instant("core.course.modulenotfound"));return void 0===u.submissiontypetext&&(void 0!==u.nattachments&&u.nattachments>0?(u.submissiontypetext=p.SUBMISSION_TYPE_AVAILABLE,u.submissiontypefile=p.SUBMISSION_TYPE_AVAILABLE):(u.submissiontypetext=p.SUBMISSION_TYPE_REQUIRED,u.submissiontypefile=p.SUBMISSION_TYPE_DISABLED)),u}))}getWorkshop(e,t,s={}){return this.getWorkshopByKey(e,"coursemodule",t,s)}getWorkshopById(e,t,s={}){return this.getWorkshopByKey(e,"id",t,s)}invalidateWorkshopData(e,t){return Object(i.a)(this,void 0,void 0,(function*(){const s=yield a.b.getSite(t);yield s.invalidateWsCacheForKey(this.getWorkshopDataCacheKey(e))}))}invalidateWorkshopWSData(e,t){return Object(i.a)(this,void 0,void 0,(function*(){const s=yield a.b.getSite(t);yield s.invalidateWsCacheForKeyStartingWith(this.getWorkshopDataPrefixCacheKey(e))}))}getWorkshopAccessInformation(e,t={}){return Object(i.a)(this,void 0,void 0,(function*(){const s=yield a.b.getSite(t.siteId),i={workshopid:e},o=Object.assign({cacheKey:this.getWorkshopAccessInformationDataCacheKey(e),component:b.a,componentId:t.cmId},a.b.getReadingStrategyPreSets(t.readingStrategy));return s.read("mod_workshop_get_workshop_access_information",i,o)}))}invalidateWorkshopAccessInformationData(e,t){return Object(i.a)(this,void 0,void 0,(function*(){const s=yield a.b.getSite(t);yield s.invalidateWsCacheForKey(this.getWorkshopAccessInformationDataCacheKey(e))}))}getUserPlanPhases(e,t={}){return Object(i.a)(this,void 0,void 0,(function*(){const s=yield a.b.getSite(t.siteId),i={workshopid:e},o=Object.assign({cacheKey:this.getUserPlanDataCacheKey(e),updateFrequency:n.a.FREQUENCY_OFTEN,component:b.a,componentId:t.cmId},a.b.getReadingStrategyPreSets(t.readingStrategy)),r=yield s.read("mod_workshop_get_user_plan",i,o);return u.a.arrayToObject(r.userplan.phases,"code")}))}invalidateUserPlanPhasesData(e,t){return Object(i.a)(this,void 0,void 0,(function*(){const s=yield a.b.getSite(t);yield s.invalidateWsCacheForKey(this.getUserPlanDataCacheKey(e))}))}getSubmissions(e,t={}){return Object(i.a)(this,void 0,void 0,(function*(){const s=t.userId||0,i=t.groupId||0,o=yield a.b.getSite(t.siteId),r={workshopid:e,userid:s,groupid:i},d=Object.assign({cacheKey:this.getSubmissionsDataCacheKey(e,s,i),updateFrequency:n.a.FREQUENCY_OFTEN,component:b.a,componentId:t.cmId},a.b.getReadingStrategyPreSets(t.readingStrategy));return(yield o.read("mod_workshop_get_submissions",r,d)).submissions}))}invalidateSubmissionsData(e,t=0,s=0,o){return Object(i.a)(this,void 0,void 0,(function*(){const i=yield a.b.getSite(o);yield i.invalidateWsCacheForKey(this.getSubmissionsDataCacheKey(e,t,s))}))}getSubmission(e,t,s={}){return Object(i.a)(this,void 0,void 0,(function*(){const i=yield a.b.getSite(s.siteId),o={submissionid:t},n=Object.assign({cacheKey:this.getSubmissionDataCacheKey(e,t),component:b.a,componentId:s.cmId},a.b.getReadingStrategyPreSets(s.readingStrategy));return(yield i.read("mod_workshop_get_submission",o,n)).submission}))}invalidateSubmissionData(e,t,s){return Object(i.a)(this,void 0,void 0,(function*(){const i=yield a.b.getSite(s);yield i.invalidateWsCacheForKey(this.getSubmissionDataCacheKey(e,t))}))}getGrades(e,t={}){return Object(i.a)(this,void 0,void 0,(function*(){const s=yield a.b.getSite(t.siteId),i={workshopid:e},o=Object.assign({cacheKey:this.getGradesDataCacheKey(e),component:b.a,componentId:t.cmId},a.b.getReadingStrategyPreSets(t.readingStrategy));return s.read("mod_workshop_get_grades",i,o)}))}invalidateGradesData(e,t){return Object(i.a)(this,void 0,void 0,(function*(){const s=yield a.b.getSite(t);yield s.invalidateWsCacheForKey(this.getGradesDataCacheKey(e))}))}getGradesReport(e,t={}){return Object(i.a)(this,void 0,void 0,(function*(){const s=yield a.b.getSite(t.siteId),i={workshopid:e,groupid:t.groupId,page:t.page||0,perpage:t.perPage||AddonModWorkshopProvider.PER_PAGE},o=Object.assign({cacheKey:this.getGradesReportDataCacheKey(e,t.groupId),updateFrequency:n.a.FREQUENCY_OFTEN,component:b.a,componentId:t.cmId},a.b.getReadingStrategyPreSets(t.readingStrategy));return(yield s.read("mod_workshop_get_grades_report",i,o)).report}))}fetchAllGradeReports(e,t={}){return this.fetchGradeReportsRecursive(e,[],Object.assign(Object.assign({},t),{page:0,perPage:t.perPage||AddonModWorkshopProvider.PER_PAGE,siteId:t.siteId||a.b.getCurrentSiteId()}))}fetchGradeReportsRecursive(e,t,s={}){var o,n;return Object(i.a)(this,void 0,void 0,(function*(){s.page=null!==(o=s.page)&&void 0!==o?o:0,s.perPage=null!==(n=s.perPage)&&void 0!==n?n:AddonModWorkshopProvider.PER_PAGE;const i=yield this.getGradesReport(e,s);Array.prototype.push.apply(t,i.grades);return(s.page+1)*s.perPage<i.totalcount?(s.page++,this.fetchGradeReportsRecursive(e,t,s)):t}))}invalidateGradeReportData(e,t=0,s){return Object(i.a)(this,void 0,void 0,(function*(){const i=yield a.b.getSite(s);yield i.invalidateWsCacheForKey(this.getGradesReportDataCacheKey(e,t))}))}getSubmissionAssessments(e,t,s={}){return Object(i.a)(this,void 0,void 0,(function*(){const i=yield a.b.getSite(s.siteId),o={submissionid:t},n=Object.assign({cacheKey:this.getSubmissionAssessmentsDataCacheKey(e,t),component:b.a,componentId:s.cmId},a.b.getReadingStrategyPreSets(s.readingStrategy));return(yield i.read("mod_workshop_get_submission_assessments",o,n)).assessments}))}invalidateSubmissionAssesmentsData(e,t,s){return Object(i.a)(this,void 0,void 0,(function*(){const i=yield a.b.getSite(s);yield i.invalidateWsCacheForKey(this.getSubmissionAssessmentsDataCacheKey(e,t))}))}addSubmission(e,t,s,o,n,r,c=!1){return Object(i.a)(this,void 0,void 0,(function*(){r=r||a.b.getCurrentSiteId();const storeOffline=()=>Object(i.a)(this,void 0,void 0,(function*(){return yield g.AddonModWorkshopOffline.saveSubmission(e,t,s,o,void 0,void 0,f.ADD,r),!1}));if(yield g.AddonModWorkshopOffline.deleteSubmissionAction(e,f.ADD,r),!d.a.isOnline()&&c)return storeOffline();try{return yield this.addSubmissionOnline(e,s,o,n,r)}catch(e){if(c&&!u.a.isWebServiceError(e))return storeOffline();throw e}}))}addSubmissionOnline(e,t,s,n,r){return Object(i.a)(this,void 0,void 0,(function*(){const i=yield a.b.getSite(r),d={workshopid:e,title:t,content:s,attachmentsid:n},c=yield i.write("mod_workshop_add_submission",d);if(h.a.throwOnFailedStatus(c,"Add submission failed"),!c.submissionid)throw new o.a("Add submission failed, no submission id was returned");return c.submissionid}))}updateSubmission(e,t,s,o,n,r,c,h=!1){return Object(i.a)(this,void 0,void 0,(function*(){c=c||a.b.getCurrentSiteId();const storeOffline=()=>Object(i.a)(this,void 0,void 0,(function*(){return yield g.AddonModWorkshopOffline.saveSubmission(e,s,o,n,void 0,t,f.UPDATE,c),!1}));if(yield g.AddonModWorkshopOffline.deleteSubmissionAction(e,f.UPDATE,c),!d.a.isOnline()&&h)return storeOffline();try{return yield this.updateSubmissionOnline(t,o,n,r,c)}catch(e){if(h&&!u.a.isWebServiceError(e))return storeOffline();throw e}}))}updateSubmissionOnline(e,t,s,o,n){return Object(i.a)(this,void 0,void 0,(function*(){const i=yield a.b.getSite(n),r={submissionid:e,title:t,content:s,attachmentsid:o||0},d=yield i.write("mod_workshop_update_submission",r);return h.a.throwOnFailedStatus(d,"Update submission failed"),e}))}deleteSubmission(e,t,s,o){return Object(i.a)(this,void 0,void 0,(function*(){o=o||a.b.getCurrentSiteId();const storeOffline=()=>g.AddonModWorkshopOffline.saveSubmission(e,s,"","",void 0,t,f.DELETE,o);if(yield g.AddonModWorkshopOffline.deleteSubmissionAction(e,f.DELETE,o),!d.a.isOnline())return storeOffline();try{return yield this.deleteSubmissionOnline(t,o)}catch(e){if(!u.a.isWebServiceError(e))return storeOffline();throw e}}))}deleteSubmissionOnline(e,t){return Object(i.a)(this,void 0,void 0,(function*(){const s=yield a.b.getSite(t),i={submissionid:e},o=yield s.write("mod_workshop_delete_submission",i);h.a.throwOnFailedStatus(o,"Delete submission failed")}))}getReviewerAssessments(e,t={}){return Object(i.a)(this,void 0,void 0,(function*(){const s=yield a.b.getSite(t.siteId),i={workshopid:e},o=Object.assign({cacheKey:this.getReviewerAssessmentsDataCacheKey(e,t.userId),component:b.a,componentId:t.cmId},a.b.getReadingStrategyPreSets(t.readingStrategy));t.userId&&(i.userid=t.userId);return(yield s.read("mod_workshop_get_reviewer_assessments",i,o)).assessments}))}invalidateReviewerAssesmentsData(e,t,s){return Object(i.a)(this,void 0,void 0,(function*(){const i=yield a.b.getSite(s);yield i.invalidateWsCacheForKey(this.getReviewerAssessmentsDataCacheKey(e,t))}))}getAssessment(e,t,s={}){return Object(i.a)(this,void 0,void 0,(function*(){const i=yield a.b.getSite(s.siteId),o={assessmentid:t},n=Object.assign({cacheKey:this.getAssessmentDataCacheKey(e,t),component:b.a,componentId:s.cmId},a.b.getReadingStrategyPreSets(s.readingStrategy));return(yield i.read("mod_workshop_get_assessment",o,n)).assessment}))}invalidateAssessmentData(e,t,s){return Object(i.a)(this,void 0,void 0,(function*(){const i=yield a.b.getSite(s);yield i.invalidateWsCacheForKey(this.getAssessmentDataCacheKey(e,t))}))}getAssessmentForm(e,t,s={}){return Object(i.a)(this,void 0,void 0,(function*(){const i=s.mode||A.ASSESSMENT,o=yield a.b.getSite(s.siteId),r={assessmentid:t,mode:i},d=Object.assign({cacheKey:this.getAssessmentFormDataCacheKey(e,t,i),updateFrequency:n.a.FREQUENCY_RARELY,component:b.a,componentId:s.cmId},a.b.getReadingStrategyPreSets(s.readingStrategy)),c=yield o.read("mod_workshop_get_assessment_form_definition",r,d);return{dimenssionscount:c.dimenssionscount,descriptionfiles:c.descriptionfiles,dimensionsinfo:c.dimensionsinfo,warnings:c.warnings,fields:this.parseFields(c.fields),current:this.parseFields(c.current),options:u.a.objectToKeyValueMap(c.options,"name","value")}}))}parseFields(e){const t=[];return e.forEach((e=>{const s=e.name.split("_"),i=s[0],o=s[3],n=s[6]||!1;parseInt(o,10)+""==o&&(t[o]||(t[o]={number:o+1}),n&&parseInt(n,10)+""==n?(t[o].fields||(t[o].fields=[]),t[o].fields[n]||(t[o].fields[n]={number:n+1}),t[o].fields[n][i]=e.value):t[o][i]=e.value)})),t}invalidateAssessmentFormData(e,t,s="assessment",o){return Object(i.a)(this,void 0,void 0,(function*(){const i=yield a.b.getSite(o);yield i.invalidateWsCacheForKey(this.getAssessmentFormDataCacheKey(e,t,s))}))}updateAssessment(e,t,s,o,n,r=!1){return Object(i.a)(this,void 0,void 0,(function*(){n=n||a.b.getCurrentSiteId();const storeOffline=()=>Object(i.a)(this,void 0,void 0,(function*(){return yield g.AddonModWorkshopOffline.saveAssessment(e,t,s,o,n),!1}));if(yield g.AddonModWorkshopOffline.deleteAssessment(e,t,n),!d.a.isOnline()&&r)return storeOffline();try{return yield this.updateAssessmentOnline(t,o,n),!0}catch(e){if(r&&!u.a.isWebServiceError(e))return storeOffline();throw e}}))}updateAssessmentOnline(e,t,s){return Object(i.a)(this,void 0,void 0,(function*(){const i=yield a.b.getSite(s),o={assessmentid:e,data:u.a.objectToArrayOfObjects(t,"name","value")},n=yield i.write("mod_workshop_update_assessment",o);h.a.throwOnFailedStatus(n,"Update assessment failed")}))}evaluateSubmission(e,t,s,o,n,r,c){return Object(i.a)(this,void 0,void 0,(function*(){c=c||a.b.getCurrentSiteId();const storeOffline=()=>g.AddonModWorkshopOffline.saveEvaluateSubmission(e,t,s,o,n,r,c).then((()=>!1));if(yield g.AddonModWorkshopOffline.deleteEvaluateSubmission(e,t,c),!d.a.isOnline())return storeOffline();try{return yield this.evaluateSubmissionOnline(t,o,n,r,c)}catch(e){if(u.a.isWebServiceError(e))throw e;return storeOffline()}}))}evaluateSubmissionOnline(e,t,s,o,n){return Object(i.a)(this,void 0,void 0,(function*(){const i=yield a.b.getSite(n),r={submissionid:e,feedbacktext:t||"",feedbackformat:c.d,published:s,gradeover:o},d=yield i.write("mod_workshop_evaluate_submission",r);return h.a.throwOnFailedStatus(d,"Evaluate submission failed"),!0}))}evaluateAssessment(e,t,s,o,n=0,r,c){return Object(i.a)(this,void 0,void 0,(function*(){c=c||a.b.getCurrentSiteId();const storeOffline=()=>g.AddonModWorkshopOffline.saveEvaluateAssessment(e,t,s,o,n,r,c).then((()=>!1));if(yield g.AddonModWorkshopOffline.deleteEvaluateAssessment(e,t,c),!d.a.isOnline())return storeOffline();try{return yield this.evaluateAssessmentOnline(t,o,n,r,c)}catch(e){if(!u.a.isWebServiceError(e))return storeOffline();throw e}}))}evaluateAssessmentOnline(e,t,s,o,n){return Object(i.a)(this,void 0,void 0,(function*(){const i=yield a.b.getSite(n),r={assessmentid:e,feedbacktext:t||"",feedbackformat:c.d,weight:s,gradinggradeover:o},d=yield i.write("mod_workshop_evaluate_assessment",r);return h.a.throwOnFailedStatus(d,"Evaluate assessment failed"),!0}))}invalidateContent(e,t,s){return Object(i.a)(this,void 0,void 0,(function*(){s=s||a.b.getCurrentSiteId();const i=yield this.getWorkshop(t,e,{readingStrategy:1,siteId:s});yield this.invalidateContentById(i.id,t,s)}))}invalidateContentById(e,t,s){return Object(i.a)(this,void 0,void 0,(function*(){s=s||a.b.getCurrentSiteId();const i=[this.invalidateWorkshopData(t,s),this.invalidateWorkshopWSData(e,s)];yield Promise.all(i)}))}logView(e,t){return Object(i.a)(this,void 0,void 0,(function*(){const s={workshopid:e};yield r.a.log("mod_workshop_view_workshop",s,b.a,e,t)}))}logViewSubmission(e,t,s){return Object(i.a)(this,void 0,void 0,(function*(){const i={submissionid:e};yield r.a.log("mod_workshop_view_submission",i,b.a,t,s)}))}}return AddonModWorkshopProvider.PER_PAGE=10,AddonModWorkshopProvider.SUBMISSION_CHANGED="addon_mod_workshop_submission_changed",AddonModWorkshopProvider.ASSESSMENT_SAVED="addon_mod_workshop_assessment_saved",AddonModWorkshopProvider.ASSESSMENT_INVALIDATED="addon_mod_workshop_assessment_invalidated",AddonModWorkshopProvider.ɵfac=function AddonModWorkshopProvider_Factory(e){return new(e||AddonModWorkshopProvider)},AddonModWorkshopProvider.ɵprov=m.uc({token:AddonModWorkshopProvider,factory:AddonModWorkshopProvider.ɵfac,providedIn:"root"}),AddonModWorkshopProvider})();const k=Object(l.M)(E)}}]);