(window.webpackJsonp=window.webpackJsonp||[]).push([[57],{ICG3:function(e,n,o){"use strict";o.r(n),o.d(n,"AddonModLessonLazyModule",(function(){return dn}));var t=o("tyNb"),i=o("L3Fv"),s=o("rSDf"),a=o("ghUQ"),c=o("pHTc"),d=o("G8NF"),_=o("fXoL"),l=o("TEn/"),r=o("4JiN"),m=o("hMzs"),g=o("nt/U"),u=o("sYmb");let p=(()=>{class AddonModLessonIndexPage extends a.a{ngOnInit(){super.ngOnInit(),this.group=c.a.getRouteNumberParam("group"),this.action=c.a.getRouteParam("action")}}return AddonModLessonIndexPage.ɵfac=function AddonModLessonIndexPage_Factory(e){return f(e||AddonModLessonIndexPage)},AddonModLessonIndexPage.ɵcmp=_.sc({type:AddonModLessonIndexPage,selectors:[["page-addon-mod-lesson-index"]],viewQuery:function AddonModLessonIndexPage_Query(e,n){var o;(1&e&&_.ud(d.a,!0),2&e)&&(_.dd(o=_.Nc())&&(n.activityComponent=o.first))},features:[_.ic],decls:14,vars:14,consts:[["collapsible",""],["slot","start"],[3,"text"],["contextLevel","module",3,"text","contextInstanceId","courseId"],["slot","end"],[1,"limited-width"],["slot","fixed",3,"disabled","ionRefresh"],[3,"pullingText"],[3,"module","courseId","group","action","dataRetrieved"]],template:function AddonModLessonIndexPage_Template(e,n){1&e&&(_.Ec(0,"ion-header",0),_.Ec(1,"ion-toolbar"),_.Ec(2,"ion-buttons",1),_.zc(3,"ion-back-button",2),_.Pc(4,"translate"),_.Dc(),_.Ec(5,"ion-title"),_.Ec(6,"h1"),_.zc(7,"core-format-text",3),_.Dc(),_.Dc(),_.zc(8,"ion-buttons",4),_.Dc(),_.Dc(),_.Ec(9,"ion-content",5),_.Ec(10,"ion-refresher",6),_.Mc("ionRefresh",(function AddonModLessonIndexPage_Template_ion_refresher_ionRefresh_10_listener(e){return null==n.activityComponent?null:n.activityComponent.doRefresh(e.target)})),_.zc(11,"ion-refresher-content",7),_.Pc(12,"translate"),_.Dc(),_.Ec(13,"addon-mod-lesson-index",8),_.Mc("dataRetrieved",(function AddonModLessonIndexPage_Template_addon_mod_lesson_index_dataRetrieved_13_listener(e){return n.updateData(e)})),_.Dc(),_.Dc()),2&e&&(_.lc(3),_.Vc("text",_.Qc(4,10,"core.back")),_.lc(4),_.Vc("text",n.title)("contextInstanceId",null==n.module?null:n.module.id)("courseId",n.courseId),_.lc(3),_.Vc("disabled",null==n.activityComponent?null:n.activityComponent.showLoading),_.lc(1),_.Wc("pullingText",_.Qc(12,12,"core.pulltorefresh")),_.lc(2),_.Vc("module",n.module)("courseId",n.courseId)("group",n.group)("action",n.action))},directives:[l.C,r.b,l.Ab,l.m,l.h,l.i,l.yb,m.a,g.a,l.v,l.bb,l.cb,d.a],pipes:[u.d],encapsulation:2}),AddonModLessonIndexPage})();const f=_.Gc(p);var h=o("ekpb"),P=o("mrSG"),v=o("93ts"),I=o("GGba"),b=o("9+EE"),D=o("uT8i"),y=o("3LXp"),M=o("mvS9"),L=o("bFG1"),E=o("j3ag"),w=o("fjkH"),k=o("oxVp"),T=o("ovS5"),A=o("2kx2"),x=o("64ry"),O=o("UkMa"),V=o("4reR"),R=o("D7J2"),C=o("3Pt+");const q=["questionFormEl"];function AddonModLessonPlayerPage_ion_button_9_Template(e,n){if(1&e){const e=_.Fc();_.Ec(0,"ion-button",9),_.Mc("click",(function AddonModLessonPlayerPage_ion_button_9_Template_ion_button_click_0_listener(){_.fd(e);return _.Oc().showMenu()})),_.Pc(1,"translate"),_.zc(2,"ion-icon",10),_.Dc()}2&e&&_.mc("aria-label",_.Qc(1,1,"addon.mod_lesson.lessonmenu"))}function AddonModLessonPlayerPage_ion_card_12_Template(e,n){if(1&e&&(_.Ec(0,"ion-card",11),_.Ec(1,"ion-item",12),_.zc(2,"ion-icon",13),_.Ec(3,"ion-label"),_.pd(4),_.Dc(),_.Dc(),_.Dc()),2&e){const e=_.Oc();_.lc(4),_.qd(e.messages[0].message)}}function AddonModLessonPlayerPage_div_13_core_timer_1_Template(e,n){if(1&e){const e=_.Fc();_.Ec(0,"core-timer",20),_.Mc("finished",(function AddonModLessonPlayerPage_div_13_core_timer_1_Template_core_timer_finished_0_listener(){_.fd(e);return _.Oc(2).timeUp()})),_.Pc(1,"translate"),_.Dc()}if(2&e){const e=_.Oc(2);_.Vc("endTime",e.endTime)("timeLeftClassThreshold",-1)("timerText",_.Qc(1,3,"addon.mod_lesson.timeremaining"))}}const _c1=function(e){return{$a:e}};function AddonModLessonPlayerPage_div_13_ion_item_2_Template(e,n){if(1&e&&(_.Ec(0,"ion-item",12),_.Ec(1,"ion-label"),_.Ec(2,"p"),_.pd(3),_.Pc(4,"translate"),_.Dc(),_.Dc(),_.Dc()),2&e){const e=_.Oc(2);_.lc(3),_.qd(_.Rc(4,1,"addon.mod_lesson.attempt",_.ad(4,_c1,e.retake)))}}function AddonModLessonPlayerPage_div_13_ion_item_3_Template(e,n){if(1&e&&(_.Ec(0,"ion-item",21),_.Ec(1,"ion-label"),_.pd(2),_.Dc(),_.Dc()),2&e){const e=_.Oc(2);_.lc(2),_.qd(e.pageData.ongoingscore)}}function AddonModLessonPlayerPage_div_13_ion_card_4_ion_item_1_Template(e,n){if(1&e&&(_.Ec(0,"ion-item",12),_.Ec(1,"ion-label"),_.zc(2,"core-format-text",23),_.Dc(),_.Dc()),2&e){const e=_.Oc(3);_.lc(2),_.Vc("component",e.component)("componentId",e.lesson.coursemodule)("text",e.pageContent)("contextInstanceId",e.lesson.coursemodule)("courseId",e.courseId)}}function AddonModLessonPlayerPage_div_13_ion_card_4_form_2_ion_item_divider_2_Template(e,n){if(1&e&&(_.Ec(0,"ion-item-divider",12),_.Ec(1,"ion-label"),_.Ec(2,"h2"),_.zc(3,"core-format-text",23),_.Dc(),_.Dc(),_.Dc()),2&e){const e=_.Oc(4);_.lc(3),_.Vc("component",e.component)("componentId",null==e.lesson?null:e.lesson.coursemodule)("text",e.pageContent)("contextInstanceId",e.lesson.coursemodule)("courseId",e.courseId)}}function AddonModLessonPlayerPage_div_13_ion_card_4_form_2_ion_item_4_Template(e,n){if(1&e&&(_.Ec(0,"ion-item",12),_.zc(1,"ion-label",31),_.zc(2,"ion-input",32),_.Pc(3,"translate"),_.Dc()),2&e){const e=_.Oc(4);_.lc(2),_.Wc("placeholder",_.Qc(3,5,"addon.mod_lesson.youranswer")),_.Vc("type",e.question.input.type)("id",e.question.input.id)("formControlName",e.question.input.name)("maxlength",e.question.input.maxlength)}}function AddonModLessonPlayerPage_div_13_ion_card_4_form_2_ng_container_5_ion_item_1_Template(e,n){if(1&e&&(_.Ec(0,"ion-item"),_.Ec(1,"ion-label",33),_.pd(2),_.Pc(3,"translate"),_.Dc(),_.zc(4,"core-rich-text-editor",34),_.Pc(5,"translate"),_.Dc()),2&e){const e=_.Oc(5);_.lc(2),_.qd(_.Qc(3,7,"core.content")),_.lc(2),_.Wc("placeholder",_.Qc(5,9,"addon.mod_lesson.youranswer")),_.Vc("control",e.question.control)("component",e.component)("componentId",null==e.lesson?null:e.lesson.coursemodule)("autoSave",!0)("contextInstanceId",null==e.lesson?null:e.lesson.coursemodule)}}function AddonModLessonPlayerPage_div_13_ion_card_4_form_2_ng_container_5_ion_item_2_Template(e,n){if(1&e&&(_.Ec(0,"ion-item",12),_.Ec(1,"ion-label"),_.Ec(2,"p",35),_.pd(3),_.Pc(4,"translate"),_.Dc(),_.Ec(5,"p"),_.zc(6,"core-format-text",23),_.Dc(),_.Dc(),_.Dc()),2&e){const e=_.Oc(5);_.lc(3),_.qd(_.Qc(4,6,"addon.mod_lesson.youranswer")),_.lc(3),_.Vc("component",e.component)("componentId",null==e.lesson?null:e.lesson.coursemodule)("text",e.question.useranswer)("contextInstanceId",null==e.lesson?null:e.lesson.coursemodule)("courseId",e.courseId)}}function AddonModLessonPlayerPage_div_13_ion_card_4_form_2_ng_container_5_Template(e,n){if(1&e&&(_.Cc(0),_.nd(1,AddonModLessonPlayerPage_div_13_ion_card_4_form_2_ng_container_5_ion_item_1_Template,6,11,"ion-item",18),_.nd(2,AddonModLessonPlayerPage_div_13_ion_card_4_form_2_ng_container_5_ion_item_2_Template,7,8,"ion-item",16),_.Bc()),2&e){const e=_.Oc(4);_.lc(1),_.Vc("ngIf",e.question.textarea),_.lc(1),_.Vc("ngIf",!e.question.textarea&&e.question.useranswer)}}function AddonModLessonPlayerPage_div_13_ion_card_4_form_2_ng_container_6_ion_radio_group_1_ion_item_1_Template(e,n){if(1&e&&(_.Ec(0,"ion-item",12),_.Ec(1,"ion-label"),_.zc(2,"core-format-text",23),_.Dc(),_.zc(3,"ion-radio",39),_.Dc()),2&e){const e=n.$implicit,o=_.Oc(6);_.lc(2),_.Vc("component",o.component)("componentId",o.lesson.coursemodule)("text",e.text)("contextInstanceId",null==o.lesson?null:o.lesson.coursemodule)("courseId",o.courseId),_.lc(1),_.Vc("id",e.id)("value",e.value)("disabled",e.disabled)}}function AddonModLessonPlayerPage_div_13_ion_card_4_form_2_ng_container_6_ion_radio_group_1_Template(e,n){if(1&e&&(_.Ec(0,"ion-radio-group",37),_.nd(1,AddonModLessonPlayerPage_div_13_ion_card_4_form_2_ng_container_6_ion_radio_group_1_ion_item_1_Template,4,8,"ion-item",38),_.Dc()),2&e){const e=_.Oc(5);_.Vc("formControlName",e.question.controlName),_.lc(1),_.Vc("ngForOf",e.question.options)}}function AddonModLessonPlayerPage_div_13_ion_card_4_form_2_ng_container_6_ng_container_2_ion_item_1_Template(e,n){if(1&e&&(_.Ec(0,"ion-item",12),_.Ec(1,"ion-label"),_.zc(2,"core-format-text",23),_.Dc(),_.zc(3,"ion-checkbox",40),_.Dc()),2&e){const e=n.$implicit,o=_.Oc(6);_.lc(2),_.Vc("component",o.component)("componentId",null==o.lesson?null:o.lesson.coursemodule)("text",e.text)("contextInstanceId",null==o.lesson?null:o.lesson.coursemodule)("courseId",o.courseId),_.lc(1),_.Vc("id",e.id)("formControlName",e.name)}}function AddonModLessonPlayerPage_div_13_ion_card_4_form_2_ng_container_6_ng_container_2_Template(e,n){if(1&e&&(_.Cc(0),_.nd(1,AddonModLessonPlayerPage_div_13_ion_card_4_form_2_ng_container_6_ng_container_2_ion_item_1_Template,4,7,"ion-item",38),_.Bc()),2&e){const e=_.Oc(5);_.lc(1),_.Vc("ngForOf",e.question.options)}}function AddonModLessonPlayerPage_div_13_ion_card_4_form_2_ng_container_6_Template(e,n){if(1&e&&(_.Cc(0),_.nd(1,AddonModLessonPlayerPage_div_13_ion_card_4_form_2_ng_container_6_ion_radio_group_1_Template,2,2,"ion-radio-group",36),_.nd(2,AddonModLessonPlayerPage_div_13_ion_card_4_form_2_ng_container_6_ng_container_2_Template,2,1,"ng-container",18),_.Bc()),2&e){const e=_.Oc(4);_.lc(1),_.Vc("ngIf",!e.question.multi),_.lc(1),_.Vc("ngIf",e.question.multi)}}function AddonModLessonPlayerPage_div_13_ion_card_4_form_2_ng_container_7_ion_item_1_ion_select_option_6_Template(e,n){if(1&e&&(_.Ec(0,"ion-select-option",43),_.pd(1),_.Dc()),2&e){const e=n.$implicit;_.Vc("value",e.value),_.lc(1),_.rd(" ",e.label," ")}}function AddonModLessonPlayerPage_div_13_ion_card_4_form_2_ng_container_7_ion_item_1_Template(e,n){if(1&e&&(_.Ec(0,"ion-item",12),_.Ec(1,"ion-label"),_.Ec(2,"p"),_.zc(3,"core-format-text",23),_.Dc(),_.Dc(),_.Ec(4,"ion-select",41),_.Pc(5,"translate"),_.nd(6,AddonModLessonPlayerPage_div_13_ion_card_4_form_2_ng_container_7_ion_item_1_ion_select_option_6_Template,2,2,"ion-select-option",42),_.Dc(),_.Dc()),2&e){const e=n.$implicit,o=_.Oc(5);_.lc(3),_.Vc("component",o.component)("componentId",null==o.lesson?null:o.lesson.coursemodule)("text",e.text)("contextInstanceId",null==o.lesson?null:o.lesson.coursemodule)("courseId",o.courseId),_.lc(1),_.Vc("id",e.id)("formControlName",e.name)("cancelText",_.Qc(5,9,"core.cancel")),_.lc(2),_.Vc("ngForOf",e.options)}}function AddonModLessonPlayerPage_div_13_ion_card_4_form_2_ng_container_7_Template(e,n){if(1&e&&(_.Cc(0),_.nd(1,AddonModLessonPlayerPage_div_13_ion_card_4_form_2_ng_container_7_ion_item_1_Template,7,11,"ion-item",38),_.Bc()),2&e){const e=_.Oc(4);_.lc(1),_.Vc("ngForOf",e.question.rows)}}function AddonModLessonPlayerPage_div_13_ion_card_4_form_2_Template(e,n){if(1&e){const e=_.Fc();_.Ec(0,"form",24,25),_.Mc("ngSubmit",(function AddonModLessonPlayerPage_div_13_ion_card_4_form_2_Template_form_ngSubmit_0_listener(n){_.fd(e);return _.Oc(3).submitQuestion(n)})),_.nd(2,AddonModLessonPlayerPage_div_13_ion_card_4_form_2_ion_item_divider_2_Template,4,5,"ion-item-divider",16),_.Cc(3,26),_.nd(4,AddonModLessonPlayerPage_div_13_ion_card_4_form_2_ion_item_4_Template,4,7,"ion-item",27),_.nd(5,AddonModLessonPlayerPage_div_13_ion_card_4_form_2_ng_container_5_Template,3,2,"ng-container",28),_.nd(6,AddonModLessonPlayerPage_div_13_ion_card_4_form_2_ng_container_6_Template,3,2,"ng-container",28),_.nd(7,AddonModLessonPlayerPage_div_13_ion_card_4_form_2_ng_container_7_Template,2,1,"ng-container",28),_.Bc(),_.Ec(8,"ion-button",29),_.pd(9),_.Dc(),_.zc(10,"input",30),_.Dc()}if(2&e){const e=_.Oc(3);_.Vc("formGroup",e.questionForm),_.lc(2),_.Vc("ngIf",e.pageContent),_.lc(1),_.Vc("ngSwitch",e.question.template),_.lc(1),_.Vc("ngSwitchCase","shortanswer"),_.lc(1),_.Vc("ngSwitchCase","essay"),_.lc(1),_.Vc("ngSwitchCase","multichoice"),_.lc(1),_.Vc("ngSwitchCase","matching"),_.lc(2),_.rd(" ",e.question.submitLabel," ")}}function AddonModLessonPlayerPage_div_13_ion_card_4_Template(e,n){if(1&e&&(_.Ec(0,"ion-card"),_.nd(1,AddonModLessonPlayerPage_div_13_ion_card_4_ion_item_1_Template,3,5,"ion-item",16),_.nd(2,AddonModLessonPlayerPage_div_13_ion_card_4_form_2_Template,11,8,"form",22),_.Dc()),2&e){const e=_.Oc(2);_.lc(1),_.Vc("ngIf",!e.question&&e.pageContent),_.lc(1),_.Vc("ngIf",e.question&&e.loaded)}}function AddonModLessonPlayerPage_div_13_ion_list_5_ion_grid_1_ion_col_2_Template(e,n){if(1&e){const e=_.Fc();_.Ec(0,"ion-col",48),_.Ec(1,"ion-button",49),_.Mc("click",(function AddonModLessonPlayerPage_div_13_ion_list_5_ion_grid_1_ion_col_2_Template_ion_button_click_1_listener(){_.fd(e);const o=n.$implicit;return _.Oc(4).buttonClicked(o.data)})),_.pd(2),_.Dc(),_.Dc()}if(2&e){const e=n.$implicit;_.lc(1),_.Vc("id",e.id),_.lc(1),_.rd(" ",e.content," ")}}function AddonModLessonPlayerPage_div_13_ion_list_5_ion_grid_1_Template(e,n){if(1&e&&(_.Ec(0,"ion-grid",45),_.Ec(1,"ion-row",46),_.nd(2,AddonModLessonPlayerPage_div_13_ion_list_5_ion_grid_1_ion_col_2_Template,3,2,"ion-col",47),_.Dc(),_.Dc()),2&e){const e=_.Oc(3);_.lc(2),_.Vc("ngForOf",e.pageButtons)}}function AddonModLessonPlayerPage_div_13_ion_list_5_ion_item_2_Template(e,n){if(1&e&&(_.Ec(0,"ion-item",12),_.Ec(1,"ion-label"),_.Ec(2,"span",50),_.pd(3),_.Pc(4,"translate"),_.Dc(),_.zc(5,"core-progress-bar",51),_.Dc(),_.Dc()),2&e){const e=_.Oc(3);_.lc(2),_.Xc("id","addon-mod_lesson-",e.cmId,"-progress"),_.lc(1),_.rd(" ",_.Rc(4,4,"addon.mod_lesson.progresscompleted",_.ad(7,_c1,e.pageData.progress))," "),_.lc(2),_.Xc("ariaDescribedBy","addon-mod_lesson-",e.cmId,"-progress"),_.Vc("progress",e.pageData.progress)}}function AddonModLessonPlayerPage_div_13_ion_list_5_ion_card_3_Template(e,n){1&e&&(_.Ec(0,"ion-card",11),_.Ec(1,"ion-item",12),_.zc(2,"ion-icon",13),_.Ec(3,"ion-label"),_.pd(4),_.Pc(5,"translate"),_.Dc(),_.Dc(),_.Dc()),2&e&&(_.lc(4),_.qd(_.Qc(5,1,"addon.mod_lesson.progressbarteacherwarning2")))}function AddonModLessonPlayerPage_div_13_ion_list_5_Template(e,n){if(1&e&&(_.Ec(0,"ion-list"),_.nd(1,AddonModLessonPlayerPage_div_13_ion_list_5_ion_grid_1_Template,3,1,"ion-grid",44),_.nd(2,AddonModLessonPlayerPage_div_13_ion_list_5_ion_item_2_Template,6,9,"ion-item",16),_.nd(3,AddonModLessonPlayerPage_div_13_ion_list_5_ion_card_3_Template,6,3,"ion-card",7),_.Dc()),2&e){const e=_.Oc(2);_.lc(1),_.Vc("ngIf",null==e.pageButtons?null:e.pageButtons.length),_.lc(1),_.Vc("ngIf",(null==e.lesson?null:e.lesson.progressbar)&&!e.canManage&&e.pageData),_.lc(1),_.Vc("ngIf",(null==e.lesson?null:e.lesson.progressbar)&&e.canManage)}}function AddonModLessonPlayerPage_div_13_ion_card_6_Template(e,n){1&e&&(_.Ec(0,"ion-card",52),_.Ec(1,"ion-item"),_.zc(2,"ion-icon",53),_.Ec(3,"ion-label"),_.pd(4),_.Pc(5,"translate"),_.Dc(),_.Dc(),_.Dc()),2&e&&(_.lc(4),_.qd(_.Qc(5,1,"addon.mod_lesson.finishretakeoffline")))}function AddonModLessonPlayerPage_div_13_ion_card_7_ion_card_header_1_Template(e,n){1&e&&(_.Ec(0,"ion-card-header",12),_.Ec(1,"ion-card-title"),_.pd(2),_.Pc(3,"translate"),_.Dc(),_.Dc()),2&e&&(_.lc(2),_.qd(_.Qc(3,1,"addon.mod_lesson.congratulations")))}function AddonModLessonPlayerPage_div_13_ion_card_7_ion_item_2_Template(e,n){if(1&e&&(_.Ec(0,"ion-item",12),_.Ec(1,"ion-label"),_.pd(2),_.Dc(),_.Dc()),2&e){const e=_.Oc(3);_.lc(2),_.qd(e.eolData.notenoughtimespent.message)}}function AddonModLessonPlayerPage_div_13_ion_card_7_ion_item_3_Template(e,n){if(1&e&&(_.Ec(0,"ion-item",12),_.Ec(1,"ion-label"),_.pd(2),_.Dc(),_.Dc()),2&e){const e=_.Oc(3);_.lc(2),_.qd(e.eolData.numberofpagesviewed.message)}}function AddonModLessonPlayerPage_div_13_ion_card_7_ion_item_4_Template(e,n){if(1&e&&(_.Ec(0,"ion-item",12),_.Ec(1,"ion-label"),_.pd(2),_.Dc(),_.Dc()),2&e){const e=_.Oc(3);_.lc(2),_.qd(e.eolData.youshouldview.message)}}function AddonModLessonPlayerPage_div_13_ion_card_7_ion_item_5_Template(e,n){if(1&e&&(_.Ec(0,"ion-item",12),_.Ec(1,"ion-label"),_.pd(2),_.Dc(),_.Dc()),2&e){const e=_.Oc(3);_.lc(2),_.qd(e.eolData.numberofcorrectanswers.message)}}function AddonModLessonPlayerPage_div_13_ion_card_7_ion_item_6_Template(e,n){if(1&e&&(_.Ec(0,"ion-item",12),_.zc(1,"ion-label",56),_.Dc()),2&e){const e=_.Oc(3);_.lc(1),_.Vc("innerHTML",e.eolData.displayscorewithessays.message,_.gd)}}function AddonModLessonPlayerPage_div_13_ion_card_7_ion_item_7_Template(e,n){if(1&e&&(_.Ec(0,"ion-item",12),_.Ec(1,"ion-label"),_.pd(2),_.Dc(),_.Dc()),2&e){const e=_.Oc(3);_.lc(2),_.qd(e.eolData.displayscorewithoutessays.message)}}function AddonModLessonPlayerPage_div_13_ion_card_7_ion_item_8_Template(e,n){if(1&e&&(_.Ec(0,"ion-item",12),_.Ec(1,"ion-label"),_.pd(2),_.Dc(),_.Dc()),2&e){const e=_.Oc(3);_.lc(2),_.qd(e.eolData.yourcurrentgradeisoutof.message)}}function AddonModLessonPlayerPage_div_13_ion_card_7_ion_item_9_Template(e,n){if(1&e&&(_.Ec(0,"ion-item",12),_.Ec(1,"ion-label"),_.pd(2),_.Dc(),_.Dc()),2&e){const e=_.Oc(3);_.lc(2),_.qd(e.eolData.eolstudentoutoftimenoanswers.message)}}function AddonModLessonPlayerPage_div_13_ion_card_7_ion_item_10_Template(e,n){if(1&e&&(_.Ec(0,"ion-item",12),_.Ec(1,"ion-label"),_.pd(2),_.Dc(),_.Dc()),2&e){const e=_.Oc(3);_.lc(2),_.qd(e.eolData.welldone.message)}}function AddonModLessonPlayerPage_div_13_ion_card_7_ion_item_11_Template(e,n){if(1&e&&(_.Ec(0,"ion-item",12),_.Ec(1,"ion-label"),_.Ec(2,"span",50),_.pd(3),_.Pc(4,"translate"),_.Dc(),_.zc(5,"core-progress-bar",51),_.Dc(),_.Dc()),2&e){const e=_.Oc(3);_.lc(2),_.Xc("id","addon-mod_lesson-",e.cmId,"-progress-end"),_.lc(1),_.rd(" ",_.Rc(4,4,"addon.mod_lesson.progresscompleted",_.ad(7,_c1,e.eolData.progresscompleted.value))," "),_.lc(2),_.Xc("ariaDescribedBy","addon-mod_lesson-",e.cmId,"-progress-end"),_.Vc("progress",e.eolData.progresscompleted.value)}}function AddonModLessonPlayerPage_div_13_ion_card_7_ion_item_12_Template(e,n){if(1&e&&(_.Ec(0,"ion-item",12),_.Ec(1,"ion-label"),_.pd(2),_.Dc(),_.Dc()),2&e){const e=_.Oc(3);_.lc(2),_.qd(e.eolData.displayofgrade.message)}}function AddonModLessonPlayerPage_div_13_ion_card_7_ion_button_13_Template(e,n){if(1&e){const e=_.Fc();_.Ec(0,"ion-button",57),_.Mc("click",(function AddonModLessonPlayerPage_div_13_ion_card_7_ion_button_13_Template_ion_button_click_0_listener(){_.fd(e);const n=_.Oc(3);return n.reviewLesson(n.reviewPageId)})),_.pd(1),_.Pc(2,"translate"),_.Dc()}2&e&&(_.lc(1),_.rd(" ",_.Qc(2,1,"addon.mod_lesson.reviewlesson")," "))}function AddonModLessonPlayerPage_div_13_ion_card_7_ion_item_14_Template(e,n){if(1&e&&(_.Ec(0,"ion-item",12),_.Ec(1,"ion-label"),_.pd(2),_.Dc(),_.Dc()),2&e){const e=_.Oc(3);_.lc(2),_.qd(e.eolData.modattemptsnoteacher.message)}}function AddonModLessonPlayerPage_div_13_ion_card_7_ion_button_15_Template(e,n){if(1&e&&(_.Ec(0,"ion-button",58),_.zc(1,"core-format-text",2),_.Dc()),2&e){const e=_.Oc(3);_.Vc("href",e.activityLink.href)("capture",!0),_.lc(1),_.Vc("text",e.activityLink.label)("contextInstanceId",null==e.lesson?null:e.lesson.coursemodule)("courseId",e.courseId)}}function AddonModLessonPlayerPage_div_13_ion_card_7_ion_item_16_Template(e,n){if(1&e&&(_.Ec(0,"ion-item",12),_.Ec(1,"ion-label"),_.zc(2,"core-format-text",2),_.Dc(),_.Dc()),2&e){const e=_.Oc(3);_.lc(2),_.Vc("text",e.activityLink.label)("contextInstanceId",null==e.lesson?null:e.lesson.coursemodule)("courseId",e.courseId)}}function AddonModLessonPlayerPage_div_13_ion_card_7_Template(e,n){if(1&e&&(_.Ec(0,"ion-card"),_.nd(1,AddonModLessonPlayerPage_div_13_ion_card_7_ion_card_header_1_Template,4,3,"ion-card-header",16),_.nd(2,AddonModLessonPlayerPage_div_13_ion_card_7_ion_item_2_Template,3,1,"ion-item",16),_.nd(3,AddonModLessonPlayerPage_div_13_ion_card_7_ion_item_3_Template,3,1,"ion-item",16),_.nd(4,AddonModLessonPlayerPage_div_13_ion_card_7_ion_item_4_Template,3,1,"ion-item",16),_.nd(5,AddonModLessonPlayerPage_div_13_ion_card_7_ion_item_5_Template,3,1,"ion-item",16),_.nd(6,AddonModLessonPlayerPage_div_13_ion_card_7_ion_item_6_Template,2,1,"ion-item",16),_.nd(7,AddonModLessonPlayerPage_div_13_ion_card_7_ion_item_7_Template,3,1,"ion-item",16),_.nd(8,AddonModLessonPlayerPage_div_13_ion_card_7_ion_item_8_Template,3,1,"ion-item",16),_.nd(9,AddonModLessonPlayerPage_div_13_ion_card_7_ion_item_9_Template,3,1,"ion-item",16),_.nd(10,AddonModLessonPlayerPage_div_13_ion_card_7_ion_item_10_Template,3,1,"ion-item",16),_.nd(11,AddonModLessonPlayerPage_div_13_ion_card_7_ion_item_11_Template,6,9,"ion-item",16),_.nd(12,AddonModLessonPlayerPage_div_13_ion_card_7_ion_item_12_Template,3,1,"ion-item",16),_.nd(13,AddonModLessonPlayerPage_div_13_ion_card_7_ion_button_13_Template,3,3,"ion-button",54),_.nd(14,AddonModLessonPlayerPage_div_13_ion_card_7_ion_item_14_Template,3,1,"ion-item",16),_.nd(15,AddonModLessonPlayerPage_div_13_ion_card_7_ion_button_15_Template,2,5,"ion-button",55),_.nd(16,AddonModLessonPlayerPage_div_13_ion_card_7_ion_item_16_Template,3,3,"ion-item",16),_.Dc()),2&e){const e=_.Oc(2);_.lc(1),_.Vc("ngIf",e.eolData.gradelesson),_.lc(1),_.Vc("ngIf",e.eolData.notenoughtimespent),_.lc(1),_.Vc("ngIf",e.eolData.numberofpagesviewed),_.lc(1),_.Vc("ngIf",e.eolData.youshouldview),_.lc(1),_.Vc("ngIf",e.eolData.numberofcorrectanswers),_.lc(1),_.Vc("ngIf",e.eolData.displayscorewithessays),_.lc(1),_.Vc("ngIf",!e.eolData.displayscorewithessays&&e.eolData.displayscorewithoutessays),_.lc(1),_.Vc("ngIf",e.eolData.yourcurrentgradeisoutof),_.lc(1),_.Vc("ngIf",e.eolData.eolstudentoutoftimenoanswers),_.lc(1),_.Vc("ngIf",e.eolData.welldone),_.lc(1),_.Vc("ngIf",e.lesson.progressbar&&e.eolData.progresscompleted),_.lc(1),_.Vc("ngIf",e.eolData.displayofgrade),_.lc(1),_.Vc("ngIf",e.eolData.reviewlesson),_.lc(1),_.Vc("ngIf",e.eolData.modattemptsnoteacher),_.lc(1),_.Vc("ngIf",e.activityLink&&e.activityLink.formatted),_.lc(1),_.Vc("ngIf",e.activityLink&&!e.activityLink.formatted)}}function AddonModLessonPlayerPage_div_13_ion_list_8_ion_item_1_Template(e,n){if(1&e&&(_.Ec(0,"ion-item",12),_.Ec(1,"ion-label"),_.pd(2),_.Dc(),_.Dc()),2&e){const e=_.Oc(3);_.lc(2),_.qd(e.processData.ongoingscore)}}function AddonModLessonPlayerPage_div_13_ion_list_8_ion_item_2_div_2_Template(e,n){if(1&e&&(_.Ec(0,"div"),_.zc(1,"core-format-text",23),_.Dc()),2&e){const e=_.Oc(4);_.lc(1),_.Vc("component",e.component)("componentId",null==e.lesson?null:e.lesson.coursemodule)("text",e.processData.feedback)("contextInstanceId",null==e.lesson?null:e.lesson.coursemodule)("courseId",e.courseId)}}function AddonModLessonPlayerPage_div_13_ion_list_8_ion_item_2_div_3_Template(e,n){1&e&&(_.Ec(0,"div"),_.Ec(1,"p"),_.pd(2),_.Pc(3,"translate"),_.Dc(),_.Ec(4,"p"),_.pd(5),_.Pc(6,"translate"),_.Dc(),_.Ec(7,"p"),_.pd(8),_.Pc(9,"translate"),_.Dc(),_.Dc()),2&e&&(_.lc(2),_.qd(_.Qc(3,3,"addon.mod_lesson.gotoendoflesson")),_.lc(3),_.qd(_.Qc(6,5,"addon.mod_lesson.or")),_.lc(3),_.qd(_.Qc(9,7,"addon.mod_lesson.continuetonextpage")))}function AddonModLessonPlayerPage_div_13_ion_list_8_ion_item_2_Template(e,n){if(1&e&&(_.Ec(0,"ion-item",12),_.Ec(1,"ion-label"),_.nd(2,AddonModLessonPlayerPage_div_13_ion_list_8_ion_item_2_div_2_Template,2,5,"div",18),_.nd(3,AddonModLessonPlayerPage_div_13_ion_list_8_ion_item_2_div_3_Template,10,9,"div",18),_.Dc(),_.Dc()),2&e){const e=_.Oc(3);_.lc(2),_.Vc("ngIf",!e.processData.reviewmode),_.lc(1),_.Vc("ngIf",e.review)}}function AddonModLessonPlayerPage_div_13_ion_list_8_ion_button_3_Template(e,n){if(1&e){const e=_.Fc();_.Ec(0,"ion-button",61),_.Mc("click",(function AddonModLessonPlayerPage_div_13_ion_list_8_ion_button_3_Template_ion_button_click_0_listener(){_.fd(e);const n=_.Oc(3);return n.changePage(n.LESSON_EOL)})),_.pd(1),_.Pc(2,"translate"),_.Dc()}2&e&&(_.lc(1),_.rd(" ",_.Qc(2,1,"addon.mod_lesson.finish")," "))}function AddonModLessonPlayerPage_div_13_ion_list_8_ion_button_4_Template(e,n){if(1&e){const e=_.Fc();_.Ec(0,"ion-button",62),_.Mc("click",(function AddonModLessonPlayerPage_div_13_ion_list_8_ion_button_4_Template_ion_button_click_0_listener(){_.fd(e);const o=n.$implicit;return _.Oc(3).changePage(o.pageId,!0)})),_.pd(1),_.Pc(2,"translate"),_.Dc()}if(2&e){const e=n.$implicit;_.lc(1),_.rd(" ",_.Qc(2,1,e.label)," ")}}function AddonModLessonPlayerPage_div_13_ion_list_8_Template(e,n){if(1&e&&(_.Ec(0,"ion-list"),_.nd(1,AddonModLessonPlayerPage_div_13_ion_list_8_ion_item_1_Template,3,1,"ion-item",16),_.nd(2,AddonModLessonPlayerPage_div_13_ion_list_8_ion_item_2_Template,4,2,"ion-item",16),_.nd(3,AddonModLessonPlayerPage_div_13_ion_list_8_ion_button_3_Template,3,3,"ion-button",59),_.nd(4,AddonModLessonPlayerPage_div_13_ion_list_8_ion_button_4_Template,3,3,"ion-button",60),_.Dc()),2&e){const e=_.Oc(2);_.lc(1),_.Vc("ngIf",e.processData.ongoingscore&&!e.processData.reviewmode),_.lc(1),_.Vc("ngIf",!e.processData.reviewmode||e.review),_.lc(1),_.Vc("ngIf",e.review),_.lc(1),_.Vc("ngForOf",e.processDataButtons)}}const _c2=function(e){return{"addon-mod_lesson-slideshow":e}},_c3=function(e,n){return{width:e,height:n}};function AddonModLessonPlayerPage_div_13_Template(e,n){if(1&e&&(_.Ec(0,"div",14),_.nd(1,AddonModLessonPlayerPage_div_13_core_timer_1_Template,2,5,"core-timer",15),_.nd(2,AddonModLessonPlayerPage_div_13_ion_item_2_Template,5,6,"ion-item",16),_.nd(3,AddonModLessonPlayerPage_div_13_ion_item_3_Template,3,1,"ion-item",17),_.nd(4,AddonModLessonPlayerPage_div_13_ion_card_4_Template,3,2,"ion-card",18),_.nd(5,AddonModLessonPlayerPage_div_13_ion_list_5_Template,4,3,"ion-list",18),_.nd(6,AddonModLessonPlayerPage_div_13_ion_card_6_Template,6,3,"ion-card",19),_.nd(7,AddonModLessonPlayerPage_div_13_ion_card_7_Template,17,16,"ion-card",18),_.nd(8,AddonModLessonPlayerPage_div_13_ion_list_8_Template,5,4,"ion-list",18),_.Dc()),2&e){const e=_.Oc();_.Vc("ngClass",_.ad(10,_c2,e.lesson.slideshow))("ngStyle",_.bd(12,_c3,e.lessonWidth,e.lessonHeight)),_.lc(1),_.Vc("ngIf",e.endTime),_.lc(1),_.Vc("ngIf",e.showRetake&&!e.eolData&&!e.processData),_.lc(1),_.Vc("ngIf",e.pageData&&e.pageData.ongoingscore&&!e.eolData&&!e.processData),_.lc(1),_.Vc("ngIf",!e.eolData&&!e.processData),_.lc(1),_.Vc("ngIf",!e.eolData&&!e.processData),_.lc(1),_.Vc("ngIf",e.eolData&&!e.processData&&(null==e.eolData.offline?null:e.eolData.offline.value)),_.lc(1),_.Vc("ngIf",e.eolData&&!e.processData),_.lc(1),_.Vc("ngIf",e.processData)}}let F=(()=>{class AddonModLessonPlayerPage{constructor(e,n){this.changeDetector=e,this.formBuilder=n,this.component=T.b.COMPONENT,this.LESSON_EOL=T.b.LESSON_EOL,this.messages=[],this.processDataButtons=[],this.forceLeave=!1,this.menuShown=!1}ngOnInit(){return Object(P.a)(this,void 0,void 0,(function*(){try{this.cmId=c.a.getRequiredRouteNumberParam("cmId"),this.courseId=c.a.getRequiredRouteNumberParam("courseId"),this.password=c.a.getRouteParam("password"),this.review=!!c.a.getRouteBooleanParam("review"),this.currentPage=c.a.getRouteNumberParam("pageId"),this.retakeToReview=c.a.getRouteNumberParam("retake")}catch(e){return y.a.showErrorModal(e),c.a.back(),void 0}try{(yield this.fetchLessonData())&&O.a.deleteRetakeFinishedInSync(this.lesson.id)}finally{this.loaded=!0}}))}ngOnDestroy(){this.lesson&&D.a.unblockOperation(this.component,this.lesson.id)}canLeave(){return Object(P.a)(this,void 0,void 0,(function*(){return this.forceLeave||!this.questionForm||(this.question&&!this.eolData&&!this.processData&&this.originalData&&(L.a.basicLeftCompare(this.questionForm.getRawValue(),this.originalData,3)||(yield y.a.showConfirm(E.I.instant("core.confirmcanceledit")))),V.a.triggerFormCancelledEvent(this.formElement,b.b.getCurrentSiteId())),!0}))}ionViewWillLeave(){this.menuShown&&E.w.dismiss()}buttonClicked(e){this.processPage(e)}callFunction(e,n){return Object(P.a)(this,void 0,void 0,(function*(){try{return yield e()}catch(o){if(this.offline||this.review||!T.a.isLessonOffline(this.lesson))throw o;if(L.a.isWebServiceError(o))throw o;return this.offline=!0,this.jumps=yield T.a.getPagesPossibleJumps(this.lesson.id,{cmId:this.cmId,readingStrategy:1}),n.readingStrategy=1,n.jumps=this.jumps,n.offline=!0,e()}}))}changePage(e,n){return Object(P.a)(this,void 0,void 0,(function*(){if(n||this.eolData||this.currentPage!=e){this.loaded=!0,this.messages=[];try{yield this.loadPage(e)}catch(e){y.a.showErrorModalDefault(e,"Error loading page")}finally{this.loaded=!0}}}))}fetchLessonData(){var e;return Object(P.a)(this,void 0,void 0,(function*(){try{this.lesson=yield T.a.getLesson(this.courseId,this.cmId),this.title=this.lesson.name,D.a.blockOperation(this.component,this.lesson.id),yield O.a.waitForSync(this.lesson.id),this.offline=yield x.a.hasOfflineData(this.lesson.id),this.offline||I.a.isOnline()||!T.a.isLessonOffline(this.lesson)||this.review||(this.offline=!0);const n=this.lesson.id,o={cmId:this.cmId,readingStrategy:this.offline?1:2};this.accessInfo=yield this.callFunction((()=>T.a.getAccessInformation(n,o)),o);const t=[];if(this.canManage=this.accessInfo.canmanage,this.retake=this.accessInfo.attemptscount,this.showRetake=!this.currentPage&&this.retake>0,this.accessInfo.preventaccessreasons.length){const e=T.a.getPreventAccessReason(this.accessInfo,!!this.password,this.review);if(e)throw new v.a(e.message)}if(this.review&&this.retakeToReview!=this.accessInfo.attemptscount-1)throw new v.a(E.I.instant("addon.mod_lesson.errorreviewretakenotlast"));if(this.password){const e={password:this.password,cmId:this.cmId,readingStrategy:this.offline?1:2};t.push(this.callFunction((()=>T.a.getLessonWithPassword(n,e)),e).then((e=>{this.lesson=e})))}return this.offline&&t.push(T.a.getPagesPossibleJumps(this.lesson.id,{cmId:this.cmId,readingStrategy:1}).then((e=>{this.jumps=e}))),yield Promise.all(t),this.mediaFile=null===(e=this.lesson.mediafiles)||void 0===e?void 0:e[0],this.lessonWidth=this.lesson.slideshow?y.a.formatPixelsSize(this.lesson.mediawidth):"",this.lessonHeight=this.lesson.slideshow?y.a.formatPixelsSize(this.lesson.mediaheight):"",yield this.launchRetake(this.currentPage),!0}catch(e){return this.review&&this.retakeToReview&&L.a.isWebServiceError(e)&&(yield O.a.deleteRetakeFinishedInSync(this.lesson.id)),y.a.showErrorModalDefault(e,"core.course.errorgetmodule",!0),this.forceLeave=!0,c.a.back(),!1}}))}finishRetake(e){var n;return Object(P.a)(this,void 0,void 0,(function*(){if(!this.lesson)return;const o=this.lesson;if(this.messages=[],this.offline&&I.a.isOnline()){const e=yield L.a.ignoreErrors(O.a.syncLesson(o.id,!0,!0));if(null===(n=null==e?void 0:e.warnings)||void 0===n?void 0:n.length){if((yield T.a.getAccessInformation(o.id,{cmId:this.cmId})).attemptscount!=this.accessInfo.attemptscount)throw this.forceLeave=!0,c.a.back(),new v.a(e.warnings[0]);y.a.showAlert(void 0,e.warnings[0])}this.offline=!1}const t={password:this.password,outOfTime:e,review:this.review,offline:this.offline,accessInfo:this.accessInfo},i=yield this.callFunction((()=>T.a.finishRetake(o,this.courseId,t)),t);if(this.title=o.name,this.eolData=i.data,this.messages=this.messages.concat(i.messages),this.processData=void 0,w.b.trigger(w.b.ACTIVITY_DATA_SENT,{module:"lesson"}),this.activityLink=this.eolData.activitylink?A.a.formatActivityLink(this.eolData.activitylink.value):void 0,this.eolData.reviewlesson){const e=M.a.extractUrlParams(this.eolData.reviewlesson.value);e&&e.pageid?this.reviewPageId=Number(e.pageid):delete this.eolData.reviewlesson}this.logPageLoaded(T.b.LESSON_EOL,E.I.instant("addon.mod_lesson.congratulations"))}))}jumpToPage(e){return Object(P.a)(this,void 0,void 0,(function*(){return 0===e?(this.forceLeave=!0,c.a.back(),void 0):e==T.b.LESSON_EOL?this.finishRetake():(this.messages=[],this.loadPage(e))}))}launchRetake(e){return Object(P.a)(this,void 0,void 0,(function*(){let n;if(this.review);else if(this.offline){(yield x.a.hasFinishedRetake(this.lesson.id))&&(e=T.b.LESSON_EOL)}else n=yield T.a.launchRetake(this.lesson.id,this.password,e);if(this.currentPage=e||this.accessInfo.firstpageid,this.messages=(null==n?void 0:n.messages)||[],this.lesson.timelimit&&!this.accessInfo.canmanage){const e=yield T.a.getTimers(this.lesson.id,{cmId:this.cmId,readingStrategy:2});this.endTime=e[e.length-1].starttime+this.lesson.timelimit}return this.loadPage(this.currentPage)}))}loadMenu(){return Object(P.a)(this,void 0,void 0,(function*(){if(!this.loadingMenu&&this.lesson)try{this.loadingMenu=!0;const e=this.lesson.id,n={password:this.password,cmId:this.cmId,readingStrategy:this.offline?1:2},o=yield this.callFunction((()=>T.a.getPages(e,n)),n);this.lessonPages=o.map((e=>e.page))}catch(e){y.a.showErrorModalDefault(e,"Error loading menu.")}finally{this.loadingMenu=!1}}))}loadPage(e){var n,o;return Object(P.a)(this,void 0,void 0,(function*(){if(e==T.b.LESSON_EOL)return this.finishRetake();if(!this.lesson)return;const t=this.lesson,i={password:this.password,review:this.review,includeContents:!0,cmId:this.cmId,readingStrategy:this.offline?1:2,accessInfo:this.accessInfo,jumps:this.jumps,includeOfflineData:!0},s=yield this.callFunction((()=>T.a.getPageData(t,e,i)),i);if(s.newpageid==T.b.LESSON_EOL)return this.finishRetake();this.pageData=s,this.title=s.page.title,this.pageContent=A.a.getPageContentsFromPageData(s),this.loaded=!0,this.currentPage=e,this.messages=this.messages.concat(s.messages),this.eolData=this.processData=void 0,T.a.isQuestionPage(s.page.type)?(this.questionForm=this.formBuilder.group({}),this.pageButtons=[],this.question=A.a.getQuestionFromPageData(this.questionForm,s),this.originalData=this.questionForm.getRawValue()):(this.pageButtons=A.a.getPageButtonsFromHtml(s.pagecontent||""),this.question=void 0,this.originalData=void 0),!s.displaymenu||this.displayMenu||this.review||this.loadMenu(),this.displayMenu=!this.review&&!!s.displaymenu,this.firstPageLoaded?this.showRetake=!1:this.firstPageLoaded=!0,this.logPageLoaded(e,null!==(o=null===(n=s.page)||void 0===n?void 0:n.title)&&void 0!==o?o:"")}))}logPageLoaded(e,n){this.lesson&&R.a.logEvent({type:R.b.VIEW_ITEM,ws:"mod_lesson_get_page_data",name:this.lesson.name+": "+n,data:{id:this.lesson.id,pageid:e,category:"lesson"},url:`/mod/lesson/view.php?id=${this.lesson.id}&pageid=${e}`})}logContinuePageLoaded(){this.lesson&&R.a.logEvent({type:R.b.VIEW_ITEM,ws:"mod_lesson_process_page",name:this.lesson.name+": "+E.I.instant("addon.mod_lesson.continue"),data:{id:this.lesson.id,category:"lesson"},url:"/mod/lesson/continue.php"})}processPage(e,n){var o,t,i;return Object(P.a)(this,void 0,void 0,(function*(){if(!this.lesson||!this.pageData)return;this.loaded=!1;const s=this.lesson,a=this.pageData,c={password:this.password,review:this.review,offline:this.offline,accessInfo:this.accessInfo,jumps:this.jumps};try{const d=yield this.callFunction((()=>T.a.processPage(s,this.courseId,a,e,c)),c);if(n&&V.a.triggerFormSubmittedEvent(this.formElement,d.sent,b.b.getCurrentSiteId()),!this.offline&&!this.review&&T.a.isLessonOffline(s)){const e=this.accessInfo.attemptscount,n={cmId:this.cmId,readingStrategy:2};T.a.isQuestionPage((null===(t=null===(o=this.pageData)||void 0===o?void 0:o.page)||void 0===t?void 0:t.type)||-1)?T.a.getQuestionsAttemptsOnline(s.id,e,n):T.a.getContentPagesViewedOnline(s.id,e,n)}if(d.nodefaultresponse||d.inmediatejump)return yield this.jumpToPage(d.newpageid);d.feedback=A.a.removeQuestionFromFeedback(d.feedback),this.messages=d.messages,this.processData=d,this.processDataButtons=[],!s.review||d.correctanswer||d.noanswer||d.isessayquestion||d.maxattemptsreached||d.reviewmode||this.processDataButtons.push({label:"addon.mod_lesson.reviewquestionback",pageId:this.currentPage}),!s.review||d.correctanswer||d.noanswer||d.isessayquestion||d.maxattemptsreached?this.processDataButtons.push({label:"addon.mod_lesson.continue",pageId:d.newpageid}):(null===(i=a.page)||void 0===i?void 0:i.id)!=d.newpageid&&this.processDataButtons.push({label:"addon.mod_lesson.reviewquestioncontinue",pageId:d.newpageid}),this.logContinuePageLoaded()}catch(e){y.a.showErrorModalDefault(e,"Error processing page")}finally{this.loaded=!0}}))}reviewLesson(e){return Object(P.a)(this,void 0,void 0,(function*(){this.loaded=!1,this.review=!0,this.offline=!1;try{yield this.loadPage(e)}catch(e){y.a.showErrorModalDefault(e,"Error loading page")}finally{this.loaded=!0}}))}submitQuestion(e){e.preventDefault(),e.stopPropagation(),this.loaded=!1;const n=A.a.prepareQuestionData(this.question,this.questionForm.getRawValue());this.processPage(n,!0).finally((()=>{this.loaded=!0}))}timeUp(){return Object(P.a)(this,void 0,void 0,(function*(){this.endTime=void 0,this.loaded=!1;try{yield this.finishRetake(!0)}catch(e){y.a.showErrorModalDefault(e,"Error finishing attempt")}finally{this.loaded=!0}}))}showMenu(){return Object(P.a)(this,void 0,void 0,(function*(){this.menuShown=!0,yield y.a.openSideModal({component:k.a,componentProps:{pageInstance:this}}),this.menuShown=!1}))}}return AddonModLessonPlayerPage.ɵfac=function AddonModLessonPlayerPage_Factory(e){return new(e||AddonModLessonPlayerPage)(_.yc(_.j),_.yc(C.f))},AddonModLessonPlayerPage.ɵcmp=_.sc({type:AddonModLessonPlayerPage,selectors:[["page-addon-mod-lesson-player"]],viewQuery:function AddonModLessonPlayerPage_Query(e,n){var o;(1&e&&(_.ud(l.v,!0),_.ud(q,!0)),2&e)&&(_.dd(o=_.Nc())&&(n.content=o.first),_.dd(o=_.Nc())&&(n.formElement=o.first))},decls:14,vars:10,consts:[["slot","start"],[3,"text"],["contextLevel","module",3,"text","contextInstanceId","courseId"],["slot","end"],["fill","clear",3,"click",4,"ngIf"],[1,"limited-width"],[3,"hideUntil"],["class","core-info-card",4,"ngIf"],[3,"ngClass","ngStyle",4,"ngIf"],["fill","clear",3,"click"],["name","fas-bookmark","slot","icon-only","aria-hidden","true"],[1,"core-info-card"],[1,"ion-text-wrap"],["name","fas-circle-info","slot","start","aria-hidden","true"],[3,"ngClass","ngStyle"],[3,"endTime","timeLeftClassThreshold","timerText","finished",4,"ngIf"],["class","ion-text-wrap",4,"ngIf"],["class","addon-mod_lesson-ongoingscore ion-text-wrap",4,"ngIf"],[4,"ngIf"],["class","core-warning-card",4,"ngIf"],[3,"endTime","timeLeftClassThreshold","timerText","finished"],[1,"addon-mod_lesson-ongoingscore","ion-text-wrap"],[3,"formGroup","ngSubmit",4,"ngIf"],["contextLevel","module",3,"component","componentId","text","contextInstanceId","courseId"],[3,"formGroup","ngSubmit"],["questionFormEl",""],[3,"ngSwitch"],["class","ion-text-wrap",4,"ngSwitchCase"],[4,"ngSwitchCase"],["expand","block","type","submit",1,"ion-text-wrap","ion-margin","button-no-uppercase"],["type","submit",1,"core-submit-hidden-enter"],["stacked","",1,"sr-only"],["autocorrect","off",3,"type","placeholder","id","formControlName","maxlength"],[1,"sr-only"],["contextLevel","module","elementId","answer_editor",3,"placeholder","control","component","componentId","autoSave","contextInstanceId"],[1,"item-heading"],[3,"formControlName",4,"ngIf"],[3,"formControlName"],["class","ion-text-wrap",4,"ngFor","ngForOf"],["slot","end",3,"id","value","disabled"],["slot","end",3,"id","formControlName"],["interface","action-sheet",3,"id","formControlName","cancelText"],[3,"value",4,"ngFor","ngForOf"],[3,"value"],["class","ion-text-wrap addon-mod_lesson-pagebuttons",4,"ngIf"],[1,"ion-text-wrap","addon-mod_lesson-pagebuttons"],[1,"ion-align-items-center"],["size","12","size-md","6","size-lg","3","col-xl","",4,"ngFor","ngForOf"],["size","12","size-md","6","size-lg","3","col-xl",""],["expand","block","fill","outline",1,"ion-text-wrap","button-no-uppercase",3,"id","click"],[3,"id"],[3,"progress","ariaDescribedBy"],[1,"core-warning-card"],["name","fas-triangle-exclamation","slot","start","aria-hidden","true"],["expand","block","class","ion-text-wrap ion-margin button-no-uppercase",3,"click",4,"ngIf"],["expand","block","fill","outline","core-link","","class","ion-text-wrap ion-margin button-no-uppercase",3,"href","capture",4,"ngIf"],[3,"innerHTML"],["expand","block",1,"ion-text-wrap","ion-margin","button-no-uppercase",3,"click"],["expand","block","fill","outline","core-link","",1,"ion-text-wrap","ion-margin","button-no-uppercase",3,"href","capture"],["expand","block","class","ion-text-wrap ion-margin",3,"click",4,"ngIf"],["expand","block","class","ion-text-wrap ion-margin","fill","outline",3,"click",4,"ngFor","ngForOf"],["expand","block",1,"ion-text-wrap","ion-margin",3,"click"],["expand","block","fill","outline",1,"ion-text-wrap","ion-margin",3,"click"]],template:function AddonModLessonPlayerPage_Template(e,n){1&e&&(_.Ec(0,"ion-header"),_.Ec(1,"ion-toolbar"),_.Ec(2,"ion-buttons",0),_.zc(3,"ion-back-button",1),_.Pc(4,"translate"),_.Dc(),_.Ec(5,"ion-title"),_.Ec(6,"h1"),_.zc(7,"core-format-text",2),_.Dc(),_.Dc(),_.Ec(8,"ion-buttons",3),_.nd(9,AddonModLessonPlayerPage_ion_button_9_Template,3,3,"ion-button",4),_.Dc(),_.Dc(),_.Dc(),_.Ec(10,"ion-content",5),_.Ec(11,"core-loading",6),_.nd(12,AddonModLessonPlayerPage_ion_card_12_Template,5,1,"ion-card",7),_.nd(13,AddonModLessonPlayerPage_div_13_Template,9,15,"div",8),_.Dc(),_.Dc()),2&e&&(_.lc(3),_.Vc("text",_.Qc(4,8,"core.back")),_.lc(4),_.Vc("text",n.title)("contextInstanceId",null==n.lesson?null:n.lesson.coursemodule)("courseId",n.courseId),_.lc(2),_.Vc("ngIf",n.displayMenu||n.mediaFile),_.lc(2),_.Vc("hideUntil",n.loaded),_.lc(1),_.Vc("ngIf",n.lesson&&(null==n.messages?null:n.messages.length)),_.lc(1),_.Vc("ngIf",n.lesson))},styles:["[_nghost-%COMP%]{--background-odd:var(--light)}html.dark[_nghost-%COMP%], html.dark   [_nghost-%COMP%]{--background-odd:var(--medium)}[_nghost-%COMP%]     .addon-mod_lesson-slideshow{max-width:100%;max-height:100%;margin:0 auto}[_nghost-%COMP%]     .studentanswer{-webkit-padding-start:8px;padding-inline-start:8px}[_nghost-%COMP%]     table{width:100%;margin-top:1.5rem}[_nghost-%COMP%]     table tr:nth-child(odd){background-color:var(--background-odd)}[_nghost-%COMP%]     table tr:last-child td{border-bottom:0}[_nghost-%COMP%]     table td{padding:5px;line-height:1.5;border-bottom:1px solid var(--stroke)}"]}),AddonModLessonPlayerPage})();var U=o("MLi9"),S=o("4pns"),z=o("vuGA"),Q=o("8vmT"),N=o("PgjG"),j=o("ofXK"),$=o("nu3w"),B=o("FeAf"),H=o("TKc2"),J=o("edOc"),G=o("ACYt"),W=o("uYHD");function AddonModLessonUserRetakePage_div_14_ion_item_7_ion_select_option_7_Template(e,n){if(1&e&&(_.Ec(0,"ion-select-option",15),_.pd(1),_.Dc()),2&e){const e=n.$implicit;_.Vc("value",e.try),_.lc(1),_.rd(" ",e.label," ")}}const user_retake_c0=function(e){return{header:e}};function AddonModLessonUserRetakePage_div_14_ion_item_7_Template(e,n){if(1&e){const e=_.Fc();_.Ec(0,"ion-item",12),_.Ec(1,"ion-label"),_.pd(2),_.Pc(3,"translate"),_.Dc(),_.Ec(4,"ion-select",13),_.Mc("ngModelChange",(function AddonModLessonUserRetakePage_div_14_ion_item_7_Template_ion_select_ngModelChange_4_listener(n){_.fd(e);return _.Oc(2).selectedRetake=n}))("ionChange",(function AddonModLessonUserRetakePage_div_14_ion_item_7_Template_ion_select_ionChange_4_listener(){_.fd(e);const n=_.Oc(2);return n.changeRetake(n.selectedRetake)})),_.Pc(5,"translate"),_.Pc(6,"translate"),_.nd(7,AddonModLessonUserRetakePage_div_14_ion_item_7_ion_select_option_7_Template,2,2,"ion-select-option",14),_.Dc(),_.Dc()}if(2&e){const e=_.Oc(2);_.lc(2),_.qd(_.Qc(3,5,"addon.mod_lesson.attemptheader")),_.lc(2),_.Vc("ngModel",e.selectedRetake)("cancelText",_.Qc(5,7,"core.cancel"))("interfaceOptions",_.ad(11,user_retake_c0,_.Qc(6,9,"addon.mod_lesson.attemptheader"))),_.lc(3),_.Vc("ngForOf",e.student.attempts)}}const user_retake_c1=function(e){return{$a:e}};function AddonModLessonUserRetakePage_div_14_ion_list_8_Template(e,n){if(1&e&&(_.Ec(0,"ion-list",16),_.Ec(1,"ion-item"),_.Ec(2,"ion-label",12),_.Ec(3,"ion-grid",17),_.Ec(4,"ion-row"),_.Ec(5,"ion-col"),_.Ec(6,"p",18),_.pd(7),_.Pc(8,"translate"),_.Dc(),_.Ec(9,"p"),_.pd(10),_.Pc(11,"translate"),_.Dc(),_.Dc(),_.Ec(12,"ion-col"),_.Ec(13,"p",18),_.pd(14),_.Pc(15,"translate"),_.Dc(),_.Ec(16,"p"),_.pd(17),_.Dc(),_.Dc(),_.Dc(),_.Dc(),_.Dc(),_.Dc(),_.Ec(18,"ion-item",12),_.Ec(19,"ion-label"),_.Ec(20,"p",18),_.pd(21),_.Pc(22,"translate"),_.Dc(),_.Ec(23,"p"),_.pd(24),_.Dc(),_.Dc(),_.Dc(),_.Ec(25,"ion-item",12),_.Ec(26,"ion-label"),_.Ec(27,"p",18),_.pd(28),_.Pc(29,"translate"),_.Dc(),_.Ec(30,"p"),_.pd(31),_.Pc(32,"coreFormatDate"),_.Dc(),_.Dc(),_.Dc(),_.Dc()),2&e){const e=_.Oc(2);_.lc(7),_.qd(_.Qc(8,9,"addon.mod_lesson.grade")),_.lc(3),_.qd(_.Rc(11,11,"core.percentagenumber",_.ad(22,user_retake_c1,e.retake.userstats.grade))),_.lc(4),_.qd(_.Qc(15,14,"addon.mod_lesson.rawgrade")),_.lc(3),_.sd("",e.retake.userstats.gradeinfo.earned," / ",e.retake.userstats.gradeinfo.total,""),_.lc(4),_.qd(_.Qc(22,16,"addon.mod_lesson.timetaken")),_.lc(3),_.qd(e.timeTakenReadable),_.lc(4),_.qd(_.Qc(29,18,"addon.mod_lesson.completed")),_.lc(3),_.qd(_.Qc(32,20,1e3*e.retake.userstats.completed))}}function AddonModLessonUserRetakePage_div_14_ion_item_9_Template(e,n){1&e&&(_.Ec(0,"ion-item",12),_.Ec(1,"ion-label"),_.pd(2),_.Pc(3,"translate"),_.Dc(),_.Dc()),2&e&&(_.lc(2),_.qd(_.Qc(3,1,"addon.mod_lesson.notcompleted")))}function AddonModLessonUserRetakePage_div_14_ng_container_10_ion_card_1_ion_item_16_Template(e,n){1&e&&(_.Ec(0,"ion-item",12),_.Ec(1,"ion-label"),_.Ec(2,"p"),_.pd(3),_.Pc(4,"translate"),_.Dc(),_.Dc(),_.Dc()),2&e&&(_.lc(3),_.qd(_.Qc(4,1,"addon.mod_lesson.didnotanswerquestion")))}function AddonModLessonUserRetakePage_div_14_ng_container_10_ion_card_1_div_17_ng_container_1_ion_item_1_Template(e,n){if(1&e&&(_.Ec(0,"ion-item"),_.Ec(1,"ion-label",12),_.Ec(2,"ion-grid",17),_.Ec(3,"ion-row"),_.Ec(4,"ion-col"),_.Ec(5,"ion-button",25),_.pd(6),_.Dc(),_.Dc(),_.Ec(7,"ion-col"),_.zc(8,"p",26),_.Dc(),_.Dc(),_.Dc(),_.Dc(),_.Dc()),2&e){const e=_.Oc().$implicit;_.lc(5),_.Vc("disabled",!0),_.lc(1),_.rd(" ",e[0].buttonText," "),_.lc(2),_.Vc("innerHTML",e[0].content,_.gd)}}function AddonModLessonUserRetakePage_div_14_ng_container_10_ion_card_1_div_17_ng_container_1_ng_container_2_ion_item_1_ion_badge_4_Template(e,n){if(1&e&&(_.Ec(0,"ion-badge",32),_.zc(1,"core-format-text",29),_.Dc()),2&e){const e=_.Oc(3).$implicit,n=_.Oc(5);_.lc(1),_.Vc("component",n.component)("componentId",null==n.lesson?null:n.lesson.coursemodule)("text",e[1])("contextInstanceId",null==n.lesson?null:n.lesson.coursemodule)("courseId",n.courseId)}}const user_retake_c2=function(e){return{"addon-mod_lesson-highlight":e}};function AddonModLessonUserRetakePage_div_14_ng_container_10_ion_card_1_div_17_ng_container_1_ng_container_2_ion_item_1_Template(e,n){if(1&e&&(_.Ec(0,"ion-item",28),_.Ec(1,"ion-label"),_.Ec(2,"p"),_.zc(3,"core-format-text",29),_.Dc(),_.nd(4,AddonModLessonUserRetakePage_div_14_ng_container_10_ion_card_1_div_17_ng_container_1_ng_container_2_ion_item_1_ion_badge_4_Template,2,5,"ion-badge",30),_.Dc(),_.zc(5,"ion-checkbox",31),_.Dc()),2&e){const e=_.Oc(2).$implicit,n=_.Oc(5);_.Vc("ngClass",_.ad(10,user_retake_c2,e[0].highlight)),_.lc(3),_.Vc("component",n.component)("componentId",null==n.lesson?null:n.lesson.coursemodule)("text",e[0].content)("contextInstanceId",null==n.lesson?null:n.lesson.coursemodule)("courseId",n.courseId),_.lc(1),_.Vc("ngIf",e[1]),_.lc(1),_.Vc("ngModel",e[0].checked)("disabled",!0),_.mc("name",e[0].name)}}function AddonModLessonUserRetakePage_div_14_ng_container_10_ion_card_1_div_17_ng_container_1_ng_container_2_ion_item_2_ion_badge_4_Template(e,n){if(1&e&&(_.Ec(0,"ion-badge",32),_.zc(1,"core-format-text",29),_.Dc()),2&e){const e=_.Oc(3).$implicit,n=_.Oc(5);_.lc(1),_.Vc("component",n.component)("componentId",null==n.lesson?null:n.lesson.coursemodule)("text",e[1])("contextInstanceId",null==n.lesson?null:n.lesson.coursemodule)("courseId",n.courseId)}}function AddonModLessonUserRetakePage_div_14_ng_container_10_ion_card_1_div_17_ng_container_1_ng_container_2_ion_item_2_Template(e,n){if(1&e&&(_.Ec(0,"ion-item",12),_.Ec(1,"ion-label"),_.Ec(2,"p"),_.pd(3),_.Dc(),_.nd(4,AddonModLessonUserRetakePage_div_14_ng_container_10_ion_card_1_div_17_ng_container_1_ng_container_2_ion_item_2_ion_badge_4_Template,2,5,"ion-badge",30),_.Dc(),_.Dc()),2&e){const e=_.Oc(2).$implicit;_.lc(3),_.qd(e[0].value),_.lc(1),_.Vc("ngIf",e[1])}}function AddonModLessonUserRetakePage_div_14_ng_container_10_ion_card_1_div_17_ng_container_1_ng_container_2_ion_item_3_ion_badge_10_Template(e,n){if(1&e&&(_.Ec(0,"ion-badge",32),_.zc(1,"core-format-text",29),_.Dc()),2&e){const e=_.Oc(3).$implicit,n=_.Oc(5);_.lc(1),_.Vc("component",n.component)("componentId",null==n.lesson?null:n.lesson.coursemodule)("text",e[1])("contextInstanceId",null==n.lesson?null:n.lesson.coursemodule)("courseId",n.courseId)}}function AddonModLessonUserRetakePage_div_14_ng_container_10_ion_card_1_div_17_ng_container_1_ng_container_2_ion_item_3_Template(e,n){if(1&e&&(_.Ec(0,"ion-item"),_.Ec(1,"ion-label",12),_.Ec(2,"ion-grid",17),_.Ec(3,"ion-row"),_.Ec(4,"ion-col"),_.Ec(5,"p"),_.zc(6,"core-format-text",29),_.Dc(),_.Dc(),_.Ec(7,"ion-col"),_.Ec(8,"p"),_.pd(9),_.Dc(),_.nd(10,AddonModLessonUserRetakePage_div_14_ng_container_10_ion_card_1_div_17_ng_container_1_ng_container_2_ion_item_3_ion_badge_10_Template,2,5,"ion-badge",30),_.Dc(),_.Dc(),_.Dc(),_.Dc(),_.Dc()),2&e){const e=_.Oc(2).$implicit,n=_.Oc(5);_.lc(6),_.Vc("component",n.component)("componentId",null==n.lesson?null:n.lesson.coursemodule)("text",e[0].content)("contextInstanceId",null==n.lesson?null:n.lesson.coursemodule)("courseId",n.courseId),_.lc(3),_.qd(e[0].value),_.lc(1),_.Vc("ngIf",e[1])}}function AddonModLessonUserRetakePage_div_14_ng_container_10_ion_card_1_div_17_ng_container_1_ng_container_2_ion_item_4_ion_badge_4_Template(e,n){if(1&e&&(_.Ec(0,"ion-badge",32),_.zc(1,"core-format-text",29),_.Dc()),2&e){const e=_.Oc(3).$implicit,n=_.Oc(5);_.lc(1),_.Vc("component",n.component)("componentId",null==n.lesson?null:n.lesson.coursemodule)("text",e[1])("contextInstanceId",null==n.lesson?null:n.lesson.coursemodule)("courseId",n.courseId)}}function AddonModLessonUserRetakePage_div_14_ng_container_10_ion_card_1_div_17_ng_container_1_ng_container_2_ion_item_4_Template(e,n){if(1&e&&(_.Ec(0,"ion-item",12),_.Ec(1,"ion-label"),_.Ec(2,"p"),_.zc(3,"core-format-text",29),_.Dc(),_.nd(4,AddonModLessonUserRetakePage_div_14_ng_container_10_ion_card_1_div_17_ng_container_1_ng_container_2_ion_item_4_ion_badge_4_Template,2,5,"ion-badge",30),_.Dc(),_.Dc()),2&e){const e=_.Oc(2).$implicit,n=_.Oc(5);_.lc(3),_.Vc("component",n.component)("componentId",null==n.lesson?null:n.lesson.coursemodule)("text",e[0])("contextInstanceId",null==n.lesson?null:n.lesson.coursemodule)("courseId",n.courseId),_.lc(1),_.Vc("ngIf",e[1])}}function AddonModLessonUserRetakePage_div_14_ng_container_10_ion_card_1_div_17_ng_container_1_ng_container_2_Template(e,n){if(1&e&&(_.Cc(0),_.nd(1,AddonModLessonUserRetakePage_div_14_ng_container_10_ion_card_1_div_17_ng_container_1_ng_container_2_ion_item_1_Template,6,12,"ion-item",27),_.nd(2,AddonModLessonUserRetakePage_div_14_ng_container_10_ion_card_1_div_17_ng_container_1_ng_container_2_ion_item_2_Template,5,2,"ion-item",10),_.nd(3,AddonModLessonUserRetakePage_div_14_ng_container_10_ion_card_1_div_17_ng_container_1_ng_container_2_ion_item_3_Template,11,7,"ion-item",6),_.nd(4,AddonModLessonUserRetakePage_div_14_ng_container_10_ion_card_1_div_17_ng_container_1_ng_container_2_ion_item_4_Template,5,6,"ion-item",10),_.Bc()),2&e){const e=_.Oc().$implicit;_.lc(1),_.Vc("ngIf",e[0].isCheckbox),_.lc(1),_.Vc("ngIf",e[0].isText),_.lc(1),_.Vc("ngIf",e[0].isSelect),_.lc(1),_.Vc("ngIf",!e[0].isCheckbox&&!e[0].isText&&!e[0].isSelect)}}function AddonModLessonUserRetakePage_div_14_ng_container_10_ion_card_1_div_17_ng_container_1_ion_item_3_ion_badge_4_Template(e,n){if(1&e&&(_.Ec(0,"ion-badge",32),_.zc(1,"core-format-text",29),_.Dc()),2&e){const e=_.Oc(2).$implicit,n=_.Oc(5);_.lc(1),_.Vc("component",n.component)("componentId",null==n.lesson?null:n.lesson.coursemodule)("text",e[1])("contextInstanceId",null==n.lesson?null:n.lesson.coursemodule)("courseId",n.courseId)}}function AddonModLessonUserRetakePage_div_14_ng_container_10_ion_card_1_div_17_ng_container_1_ion_item_3_Template(e,n){if(1&e&&(_.Ec(0,"ion-item",12),_.Ec(1,"ion-label"),_.Ec(2,"p"),_.zc(3,"core-format-text",29),_.Dc(),_.nd(4,AddonModLessonUserRetakePage_div_14_ng_container_10_ion_card_1_div_17_ng_container_1_ion_item_3_ion_badge_4_Template,2,5,"ion-badge",30),_.Dc(),_.Dc()),2&e){const e=_.Oc().$implicit,n=_.Oc(5);_.lc(3),_.Vc("component",n.component)("componentId",null==n.lesson?null:n.lesson.coursemodule)("text",e[0])("contextInstanceId",null==n.lesson?null:n.lesson.coursemodule)("courseId",n.courseId),_.lc(1),_.Vc("ngIf",e[1])}}function AddonModLessonUserRetakePage_div_14_ng_container_10_ion_card_1_div_17_ng_container_1_Template(e,n){if(1&e&&(_.Cc(0),_.nd(1,AddonModLessonUserRetakePage_div_14_ng_container_10_ion_card_1_div_17_ng_container_1_ion_item_1_Template,9,3,"ion-item",6),_.nd(2,AddonModLessonUserRetakePage_div_14_ng_container_10_ion_card_1_div_17_ng_container_1_ng_container_2_Template,5,4,"ng-container",6),_.nd(3,AddonModLessonUserRetakePage_div_14_ng_container_10_ion_card_1_div_17_ng_container_1_ion_item_3_Template,5,6,"ion-item",10),_.Bc()),2&e){const e=_.Oc(2).$implicit;_.lc(1),_.Vc("ngIf",e.isContent),_.lc(1),_.Vc("ngIf",e.isQuestion),_.lc(1),_.Vc("ngIf",!e.isContent&&!e.isQuestion)}}function AddonModLessonUserRetakePage_div_14_ng_container_10_ion_card_1_div_17_ion_item_2_Template(e,n){if(1&e&&(_.Ec(0,"ion-item",12),_.Ec(1,"ion-label"),_.Ec(2,"p",18),_.pd(3),_.Pc(4,"translate"),_.Dc(),_.Ec(5,"p"),_.zc(6,"core-format-text",29),_.Dc(),_.Dc(),_.Dc()),2&e){const e=_.Oc(2).$implicit,n=_.Oc(3);_.lc(3),_.qd(_.Qc(4,6,"addon.mod_lesson.response")),_.lc(3),_.Vc("component",n.component)("componentId",null==n.lesson?null:n.lesson.coursemodule)("text",e.answerdata.response)("contextInstanceId",null==n.lesson?null:n.lesson.coursemodule)("courseId",n.courseId)}}function AddonModLessonUserRetakePage_div_14_ng_container_10_ion_card_1_div_17_ion_item_3_Template(e,n){if(1&e&&(_.Ec(0,"ion-item",12),_.Ec(1,"ion-label"),_.Ec(2,"p"),_.pd(3),_.Dc(),_.Dc(),_.Dc()),2&e){const e=_.Oc(2).$implicit;_.lc(3),_.qd(e.answerdata.score)}}function AddonModLessonUserRetakePage_div_14_ng_container_10_ion_card_1_div_17_Template(e,n){if(1&e&&(_.Ec(0,"div",23),_.nd(1,AddonModLessonUserRetakePage_div_14_ng_container_10_ion_card_1_div_17_ng_container_1_Template,4,3,"ng-container",24),_.nd(2,AddonModLessonUserRetakePage_div_14_ng_container_10_ion_card_1_div_17_ion_item_2_Template,7,8,"ion-item",10),_.nd(3,AddonModLessonUserRetakePage_div_14_ng_container_10_ion_card_1_div_17_ion_item_3_Template,4,1,"ion-item",10),_.Dc()),2&e){const e=_.Oc().$implicit;_.lc(1),_.Vc("ngForOf",e.answerdata.answers),_.lc(1),_.Vc("ngIf",e.answerdata.response),_.lc(1),_.Vc("ngIf",e.answerdata.score)}}const user_retake_c3=function(e){return{"text-dimmed":e}};function AddonModLessonUserRetakePage_div_14_ng_container_10_ion_card_1_Template(e,n){if(1&e&&(_.Ec(0,"ion-card",20),_.Ec(1,"ion-card-header",12),_.Ec(2,"ion-card-title"),_.pd(3),_.Dc(),_.Dc(),_.Ec(4,"ion-item",12),_.Ec(5,"ion-label"),_.Ec(6,"p",18),_.pd(7),_.Pc(8,"translate"),_.Dc(),_.Ec(9,"p"),_.zc(10,"core-format-text",21),_.Dc(),_.Dc(),_.Dc(),_.Ec(11,"ion-item",12),_.Ec(12,"ion-label"),_.Ec(13,"p",18),_.pd(14),_.Pc(15,"translate"),_.Dc(),_.Dc(),_.Dc(),_.nd(16,AddonModLessonUserRetakePage_div_14_ng_container_10_ion_card_1_ion_item_16_Template,5,3,"ion-item",10),_.nd(17,AddonModLessonUserRetakePage_div_14_ng_container_10_ion_card_1_div_17_Template,4,3,"div",22),_.Dc()),2&e){const e=n.$implicit,o=_.Oc(3);_.Vc("ngClass",_.ad(16,user_retake_c3,e.grayout)),_.lc(3),_.sd("",e.qtype,": ",e.title,""),_.lc(4),_.qd(_.Qc(8,12,"addon.mod_lesson.question")),_.lc(3),_.Vc("component",o.component)("componentId",null==o.lesson?null:o.lesson.coursemodule)("text",e.contents)("contextInstanceId",null==o.lesson?null:o.lesson.coursemodule)("courseId",o.courseId),_.lc(4),_.qd(_.Qc(15,14,"addon.mod_lesson.answer")),_.lc(2),_.Vc("ngIf",!e.answerdata||!e.answerdata.answers||!e.answerdata.answers.length),_.lc(1),_.Vc("ngIf",e.answerdata&&e.answerdata.answers&&e.answerdata.answers.length)}}function AddonModLessonUserRetakePage_div_14_ng_container_10_Template(e,n){if(1&e&&(_.Cc(0),_.nd(1,AddonModLessonUserRetakePage_div_14_ng_container_10_ion_card_1_Template,18,18,"ion-card",19),_.Bc()),2&e){const e=_.Oc(2);_.lc(1),_.Vc("ngForOf",e.retake.answerpages)}}function AddonModLessonUserRetakePage_div_14_Template(e,n){if(1&e&&(_.Ec(0,"div"),_.Ec(1,"ion-item",7),_.zc(2,"core-user-avatar",8),_.Ec(3,"ion-label"),_.Ec(4,"h2"),_.pd(5),_.Dc(),_.zc(6,"core-progress-bar",9),_.Dc(),_.Dc(),_.nd(7,AddonModLessonUserRetakePage_div_14_ion_item_7_Template,8,13,"ion-item",10),_.nd(8,AddonModLessonUserRetakePage_div_14_ion_list_8_Template,33,24,"ion-list",11),_.nd(9,AddonModLessonUserRetakePage_div_14_ion_item_9_Template,4,3,"ion-item",10),_.nd(10,AddonModLessonUserRetakePage_div_14_ng_container_10_Template,2,1,"ng-container",6),_.Dc()),2&e){const e=_.Oc();_.lc(1),_.Vc("userId",e.student.id)("courseId",e.courseId),_.mc("aria-label",e.student.fullname),_.lc(1),_.Vc("user",e.student)("userId",e.student.id)("courseId",e.courseId)("linkProfile",!1),_.lc(3),_.qd(e.student.fullname),_.lc(1),_.Vc("progress",e.student.bestgrade),_.lc(1),_.Vc("ngIf",e.student.attempts&&e.student.attempts.length>1),_.lc(1),_.Vc("ngIf",e.retake&&e.retake.userstats&&e.retake.userstats.gradeinfo),_.lc(1),_.Vc("ngIf",e.retake&&(!e.retake.userstats||!e.retake.userstats.gradeinfo)),_.lc(1),_.Vc("ngIf",e.retake)}}let X=(()=>{class AddonModLessonUserRetakePage{constructor(){this.component=T.b.COMPONENT,this.logView=Q.a.once((()=>this.performLogView()))}ngOnInit(){try{this.cmId=c.a.getRequiredRouteNumberParam("cmId"),this.courseId=c.a.getRequiredRouteNumberParam("courseId"),this.userId=c.a.getRouteNumberParam("userId")||b.b.getCurrentSiteUserId(),this.retakeNumber=c.a.getRouteNumberParam("retake")}catch(e){return y.a.showErrorModal(e),c.a.back(),void 0}this.fetchData().finally((()=>{this.loaded=!0}))}changeRetake(e){var n;return Object(P.a)(this,void 0,void 0,(function*(){this.loaded=!1;try{yield this.setRetake(e),this.performLogView()}catch(e){this.selectedRetake=null!==(n=this.previousSelectedRetake)&&void 0!==n?n:this.selectedRetake,y.a.showErrorModal(L.a.addDataNotDownloadedError(e,"Error getting attempt."))}finally{this.loaded=!0}}))}doRefresh(e){this.refreshData().finally((()=>{null==e?void 0:e.complete()}))}fetchData(){var e;return Object(P.a)(this,void 0,void 0,(function*(){try{this.lesson=yield T.a.getLesson(this.courseId,this.cmId);const n=yield T.a.getRetakesOverview(this.lesson.id,{cmId:this.cmId}),o=null===(e=null==n?void 0:n.students)||void 0===e?void 0:e.find((e=>e.id==this.userId));if(!o)throw new v.a(E.I.instant("addon.mod_lesson.cannotfinduser"));if(!o.attempts.length)throw new v.a(E.I.instant("addon.mod_lesson.cannotfindattempt"));o.bestgrade=z.b.roundToDecimals(o.bestgrade,2),o.attempts.forEach((e=>{this.selectedRetake||this.retakeNumber!=e.try||(this.selectedRetake=this.retakeNumber),e.label=A.a.getRetakeLabel(e)})),this.selectedRetake||(this.selectedRetake=o.attempts[o.attempts.length-1].try);const t=yield L.a.ignoreErrors(S.a.getProfile(o.id,this.courseId,!0));this.student=o,this.student.profileimageurl=null==t?void 0:t.profileimageurl,yield this.setRetake(this.selectedRetake),this.logView()}catch(e){y.a.showErrorModalDefault(e,"Error getting data.",!0)}}))}refreshData(){return Object(P.a)(this,void 0,void 0,(function*(){const e=[];e.push(T.a.invalidateLessonData(this.courseId)),this.lesson&&(e.push(T.a.invalidateRetakesOverview(this.lesson.id)),e.push(T.a.invalidateUserRetakesForUser(this.lesson.id,this.userId))),yield L.a.ignoreErrors(Promise.all(e)),yield this.fetchData()}))}setRetake(e){return Object(P.a)(this,void 0,void 0,(function*(){this.selectedRetake=e;const n=yield T.a.getUserRetake(this.lesson.id,e,{cmId:this.cmId,userId:this.userId});this.retake=this.formatRetake(n),this.previousSelectedRetake=this.selectedRetake}))}formatRetake(e){const n=e;return n.userstats.gradeinfo&&(n.userstats.grade=z.b.roundToDecimals(n.userstats.grade,2),this.timeTakenReadable=Q.a.formatTime(n.userstats.timetotake)),n.answerpages.forEach((e=>{var n,o;T.a.answerPageIsContent(e)?(e.isContent=!0,(null===(n=e.answerdata)||void 0===n?void 0:n.answers)&&e.answerdata.answers.forEach((e=>{e[0]=A.a.getContentPageAnswerDataFromHtml(e[0])}))):T.a.answerPageIsQuestion(e)&&(e.isQuestion=!0,(null===(o=e.answerdata)||void 0===o?void 0:o.answers)&&e.answerdata.answers.forEach((e=>{e[0]=A.a.getQuestionPageAnswerDataFromHtml(e[0])})))})),n}performLogView(){this.lesson&&R.a.logEvent({type:R.b.VIEW_ITEM,ws:"mod_lesson_get_user_attempt",name:this.lesson.name+": "+E.I.instant("addon.mod_lesson.detailedstats"),data:{id:this.lesson.id,userid:this.userId,try:this.selectedRetake,category:"lesson"},url:`/mod/lesson/report.php?id=${this.cmId}&action=reportdetail&userid=${this.userId}&try=${this.selectedRetake}`})}}return AddonModLessonUserRetakePage.ɵfac=function AddonModLessonUserRetakePage_Factory(e){return new(e||AddonModLessonUserRetakePage)},AddonModLessonUserRetakePage.ɵcmp=_.sc({type:AddonModLessonUserRetakePage,selectors:[["page-addon-mod-lesson-user-retake"]],decls:15,vars:12,consts:[["slot","start"],[3,"text"],[1,"limited-width"],["slot","fixed",3,"disabled","ionRefresh"],[3,"pullingText"],[3,"hideUntil"],[4,"ngIf"],["core-user-link","",1,"ion-text-wrap",3,"userId","courseId"],["slot","start",3,"user","userId","courseId","linkProfile"],["a11yText","addon.mod_lesson.grade",3,"progress"],["class","ion-text-wrap",4,"ngIf"],["class","addon-mod_lesson-userstats",4,"ngIf"],[1,"ion-text-wrap"],["interface","action-sheet",3,"ngModel","cancelText","interfaceOptions","ngModelChange","ionChange"],[3,"value",4,"ngFor","ngForOf"],[3,"value"],[1,"addon-mod_lesson-userstats"],[1,"ion-no-padding"],[1,"item-heading"],["class","addon-mod_lesson-answerpage",3,"ngClass",4,"ngFor","ngForOf"],[1,"addon-mod_lesson-answerpage",3,"ngClass"],["collapsible-item","","contextLevel","module",3,"component","componentId","text","contextInstanceId","courseId"],["class","addon-mod_lesson-answer",4,"ngIf"],[1,"addon-mod_lesson-answer"],[4,"ngFor","ngForOf"],["expand","block","fill","outline",1,"ion-text-wrap",3,"disabled"],[3,"innerHTML"],["class","ion-text-wrap",3,"ngClass",4,"ngIf"],[1,"ion-text-wrap",3,"ngClass"],["contextLevel","module",3,"component","componentId","text","contextInstanceId","courseId"],["color","dark",4,"ngIf"],["slot","end",3,"ngModel","disabled"],["color","dark"]],template:function AddonModLessonUserRetakePage_Template(e,n){1&e&&(_.Ec(0,"ion-header"),_.Ec(1,"ion-toolbar"),_.Ec(2,"ion-buttons",0),_.zc(3,"ion-back-button",1),_.Pc(4,"translate"),_.Dc(),_.Ec(5,"ion-title"),_.Ec(6,"h1"),_.pd(7),_.Pc(8,"translate"),_.Dc(),_.Dc(),_.Dc(),_.Dc(),_.Ec(9,"ion-content",2),_.Ec(10,"ion-refresher",3),_.Mc("ionRefresh",(function AddonModLessonUserRetakePage_Template_ion_refresher_ionRefresh_10_listener(e){return n.doRefresh(e.target)})),_.zc(11,"ion-refresher-content",4),_.Pc(12,"translate"),_.Dc(),_.Ec(13,"core-loading",5),_.nd(14,AddonModLessonUserRetakePage_div_14_Template,11,13,"div",6),_.Dc(),_.Dc()),2&e&&(_.lc(3),_.Vc("text",_.Qc(4,6,"core.back")),_.lc(4),_.qd(_.Qc(8,8,"addon.mod_lesson.detailedstats")),_.lc(3),_.Vc("disabled",!n.loaded),_.lc(1),_.Wc("pullingText",_.Qc(12,10,"core.pulltorefresh")),_.lc(2),_.Vc("hideUntil",n.loaded),_.lc(1),_.Vc("ngIf",n.student))},directives:[l.C,l.Ab,l.m,l.h,l.i,l.yb,g.a,l.v,l.bb,l.cb,N.a,j.t,l.I,$.a,B.a,l.O,H.a,l.lb,l.Ob,C.r,C.u,j.s,l.mb,l.P,l.B,l.hb,l.u,l.n,j.q,l.p,l.r,m.a,J.a,G.a,l.l,l.s,l.d,l.k],pipes:[u.d,W.a],styles:["[_nghost-%COMP%]   .button-disabled[_ngcontent-%COMP%]{opacity:.4}[_nghost-%COMP%]   .addon-mod_lesson-highlight[_ngcontent-%COMP%]{--background:var(--primary-tint)}[_nghost-%COMP%]   .addon-mod_lesson-highlight[_ngcontent-%COMP%]   ion-label[_ngcontent-%COMP%], [_nghost-%COMP%]   .addon-mod_lesson-highlight[_ngcontent-%COMP%]   ion-label[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{color:var(--primary-shade)}[_nghost-%COMP%]   .item-interactive-disabled[_ngcontent-%COMP%]   ion-label[_ngcontent-%COMP%]{opacity:.5}"]}),AddonModLessonUserRetakePage})();var K=o("M9y5"),Y=o("aEIl"),Z=o("3zv0"),ee=o("Lmwl"),ne=o("4qNr"),oe=o("fQ68"),te=o("8/N+"),ie=o("0QZc"),se=o("uHIS"),ae=o("w+Pn"),ce=o("r8G5"),de=o("5450"),_e=o("W5pS"),le=o("WPIK"),re=o("qNqN"),me=o("xpMl"),ge=o("FTxb"),ue=o("/K1O"),pe=o("FasJ"),fe=o("9pYf"),he=o("eAud"),Pe=o("ACV2"),ve=o("/BoF"),Ie=o("whRm"),be=o("O4u7"),De=o("lqoc"),ye=o("3lz8"),Me=o("46ml"),Le=o("QQhE"),Ee=o("MpCO"),we=o("JYLr"),ke=o("vWwc"),Te=o("NhJP"),Ae=o("rztj"),xe=o("rf3J"),Oe=o("nEkO"),Ve=o("TF0o"),Re=o("p5uK"),Ce=o("ijlo"),qe=o("vFDU"),Fe=o("6uVz"),Ue=o("d0nH"),Se=o("NcPy"),ze=o("yNDK"),Qe=o("3CSS"),Ne=o("iSJP"),je=o("iJls"),$e=o("ArDJ"),Be=o("saTE"),He=o("8PoL"),Je=o("4a38"),Ge=o("OZH1"),We=o("3jOR"),Xe=o("6A9T"),Ke=o("N5Lt"),Ye=o("1iFe"),Ze=o("dne1"),en=o("Cg42"),nn=o("llyR"),on=o("SspJ"),tn=o("U2xU"),sn=o("lAaw"),an=o("1ArG");const cn=[{path:":courseId/:cmId",component:p},{path:":courseId/:cmId/player",component:F,canDeactivate:[U.a]},{path:":courseId/:cmId/user-retake/:userId",component:X}];let dn=(()=>{class AddonModLessonLazyModule{}return AddonModLessonLazyModule.ɵmod=_.wc({type:AddonModLessonLazyModule}),AddonModLessonLazyModule.ɵinj=_.vc({factory:function AddonModLessonLazyModule_Factory(e){return new(e||AddonModLessonLazyModule)},imports:[[t.m.forChild(cn),i.a,h.a,s.a]]}),AddonModLessonLazyModule})();void(("undefined"==typeof ngJitMode||ngJitMode)&&_.kd(dn,{declarations:[p,F,X],imports:[t.m,i.a,h.a,s.a]})),_.jd(F,[t.n,t.j,t.l,t.k,t.p,j.q,j.r,j.s,j.t,j.A,j.w,j.x,j.y,j.z,j.u,j.v,K.a,Y.a,Z.a,ee.a,ne.a,oe.a,te.a,ie.a,se.a,ae.a,ce.a,de.a,_e.a,le.a,re.a,me.a,ge.a,N.a,ue.a,pe.a,fe.a,he.a,Pe.a,ve.a,H.a,Ie.a,be.a,De.a,ye.a,Me.a,Le.a,Ee.a,we.a,ke.a,Te.a,Ae.a,B.a,xe.a,Oe.a,Ve.a,Re.a,Ce.a,qe.a,Fe.a,Ue.a,Se.a,ze.a,Qe.a,m.a,Ne.a,je.a,$e.a,$.a,Be.a,He.a,Je.a,r.b,Ge.a,J.a,We.a,g.a,G.a,Xe.a,C.H,C.w,C.G,C.c,C.x,C.A,C.a,C.D,C.E,C.z,C.r,C.s,C.C,C.o,C.n,C.y,C.b,C.d,C.u,C.v,C.t,l.f,l.g,l.h,l.j,l.k,l.l,l.m,l.n,l.o,l.p,l.q,l.r,l.s,l.t,l.u,l.v,l.w,l.x,l.y,l.z,l.A,l.B,l.C,l.D,l.E,l.F,l.G,l.H,l.I,l.J,l.K,l.L,l.M,l.N,l.O,l.P,l.Q,l.R,l.S,l.T,l.U,l.V,l.W,l.X,l.Y,l.Z,l.ab,l.bb,l.cb,l.db,l.eb,l.fb,l.hb,l.ib,l.jb,l.kb,l.lb,l.mb,l.nb,l.ob,l.pb,l.qb,l.rb,l.sb,l.tb,l.vb,l.wb,l.xb,l.zb,l.Ab,l.yb,l.ub,l.d,l.Jb,l.Mb,l.Ob,l.Pb,l.gb,l.i,l.Hb,l.Nb,l.Rb,l.Sb,l.Tb,l.Bb,C.h,C.k,C.i,C.l,C.e,u.a,Ke.a,d.a,k.a,p,F,X],[j.b,j.G,j.p,j.k,j.E,j.g,j.C,j.F,j.d,j.f,j.i,j.j,j.l,Ye.a,Ze.a,en.a,nn.a,W.a,on.a,tn.a,sn.a,an.a,u.d])}}]);