(window.webpackJsonp=window.webpackJsonp||[]).push([[84],{KVTe:function(e,t,n){"use strict";n.r(t),n.d(t,"CoreLoginLazyModule",(function(){return be}));var o=n("tyNb"),i=n("L3Fv"),c=n("mrSG"),r=n("9+EE"),a=n("bFG1"),s=n("j3ag"),l=n("mv9v"),g=n("fXoL");let d=(()=>{class CoreLoginHasSitesGuard{canActivate(){return this.guard()}canLoad(){return this.guard()}guard(){return Object(c.a)(this,void 0,void 0,(function*(){if((yield a.a.ignoreErrors(r.b.getSites(),[])).length>0)return!0;const[e,t]=yield l.a.getAddSiteRouteInfo(),n=s.D.parseUrl(e);return n.queryParams=t,n}))}}return CoreLoginHasSitesGuard.ɵfac=function CoreLoginHasSitesGuard_Factory(e){return new(e||CoreLoginHasSitesGuard)},CoreLoginHasSitesGuard.ɵprov=g.uc({token:CoreLoginHasSitesGuard,factory:CoreLoginHasSitesGuard.ɵfac,providedIn:"root"}),CoreLoginHasSitesGuard})();var _=n("ho2i"),u=n("3Pt+"),m=n("3LXp"),p=n("pHTc"),h=n("4reR"),f=n("r2Z7"),P=n("H8uD"),C=n("TEn/"),b=n("nt/U"),O=n("ofXK"),E=n("6uVz"),v=n("ACYt"),y=n("uI1u"),S=n("sYmb");const M=["resetPasswordForm"];function CoreLoginForgottenPasswordPage_core_login_exceeded_attempts_11_Template(e,t){if(1&e&&(g.Ec(0,"core-login-exceeded-attempts",14),g.Pc(1,"translate"),g.pd(2),g.Pc(3,"translate"),g.Dc()),2&e){const e=g.Oc();g.Vc("supportConfig",e.supportConfig)("supportSubject",g.Qc(1,3,"core.login.exceededpasswordresetattemptssupportsubject")),g.lc(2),g.rd(" ",g.Qc(3,5,"core.login.exceededpasswordresetattempts")," ")}}let w=(()=>{class CoreLoginForgottenPasswordPage{constructor(e){this.formBuilder=e,this.wasPasswordResetRequestedRecently=!1}ngOnInit(){var e;return Object(c.a)(this,void 0,void 0,(function*(){const t=p.a.getRouteParam("siteUrl");if(!t)return m.a.showErrorModal("Site URL not supplied."),p.a.back(),void 0;const n=p.a.getRouteParam("siteConfig");this.siteUrl=t,this.autoFocus=f.a.is("tablet"),this.myForm=this.formBuilder.group({field:["username",u.F.required],value:[p.a.getRouteParam("username")||"",u.F.required]}),this.supportConfig=n&&new P.a(n),this.canContactSupport=null===(e=this.supportConfig)||void 0===e?void 0:e.canContactSupport(),this.wasPasswordResetRequestedRecently=yield l.a.wasPasswordResetRequestedRecently(t)}))}resetPassword(e){var t;return Object(c.a)(this,void 0,void 0,(function*(){e.preventDefault(),e.stopPropagation();const n=this.myForm.value.field,o=this.myForm.value.value;if(!o)return m.a.showErrorModal("core.login.usernameoremail",!0),void 0;const i=yield m.a.showModalLoading("core.sending",!0),c="email"===n;try{const e=yield l.a.requestPasswordReset(this.siteUrl,c?"":o,c?o:"");if("dataerror"===e.status){const n=null===(t=e.warnings)||void 0===t?void 0:t.find((e=>"email"===e.item&&c||"username"===e.item&&!c));n&&m.a.showErrorModal(n.message)}else"emailpasswordconfirmnotsent"===e.status||"emailpasswordconfirmnoemail"===e.status?m.a.showErrorModal(e.notice):(h.a.triggerFormSubmittedEvent(this.formElement,!0),yield m.a.showAlert(s.I.instant("core.success"),e.notice),yield p.a.back(),yield l.a.passwordResetRequested(this.siteUrl))}catch(e){m.a.showErrorModal(e)}finally{i.dismiss()}}))}}return CoreLoginForgottenPasswordPage.ɵfac=function CoreLoginForgottenPasswordPage_Factory(e){return new(e||CoreLoginForgottenPasswordPage)(g.yc(u.f))},CoreLoginForgottenPasswordPage.ɵcmp=g.sc({type:CoreLoginForgottenPasswordPage,selectors:[["page-core-login-forgotten-password"]],viewQuery:function CoreLoginForgottenPasswordPage_Query(e,t){var n;(1&e&&g.ud(M,!0),2&e)&&(g.dd(n=g.Nc())&&(t.formElement=n.first))},decls:45,vars:31,consts:[["slot","start"],[3,"text"],[1,"list-item-limited-width"],[3,"supportConfig","supportSubject",4,"ngIf"],[1,"ion-text-wrap"],[3,"formGroup","ngSubmit"],["resetPasswordForm",""],[1,"item-heading"],["formControlName","field"],["slot","end","value","username"],["slot","end","value","email"],[1,"sr-only"],["type","text","name","value","formControlName","value","autocapitalize","none","autocorrect","off",3,"placeholder","core-auto-focus"],["type","submit","expand","block",1,"ion-margin",3,"disabled"],[3,"supportConfig","supportSubject"]],template:function CoreLoginForgottenPasswordPage_Template(e,t){1&e&&(g.Ec(0,"ion-header"),g.Ec(1,"ion-toolbar"),g.Ec(2,"ion-buttons",0),g.zc(3,"ion-back-button",1),g.Pc(4,"translate"),g.Dc(),g.Ec(5,"ion-title"),g.Ec(6,"h1"),g.pd(7),g.Pc(8,"translate"),g.Dc(),g.Dc(),g.Dc(),g.Dc(),g.Ec(9,"ion-content"),g.Ec(10,"div",2),g.nd(11,CoreLoginForgottenPasswordPage_core_login_exceeded_attempts_11_Template,4,7,"core-login-exceeded-attempts",3),g.Ec(12,"ion-list"),g.Ec(13,"ion-item",4),g.Ec(14,"ion-label"),g.pd(15),g.Pc(16,"translate"),g.Dc(),g.Dc(),g.Dc(),g.Ec(17,"ion-card"),g.Ec(18,"form",5,6),g.Mc("ngSubmit",(function CoreLoginForgottenPasswordPage_Template_form_ngSubmit_18_listener(e){return t.resetPassword(e)})),g.Ec(20,"ion-item-divider",4),g.Ec(21,"ion-label"),g.Ec(22,"p",7),g.pd(23),g.Pc(24,"translate"),g.Dc(),g.Dc(),g.Dc(),g.Ec(25,"ion-radio-group",8),g.Ec(26,"ion-item"),g.Ec(27,"ion-label"),g.pd(28),g.Pc(29,"translate"),g.Dc(),g.zc(30,"ion-radio",9),g.Dc(),g.Ec(31,"ion-item"),g.Ec(32,"ion-label"),g.pd(33),g.Pc(34,"translate"),g.Dc(),g.zc(35,"ion-radio",10),g.Dc(),g.Dc(),g.Ec(36,"ion-item"),g.Ec(37,"ion-label",11),g.pd(38),g.Pc(39,"translate"),g.Dc(),g.zc(40,"ion-input",12),g.Pc(41,"translate"),g.Dc(),g.Ec(42,"ion-button",13),g.pd(43),g.Pc(44,"translate"),g.Dc(),g.Dc(),g.Dc(),g.Dc(),g.Dc()),2&e&&(g.lc(3),g.Vc("text",g.Qc(4,13,"core.back")),g.lc(4),g.qd(g.Qc(8,15,"core.login.passwordforgotten")),g.lc(4),g.Vc("ngIf",t.canContactSupport&&t.wasPasswordResetRequestedRecently),g.lc(4),g.qd(g.Qc(16,17,"core.login.passwordforgotteninstructions2")),g.lc(3),g.Vc("formGroup",t.myForm),g.lc(5),g.qd(g.Qc(24,19,"core.login.searchby")),g.lc(5),g.qd(g.Qc(29,21,"core.login.username")),g.lc(5),g.qd(g.Qc(34,23,"core.user.email")),g.lc(5),g.qd(g.Qc(39,25,"core.login.usernameoremail")),g.lc(2),g.Wc("placeholder",g.Qc(41,27,"core.login.usernameoremail")),g.Vc("core-auto-focus",t.autoFocus),g.lc(2),g.Vc("disabled",!t.myForm.valid),g.lc(1),g.rd(" ",g.Qc(44,29,"core.courses.search")," "))},directives:[C.C,C.Ab,C.m,C.h,C.i,C.yb,b.a,C.v,O.t,C.P,C.I,C.O,C.n,u.H,u.s,u.k,C.J,C.Z,C.Ob,u.r,u.i,C.Y,C.Mb,C.H,C.Pb,E.a,v.a,C.l,y.a],pipes:[S.d],encapsulation:2}),CoreLoginForgottenPasswordPage})();var L=n("vbeB"),D=n("fjkH"),T=n("D7J2"),x=n("PgjG"),I=n("iSJP"),F=n("qNqN");function CoreLoginSitePolicyPage_ion_list_11_ion_card_12_Template(e,t){if(1&e&&(g.Ec(0,"ion-card",9),g.zc(1,"core-iframe",10),g.Dc()),2&e){const e=g.Oc(2);g.lc(1),g.Vc("src",e.sitePolicy)}}function CoreLoginSitePolicyPage_ion_list_11_Template(e,t){if(1&e){const e=g.Fc();g.Ec(0,"ion-list"),g.Ec(1,"ion-item",4),g.Ec(2,"ion-label"),g.Ec(3,"p"),g.pd(4),g.Pc(5,"translate"),g.Dc(),g.Dc(),g.Dc(),g.Ec(6,"ion-item",4),g.Ec(7,"ion-label"),g.Ec(8,"p"),g.Ec(9,"a",5),g.pd(10),g.Pc(11,"translate"),g.Dc(),g.Dc(),g.Dc(),g.Dc(),g.nd(12,CoreLoginSitePolicyPage_ion_list_11_ion_card_12_Template,2,1,"ion-card",6),g.Ec(13,"ion-button",7),g.Mc("click",(function CoreLoginSitePolicyPage_ion_list_11_Template_ion_button_click_13_listener(){g.fd(e);return g.Oc().accept()})),g.pd(14),g.Pc(15,"translate"),g.Dc(),g.Ec(16,"ion-button",8),g.Mc("click",(function CoreLoginSitePolicyPage_ion_list_11_Template_ion_button_click_16_listener(){g.fd(e);return g.Oc().cancel()})),g.pd(17),g.Pc(18,"translate"),g.Dc(),g.Dc()}if(2&e){const e=g.Oc();g.lc(4),g.qd(g.Qc(5,7,"core.login.policyagree")),g.lc(5),g.Vc("href",e.sitePolicy,g.id)("capture",!1),g.lc(1),g.qd(g.Qc(11,9,"core.login.policyagreementclick")),g.lc(2),g.Vc("ngIf",e.showInline),g.lc(2),g.rd(" ",g.Qc(15,11,"core.login.policyacceptmandatory")," "),g.lc(3),g.rd(" ",g.Qc(18,13,"core.login.cancel")," ")}}let k=(()=>{class CoreLoginSitePolicyPage{ngOnInit(){this.siteId=p.a.getRouteParam("siteId");try{this.currentSite=r.b.getRequiredCurrentSite()}catch(e){return this.cancel(),void 0}const e=this.currentSite.id;if(this.siteId=this.siteId||e,this.siteId!=e)return this.cancel(),void 0;this.fetchSitePolicy()}fetchSitePolicy(){return Object(c.a)(this,void 0,void 0,(function*(){try{this.sitePolicy=yield l.a.getSitePolicy(this.siteId)}catch(e){return m.a.showErrorModalDefault(e,"Error getting site policy."),this.cancel(),void 0}try{const e=yield a.a.getMimeTypeFromUrl(this.sitePolicy),t=L.a.getExtension(e,this.sitePolicy);this.showInline="html"==t||"htm"==t}catch(e){this.showInline=!1}finally{this.policyLoaded=!0}T.a.logEvent({type:T.b.VIEW_ITEM,ws:"auth_email_get_signup_settings",name:s.I.instant("core.login.policyagreement"),data:{category:"policy"},url:"/user/policy.php"})}))}cancel(){return Object(c.a)(this,void 0,void 0,(function*(){yield a.a.ignoreErrors(r.b.logout()),yield p.a.navigate("/login/sites",{reset:!0})}))}accept(){return Object(c.a)(this,void 0,void 0,(function*(){const e=yield m.a.showModalLoading("core.sending",!0);try{yield l.a.acceptSitePolicy(this.siteId),yield a.a.ignoreErrors(this.currentSite.invalidateWsCache()),D.b.trigger(D.b.SITE_POLICY_AGREED,{},this.siteId),yield p.a.navigateToSiteHome()}catch(e){m.a.showErrorModalDefault(e,"Error accepting site policy.")}finally{e.dismiss()}}))}}return CoreLoginSitePolicyPage.ɵfac=function CoreLoginSitePolicyPage_Factory(e){return new(e||CoreLoginSitePolicyPage)},CoreLoginSitePolicyPage.ɵcmp=g.sc({type:CoreLoginSitePolicyPage,selectors:[["page-core-login-site-policy"]],decls:12,vars:8,consts:[["slot","start"],[3,"text"],[3,"hideUntil"],[4,"ngIf"],[1,"ion-text-wrap"],["core-link","",3,"href","capture"],["class","core-site-policy-iframe-container",4,"ngIf"],["expand","block",1,"ion-text-wrap","ion-margin-horizontal",3,"click"],["expand","block","fill","outline",1,"ion-text-wrap","ion-margin-horizontal","ion-margin-bottom",3,"click"],[1,"core-site-policy-iframe-container"],[3,"src"]],template:function CoreLoginSitePolicyPage_Template(e,t){1&e&&(g.Ec(0,"ion-header"),g.Ec(1,"ion-toolbar"),g.Ec(2,"ion-buttons",0),g.zc(3,"ion-back-button",1),g.Pc(4,"translate"),g.Dc(),g.Ec(5,"ion-title"),g.Ec(6,"h1"),g.pd(7),g.Pc(8,"translate"),g.Dc(),g.Dc(),g.Dc(),g.Dc(),g.Ec(9,"ion-content"),g.Ec(10,"core-loading",2),g.nd(11,CoreLoginSitePolicyPage_ion_list_11_Template,19,15,"ion-list",3),g.Dc(),g.Dc()),2&e&&(g.lc(3),g.Vc("text",g.Qc(4,4,"core.back")),g.lc(4),g.qd(g.Qc(8,6,"core.login.policyagreement")),g.lc(3),g.Vc("hideUntil",t.policyLoaded),g.lc(1),g.Vc("ngIf",t.sitePolicy))},directives:[C.C,C.Ab,C.m,C.h,C.i,C.yb,b.a,C.v,x.a,O.t,C.P,C.I,C.O,I.a,v.a,C.l,C.n,F.a],pipes:[S.d],styles:["[_nghost-%COMP%]   ion-list[_ngcontent-%COMP%]{display:flex;flex-direction:column;height:100%}[_nghost-%COMP%]   ion-list[_ngcontent-%COMP%]   ion-item[_ngcontent-%COMP%]{flex-shrink:0}[_nghost-%COMP%]   ion-list[_ngcontent-%COMP%]   .core-site-policy-iframe-container[_ngcontent-%COMP%]{height:100%}[_nghost-%COMP%]   ion-list[_ngcontent-%COMP%]   .core-site-policy-iframe-container[_ngcontent-%COMP%]   core-iframe[_ngcontent-%COMP%]{height:100%;width:100%}"]}),CoreLoginSitePolicyPage})();var V=n("5aQ+"),q=n("vuGA"),Q=n("JFK0"),U=n("Smo8"),z=n("whRm"),R=n("qgEA"),A=n("6s78"),N=n("3CSS"),j=n("FasJ"),B=n("FTxb"),H=n("lqoc"),G=n("hMzs"),$=n("f1LK");const W=["ageForm"],J=["signupFormEl"];function CoreLoginEmailSignupPage_ion_button_10_Template(e,t){if(1&e){const e=g.Fc();g.Ec(0,"ion-button",7),g.Mc("click",(function CoreLoginEmailSignupPage_ion_button_10_Template_ion_button_click_0_listener(){g.fd(e);return g.Oc().showAuthInstructions()})),g.Pc(1,"translate"),g.zc(2,"ion-icon",8),g.Dc()}2&e&&g.mc("aria-label",g.Qc(1,1,"core.login.instructions"))}function CoreLoginEmailSignupPage_core_loading_12_ion_list_2_Template(e,t){if(1&e&&(g.Ec(0,"ion-list"),g.Ec(1,"ion-item",10),g.Ec(2,"ion-label"),g.pd(3),g.Pc(4,"translate"),g.Dc(),g.Dc(),g.Ec(5,"ion-button",11),g.pd(6),g.Pc(7,"translate"),g.Dc(),g.Dc()),2&e){const e=g.Oc(2);g.lc(3),g.rd(" ",g.Qc(4,4,"core.login.signuprequiredfieldnotsupported")," "),g.lc(2),g.Vc("href",e.signupUrl)("showBrowserWarning",!1),g.lc(1),g.rd(" ",g.Qc(7,6,"core.openinbrowser")," ")}}function CoreLoginEmailSignupPage_core_loading_12_ng_container_3_form_1_ion_select_option_25_Template(e,t){if(1&e&&(g.Ec(0,"ion-select-option",23),g.pd(1),g.Dc()),2&e){const e=t.$implicit;g.Vc("value",e.code),g.lc(1),g.qd(e.name)}}function CoreLoginEmailSignupPage_core_loading_12_ng_container_3_form_1_Template(e,t){if(1&e){const e=g.Fc();g.Ec(0,"form",13,14),g.Mc("ngSubmit",(function CoreLoginEmailSignupPage_core_loading_12_ng_container_3_form_1_Template_form_ngSubmit_0_listener(t){g.fd(e);return g.Oc(3).verifyAge(t)})),g.Ec(2,"ion-item-divider",10),g.Ec(3,"ion-label"),g.Ec(4,"h2"),g.pd(5),g.Pc(6,"translate"),g.Dc(),g.Dc(),g.Dc(),g.Ec(7,"ion-item",10),g.Ec(8,"ion-label",15),g.Ec(9,"span",16),g.pd(10),g.Pc(11,"translate"),g.Dc(),g.Dc(),g.zc(12,"ion-input",17),g.Dc(),g.Ec(13,"ion-item",10),g.Ec(14,"ion-label",15),g.Ec(15,"span",16),g.pd(16),g.Pc(17,"translate"),g.Dc(),g.Dc(),g.Ec(18,"ion-select",18),g.Pc(19,"translate"),g.Pc(20,"translate"),g.Pc(21,"translate"),g.Ec(22,"ion-select-option",19),g.pd(23),g.Pc(24,"translate"),g.Dc(),g.nd(25,CoreLoginEmailSignupPage_core_loading_12_ng_container_3_form_1_ion_select_option_25_Template,2,2,"ion-select-option",20),g.Dc(),g.Dc(),g.Ec(26,"ion-button",21),g.pd(27),g.Pc(28,"translate"),g.Dc(),g.Ec(29,"ion-item",10),g.Ec(30,"ion-label"),g.Ec(31,"p",22),g.pd(32),g.Pc(33,"translate"),g.Dc(),g.Ec(34,"p"),g.pd(35),g.Pc(36,"translate"),g.Dc(),g.Dc(),g.Dc(),g.Dc()}if(2&e){const e=g.Oc(3);g.Vc("formGroup",e.ageVerificationForm),g.lc(5),g.qd(g.Qc(6,13,"core.agelocationverification")),g.lc(5),g.qd(g.Qc(11,15,"core.whatisyourage")),g.lc(6),g.qd(g.Qc(17,17,"core.wheredoyoulive")),g.lc(2),g.Vc("cancelText",g.Qc(19,19,"core.cancel"))("okText",g.Qc(20,21,"core.ok"))("placeholder",g.Qc(21,23,"core.login.selectacountry")),g.lc(5),g.qd(g.Qc(24,25,"core.login.selectacountry")),g.lc(2),g.Vc("ngForOf",e.countries),g.lc(1),g.Vc("disabled",!e.ageVerificationForm.valid),g.lc(1),g.rd(" ",g.Qc(28,27,"core.proceed")," "),g.lc(5),g.qd(g.Qc(33,29,"core.whyisthisrequired")),g.lc(3),g.qd(g.Qc(36,31,"core.explanationdigitalminor"))}}function CoreLoginEmailSignupPage_core_loading_12_ng_container_3_form_2_p_4_Template(e,t){if(1&e&&(g.Ec(0,"p",40),g.pd(1),g.Dc()),2&e){const e=g.Oc(4);g.lc(1),g.qd(e.siteUrl)}}function CoreLoginEmailSignupPage_core_loading_12_ng_container_3_form_2_p_5_Template(e,t){if(1&e&&(g.Ec(0,"p",40),g.zc(1,"core-format-text",41),g.Dc()),2&e){const e=g.Oc(4);g.lc(1),g.Vc("text",e.siteName)("filter",!1)}}function CoreLoginEmailSignupPage_core_loading_12_ng_container_3_form_2_p_6_Template(e,t){if(1&e&&(g.Ec(0,"p"),g.pd(1),g.Dc()),2&e){const e=g.Oc(4);g.lc(1),g.qd(e.siteUrl)}}function CoreLoginEmailSignupPage_core_loading_12_ng_container_3_form_2_p_28_Template(e,t){if(1&e&&(g.Ec(0,"p",42),g.pd(1),g.Dc()),2&e){const e=g.Oc(4);g.lc(1),g.rd(" ",e.settings.passwordpolicy," ")}}function CoreLoginEmailSignupPage_core_loading_12_ng_container_3_form_2_ion_item_51_Template(e,t){if(1&e&&(g.Ec(0,"ion-item",10),g.Ec(1,"ion-label",15),g.Ec(2,"span",16),g.pd(3),g.Pc(4,"translate"),g.Dc(),g.Dc(),g.zc(5,"ion-input",43),g.Pc(6,"translate"),g.zc(7,"core-input-errors",28),g.Dc()),2&e){const e=t.$implicit,n=g.Oc(4);g.lc(3),g.qd(g.Qc(4,6,"core.user."+e)),g.lc(2),g.Wc("placeholder",g.Qc(6,8,"core.user."+e)),g.Wc("formControlName",e),g.Vc("name",e),g.lc(2),g.Vc("control",n.signupForm.controls[e])("errorMessages",n.namefieldsErrors[e])}}function CoreLoginEmailSignupPage_core_loading_12_ng_container_3_form_2_ion_select_option_69_Template(e,t){if(1&e&&(g.Ec(0,"ion-select-option",23),g.pd(1),g.Dc()),2&e){const e=t.$implicit;g.Vc("value",e.code),g.lc(1),g.qd(e.name)}}function CoreLoginEmailSignupPage_core_loading_12_ng_container_3_form_2_ng_container_70_core_user_profile_field_5_Template(e,t){if(1&e&&g.zc(0,"core-user-profile-field",45),2&e){const e=t.$implicit,n=g.Oc(5);g.Vc("field",e)("edit",!0)("signup",!0)("form",n.signupForm)}}function CoreLoginEmailSignupPage_core_loading_12_ng_container_3_form_2_ng_container_70_Template(e,t){if(1&e&&(g.Cc(0),g.Ec(1,"ion-item-divider",10),g.Ec(2,"ion-label"),g.Ec(3,"p",22),g.pd(4),g.Dc(),g.Dc(),g.Dc(),g.nd(5,CoreLoginEmailSignupPage_core_loading_12_ng_container_3_form_2_ng_container_70_core_user_profile_field_5_Template,1,4,"core-user-profile-field",44),g.Bc()),2&e){const e=t.$implicit;g.lc(4),g.qd(e.name),g.lc(1),g.Vc("ngForOf",e.fields)}}function CoreLoginEmailSignupPage_core_loading_12_ng_container_3_form_2_ng_container_71_Template(e,t){if(1&e&&(g.Cc(0),g.Ec(1,"ion-item-divider",10),g.Ec(2,"ion-label"),g.Ec(3,"h2"),g.Ec(4,"span",46),g.pd(5),g.Pc(6,"translate"),g.Dc(),g.Dc(),g.Dc(),g.Dc(),g.zc(7,"core-recaptcha",47),g.Bc()),2&e){const e=g.Oc(4);g.lc(4),g.Vc("core-mark-required",!0),g.lc(1),g.qd(g.Qc(6,5,"core.login.security_question")),g.lc(2),g.Vc("publicKey",e.settings.recaptchapublickey)("model",e.captcha)("siteUrl",e.siteUrl)}}function CoreLoginEmailSignupPage_core_loading_12_ng_container_3_form_2_ng_container_72_Template(e,t){if(1&e&&(g.Cc(0),g.Ec(1,"ion-item-divider",10),g.Ec(2,"ion-label"),g.Ec(3,"h2"),g.pd(4),g.Pc(5,"translate"),g.Dc(),g.Dc(),g.Dc(),g.Ec(6,"ion-item",10),g.Ec(7,"ion-label"),g.Ec(8,"a",48),g.pd(9),g.Pc(10,"translate"),g.Dc(),g.Dc(),g.Dc(),g.Ec(11,"ion-item",10),g.Ec(12,"ion-label"),g.Ec(13,"span",46),g.pd(14),g.Pc(15,"translate"),g.Dc(),g.zc(16,"core-input-errors",28),g.Dc(),g.zc(17,"ion-checkbox",49),g.Dc(),g.Bc()),2&e){const e=g.Oc(4);g.lc(4),g.qd(g.Qc(5,7,"core.login.policyagreement")),g.lc(4),g.Vc("href",e.settings.sitepolicy,g.id),g.lc(1),g.rd(" ",g.Qc(10,9,"core.login.policyagreementclick")," "),g.lc(4),g.Vc("core-mark-required",!0),g.lc(1),g.qd(g.Qc(15,11,"core.login.policyacceptmandatory")),g.lc(2),g.Vc("control",e.signupForm.controls.policyagreed)("errorMessages",e.policyErrors)}}function CoreLoginEmailSignupPage_core_loading_12_ng_container_3_form_2_Template(e,t){if(1&e){const e=g.Fc();g.Ec(0,"form",13,24),g.Mc("ngSubmit",(function CoreLoginEmailSignupPage_core_loading_12_ng_container_3_form_2_Template_form_ngSubmit_0_listener(t){g.fd(e);return g.Oc(3).create(t)})),g.Ec(2,"ion-item",25),g.Ec(3,"ion-label"),g.nd(4,CoreLoginEmailSignupPage_core_loading_12_ng_container_3_form_2_p_4_Template,2,1,"p",26),g.nd(5,CoreLoginEmailSignupPage_core_loading_12_ng_container_3_form_2_p_5_Template,2,2,"p",26),g.nd(6,CoreLoginEmailSignupPage_core_loading_12_ng_container_3_form_2_p_6_Template,2,1,"p",6),g.Dc(),g.Dc(),g.Ec(7,"ion-item-divider",10),g.Ec(8,"ion-label"),g.Ec(9,"h2"),g.pd(10),g.Pc(11,"translate"),g.Dc(),g.Dc(),g.Dc(),g.Ec(12,"ion-item",10),g.Ec(13,"ion-label",15),g.Ec(14,"span",16),g.pd(15),g.Pc(16,"translate"),g.Dc(),g.Dc(),g.zc(17,"ion-input",27),g.Pc(18,"translate"),g.zc(19,"core-input-errors",28),g.Dc(),g.Ec(20,"ion-item",10),g.Ec(21,"ion-label",15),g.Ec(22,"span",16),g.pd(23),g.Pc(24,"translate"),g.Dc(),g.Dc(),g.Ec(25,"core-show-password",29),g.zc(26,"ion-input",30),g.Pc(27,"translate"),g.Dc(),g.nd(28,CoreLoginEmailSignupPage_core_loading_12_ng_container_3_form_2_p_28_Template,2,1,"p",31),g.zc(29,"core-input-errors",28),g.Dc(),g.Ec(30,"ion-item-divider",10),g.Ec(31,"ion-label"),g.Ec(32,"h2"),g.pd(33),g.Pc(34,"translate"),g.Dc(),g.Dc(),g.Dc(),g.Ec(35,"ion-item",10),g.Ec(36,"ion-label",15),g.Ec(37,"span",16),g.pd(38),g.Pc(39,"translate"),g.Dc(),g.Dc(),g.zc(40,"ion-input",32),g.Pc(41,"translate"),g.zc(42,"core-input-errors",28),g.Dc(),g.Ec(43,"ion-item",10),g.Ec(44,"ion-label",15),g.Ec(45,"span",16),g.pd(46),g.Pc(47,"translate"),g.Dc(),g.Dc(),g.zc(48,"ion-input",33),g.Pc(49,"translate"),g.zc(50,"core-input-errors",28),g.Dc(),g.nd(51,CoreLoginEmailSignupPage_core_loading_12_ng_container_3_form_2_ion_item_51_Template,8,10,"ion-item",34),g.Ec(52,"ion-item",10),g.Ec(53,"ion-label",15),g.pd(54),g.Pc(55,"translate"),g.Dc(),g.zc(56,"ion-input",35),g.Pc(57,"translate"),g.Dc(),g.Ec(58,"ion-item",10),g.Ec(59,"ion-label",15),g.pd(60),g.Pc(61,"translate"),g.Dc(),g.Ec(62,"ion-select",36),g.Pc(63,"translate"),g.Pc(64,"translate"),g.Pc(65,"translate"),g.Ec(66,"ion-select-option",19),g.pd(67),g.Pc(68,"translate"),g.Dc(),g.nd(69,CoreLoginEmailSignupPage_core_loading_12_ng_container_3_form_2_ion_select_option_69_Template,2,2,"ion-select-option",20),g.Dc(),g.Dc(),g.nd(70,CoreLoginEmailSignupPage_core_loading_12_ng_container_3_form_2_ng_container_70_Template,6,2,"ng-container",37),g.nd(71,CoreLoginEmailSignupPage_core_loading_12_ng_container_3_form_2_ng_container_71_Template,8,7,"ng-container",6),g.nd(72,CoreLoginEmailSignupPage_core_loading_12_ng_container_3_form_2_ng_container_72_Template,18,13,"ng-container",6),g.Ec(73,"ion-button",38),g.pd(74),g.Pc(75,"translate"),g.Dc(),g.zc(76,"input",39),g.Dc()}if(2&e){const e=g.Oc(3);g.Vc("formGroup",e.signupForm),g.lc(4),g.Vc("ngIf",!e.siteName),g.lc(1),g.Vc("ngIf",e.siteName),g.lc(1),g.Vc("ngIf",e.siteName),g.lc(4),g.qd(g.Qc(11,38,"core.login.createuserandpass")),g.lc(5),g.qd(g.Qc(16,40,"core.login.username")),g.lc(2),g.Wc("placeholder",g.Qc(18,42,"core.login.username")),g.lc(2),g.Vc("control",e.signupForm.controls.username)("errorMessages",e.usernameErrors),g.lc(4),g.qd(g.Qc(24,44,"core.login.password")),g.lc(3),g.Wc("placeholder",g.Qc(27,46,"core.login.password")),g.Vc("clearOnEdit",!1),g.lc(2),g.Vc("ngIf",e.settings.passwordpolicy),g.lc(1),g.Vc("control",e.signupForm.controls.password)("errorMessages",e.passwordErrors),g.lc(4),g.qd(g.Qc(34,48,"core.login.supplyinfo")),g.lc(5),g.qd(g.Qc(39,50,"core.user.email")),g.lc(2),g.Wc("placeholder",g.Qc(41,52,"core.user.email")),g.lc(2),g.Vc("control",e.signupForm.controls.email)("errorMessages",e.emailErrors),g.lc(4),g.qd(g.Qc(47,54,"core.user.emailagain")),g.lc(2),g.Wc("placeholder",g.Qc(49,56,"core.user.emailagain")),g.Vc("pattern",e.escapeMail(e.signupForm.controls.email.value)),g.lc(2),g.Vc("control",e.signupForm.controls.email2)("errorMessages",e.email2Errors),g.lc(1),g.Vc("ngForOf",e.settings.namefields),g.lc(3),g.qd(g.Qc(55,58,"core.user.city")),g.lc(2),g.Wc("placeholder",g.Qc(57,60,"core.user.city")),g.lc(4),g.qd(g.Qc(61,62,"core.user.country")),g.lc(2),g.Vc("placeholder",g.Qc(63,64,"core.login.selectacountry"))("cancelText",g.Qc(64,66,"core.cancel"))("okText",g.Qc(65,68,"core.ok")),g.lc(5),g.qd(g.Qc(68,70,"core.login.selectacountry")),g.lc(2),g.Vc("ngForOf",e.countries),g.lc(1),g.Vc("ngForOf",e.categories),g.lc(1),g.Vc("ngIf",e.settings.recaptchapublickey),g.lc(1),g.Vc("ngIf",e.settings.sitepolicy),g.lc(2),g.qd(g.Qc(75,72,"core.login.createaccount"))}}function CoreLoginEmailSignupPage_core_loading_12_ng_container_3_Template(e,t){if(1&e&&(g.Cc(0),g.nd(1,CoreLoginEmailSignupPage_core_loading_12_ng_container_3_form_1_Template,37,33,"form",12),g.nd(2,CoreLoginEmailSignupPage_core_loading_12_ng_container_3_form_2_Template,77,74,"form",12),g.Bc()),2&e){const e=g.Oc(2);g.lc(1),g.Vc("ngIf",e.ageDigitalConsentVerification),g.lc(1),g.Vc("ngIf",!e.ageDigitalConsentVerification)}}function CoreLoginEmailSignupPage_core_loading_12_Template(e,t){if(1&e&&(g.Ec(0,"core-loading",9),g.Ec(1,"div",5),g.nd(2,CoreLoginEmailSignupPage_core_loading_12_ion_list_2_Template,8,8,"ion-list",6),g.nd(3,CoreLoginEmailSignupPage_core_loading_12_ng_container_3_Template,3,2,"ng-container",6),g.Dc(),g.Dc()),2&e){const e=g.Oc();g.Vc("hideUntil",e.settingsLoaded),g.lc(2),g.Vc("ngIf",!e.allRequiredSupported),g.lc(1),g.Vc("ngIf",e.allRequiredSupported&&e.settingsLoaded&&e.settings)}}function CoreLoginEmailSignupPage_ion_list_14_h2_3_Template(e,t){if(1&e&&(g.Ec(0,"h2",52),g.zc(1,"core-format-text",41),g.Dc()),2&e){const e=g.Oc(2);g.lc(1),g.Vc("text",e.siteName)("filter",!1)}}function CoreLoginEmailSignupPage_ion_list_14_p_12_Template(e,t){if(1&e&&(g.Ec(0,"p"),g.pd(1),g.Dc()),2&e){const e=g.Oc(2);g.lc(1),g.qd(e.supportName)}}function CoreLoginEmailSignupPage_ion_list_14_p_13_Template(e,t){if(1&e&&(g.Ec(0,"p"),g.pd(1),g.Dc()),2&e){const e=g.Oc(2);g.lc(1),g.qd(e.supportEmail)}}function CoreLoginEmailSignupPage_ion_list_14_ion_button_14_Template(e,t){if(1&e){const e=g.Fc();g.Ec(0,"ion-button",53),g.Mc("click",(function CoreLoginEmailSignupPage_ion_list_14_ion_button_14_Template_ion_button_click_0_listener(){g.fd(e);return g.Oc(2).showContactOnSite()})),g.pd(1),g.Pc(2,"translate"),g.Dc()}2&e&&(g.lc(1),g.rd(" ",g.Qc(2,1,"core.openinbrowser")," "))}function CoreLoginEmailSignupPage_ion_list_14_Template(e,t){if(1&e&&(g.Ec(0,"ion-list"),g.Ec(1,"ion-item-divider",10),g.Ec(2,"ion-label"),g.nd(3,CoreLoginEmailSignupPage_ion_list_14_h2_3_Template,2,2,"h2",50),g.Dc(),g.Dc(),g.Ec(4,"ion-item",10),g.Ec(5,"ion-label"),g.Ec(6,"p",22),g.pd(7),g.Pc(8,"translate"),g.Dc(),g.Ec(9,"p"),g.pd(10),g.Pc(11,"translate"),g.Dc(),g.nd(12,CoreLoginEmailSignupPage_ion_list_14_p_12_Template,2,1,"p",6),g.nd(13,CoreLoginEmailSignupPage_ion_list_14_p_13_Template,2,1,"p",6),g.Dc(),g.Dc(),g.nd(14,CoreLoginEmailSignupPage_ion_list_14_ion_button_14_Template,3,3,"ion-button",51),g.Dc()),2&e){const e=g.Oc();g.lc(3),g.Vc("ngIf",e.siteName),g.lc(4),g.qd(g.Qc(8,6,"core.considereddigitalminor")),g.lc(3),g.qd(g.Qc(11,8,"core.digitalminor_desc")),g.lc(2),g.Vc("ngIf",e.supportName),g.lc(1),g.Vc("ngIf",e.supportEmail),g.lc(1),g.Vc("ngIf",!e.supportName&&!e.supportEmail)}}let K=(()=>{class CoreLoginEmailSignupPage{constructor(e,t,n){this.fb=e,this.elementRef=t,this.changeDetector=n,this.authInstructions="",this.settingsLoaded=!1,this.allRequiredSupported=!0,this.captcha={recaptcharesponse:""},this.isMinor=!1,this.ageVerificationForm=this.fb.group({age:["",u.F.required]}),this.countryControl=this.fb.control("",u.F.required),this.ageVerificationForm.addControl("country",this.countryControl),this.signupForm=this.fb.group({username:["",u.F.required],password:["",u.F.required],email:["",u.F.compose([u.F.required,u.F.email])],email2:["",u.F.compose([u.F.required,u.F.email])]}),this.usernameErrors=l.a.getErrorMessages("core.login.usernamerequired"),this.passwordErrors=l.a.getErrorMessages("core.login.passwordrequired"),this.emailErrors=l.a.getErrorMessages("core.login.missingemail"),this.policyErrors=l.a.getErrorMessages("core.login.policyagree"),this.email2Errors=l.a.getErrorMessages("core.login.missingemail",void 0,"core.login.emailnotmatch")}ngOnInit(){const e=p.a.getRouteParam("siteUrl");if(!e)return m.a.showErrorModal("Site URL not supplied."),p.a.back(),void 0;this.siteUrl=e,this.fetchData().finally((()=>{this.settingsLoaded=!0}))}completeFormGroup(){var e,t,n,o,i;this.signupForm.addControl("city",this.fb.control((null===(e=this.settings)||void 0===e?void 0:e.defaultcity)||"")),this.signUpCountryControl=this.fb.control((null===(t=this.settings)||void 0===t?void 0:t.country)||""),this.signupForm.addControl("country",this.signUpCountryControl);for(const e in null===(n=this.settings)||void 0===n?void 0:n.namefields)this.signupForm.addControl(null===(o=this.settings)||void 0===o?void 0:o.namefields[e],this.fb.control("",u.F.required));(null===(i=this.settings)||void 0===i?void 0:i.sitepolicy)&&this.signupForm.addControl("policyagreed",this.fb.control(!1,u.F.requiredTrue))}fetchData(){return Object(c.a)(this,void 0,void 0,(function*(){try{if(this.siteConfig=yield r.b.getSitePublicConfig(this.siteUrl),this.signupUrl=R.a.concatenatePaths(this.siteConfig.httpswwwroot,"login/signup.php"),this.treatSiteConfig()){if(void 0===this.ageDigitalConsentVerification){const e=yield a.a.ignoreErrors(Q.a.callAjax("core_auth_is_age_digital_consent_verification_enabled",{},{siteUrl:this.siteUrl}));this.ageDigitalConsentVerification=!!(null==e?void 0:e.status)}yield this.getSignupSettings()}this.completeFormGroup()}catch(e){this.allRequiredSupported&&m.a.showErrorModal(e)}}))}getSignupSettings(){return Object(c.a)(this,void 0,void 0,(function*(){if(this.settings=yield Q.a.callAjax("auth_email_get_signup_settings",{},{siteUrl:this.siteUrl}),U.a.hasRequiredUnsupportedField(this.settings.profilefields))throw this.allRequiredSupported=!1,new Error(s.I.instant("core.login.signuprequiredfieldnotsupported"));this.categories=l.a.formatProfileFieldsForSignup(this.settings.profilefields),this.settings.recaptchapublickey&&(this.captcha.recaptcharesponse=""),this.countryControl.value||this.countryControl.setValue(this.settings.country||"");const e={};this.settings.namefields&&this.settings.namefields.forEach((t=>{e[t]=l.a.getErrorMessages("core.login.missing"+t)})),this.namefieldsErrors=e,this.countries=yield a.a.getCountryListSorted()}))}treatSiteConfig(){var e;return"email"!=(null===(e=this.siteConfig)||void 0===e?void 0:e.registerauth)||l.a.isEmailSignupDisabled(this.siteConfig)?(m.a.showErrorModal(s.I.instant("core.login.signupplugindisabled",{$a:s.I.instant("core.login.auth_email")})),p.a.back(),!1):(this.siteName=this.siteConfig.sitename,this.authInstructions=this.siteConfig.authinstructions,this.ageDigitalConsentVerification=this.siteConfig.agedigitalconsentverification,this.supportName=this.siteConfig.supportname,this.supportEmail=this.siteConfig.supportemail,this.countryControl.setValue(this.siteConfig.country||""),!0)}create(e){var t,n,o,i,r,a;return Object(c.a)(this,void 0,void 0,(function*(){if(e.preventDefault(),e.stopPropagation(),!this.signupForm.valid||(null===(t=this.settings)||void 0===t?void 0:t.recaptchapublickey)&&!this.captcha.recaptcharesponse){for(const e in this.signupForm.controls)this.signupForm.controls[e].markAsDirty();this.changeDetector.detectChanges();return(yield A.a.scrollToInputError(this.elementRef.nativeElement))||m.a.showErrorModal("core.errorinvalidform",!0),void 0}const c=yield m.a.showModalLoading("core.sending",!0),g={username:this.signupForm.value.username.trim().toLowerCase(),password:this.signupForm.value.password,firstname:q.b.cleanTags(this.signupForm.value.firstname),lastname:q.b.cleanTags(this.signupForm.value.lastname),email:this.signupForm.value.email.trim(),city:q.b.cleanTags(this.signupForm.value.city),country:this.signupForm.value.country};(null===(n=this.siteConfig)||void 0===n?void 0:n.launchurl)&&(g.redirect=l.a.prepareForSSOLogin(this.siteUrl,void 0,this.siteConfig.launchurl)),(null===(o=this.settings)||void 0===o?void 0:o.recaptchapublickey)&&this.captcha.recaptcharesponse&&(g.recaptcharesponse=this.captcha.recaptcharesponse);try{g.customprofilefields=yield U.a.getDataForFields(null===(i=this.settings)||void 0===i?void 0:i.profilefields,!0,"email",this.signupForm.value);const e=yield Q.a.callAjax("auth_email_signup_user",g,{siteUrl:this.siteUrl});if(e.success){h.a.triggerFormSubmittedEvent(this.signupFormElement,!0);const e=s.I.instant("core.login.emailconfirmsent",{$a:g.email});m.a.showAlert(s.I.instant("core.success"),e),p.a.back()}else{null===(r=this.recaptchaComponent)||void 0===r?void 0:r.expireRecaptchaAnswer();const t=null===(a=e.warnings)||void 0===a?void 0:a[0];if(t){let e=t.message;("incorrect-captcha-sol"==e||!e&&"recaptcharesponse"==t.item)&&(e=s.I.instant("core.login.recaptchaincorrect")),m.a.showErrorModal(e)}else m.a.showErrorModal("core.login.usernotaddederror",!0)}}catch(e){m.a.showErrorModalDefault(e,"core.login.usernotaddederror",!0)}finally{c.dismiss()}}))}escapeMail(e){return q.b.escapeForRegex(e)}showAuthInstructions(){q.b.viewText(s.I.instant("core.login.instructions"),this.authInstructions)}showContactOnSite(){a.a.openInBrowser(R.a.concatenatePaths(this.siteUrl,"/login/verify_age_location.php"),{showBrowserWarning:!1})}verifyAge(e){var t;return Object(c.a)(this,void 0,void 0,(function*(){if(e.preventDefault(),e.stopPropagation(),!this.ageVerificationForm.valid)return m.a.showErrorModal("core.errorinvalidform",!0),void 0;const n=yield m.a.showModalLoading("core.sending",!0),o=this.ageVerificationForm.value;o.age=parseInt(o.age,10);try{const e=yield Q.a.callAjax("core_auth_is_minor",o,{siteUrl:this.siteUrl});h.a.triggerFormSubmittedEvent(this.ageFormElement,!0),e.status?this.isMinor=!0:(this.countryControl.value&&(null===(t=this.signUpCountryControl)||void 0===t?void 0:t.setValue(this.countryControl.value)),this.ageDigitalConsentVerification=!1)}catch(e){m.a.showErrorModal("There was an error verifying your age, please try again using the browser.")}finally{n.dismiss()}}))}}return CoreLoginEmailSignupPage.ɵfac=function CoreLoginEmailSignupPage_Factory(e){return new(e||CoreLoginEmailSignupPage)(g.yc(u.f),g.yc(g.r),g.yc(g.j))},CoreLoginEmailSignupPage.ɵcmp=g.sc({type:CoreLoginEmailSignupPage,selectors:[["page-core-login-email-signup"]],viewQuery:function CoreLoginEmailSignupPage_Query(e,t){var n;(1&e&&(g.ud(z.a,!0),g.ud(W,!0),g.ud(J,!0)),2&e)&&(g.dd(n=g.Nc())&&(t.recaptchaComponent=n.first),g.dd(n=g.Nc())&&(t.ageFormElement=n.first),g.dd(n=g.Nc())&&(t.signupFormElement=n.first))},decls:15,vars:9,consts:[["slot","start"],[3,"text"],["slot","end"],["fill","clear",3,"click",4,"ngIf"],[3,"hideUntil",4,"ngIf"],[1,"list-item-limited-width"],[4,"ngIf"],["fill","clear",3,"click"],["slot","icon-only","name","far-circle-question","aria-hidden","true"],[3,"hideUntil"],[1,"ion-text-wrap"],["expand","block","core-link","","autoLogin","no",1,"ion-margin",3,"href","showBrowserWarning"],[3,"formGroup","ngSubmit",4,"ngIf"],[3,"formGroup","ngSubmit"],["ageForm",""],["position","stacked"],["core-mark-required","true"],["type","number","name","age","placeholder","0","formControlName","age","autocapitalize","none","autocorrect","off"],["name","country","formControlName","country",3,"cancelText","okText","placeholder"],["value",""],[3,"value",4,"ngFor","ngForOf"],["expand","block","type","submit",1,"ion-margin",3,"disabled"],[1,"item-heading"],[3,"value"],["signupFormEl",""],[1,"ion-text-wrap","ion-text-center"],["class","ion-padding item-heading",4,"ngIf"],["type","text","name","username","formControlName","username","autocapitalize","none","autocorrect","off",3,"placeholder"],[3,"control","errorMessages"],["name","password"],["name","password","type","password","formControlName","password","autocomplete","new-password","required","true",3,"placeholder","clearOnEdit"],["class","core-input-footnote",4,"ngIf"],["type","email","name","email","formControlName","email","autocapitalize","none","autocorrect","off",3,"placeholder"],["type","email","name","email2","autocapitalize","none","formControlName","email2","autocorrect","off",3,"placeholder","pattern"],["class","ion-text-wrap",4,"ngFor","ngForOf"],["type","text","name","city","formControlName","city","autocorrect","off",3,"placeholder"],["name","country","formControlName","country",3,"placeholder","cancelText","okText"],[4,"ngFor","ngForOf"],["expand","block","type","submit",1,"ion-margin"],["type","submit",1,"core-submit-hidden-enter"],[1,"ion-padding","item-heading"],[3,"text","filter"],[1,"core-input-footnote"],["type","text","autocorrect","off",3,"name","placeholder","formControlName"],["registerAuth","email",3,"field","edit","signup","form",4,"ngFor","ngForOf"],["registerAuth","email",3,"field","edit","signup","form"],[3,"core-mark-required"],[3,"publicKey","model","siteUrl"],["core-link","","capture","false",3,"href"],["slot","end","name","policyagreed","formControlName","policyagreed"],["class","item-heading ion-padding",4,"ngIf"],["expand","block","class","ion-margin",3,"click",4,"ngIf"],[1,"item-heading","ion-padding"],["expand","block",1,"ion-margin",3,"click"]],template:function CoreLoginEmailSignupPage_Template(e,t){1&e&&(g.Ec(0,"ion-header"),g.Ec(1,"ion-toolbar"),g.Ec(2,"ion-buttons",0),g.zc(3,"ion-back-button",1),g.Pc(4,"translate"),g.Dc(),g.Ec(5,"ion-title"),g.Ec(6,"h1"),g.pd(7),g.Pc(8,"translate"),g.Dc(),g.Dc(),g.Ec(9,"ion-buttons",2),g.nd(10,CoreLoginEmailSignupPage_ion_button_10_Template,3,3,"ion-button",3),g.Dc(),g.Dc(),g.Dc(),g.Ec(11,"ion-content"),g.nd(12,CoreLoginEmailSignupPage_core_loading_12_Template,4,3,"core-loading",4),g.Ec(13,"div",5),g.nd(14,CoreLoginEmailSignupPage_ion_list_14_Template,15,10,"ion-list",6),g.Dc(),g.Dc()),2&e&&(g.lc(3),g.Vc("text",g.Qc(4,5,"core.back")),g.lc(4),g.qd(g.Qc(8,7,"core.login.newaccount")),g.lc(3),g.Vc("ngIf",t.authInstructions),g.lc(2),g.Vc("ngIf",!t.isMinor),g.lc(2),g.Vc("ngIf",t.allRequiredSupported&&t.isMinor))},directives:[C.C,C.Ab,C.m,C.h,C.i,C.yb,O.t,b.a,C.v,v.a,C.l,C.D,N.a,x.a,C.P,C.I,C.O,I.a,u.H,u.s,u.k,C.J,j.a,C.H,C.Jb,u.r,u.i,C.lb,C.Ob,C.mb,O.s,C.Pb,B.a,H.a,u.C,u.y,G.a,$.a,z.a,C.s,C.d],pipes:[S.d],styles:["[_nghost-%COMP%]   ion-content[_ngcontent-%COMP%], [_nghost-%COMP%]   ion-list[_ngcontent-%COMP%]{--background:var(--core-login-background);--ion-item-background:var(--core-login-background)}[_nghost-%COMP%]   ion-content[_ngcontent-%COMP%], [_nghost-%COMP%]   ion-item[_ngcontent-%COMP%]   ion-label[_ngcontent-%COMP%], [_nghost-%COMP%]   ion-list[_ngcontent-%COMP%]{--color:var(--core-login-text-color)}[_nghost-%COMP%]   form[_ngcontent-%COMP%]   div[_ngcontent-%COMP%], [_nghost-%COMP%]   ion-item[_ngcontent-%COMP%]   ion-label[_ngcontent-%COMP%]   .core-oauth-icon[_ngcontent-%COMP%], [_nghost-%COMP%]   ion-item[_ngcontent-%COMP%]   ion-label[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%], [_nghost-%COMP%]   ion-item[_ngcontent-%COMP%]   ion-label[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%], [_nghost-%COMP%]   ion-item[_ngcontent-%COMP%]   ion-label[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{color:var(--color)}[_nghost-%COMP%]   ion-button.core-button-as-link[_ngcontent-%COMP%]{--color:var(--core-login-text-color);-webkit-text-decoration-color:var(--core-login-text-color);text-decoration-color:var(--core-login-text-color)}[_nghost-%COMP%]   ion-button.core-button-as-link[_ngcontent-%COMP%]   ion-label[_ngcontent-%COMP%]{color:var(--core-login-text-color)}[_nghost-%COMP%]   form[_ngcontent-%COMP%]   .core-username.item[_ngcontent-%COMP%], [_nghost-%COMP%]   form[_ngcontent-%COMP%]   .item.item-input[_ngcontent-%COMP%]{margin-bottom:16px}[_nghost-%COMP%]   form[_ngcontent-%COMP%]   .core-username.ios[_ngcontent-%COMP%]{--inner-border-width:0 0 1px 0}[_nghost-%COMP%]   form[_ngcontent-%COMP%]   .item[_ngcontent-%COMP%], [_nghost-%COMP%]   form[_ngcontent-%COMP%]   .item[_ngcontent-%COMP%]   ion-label[_ngcontent-%COMP%]{--background:var(--core-login-input-background);--color:var(--core-login-input-color)}[_nghost-%COMP%]   form[_ngcontent-%COMP%]   .core-username.item[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{font-size:16px}[_nghost-%COMP%]   form[_ngcontent-%COMP%]   .core-username.item.md[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{padding-left:8px}@supports ((-webkit-margin-start:0) or (margin-inline-start:0)) or (-webkit-margin-start:0){[_nghost-%COMP%]   form[_ngcontent-%COMP%]   .core-username.item.md[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{padding-left:unset;-webkit-padding-start:8px;padding-inline-start:8px}}[_nghost-%COMP%]   .core-login-site-logo[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{max-width:100%}[_nghost-%COMP%]   .core-sitename[_ngcontent-%COMP%] + .core-siteurl[_ngcontent-%COMP%]{margin-top:0}[_nghost-%COMP%]   .core-sitename[_ngcontent-%COMP%]{font-size:1.2rem;margin-bottom:0}[_nghost-%COMP%]   .core-login-site-logo[_ngcontent-%COMP%]{width:90%;max-width:300px;margin:5px auto}[_nghost-%COMP%]   .core-login-forgotten-password[_ngcontent-%COMP%]{text-decoration:underline}[_nghost-%COMP%]   core-user-avatar.large-avatar[_ngcontent-%COMP%]{--core-avatar-size:var(--core-large-avatar-size)}html.dark[_nghost-%COMP%]   core-loading[_ngcontent-%COMP%], html.dark   [_nghost-%COMP%]   core-loading[_ngcontent-%COMP%]{--loading-background:var(--core-login-background-dark);--loading-text-color:#fff;--loading-spinner:#fff}"]}),CoreLoginEmailSignupPage})();var X=n("nvXB"),Y=n("GGba"),Z=n("BBqZ"),ee=n("93ts"),te=n("BaYo"),ne=n("oZnq"),oe=n("mvS9"),ie=n("JpIC"),ce=n("m2Ry"),re=n("y9BN"),ae=n("X3v+"),se=n("51eS"),le=n("cjIW"),ge=n("rdt7");const de=["siteFormEl"];function CoreLoginSitePage_form_10_ng_container_2_Template(e,t){if(1&e&&(g.Cc(0),g.Ec(1,"ion-item"),g.zc(2,"ion-input",12),g.Pc(3,"translate"),g.Dc(),g.Bc()),2&e){const e=g.Oc(2);g.lc(2),g.Wc("placeholder",g.Qc(3,2,"core.login.siteaddressplaceholder")),g.Vc("core-auto-focus",e.showKeyboard&&!e.showScanQR)}}function CoreLoginSitePage_form_10_ng_container_3_ion_item_4_Template(e,t){if(1&e){const e=g.Fc();g.Ec(0,"ion-item",20),g.Mc("click",(function CoreLoginSitePage_form_10_ng_container_3_ion_item_4_Template_ion_item_click_0_listener(){g.fd(e);const t=g.Oc(3);return t.connect(t.enteredSiteUrl.url)})),g.Pc(1,"translate"),g.Ec(2,"ion-thumbnail",21),g.zc(3,"ion-icon",22),g.Dc(),g.Ec(4,"ion-label"),g.Ec(5,"h2",23),g.pd(6),g.Pc(7,"translate"),g.Dc(),g.Ec(8,"p"),g.pd(9),g.Dc(),g.Dc(),g.Dc()}if(2&e){const e=g.Oc(3);g.mc("aria-label",g.Qc(1,3,"core.login.connect")),g.lc(6),g.qd(g.Qc(7,5,"core.login.yourenteredsite")),g.lc(3),g.qd(e.enteredSiteUrl.noProtocolUrl)}}function CoreLoginSitePage_form_10_ng_container_3_div_6_Template(e,t){1&e&&(g.Ec(0,"div",24),g.zc(1,"ion-spinner"),g.Pc(2,"translate"),g.Dc()),2&e&&(g.lc(1),g.mc("aria-label",g.Qc(2,1,"core.loading")))}function CoreLoginSitePage_form_10_ng_container_3_ng_container_7_ng_container_1_Template(e,t){1&e&&g.Ac(0)}const site_c1=function(e){return{site:e}};function CoreLoginSitePage_form_10_ng_container_3_ng_container_7_Template(e,t){if(1&e&&(g.Cc(0),g.nd(1,CoreLoginSitePage_form_10_ng_container_3_ng_container_7_ng_container_1_Template,1,0,"ng-container",25),g.Bc()),2&e){const e=t.$implicit;g.Oc(3);const n=g.ed(13);g.lc(1),g.Vc("ngTemplateOutlet",n)("ngTemplateOutletContext",g.ad(2,site_c1,e))}}function CoreLoginSitePage_form_10_ng_container_3_div_8_Template(e,t){1&e&&(g.Ec(0,"div",26),g.zc(1,"ion-spinner"),g.Pc(2,"translate"),g.Dc()),2&e&&(g.lc(1),g.mc("aria-label",g.Qc(2,1,"core.loading")))}function CoreLoginSitePage_form_10_ng_container_3_Template(e,t){if(1&e&&(g.Cc(0),g.zc(1,"ion-item"),g.Ec(2,"ion-list",13),g.zc(3,"ion-item",14),g.nd(4,CoreLoginSitePage_form_10_ng_container_3_ion_item_4_Template,10,7,"ion-item",15),g.Ec(5,"div",16),g.nd(6,CoreLoginSitePage_form_10_ng_container_3_div_6_Template,3,3,"div",17),g.nd(7,CoreLoginSitePage_form_10_ng_container_3_ng_container_7_Template,2,4,"ng-container",18),g.Dc(),g.Dc(),g.nd(8,CoreLoginSitePage_form_10_ng_container_3_div_8_Template,3,3,"div",19),g.Bc()),2&e){const e=g.Oc(2);g.lc(2),g.qc("hidden",!e.hasSites&&!e.enteredSiteUrl),g.lc(2),g.Vc("ngIf",e.enteredSiteUrl),g.lc(1),g.qc("hidden",!e.hasSites)("dimmed",e.loadingSites),g.lc(1),g.Vc("ngIf",e.loadingSites),g.lc(1),g.Vc("ngForOf",e.sites),g.lc(1),g.Vc("ngIf",!e.hasSites&&e.loadingSites)}}function CoreLoginSitePage_form_10_ion_item_4_Template(e,t){if(1&e&&(g.Ec(0,"ion-item"),g.Ec(1,"ion-label"),g.Ec(2,"ion-button",27),g.pd(3),g.Pc(4,"translate"),g.Dc(),g.Dc(),g.Dc()),2&e){const e=g.Oc(2);g.lc(2),g.Vc("disabled",!e.siteForm.valid),g.lc(1),g.rd(" ",g.Qc(4,2,"core.login.connect")," ")}}function CoreLoginSitePage_form_10_Template(e,t){if(1&e){const e=g.Fc();g.Ec(0,"form",10,11),g.Mc("ngSubmit",(function CoreLoginSitePage_form_10_Template_form_ngSubmit_0_listener(t){g.fd(e);const n=g.Oc();return n.connect(t,n.siteForm.value.siteUrl)})),g.nd(2,CoreLoginSitePage_form_10_ng_container_2_Template,4,4,"ng-container",8),g.nd(3,CoreLoginSitePage_form_10_ng_container_3_Template,9,10,"ng-container",8),g.nd(4,CoreLoginSitePage_form_10_ion_item_4_Template,5,4,"ion-item",8),g.Dc()}if(2&e){const e=g.Oc();g.Vc("formGroup",e.siteForm),g.lc(2),g.Vc("ngIf","url"==e.siteSelector),g.lc(1),g.Vc("ngIf","url"!=e.siteSelector),g.lc(1),g.Vc("ngIf","url"==e.siteSelector)}}function CoreLoginSitePage_ng_container_11_ion_list_1_ion_searchbar_6_Template(e,t){if(1&e){const e=g.Fc();g.Ec(0,"ion-searchbar",30),g.Mc("ngModelChange",(function CoreLoginSitePage_ng_container_11_ion_list_1_ion_searchbar_6_Template_ion_searchbar_ngModelChange_0_listener(t){g.fd(e);return g.Oc(3).filter=t}))("ionInput",(function CoreLoginSitePage_ng_container_11_ion_list_1_ion_searchbar_6_Template_ion_searchbar_ionInput_0_listener(t){g.fd(e);return g.Oc(3).filterChanged(t)}))("ionCancel",(function CoreLoginSitePage_ng_container_11_ion_list_1_ion_searchbar_6_Template_ion_searchbar_ionCancel_0_listener(){g.fd(e);return g.Oc(3).filterChanged()})),g.Pc(1,"translate"),g.Dc()}if(2&e){const e=g.Oc(3);g.Vc("ngModel",e.filter)("placeholder",g.Qc(1,2,"core.login.findyoursite"))}}function CoreLoginSitePage_ng_container_11_ion_list_1_ng_container_7_ng_container_1_Template(e,t){1&e&&g.Ac(0)}function CoreLoginSitePage_ng_container_11_ion_list_1_ng_container_7_Template(e,t){if(1&e&&(g.Cc(0),g.nd(1,CoreLoginSitePage_ng_container_11_ion_list_1_ng_container_7_ng_container_1_Template,1,0,"ng-container",25),g.Bc()),2&e){const e=t.$implicit;g.Oc(3);const n=g.ed(13);g.lc(1),g.Vc("ngTemplateOutlet",n)("ngTemplateOutletContext",g.ad(2,site_c1,e))}}function CoreLoginSitePage_ng_container_11_ion_list_1_Template(e,t){if(1&e&&(g.Ec(0,"ion-list"),g.Ec(1,"ion-item"),g.Ec(2,"ion-label"),g.Ec(3,"h2",28),g.pd(4),g.Pc(5,"translate"),g.Dc(),g.Dc(),g.Dc(),g.nd(6,CoreLoginSitePage_ng_container_11_ion_list_1_ion_searchbar_6_Template,2,4,"ion-searchbar",29),g.nd(7,CoreLoginSitePage_ng_container_11_ion_list_1_ng_container_7_Template,2,4,"ng-container",18),g.Dc()),2&e){const e=g.Oc(2);g.lc(4),g.qd(g.Qc(5,3,"core.login.selectsite")),g.lc(2),g.Vc("ngIf",e.fixedSites.length>4),g.lc(1),g.Vc("ngForOf",e.filteredSites)}}function CoreLoginSitePage_ng_container_11_Template(e,t){if(1&e&&(g.Cc(0),g.nd(1,CoreLoginSitePage_ng_container_11_ion_list_1_Template,8,5,"ion-list",8),g.Bc()),2&e){const e=g.Oc();g.lc(1),g.Vc("ngIf","list"==e.siteSelector)}}function CoreLoginSitePage_ng_template_12_ion_thumbnail_1_img_1_Template(e,t){if(1&e&&g.zc(0,"img",36),2&e){const e=g.Oc(2).site;g.Vc("src",e.imageurl,g.id)}}function CoreLoginSitePage_ng_template_12_ion_thumbnail_1_img_2_Template(e,t){1&e&&g.zc(0,"img",37)}function CoreLoginSitePage_ng_template_12_ion_thumbnail_1_Template(e,t){if(1&e&&(g.Ec(0,"ion-thumbnail",0),g.nd(1,CoreLoginSitePage_ng_template_12_ion_thumbnail_1_img_1_Template,1,1,"img",34),g.nd(2,CoreLoginSitePage_ng_template_12_ion_thumbnail_1_img_2_Template,1,0,"img",35),g.Dc()),2&e){const e=g.Oc().site;g.lc(1),g.Vc("ngIf",e.imageurl),g.lc(1),g.Vc("ngIf",!e.imageurl)}}function CoreLoginSitePage_ng_template_12_p_3_Template(e,t){if(1&e&&(g.Ec(0,"p",38),g.pd(1),g.Dc()),2&e){const e=g.Oc().site;g.lc(1),g.qd(e.title)}}function CoreLoginSitePage_ng_template_12_p_4_Template(e,t){if(1&e&&(g.Ec(0,"p"),g.pd(1),g.Dc()),2&e){const e=g.Oc().site;g.lc(1),g.qd(e.noProtocolUrl)}}function CoreLoginSitePage_ng_template_12_p_5_Template(e,t){if(1&e&&(g.Ec(0,"p"),g.pd(1),g.Dc()),2&e){const e=g.Oc().site;g.lc(1),g.qd(e.location)}}function CoreLoginSitePage_ng_template_12_Template(e,t){if(1&e){const e=g.Fc();g.Ec(0,"ion-item",31),g.Mc("click",(function CoreLoginSitePage_ng_template_12_Template_ion_item_click_0_listener(){g.fd(e);const n=t.site;return g.Oc().connect(n.url,n)})),g.nd(1,CoreLoginSitePage_ng_template_12_ion_thumbnail_1_Template,3,2,"ion-thumbnail",32),g.Ec(2,"ion-label"),g.nd(3,CoreLoginSitePage_ng_template_12_p_3_Template,2,1,"p",33),g.nd(4,CoreLoginSitePage_ng_template_12_p_4_Template,2,1,"p",8),g.nd(5,CoreLoginSitePage_ng_template_12_p_5_Template,2,1,"p",8),g.Dc(),g.Dc()}if(2&e){const e=t.site,n=g.Oc();g.Vc("ngClass",e.className),g.mc("aria-label",e.name),g.lc(1),g.Vc("ngIf",n.siteFinderSettings.displayimage),g.lc(2),g.Vc("ngIf",e.title),g.lc(1),g.Vc("ngIf",e.noProtocolUrl),g.lc(1),g.Vc("ngIf",e.location)}}let _e=(()=>{class CoreLoginSitePage{constructor(e){this.formBuilder=e,this.siteSelector="sitefinder",this.showKeyboard=!1,this.filter="",this.sites=[],this.hasSites=!1,this.loadingSites=!1}ngOnInit(){return Object(c.a)(this,void 0,void 0,(function*(){let e="";this.siteSelector=te.a.CONFIG.multisitesdisplay;this.siteFinderSettings=Object.assign({displaysitename:!0,displayimage:!0,displayalias:!0,displaycity:!0,displaycountry:!0,displayurl:!0},te.a.CONFIG.sitefindersettings||{});const t=yield l.a.getAvailableSites();this.connect("https://courses.teflinstitute.com/"),t.length?e=yield this.initSiteSelector():te.a.CONFIG.enableonboarding&&!f.a.isIOS()&&this.initOnboarding(),this.showScanQR=l.a.displayQRInSiteScreen(),this.siteForm=this.formBuilder.group({siteUrl:[e,this.moodleUrlValidator()]}),this.searchFunction=a.a.debounce((e=>Object(c.a)(this,void 0,void 0,(function*(){if((e=e.trim()).length>=3){const t=yield r.b.findSites(e);this.sites=this.extendCoreLoginSiteInfo(t),this.hasSites=!!this.sites.length}else this.hasSites=!1;this.loadingSites=!1}))),1e3),this.showKeyboard=!!p.a.getRouteBooleanParam("showKeyboard")}))}initSiteSelector(){return Object(c.a)(this,void 0,void 0,(function*(){const e=yield l.a.getAvailableSites();return this.fixedSites=this.extendCoreLoginSiteInfo(e),this.siteSelector="list",this.fixedSites.some((e=>!!e.imageurl))||(this.siteFinderSettings.displayimage=!1),this.filteredSites=this.fixedSites,this.fixedSites[0].url}))}initOnboarding(){return Object(c.a)(this,void 0,void 0,(function*(){!(yield Z.a.get(l.b.ONBOARDING_DONE,!1))}))}extendCoreLoginSiteInfo(e){return e.map((e=>{e.noProtocolUrl=this.siteFinderSettings.displayurl&&e.url?ne.a.removeProtocol(e.url):"";const t=this.siteFinderSettings.displaysitename?e.name:"",n=this.siteFinderSettings.displayalias&&e.alias?e.alias:"";e.title=t&&n?t+" ("+n+")":t+n;const o=this.siteFinderSettings.displaycountry&&e.countrycode?a.a.getCountryName(e.countrycode):"",i=this.siteFinderSettings.displaycity&&e.city?e.city:"";return e.location=i&&o?i+" - "+o:i+o,r.b.hasDefaultImage(e)&&this.siteFinderSettings.defaultimageurl&&(e.imageurl=this.siteFinderSettings.defaultimageurl),e}))}moodleUrlValidator(){return e=>{const t=e.value.trim();let n=t.length>=3&&ne.a.isValidMoodleUrl(t);if(!n){!!r.b.getDemoSiteData(t)&&(n=!0)}return n?null:{siteUrl:{value:e.value}}}}showHelp(){return Object(c.a)(this,void 0,void 0,(function*(){yield m.a.openModal({component:ie.a,cssClass:"core-modal-fullscreen"})}))}showOnboarding(){return Object(c.a)(this,void 0,void 0,(function*(){yield m.a.openModal({component:ce.a,cssClass:"core-modal-fullscreen"})}))}connect(e,t){return Object(c.a)(this,void 0,void 0,(function*(){if(X.a.closeKeyboard(),!e)return m.a.showErrorModal("core.login.siteurlrequired",!0),void 0;if(!Y.a.isOnline())return m.a.showErrorModal("core.networkerrormsg",!0),void 0;if((e=e.trim()).match(/^(https?:\/\/)?campus\.example\.edu/))return this.showLoginIssue(null,new ee.a(s.I.instant("core.login.errorexampleurl"))),void 0;const n=r.b.getDemoSiteData(e="https://courses.teflinstitute.com/");if(n)yield this.loginDemoSite(n);else{const n=yield m.a.showModalLoading();let o;try{o=yield r.b.checkSite(e)}catch(t){const i=ne.a.guessMoodleDomain(e);if(!i||i==e)return n.dismiss(),this.showLoginIssue(e,t);try{o=yield r.b.checkSite(i)}catch(o){return n.dismiss(),this.showLoginIssue(e,t||o)}}yield this.login(o,t),n.dismiss()}}))}loginDemoSite(e){return Object(c.a)(this,void 0,void 0,(function*(){const t=yield m.a.showModalLoading();try{const t=yield r.b.getUserToken(e.url,e.username,e.password);return yield r.b.newSite(t.siteUrl,t.token,t.privateToken),h.a.triggerFormSubmittedEvent(this.formElement,!0),yield p.a.navigateToSiteHome(),void 0}catch(t){l.a.treatUserTokenError(e.url,t,e.username,e.password),t.loggedout&&p.a.navigate("/login/sites",{reset:!0})}finally{t.dismiss()}}))}login(e,t){var n;return Object(c.a)(this,void 0,void 0,(function*(){try{if(yield r.b.checkApplication(e.config),h.a.triggerFormSubmittedEvent(this.formElement,!0),l.a.isSSOLoginNeeded(e.code))l.a.confirmAndOpenBrowserForSSOLogin(e.siteUrl,e.code,e.service,null===(n=e.config)||void 0===n?void 0:n.launchurl);else{const n={siteUrl:e.siteUrl,siteConfig:e.config};t&&!this.fixedSites&&(n.siteName=t.name,n.logoUrl=t.imageurl),p.a.navigate("/login/credentials",{params:n})}}catch(e){}}))}showLoginIssue(e,t){return Object(c.a)(this,void 0,void 0,(function*(){let e,n,o,i,c=m.a.getErrorMessage(t),r=!1;t instanceof ae.a&&(e=t.supportConfig,o=t.errorDetails,i=t.errorcode,r=e instanceof P.a),t instanceof ge.a&&(n=t.title),o&&(c=`<p>${c}</p><div class="core-error-info-container"></div>`);const a=e,l=[{text:s.I.instant("core.tryagain"),role:"cancel"},(null==a?void 0:a.canContactSupport())?{text:s.I.instant("core.contactsupport"),handler:()=>se.a.contact({supportConfig:a,subject:s.I.instant("core.cannotconnect"),message:`Error: ${i}\n\n${o}`})}:r?null:{text:s.I.instant("core.needhelp"),cssClass:"core-login-need-help",handler:()=>this.showHelp()}].filter((e=>!!e)),g=yield m.a.showAlertWithOptions({header:null!=n?n:s.I.instant("core.cannotconnect"),message:null!=c?c:s.I.instant("core.sitenotfoundhelp"),buttons:l});if(o){const e=g.querySelector(".core-error-info-container");e&&(e.innerHTML=le.a.render(o,i))}}))}filterChanged(e){var t;const n=null===(t=null==e?void 0:e.target.value)||void 0===t?void 0:t.trim().toLowerCase();this.filteredSites=n&&this.fixedSites?this.fixedSites.filter((e=>e.title.toLowerCase().indexOf(n)>-1||e.noProtocolUrl.toLowerCase().indexOf(n)>-1||e.location.toLowerCase().indexOf(n)>-1)):this.fixedSites}searchSite(e,t){this.loadingSites=!0,t=t.trim(),this.enteredSiteUrl=this.siteForm.valid&&t.length>=3?{url:t,name:"connect",title:"",location:"",noProtocolUrl:ne.a.removeProtocol(t)}:void 0,this.searchFunction(t.trim())}showInstructionsAndScanQR(){return Object(c.a)(this,void 0,void 0,(function*(){try{yield l.a.showScanQRInstructions(),yield this.scanQR()}catch(e){}}))}scanQR(){return Object(c.a)(this,void 0,void 0,(function*(){const e=yield a.a.scanQR();if(!e)return;if(re.a.isCustomURL(e)){try{yield re.a.handleCustomURL(e)}catch(t){t&&t.data&&t.data.isAuthenticationURL&&t.data.siteUrl?this.treatErrorInAuthenticationCustomURL(e,t):re.a.treatHandleCustomURLError(t)}return}const t=oe.a.getUrlProtocol(e);if(t&&"http"!=t&&"https"!=t)return m.a.showErrorModal(s.I.instant("core.errorurlschemeinvalidscheme",{$a:e})),void 0;(yield l.a.isSiteUrlAllowed(e))?this.siteForm.controls.siteUrl.setValue(e):m.a.showErrorModal("core.errorurlschemeinvalidsite",!0)}))}treatErrorInAuthenticationCustomURL(e,t){var n;return Object(c.a)(this,void 0,void 0,(function*(){const e=(null===(n=t.data)||void 0===n?void 0:n.siteUrl)||"",o=yield m.a.showModalLoading();this.siteForm.controls.siteUrl.setValue(e);try{const t=yield r.b.checkSite(e);yield r.b.checkApplication(t.config),l.a.isSSOLoginNeeded(t.code)||(yield p.a.navigate("/login/credentials",{params:{siteUrl:t.siteUrl,siteConfig:t.config}}))}catch(e){}finally{o.dismiss()}t.error=q.b.addTextToError(t.error,"<br><br>"+s.I.instant("core.login.youcanstillconnectwithcredentials")),re.a.treatHandleCustomURLError(t)}))}openSettings(){p.a.navigate("/settings")}}return CoreLoginSitePage.ɵfac=function CoreLoginSitePage_Factory(e){return new(e||CoreLoginSitePage)(g.yc(u.f))},CoreLoginSitePage.ɵcmp=g.sc({type:CoreLoginSitePage,selectors:[["page-core-login-site"]],viewQuery:function CoreLoginSitePage_Query(e,t){var n;(1&e&&g.ud(de,!0),2&e)&&(g.dd(n=g.Nc())&&(t.formElement=n.first))},decls:14,vars:7,consts:[["slot","start"],[3,"text"],["slot","end"],[1,"ion-padding"],[1,"list-item-limited-width"],[1,"ion-text-center","ion-padding","ion-margin-bottom","core-login-site-logo"],["src","assets/img/icon.png","role","presentation","alt","",1,"avatar-full","login-logo"],[3,"formGroup","ngSubmit",4,"ngIf"],[4,"ngIf"],["sitelisting",""],[3,"formGroup","ngSubmit"],["siteFormEl",""],["name","url","type","url","formControlName","siteUrl",3,"placeholder","core-auto-focus"],[1,"core-login-site-list"],[1,"core-login-site-list-title"],["button","","detail","true","class","core-login-entered-site",3,"click",4,"ngIf"],[1,"core-login-site-list-found"],["class","core-login-site-list-loading",4,"ngIf"],[4,"ngFor","ngForOf"],["class","core-login-site-nolist-loading",4,"ngIf"],["button","","detail","true",1,"core-login-entered-site",3,"click"],["slot","start","aria-hidden","true"],["name","fas-pen","aria-hidden","true"],[1,"ion-text-wrap"],[1,"core-login-site-list-loading"],[4,"ngTemplateOutlet","ngTemplateOutletContext"],[1,"core-login-site-nolist-loading"],["expand","block","type","submit",1,"ion-text-wrap",3,"disabled"],[1,"item-heading"],[3,"ngModel","placeholder","ngModelChange","ionInput","ionCancel",4,"ngIf"],[3,"ngModel","placeholder","ngModelChange","ionInput","ionCancel"],["button","","detail","true",3,"ngClass","click"],["slot","start",4,"ngIf"],["class","item-heading ion-text-wrap",4,"ngIf"],["onError","this.src='assets/icon/icon.png'","alt","","role","presentation",3,"src",4,"ngIf"],["src","assets/icon/icon.png","class","core-login-default-icon","alt","","role","presentation",4,"ngIf"],["onError","this.src='assets/icon/icon.png'","alt","","role","presentation",3,"src"],["src","assets/icon/icon.png","alt","","role","presentation",1,"core-login-default-icon"],[1,"item-heading","ion-text-wrap"]],template:function CoreLoginSitePage_Template(e,t){1&e&&(g.Ec(0,"ion-header"),g.Ec(1,"ion-toolbar"),g.Ec(2,"ion-buttons",0),g.zc(3,"ion-back-button",1),g.Pc(4,"translate"),g.Dc(),g.zc(5,"ion-buttons",2),g.Dc(),g.Dc(),g.Ec(6,"ion-content",3),g.Ec(7,"div",4),g.Ec(8,"div",5),g.zc(9,"img",6),g.Dc(),g.nd(10,CoreLoginSitePage_form_10_Template,5,4,"form",7),g.nd(11,CoreLoginSitePage_ng_container_11_Template,2,1,"ng-container",8),g.Dc(),g.Dc(),g.nd(12,CoreLoginSitePage_ng_template_12_Template,6,6,"ng-template",null,9,g.od)),2&e&&(g.lc(3),g.Vc("text",g.Qc(4,5,"core.back")),g.lc(5),g.qc("hidden",t.hasSites||t.enteredSiteUrl),g.lc(2),g.Vc("ngIf",!t.fixedSites&&t.siteForm),g.lc(1),g.Vc("ngIf",t.fixedSites))},directives:[C.C,C.Ab,C.m,C.h,C.i,b.a,C.v,O.t,u.H,u.s,u.k,C.I,C.H,C.Pb,u.r,u.i,E.a,C.P,O.s,C.xb,C.D,N.a,C.O,C.qb,O.A,v.a,C.l,C.ib,u.u,O.q],pipes:[S.d],styles:["[_nghost-%COMP%]{--list-item-max-width:600px}.item-input[_ngcontent-%COMP%]:last-child{margin-bottom:20px}.core-login-site-connect[_ngcontent-%COMP%]{margin-top:1.4rem}.item[_ngcontent-%COMP%]   ion-thumbnail[_ngcontent-%COMP%]{min-width:50px;min-height:50px;width:50px;height:50px;border-radius:20%;box-shadow:0 0 4px var(--gray-200);text-align:center;overflow:hidden}.item[_ngcontent-%COMP%]   ion-thumbnail[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{max-height:50px;max-width:-webkit-fit-content;max-width:fit-content;width:auto;height:auto;margin:0 auto 0 50%;transform:translate3d(-50%,0,0);object-fit:cover;object-position:50% 50%}[dir=rtl][_nghost-%COMP%]   .item[_ngcontent-%COMP%]   ion-thumbnail[_ngcontent-%COMP%]   img[_ngcontent-%COMP%], [dir=rtl]   [_nghost-%COMP%]   .item[_ngcontent-%COMP%]   ion-thumbnail[_ngcontent-%COMP%]   img[_ngcontent-%COMP%], [dir=rtl][_ngcontent-%COMP%]   .item[_ngcontent-%COMP%]   ion-thumbnail[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{transform:translate3d(calc(-1 * -50%),0,0)}.item[_ngcontent-%COMP%]   ion-thumbnail[_ngcontent-%COMP%]   ion-icon[_ngcontent-%COMP%]{margin:0 auto;font-size:35px;height:50px}[dir=rtl][_nghost-%COMP%]   .item[_ngcontent-%COMP%]   ion-thumbnail[_ngcontent-%COMP%]   img[_ngcontent-%COMP%], [dir=rtl]   [_nghost-%COMP%]   .item[_ngcontent-%COMP%]   ion-thumbnail[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{margin-left:0;margin-right:50%}.core-login-site-list[_ngcontent-%COMP%], .core-login-site-list-found[_ngcontent-%COMP%], .core-login-site-logo[_ngcontent-%COMP%]{transition-delay:0s;visibility:visible;opacity:1;transition:all .7s ease-in-out;max-height:9999px}.core-login-site-list-found.hidden[_ngcontent-%COMP%], .core-login-site-list.hidden[_ngcontent-%COMP%], .core-login-site-logo.hidden[_ngcontent-%COMP%]{opacity:0;visibility:hidden;margin-top:0;margin-bottom:0;padding:0;max-height:0}.core-login-site-list-found.dimmed[_ngcontent-%COMP%]{pointer-events:none;position:relative}.core-login-site-list-loading[_ngcontent-%COMP%]{position:absolute;top:0;bottom:0;left:0;right:0;width:100%;height:100%;display:flex;align-content:center;align-items:center;background-color:hsla(0,0%,100%,.5);z-index:1}.core-login-site-list-loading[_ngcontent-%COMP%]   ion-spinner[_ngcontent-%COMP%]{margin:0 auto}.core-login-site-nolist-loading[_ngcontent-%COMP%]{margin-top:16px;text-align:center}.item.core-login-site-list-title[_ngcontent-%COMP%]   ion-label[_ngcontent-%COMP%], .item.core-login-site-list-title[_ngcontent-%COMP%]   ion-label[_ngcontent-%COMP%]   h2.item-heading[_ngcontent-%COMP%]{margin-top:0}@media (min-width:768px){ion-content[_ngcontent-%COMP%]   .core-login-site-logo[_ngcontent-%COMP%]{margin-top:20%}ion-content[_ngcontent-%COMP%]   .core-login-site-logo.hidden[_ngcontent-%COMP%]{margin-top:0}}.core-login-entered-site[_ngcontent-%COMP%]{background-color:var(--light)}.core-login-entered-site[_ngcontent-%COMP%]   ion-thumbnail[_ngcontent-%COMP%]{box-shadow:0 0 4px var(--gray-300)}.core-login-default-icon[_ngcontent-%COMP%]{filter:grayscale(100%)}","[_nghost-%COMP%]   ion-content[_ngcontent-%COMP%], [_nghost-%COMP%]   ion-list[_ngcontent-%COMP%]{--background:var(--core-login-background);--ion-item-background:var(--core-login-background)}[_nghost-%COMP%]   ion-content[_ngcontent-%COMP%], [_nghost-%COMP%]   ion-item[_ngcontent-%COMP%]   ion-label[_ngcontent-%COMP%], [_nghost-%COMP%]   ion-list[_ngcontent-%COMP%]{--color:var(--core-login-text-color)}[_nghost-%COMP%]   form[_ngcontent-%COMP%]   div[_ngcontent-%COMP%], [_nghost-%COMP%]   ion-item[_ngcontent-%COMP%]   ion-label[_ngcontent-%COMP%]   .core-oauth-icon[_ngcontent-%COMP%], [_nghost-%COMP%]   ion-item[_ngcontent-%COMP%]   ion-label[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%], [_nghost-%COMP%]   ion-item[_ngcontent-%COMP%]   ion-label[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%], [_nghost-%COMP%]   ion-item[_ngcontent-%COMP%]   ion-label[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{color:var(--color)}[_nghost-%COMP%]   ion-button.core-button-as-link[_ngcontent-%COMP%]{--color:var(--core-login-text-color);-webkit-text-decoration-color:var(--core-login-text-color);text-decoration-color:var(--core-login-text-color)}[_nghost-%COMP%]   ion-button.core-button-as-link[_ngcontent-%COMP%]   ion-label[_ngcontent-%COMP%]{color:var(--core-login-text-color)}[_nghost-%COMP%]   form[_ngcontent-%COMP%]   .core-username.item[_ngcontent-%COMP%], [_nghost-%COMP%]   form[_ngcontent-%COMP%]   .item.item-input[_ngcontent-%COMP%]{margin-bottom:16px}[_nghost-%COMP%]   form[_ngcontent-%COMP%]   .core-username.ios[_ngcontent-%COMP%]{--inner-border-width:0 0 1px 0}[_nghost-%COMP%]   form[_ngcontent-%COMP%]   .item[_ngcontent-%COMP%], [_nghost-%COMP%]   form[_ngcontent-%COMP%]   .item[_ngcontent-%COMP%]   ion-label[_ngcontent-%COMP%]{--background:var(--core-login-input-background);--color:var(--core-login-input-color)}[_nghost-%COMP%]   form[_ngcontent-%COMP%]   .core-username.item[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{font-size:16px}[_nghost-%COMP%]   form[_ngcontent-%COMP%]   .core-username.item.md[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{padding-left:8px}@supports ((-webkit-margin-start:0) or (margin-inline-start:0)) or (-webkit-margin-start:0){[_nghost-%COMP%]   form[_ngcontent-%COMP%]   .core-username.item.md[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{padding-left:unset;-webkit-padding-start:8px;padding-inline-start:8px}}[_nghost-%COMP%]   .core-login-site-logo[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{max-width:100%}[_nghost-%COMP%]   .core-sitename[_ngcontent-%COMP%] + .core-siteurl[_ngcontent-%COMP%]{margin-top:0}[_nghost-%COMP%]   .core-sitename[_ngcontent-%COMP%]{font-size:1.2rem;margin-bottom:0}[_nghost-%COMP%]   .core-login-site-logo[_ngcontent-%COMP%]{width:90%;max-width:300px;margin:5px auto}[_nghost-%COMP%]   .core-login-forgotten-password[_ngcontent-%COMP%]{text-decoration:underline}[_nghost-%COMP%]   core-user-avatar.large-avatar[_ngcontent-%COMP%]{--core-avatar-size:var(--core-large-avatar-size)}html.dark[_nghost-%COMP%]   core-loading[_ngcontent-%COMP%], html.dark   [_nghost-%COMP%]   core-loading[_ngcontent-%COMP%]{--loading-background:var(--core-login-background-dark);--loading-text-color:#fff;--loading-spinner:#fff}"]}),CoreLoginSitePage})();var ue=n("tS8V"),me=n("MUy3"),pe=n("yNDK"),he=n("FeAf");function CoreLoginSitesPage_ion_button_10_Template(e,t){if(1&e){const e=g.Fc();g.Ec(0,"ion-button",13),g.Mc("click",(function CoreLoginSitesPage_ion_button_10_Template_ion_button_click_0_listener(){g.fd(e);return g.Oc().toggleDelete()})),g.Pc(1,"translate"),g.zc(2,"ion-icon",14),g.Dc()}2&e&&g.mc("aria-label",g.Qc(1,1,"core.login.toggleremove"))}function CoreLoginSitesPage_ion_card_17_ion_item_divider_1_Template(e,t){if(1&e&&(g.Ec(0,"ion-item-divider",17),g.Ec(1,"ion-label"),g.Ec(2,"h2"),g.zc(3,"core-format-text",18),g.Dc(),g.Ec(4,"p"),g.Ec(5,"a",19),g.pd(6),g.Dc(),g.Dc(),g.Dc(),g.Dc()),2&e){const e=g.Oc().$implicit;g.lc(3),g.Vc("text",e[0].siteName)("siteId",e[0].id),g.lc(2),g.Vc("href",e[0].siteUrl,g.id),g.lc(1),g.qd(e[0].siteUrlWithoutProtocol)}}const sites_c0=function(e){return{count:e}};function CoreLoginSitesPage_ion_card_17_ion_item_2_ion_badge_5_Template(e,t){if(1&e&&(g.Ec(0,"ion-badge",2),g.Ec(1,"span",25),g.pd(2),g.Dc(),g.Ec(3,"span",12),g.pd(4),g.Pc(5,"translate"),g.Dc(),g.Dc()),2&e){const e=g.Oc().$implicit;g.Vc("@coreShowHideAnimation",void 0),g.lc(2),g.qd(e.badge),g.lc(2),g.qd(g.Rc(5,3,"core.login.sitebadgedescription",g.ad(6,sites_c0,e.badge)))}}function CoreLoginSitesPage_ion_card_17_ion_item_2_ion_button_6_Template(e,t){if(1&e){const e=g.Fc();g.Ec(0,"ion-button",26),g.Mc("click",(function CoreLoginSitesPage_ion_card_17_ion_item_2_ion_button_6_Template_ion_button_click_0_listener(t){g.fd(e);const n=g.Oc().$implicit;return g.Oc(2).deleteSite(t,n)})),g.Pc(1,"translate"),g.zc(2,"ion-icon",27),g.Dc()}2&e&&(g.Vc("@coreSlideInOut","fromRight"),g.mc("aria-label",g.Qc(1,2,"core.login.removeaccount")))}function CoreLoginSitesPage_ion_card_17_ion_item_2_Template(e,t){if(1&e){const e=g.Fc();g.Ec(0,"ion-item",20),g.Mc("click",(function CoreLoginSitesPage_ion_card_17_ion_item_2_Template_ion_item_click_0_listener(n){g.fd(e);const o=t.$implicit;return g.Oc(2).login(n,o.id)})),g.zc(1,"core-user-avatar",21),g.Ec(2,"ion-label"),g.Ec(3,"p",22),g.pd(4),g.Dc(),g.Dc(),g.nd(5,CoreLoginSitesPage_ion_card_17_ion_item_2_ion_badge_5_Template,6,8,"ion-badge",23),g.nd(6,CoreLoginSitesPage_ion_card_17_ion_item_2_ion_button_6_Template,3,4,"ion-button",24),g.Dc()}if(2&e){const e=t.$implicit,n=g.Oc(2);g.lc(1),g.Vc("user",e)("linkProfile",!1)("siteId",e.id),g.lc(3),g.qd(e.fullname),g.lc(1),g.Vc("ngIf",!n.showDelete&&e.badge),g.lc(1),g.Vc("ngIf",n.showDelete)}}function CoreLoginSitesPage_ion_card_17_Template(e,t){if(1&e&&(g.Ec(0,"ion-card"),g.nd(1,CoreLoginSitesPage_ion_card_17_ion_item_divider_1_Template,7,4,"ion-item-divider",15),g.nd(2,CoreLoginSitesPage_ion_card_17_ion_item_2_Template,7,6,"ion-item",16),g.Dc()),2&e){const e=t.$implicit;g.lc(1),g.Vc("ngIf",e[0]),g.lc(1),g.Vc("ngForOf",e)}}let fe=(()=>{class CoreLoginSitesPage{constructor(){this.accountsList={sameSite:[],otherSites:[],count:0},this.showDelete=!1,this.loaded=!1}ngOnInit(){return Object(c.a)(this,void 0,void 0,(function*(){if(p.a.getRouteBooleanParam("openAddSite"))return this.add(),void 0;this.accountsList=yield l.a.getAccountsList(),this.loaded=!0,0==this.accountsList.count&&this.add()}))}add(){l.a.goToAddSite(!1,!0)}deleteSite(e,t){return Object(c.a)(this,void 0,void 0,(function*(){e.stopPropagation();let n=t.siteName||"";n=yield ue.a.formatText(n,{clean:!0,singleLine:!0,filter:!1},[],t.id);try{yield m.a.showDeleteConfirm("core.login.confirmdeletesite",{sitename:n})}catch(e){return}try{yield l.a.deleteAccountFromList(this.accountsList,t),this.showDelete=!1,0==this.accountsList.count&&l.a.goToAddSite(!0,!0)}catch(e){m.a.showErrorModalDefault(e,"core.login.errordeletesite",!0)}}))}login(e,t){return Object(c.a)(this,void 0,void 0,(function*(){e.preventDefault(),e.stopPropagation();const n=yield m.a.showModalLoading();try{if(yield r.b.loadSite(t))return yield p.a.navigateToSiteHome(),void 0}catch(e){m.a.showErrorModalDefault(e,"Error loading site.")}finally{n.dismiss()}}))}toggleDelete(){this.showDelete=!this.showDelete}openSettings(){p.a.navigate("/settings")}}return CoreLoginSitesPage.ɵfac=function CoreLoginSitesPage_Factory(e){return new(e||CoreLoginSitesPage)},CoreLoginSitesPage.ɵcmp=g.sc({type:CoreLoginSitesPage,selectors:[["page-core-login-sites"]],decls:25,vars:18,consts:[["slot","start"],[3,"text"],["slot","end"],["fill","clear",3,"click",4,"ngIf"],[3,"click"],["slot","icon-only","name","fas-gear","aria-hidden","true"],[1,"limited-width"],[3,"hideUntil"],[1,"core-sitelist"],[4,"ngFor","ngForOf"],["slot","fixed","core-fab","","vertical","bottom","horizontal","end"],["name","fas-plus","aria-hidden","true"],[1,"sr-only"],["fill","clear",3,"click"],["slot","icon-only","name","fas-pen","aria-hidden","true"],["sticky","true","class","core-sitelist-sitename",4,"ngIf"],["button","","detail","true",3,"click",4,"ngFor","ngForOf"],["sticky","true",1,"core-sitelist-sitename"],["clean","true",3,"text","siteId"],["core-link","","autoLogin","no",3,"href"],["button","","detail","true",3,"click"],["slot","start",3,"user","linkProfile","siteId"],[1,"item-heading"],["slot","end",4,"ngIf"],["slot","end","fill","clear","color","danger",3,"click",4,"ngIf"],["aria-hidden","true"],["slot","end","fill","clear","color","danger",3,"click"],["name","fas-trash","slot","icon-only","aria-hidden","true"]],template:function CoreLoginSitesPage_Template(e,t){1&e&&(g.Ec(0,"ion-header"),g.Ec(1,"ion-toolbar"),g.Ec(2,"ion-buttons",0),g.zc(3,"ion-back-button",1),g.Pc(4,"translate"),g.Dc(),g.Ec(5,"ion-title"),g.Ec(6,"h1"),g.pd(7),g.Pc(8,"translate"),g.Dc(),g.Dc(),g.Ec(9,"ion-buttons",2),g.nd(10,CoreLoginSitesPage_ion_button_10_Template,3,3,"ion-button",3),g.Ec(11,"ion-button",4),g.Mc("click",(function CoreLoginSitesPage_Template_ion_button_click_11_listener(){return t.openSettings()})),g.Pc(12,"translate"),g.zc(13,"ion-icon",5),g.Dc(),g.Dc(),g.Dc(),g.Dc(),g.Ec(14,"ion-content",6),g.Ec(15,"core-loading",7),g.Ec(16,"ion-list",8),g.nd(17,CoreLoginSitesPage_ion_card_17_Template,3,2,"ion-card",9),g.Dc(),g.Dc(),g.Ec(18,"ion-fab",10),g.Ec(19,"ion-fab-button",4),g.Mc("click",(function CoreLoginSitesPage_Template_ion_fab_button_click_19_listener(){return t.add()})),g.Pc(20,"translate"),g.zc(21,"ion-icon",11),g.Ec(22,"span",12),g.pd(23),g.Pc(24,"translate"),g.Dc(),g.Dc(),g.Dc(),g.Dc()),2&e&&(g.lc(3),g.Vc("text",g.Qc(4,8,"core.back")),g.lc(4),g.qd(g.Qc(8,10,"core.login.accounts")),g.lc(3),g.Vc("ngIf",t.accountsList.count>0),g.lc(1),g.mc("aria-label",g.Qc(12,12,"core.settings.appsettings")),g.lc(4),g.Vc("hideUntil",t.loaded),g.lc(2),g.Vc("ngForOf",t.accountsList.otherSites),g.lc(2),g.mc("aria-label",g.Qc(20,14,"core.login.add")),g.lc(4),g.qd(g.Qc(24,16,"core.login.add")))},directives:[C.C,C.Ab,C.m,C.h,C.i,C.yb,O.t,v.a,C.l,C.D,N.a,b.a,C.v,x.a,C.P,O.s,C.x,pe.a,C.y,C.n,C.J,C.O,G.a,I.a,C.I,he.a,C.k],pipes:[S.d],styles:["ion-list.core-sitelist[_ngcontent-%COMP%]   .core-sitelist-sitename[_ngcontent-%COMP%]{border-bottom:1px solid var(--stroke)}ion-list.core-sitelist[_ngcontent-%COMP%]   .core-sitelist-sitename[_ngcontent-%COMP%]   ion-label[_ngcontent-%COMP%]{margin-top:8px;margin-bottom:8px}"],data:{animation:[me.a.SLIDE_IN_OUT,me.a.SHOW_HIDE]}}),CoreLoginSitesPage})();function CoreLoginChangePasswordPage_h1_6_Template(e,t){1&e&&(g.Ec(0,"h1"),g.pd(1),g.Pc(2,"translate"),g.Dc()),2&e&&(g.lc(1),g.qd(g.Qc(2,1,"core.login.changepassword")))}function CoreLoginChangePasswordPage_h1_7_Template(e,t){1&e&&(g.Ec(0,"h1"),g.pd(1),g.Pc(2,"translate"),g.Dc()),2&e&&(g.lc(1),g.qd(g.Qc(2,1,"core.login.reconnecttosite")))}function CoreLoginChangePasswordPage_ng_container_14_Template(e,t){if(1&e){const e=g.Fc();g.Cc(0),g.Ec(1,"ion-item",7),g.Ec(2,"ion-label"),g.Ec(3,"h2"),g.pd(4),g.Pc(5,"translate"),g.Dc(),g.Dc(),g.Dc(),g.Ec(6,"ion-button",9),g.Mc("click",(function CoreLoginChangePasswordPage_ng_container_14_Template_ion_button_click_6_listener(){g.fd(e);return g.Oc().openChangePasswordPage()})),g.pd(7),g.Pc(8,"translate"),g.Dc(),g.Bc()}2&e&&(g.lc(4),g.qd(g.Qc(5,2,"core.login.forcepasswordchangenotice")),g.lc(3),g.rd(" ",g.Qc(8,4,"core.login.changepasswordbutton")," "))}function CoreLoginChangePasswordPage_ng_container_15_Template(e,t){if(1&e){const e=g.Fc();g.Cc(0),g.Ec(1,"ion-item",7),g.Ec(2,"ion-label"),g.Ec(3,"p"),g.pd(4),g.Pc(5,"translate"),g.Dc(),g.Dc(),g.Dc(),g.Ec(6,"ion-button",9),g.Mc("click",(function CoreLoginChangePasswordPage_ng_container_15_Template_ion_button_click_6_listener(){g.fd(e);return g.Oc().login()})),g.pd(7),g.Pc(8,"translate"),g.Dc(),g.Bc()}2&e&&(g.lc(4),g.qd(g.Qc(5,2,"core.login.changepasswordreconnectinstructions")),g.lc(3),g.rd(" ",g.Qc(8,4,"core.login.reconnect")," "))}let Pe=(()=>{class CoreLoginChangePasswordPage{constructor(){this.changingPassword=!1,this.logoutLabel=l.a.getLogoutLabel()}showHelp(){se.a.showHelp(s.I.instant("core.login.changepasswordhelp"),s.I.instant("core.login.changepasswordsupportsubject"))}openChangePasswordPage(){l.a.openInAppForEdit(r.b.getCurrentSiteId(),"/login/change_password.php",void 0,!0),this.changingPassword=!0,this.detectPasswordChanged()}login(){p.a.navigateToSiteHome(),this.changingPassword=!1}logout(){r.b.logout(),this.changingPassword=!1}detectPasswordChanged(){this.urlLoadedObserver||(this.urlLoadedObserver=D.b.on(D.b.IAB_LOAD_STOP,(e=>{var t;if(e.url.match(/\/login\/change_password\.php.*return=1/))return a.a.closeInAppBrowser(),this.login(),void 0;e.url.match(/\/login\/change_password\.php/)&&(null===(t=a.a.getInAppBrowserInstance())||void 0===t?void 0:t.executeScript({code:"\n                    if (\n                        document.querySelector('input[type=\"password\"]') === null &&\n                        document.querySelector('button[type=\"submit\"]') !== null\n                    ) {\n                        webkit.messageHandlers.cordova_iab.postMessage(JSON.stringify({ passwordChanged: true }));\n                    }\n                "}))})),this.messageObserver=D.b.on(D.b.IAB_MESSAGE,(e=>{e.passwordChanged&&(a.a.closeInAppBrowser(),this.login())})),this.browserClosedObserver=D.b.on(D.b.IAB_EXIT,(()=>{var e,t,n;null===(e=this.urlLoadedObserver)||void 0===e?void 0:e.off(),null===(t=this.messageObserver)||void 0===t||t.off(),null===(n=this.browserClosedObserver)||void 0===n||n.off(),delete this.urlLoadedObserver,delete this.messageObserver,delete this.browserClosedObserver})))}ngOnDestroy(){var e,t,n;null===(e=this.urlLoadedObserver)||void 0===e?void 0:e.off(),null===(t=this.messageObserver)||void 0===t||t.off(),null===(n=this.browserClosedObserver)||void 0===n||n.off()}}return CoreLoginChangePasswordPage.ɵfac=function CoreLoginChangePasswordPage_Factory(e){return new(e||CoreLoginChangePasswordPage)},CoreLoginChangePasswordPage.ɵcmp=g.sc({type:CoreLoginChangePasswordPage,selectors:[["page-core-login-change-password"]],decls:24,vars:16,consts:[["slot","start"],[3,"text"],[4,"ngIf"],["slot","end"],["fill","clear",3,"click"],["slot","icon-only","name","far-circle-question","aria-hidden","true"],[1,"list-item-limited-width"],[1,"ion-text-wrap"],["expand","block","fill","outline",1,"ion-text-wrap","ion-margin",3,"click"],["expand","block",1,"ion-text-wrap","ion-margin",3,"click"]],template:function CoreLoginChangePasswordPage_Template(e,t){1&e&&(g.Ec(0,"ion-header"),g.Ec(1,"ion-toolbar"),g.Ec(2,"ion-buttons",0),g.zc(3,"ion-back-button",1),g.Pc(4,"translate"),g.Dc(),g.Ec(5,"ion-title"),g.nd(6,CoreLoginChangePasswordPage_h1_6_Template,3,3,"h1",2),g.nd(7,CoreLoginChangePasswordPage_h1_7_Template,3,3,"h1",2),g.Dc(),g.Ec(8,"ion-buttons",3),g.Ec(9,"ion-button",4),g.Mc("click",(function CoreLoginChangePasswordPage_Template_ion_button_click_9_listener(){return t.showHelp()})),g.Pc(10,"translate"),g.zc(11,"ion-icon",5),g.Dc(),g.Dc(),g.Dc(),g.Dc(),g.Ec(12,"ion-content"),g.Ec(13,"ion-list",6),g.nd(14,CoreLoginChangePasswordPage_ng_container_14_Template,9,6,"ng-container",2),g.nd(15,CoreLoginChangePasswordPage_ng_container_15_Template,9,6,"ng-container",2),g.Ec(16,"ion-item",7),g.Ec(17,"ion-label"),g.Ec(18,"p"),g.pd(19),g.Pc(20,"translate"),g.Dc(),g.Dc(),g.Dc(),g.Ec(21,"ion-button",8),g.Mc("click",(function CoreLoginChangePasswordPage_Template_ion_button_click_21_listener(){return t.logout()})),g.pd(22),g.Pc(23,"translate"),g.Dc(),g.Dc(),g.Dc()),2&e&&(g.lc(3),g.Vc("text",g.Qc(4,8,"core.back")),g.lc(3),g.Vc("ngIf",!t.changingPassword),g.lc(1),g.Vc("ngIf",t.changingPassword),g.lc(2),g.mc("aria-label",g.Qc(10,10,"core.help")),g.lc(5),g.Vc("ngIf",!t.changingPassword),g.lc(1),g.Vc("ngIf",t.changingPassword),g.lc(4),g.qd(g.Qc(20,12,"core.wanttochangesite")),g.lc(3),g.rd(" ",g.Qc(23,14,t.logoutLabel)," "))},directives:[C.C,C.Ab,C.m,C.h,C.i,C.yb,O.t,v.a,C.l,C.D,N.a,b.a,C.v,C.P,C.I,C.O],pipes:[S.d],encapsulation:2}),CoreLoginChangePasswordPage})();const Ce=[{path:"",pathMatch:"full",redirectTo:"sites"},{path:"site",component:_e},{path:"credentials",loadChildren:()=>l.a.getCredentialsRouteModule()},{path:"sites",component:fe,canLoad:[d],canActivate:[d]},{path:"forgottenpassword",component:w},{path:"changepassword",component:Pe},{path:"sitepolicy",component:k},{path:"emailsignup",component:K},{path:"reconnect",loadChildren:()=>l.a.getReconnectRouteModule()}];let be=(()=>{class CoreLoginLazyModule{}return CoreLoginLazyModule.ɵmod=g.wc({type:CoreLoginLazyModule}),CoreLoginLazyModule.ɵinj=g.vc({factory:function CoreLoginLazyModule_Factory(e){return new(e||CoreLoginLazyModule)},imports:[[i.a,_.a,V.a,o.m.forChild(Ce)]]}),CoreLoginLazyModule})();void(("undefined"==typeof ngJitMode||ngJitMode)&&g.kd(be,{declarations:[w,k,_e,fe,Pe,K],imports:[i.a,_.a,V.a,o.m]}))}}]);