(window.webpackJsonp=window.webpackJsonp||[]).push([[67],{"8/zp":function(e,o,s){"use strict";s.r(o),s.d(o,"AddonModWorkshopHelperProvider",(function(){return g})),s.d(o,"AddonModWorkshopHelper",(function(){return A}));var r=s("mrSG"),t=s("93ts"),d=s("hSQQ"),i=s("EmGO"),n=s("9+EE"),a=s("vuGA"),l=s("bFG1"),u=s("j3ag"),c=s("49BL"),m=s("i1f9"),p=s("EyWp"),h=s("DJrq"),f=s("fXoL");let g=(()=>{class AddonModWorkshopHelperProvider{getTask(e,o){return e.find((e=>e.code==o))}isTaskDone(e,o){const s=this.getTask(e,o);return!s||!!s.completed}canSubmit(e,o,s){const r=e.useexamples&&e.examplesmode==m.AddonModWorkshopExampleMode.EXAMPLES_BEFORE_SUBMISSION,t=o.canmanageexamples||e.examplesmode==m.AddonModWorkshopExampleMode.EXAMPLES_VOLUNTARY||this.isTaskDone(s,"examples");return e.phase>m.AddonModWorkshopPhase.PHASE_SETUP&&o.cansubmit&&(!r||t)}canAssess(e,o){return!(e.useexamples&&e.examplesmode==m.AddonModWorkshopExampleMode.EXAMPLES_BEFORE_ASSESSMENT)||o.canmanageexamples}getUserSubmission(e,o={}){return Object(r.a)(this,void 0,void 0,(function*(){const s=o.userId||n.b.getCurrentSiteUserId();return(yield m.AddonModWorkshop.getSubmissions(e,o)).find((e=>e.authorid==s))}))}getSubmissionById(e,o,s={}){return Object(r.a)(this,void 0,void 0,(function*(){try{return yield m.AddonModWorkshop.getSubmission(e,o,s)}catch(r){const d=(yield m.AddonModWorkshop.getSubmissions(e,s)).find((e=>e.id==o));if(!d)throw new t.a("Submission not found");return d}}))}getReviewerAssessmentById(e,o,s={}){return Object(r.a)(this,void 0,void 0,(function*(){let r;try{r=yield m.AddonModWorkshop.getAssessment(e,o,s)}catch(t){if(r=(yield m.AddonModWorkshop.getReviewerAssessments(e,s)).find((e=>e.id===o)),!r)throw t}return r.form=yield m.AddonModWorkshop.getAssessmentForm(e,o,s),r}))}getReviewerAssessments(e,o={}){return Object(r.a)(this,void 0,void 0,(function*(){o.siteId=o.siteId||n.b.getCurrentSiteId();const s=yield m.AddonModWorkshop.getReviewerAssessments(e,o),r=[];return s.forEach((s=>{r.push(this.getSubmissionById(e,s.submissionid,o).then((e=>{s.submission=e}))),r.push(m.AddonModWorkshop.getAssessmentForm(e,s.id,o).then((e=>{s.form=e})))})),yield Promise.all(r),s}))}deleteSubmissionStoredFiles(e,o){return Object(r.a)(this,void 0,void 0,(function*(){const s=yield p.AddonModWorkshopOffline.getSubmissionFolder(e,o);yield l.a.ignoreErrors(i.a.removeDir(s))}))}storeSubmissionFiles(e,o,s){return Object(r.a)(this,void 0,void 0,(function*(){const r=yield p.AddonModWorkshopOffline.getSubmissionFolder(e,s);return d.a.storeFilesToUpload(r,o)}))}uploadOrStoreSubmissionFiles(e,o,s,r){return s?this.storeSubmissionFiles(e,o,r):d.a.uploadOrReuploadFiles(o,h.a,e,r)}getStoredSubmissionFiles(e,o){return Object(r.a)(this,void 0,void 0,(function*(){const s=yield p.AddonModWorkshopOffline.getSubmissionFolder(e,o);return l.a.ignoreErrors(d.a.getStoredFiles(s),[])}))}getSubmissionFilesFromOfflineFilesObject(e,o,s){return Object(r.a)(this,void 0,void 0,(function*(){const r=yield p.AddonModWorkshopOffline.getSubmissionFolder(o,s);return d.a.getStoredFilesFromOfflineFilesObject(e,r)}))}deleteAssessmentStoredFiles(e,o,s){return Object(r.a)(this,void 0,void 0,(function*(){const r=yield p.AddonModWorkshopOffline.getAssessmentFolder(e,o,s);yield l.a.ignoreErrors(i.a.removeDir(r))}))}storeAssessmentFiles(e,o,s,t){return Object(r.a)(this,void 0,void 0,(function*(){const r=yield p.AddonModWorkshopOffline.getAssessmentFolder(e,o,t);return d.a.storeFilesToUpload(r,s)}))}uploadOrStoreAssessmentFiles(e,o,s,r,t){return r?this.storeAssessmentFiles(e,o,s,t):d.a.uploadOrReuploadFiles(s,h.a,e,t)}getStoredAssessmentFiles(e,o,s){return Object(r.a)(this,void 0,void 0,(function*(){const r=yield p.AddonModWorkshopOffline.getAssessmentFolder(e,o,s);return l.a.ignoreErrors(d.a.getStoredFiles(r),[])}))}getAssessmentFilesFromOfflineFilesObject(e,o,s,t){return Object(r.a)(this,void 0,void 0,(function*(){const r=yield p.AddonModWorkshopOffline.getAssessmentFolder(o,s,t);return d.a.getStoredFilesFromOfflineFilesObject(e,r)}))}applyOfflineData(e={id:0,workshopid:0,title:"",content:"",timemodified:0,example:!1,authorid:0,timecreated:0,contenttrust:0,attachment:0,published:!1,late:0},o=[]){return Object(r.a)(this,void 0,void 0,(function*(){if(0===o.length)return e;let s;const r=o[0].workshopid;return o.forEach((o=>{switch(o.action){case m.AddonModWorkshopAction.ADD:case m.AddonModWorkshopAction.UPDATE:e.title=o.title,e.content=o.content,e.title=o.title,e.courseid=o.courseid,e.submissionmodified=o.timemodified/1e3,e.offline=!0,s=o.attachmentsid;break;case m.AddonModWorkshopAction.DELETE:e.deleted=!0,e.submissionmodified=o.timemodified/1e3}})),e.attachmentfiles=s?yield this.getSubmissionFilesFromOfflineFilesObject(s,r):[],e}))}prepareAssessmentData(e,o,s,t,d=0){var i;return Object(r.a)(this,void 0,void 0,(function*(){if(e.overallfeedbackmode==m.AddonModWorkshopOverallFeedbackMode.ENABLED_REQUIRED&&!s){throw{feedbackauthor:u.I.instant("core.err_required")}}const r=(yield c.AddonWorkshopAssessmentStrategyDelegate.prepareAssessmentData(null!==(i=e.strategy)&&void 0!==i?i:"",o,t))||{};return r.feedbackauthor=s,r.feedbackauthorformat=a.a.FORMAT_HTML,r.feedbackauthorattachmentsid=d,r.nodims=t.dimenssionscount,r}))}realGradeValueHelper(e,o=0,s=0){return"string"==typeof e?e:null!=e?0===o?"0":(e=a.b.roundToDecimals(o*e/100,s),l.a.formatFloat(e)):void 0}realGradeValue(e,o){return o.grade=this.realGradeValueHelper(o.grade,e.grade,e.gradedecimals),o.gradinggrade=this.realGradeValueHelper(o.gradinggrade,e.gradinggrade,e.gradedecimals),o.gradinggradeover=this.realGradeValueHelper(o.gradinggradeover,e.gradinggrade,e.gradedecimals),o}showGrade(e){return null!=e}}return AddonModWorkshopHelperProvider.ɵfac=function AddonModWorkshopHelperProvider_Factory(e){return new(e||AddonModWorkshopHelperProvider)},AddonModWorkshopHelperProvider.ɵprov=f.uc({token:AddonModWorkshopHelperProvider,factory:AddonModWorkshopHelperProvider.ɵfac,providedIn:"root"}),AddonModWorkshopHelperProvider})();const A=Object(u.M)(g)}}]);