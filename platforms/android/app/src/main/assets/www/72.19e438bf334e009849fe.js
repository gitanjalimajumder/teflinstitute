(window.webpackJsonp=window.webpackJsonp||[]).push([[72],{gq5R:function(e,i,t){"use strict";t.r(i),t.d(i,"AddonPrivateFilesLazyModule",(function(){return M}));var o=t("L3Fv"),n=t("mrSG"),a=t("kScs"),l=t("GGba"),r=t("9+EE"),s=t("3LXp"),c=t("vuGA"),d=t("j3ag"),_=t("fjkH"),f=t("tP62"),u=t("S7NA"),p=t("bFG1"),h=t("pHTc"),g=t("8vmT"),m=t("D7J2"),v=t("fXoL"),P=t("TEn/"),b=t("nt/U"),F=t("ofXK"),I=t("PgjG"),x=t("rf3J"),y=t("3CSS"),A=t("5450"),w=t("r8G5"),E=t("yNDK"),T=t("sYmb");function AddonPrivateFilesIndexPage_core_loading_12_core_combobox_1_Template(e,i){if(1&e){const e=v.Fc();v.Ec(0,"core-combobox",12),v.Mc("onChange",(function AddonPrivateFilesIndexPage_core_loading_12_core_combobox_1_Template_core_combobox_onChange_0_listener(i){v.fd(e);return v.Oc(2).rootChanged(i)})),v.Ec(1,"ion-select-option",13),v.pd(2),v.Pc(3,"translate"),v.Dc(),v.Ec(4,"ion-select-option",14),v.pd(5),v.Pc(6,"translate"),v.Dc(),v.Dc()}if(2&e){const e=v.Oc(2);v.Vc("selection",e.root),v.lc(2),v.rd(" ",v.Qc(3,3,"addon.privatefiles.privatefiles")," "),v.lc(3),v.rd(" ",v.Qc(6,5,"addon.privatefiles.sitefiles")," ")}}const _c0=function(e,i){return{used:e,total:i}},_c1=function(e){return{$a:e}};function AddonPrivateFilesIndexPage_core_loading_12_ion_card_2_Template(e,i){if(1&e&&(v.Ec(0,"ion-card",15),v.Ec(1,"ion-item"),v.Ec(2,"ion-label"),v.pd(3),v.Pc(4,"translate"),v.Dc(),v.Dc(),v.Dc()),2&e){const e=v.Oc(2);v.lc(3),v.rd(" ",v.Rc(4,1,"core.quotausage",v.ad(7,_c1,v.bd(4,_c0,e.spaceUsed,e.userQuotaReadable)))," ")}}function AddonPrivateFilesIndexPage_core_loading_12_ion_list_3_ng_container_1_ion_item_1_Template(e,i){if(1&e){const e=v.Fc();v.Ec(0,"ion-item",19),v.Mc("click",(function AddonPrivateFilesIndexPage_core_loading_12_ion_list_3_ng_container_1_ion_item_1_Template_ion_item_click_0_listener(){v.fd(e);const i=v.Oc().$implicit;return v.Oc(3).openFolder(i)})),v.zc(1,"ion-icon",20),v.Pc(2,"translate"),v.Ec(3,"ion-label"),v.pd(4),v.Dc(),v.Dc()}if(2&e){const e=v.Oc().$implicit;v.lc(1),v.mc("aria-label",v.Qc(2,2,"core.folder")),v.lc(3),v.qd(e.filename)}}function AddonPrivateFilesIndexPage_core_loading_12_ion_list_3_ng_container_1_core_file_2_Template(e,i){if(1&e&&v.zc(0,"core-file",21),2&e){const e=v.Oc().$implicit,i=v.Oc(3);v.Vc("file",e)("component",i.component)("componentId",e.contextid)}}function AddonPrivateFilesIndexPage_core_loading_12_ion_list_3_ng_container_1_Template(e,i){if(1&e&&(v.Cc(0),v.nd(1,AddonPrivateFilesIndexPage_core_loading_12_ion_list_3_ng_container_1_ion_item_1_Template,5,4,"ion-item",17),v.nd(2,AddonPrivateFilesIndexPage_core_loading_12_ion_list_3_ng_container_1_core_file_2_Template,1,3,"core-file",18),v.Bc()),2&e){const e=i.$implicit;v.lc(1),v.Vc("ngIf",e.isdir),v.lc(1),v.Vc("ngIf",!e.isdir)}}function AddonPrivateFilesIndexPage_core_loading_12_ion_list_3_Template(e,i){if(1&e&&(v.Ec(0,"ion-list"),v.nd(1,AddonPrivateFilesIndexPage_core_loading_12_ion_list_3_ng_container_1_Template,3,2,"ng-container",16),v.Dc()),2&e){const e=v.Oc(2);v.lc(1),v.Vc("ngForOf",e.files)}}function AddonPrivateFilesIndexPage_core_loading_12_core_empty_box_4_Template(e,i){1&e&&(v.zc(0,"core-empty-box",22),v.Pc(1,"translate")),2&e&&v.Vc("message",v.Qc(1,1,"addon.privatefiles.emptyfilelist"))}function AddonPrivateFilesIndexPage_core_loading_12_Template(e,i){if(1&e&&(v.Ec(0,"core-loading",7),v.nd(1,AddonPrivateFilesIndexPage_core_loading_12_core_combobox_1_Template,7,7,"core-combobox",8),v.nd(2,AddonPrivateFilesIndexPage_core_loading_12_ion_card_2_Template,5,9,"ion-card",9),v.nd(3,AddonPrivateFilesIndexPage_core_loading_12_ion_list_3_Template,2,1,"ion-list",10),v.nd(4,AddonPrivateFilesIndexPage_core_loading_12_core_empty_box_4_Template,2,3,"core-empty-box",11),v.Dc()),2&e){const e=v.Oc();v.Vc("hideUntil",e.filesLoaded),v.lc(1),v.Vc("ngIf",e.showPrivateFiles&&e.showSiteFiles&&!e.path),v.lc(1),v.Vc("ngIf",e.userQuota&&e.filesInfo&&e.filesInfo.filecount>0),v.lc(1),v.Vc("ngIf",e.files&&e.files.length>0),v.lc(1),v.Vc("ngIf",!e.files||!e.files.length)}}function AddonPrivateFilesIndexPage_ion_fab_13_Template(e,i){if(1&e){const e=v.Fc();v.Ec(0,"ion-fab",23),v.Ec(1,"ion-fab-button",24),v.Mc("click",(function AddonPrivateFilesIndexPage_ion_fab_13_Template_ion_fab_button_click_1_listener(){v.fd(e);return v.Oc().uploadFile()})),v.Pc(2,"translate"),v.zc(3,"ion-icon",25),v.Ec(4,"span",26),v.pd(5),v.Pc(6,"translate"),v.Dc(),v.Dc(),v.Dc()}2&e&&(v.lc(1),v.mc("aria-label",v.Qc(2,2,"core.fileuploader.uploadafile")),v.lc(4),v.qd(v.Qc(6,4,"core.fileuploader.uploadafile")))}let D=(()=>{class AddonPrivateFilesIndexPage{constructor(){this.filesLoaded=!1,this.updateSiteObserver=_.b.on(_.b.SITE_UPDATED,(()=>{this.setVisibility()}),r.b.getCurrentSiteId()),this.logView=g.a.once((()=>Object(n.a)(this,void 0,void 0,(function*(){m.a.logEvent({type:m.b.VIEW_ITEM_LIST,ws:"core_files_get_files",name:d.I.instant("addon.privatefiles.files"),data:{category:"files"},url:"/user/files.php"})}))))}ngOnInit(){var e,i,t;try{this.root=h.a.getRouteParam("root");const e=h.a.getRouteNumberParam("contextid");e&&(this.path={contextid:e,component:h.a.getRequiredRouteParam("component"),filearea:h.a.getRequiredRouteParam("filearea"),itemid:h.a.getRequiredRouteNumberParam("itemid"),filepath:h.a.getRequiredRouteParam("filepath"),filename:h.a.getRequiredRouteParam("filename")})}catch(e){return s.a.showErrorModal(e),h.a.back(),void 0}this.title=(null===(e=this.path)||void 0===e?void 0:e.filename)||d.I.instant("addon.privatefiles.files"),this.setVisibility(),this.userQuota=null===(t=null===(i=r.b.getCurrentSite())||void 0===i?void 0:i.getInfo())||void 0===t?void 0:t.userquota,this.root||(this.showPrivateFiles?this.root="my":this.showSiteFiles&&(this.root="site")),this.root?this.rootChanged(this.root):this.filesLoaded=!0}setVisibility(){this.showPrivateFiles=f.a.canViewPrivateFiles(),this.showSiteFiles=f.a.canViewSiteFiles(),this.showUpload=f.a.canUploadFiles()}refreshData(e){this.refreshFiles().finally((()=>{null==e?void 0:e.complete()}))}rootChanged(e){this.root=e,this.filesLoaded=!1,this.component="my"==this.root?f.b.PRIVATE_FILES_COMPONENT:f.b.SITE_FILES_COMPONENT,this.fetchFiles().finally((()=>{this.filesLoaded=!0}))}uploadFile(){return Object(n.a)(this,void 0,void 0,(function*(){if(!l.a.isOnline())return s.a.showErrorModal("core.fileuploader.errormustbeonlinetoupload",!0),void 0;try{yield u.a.uploadPrivateFile(this.filesInfo),this.filesLoaded=!1,yield p.a.ignoreErrors(this.refreshFiles()),this.filesLoaded=!0}catch(e){s.a.showErrorModalDefault(e,"core.fileuploader.errorwhileuploading",!0)}}))}fetchFiles(){return Object(n.a)(this,void 0,void 0,(function*(){try{if(this.path)return this.files=yield f.a.getFiles(this.path),void 0;"site"==this.root?(this.title=d.I.instant("addon.privatefiles.sitefiles"),this.files=yield f.a.getSiteFiles()):"my"==this.root?(this.title=d.I.instant("addon.privatefiles.files"),this.files=yield f.a.getPrivateFiles(),this.showUpload&&this.userQuota&&this.userQuota>0?(this.filesInfo=yield f.a.getPrivateFilesInfo(),this.spaceUsed=c.b.bytesToSize(this.filesInfo.filesizewithoutreferences,1),this.userQuotaReadable=c.b.bytesToSize(this.userQuota,1)):delete this.userQuota,this.logView()):s.a.showErrorModal("addon.privatefiles.couldnotloadfiles",!0)}catch(e){s.a.showErrorModalDefault(e,"addon.privatefiles.couldnotloadfiles",!0)}}))}refreshFiles(){return Object(n.a)(this,void 0,void 0,(function*(){try{yield Promise.all([f.a.invalidateDirectory(this.root,this.path),f.a.invalidatePrivateFilesInfoForUser()])}finally{yield this.fetchFiles()}}))}openFolder(e){const i={contextid:e.contextid,component:e.component||"",filearea:e.filearea||"",itemid:e.itemid||0,filepath:e.filepath||"",filename:e.filename||""};e.component&&(i.filename="");const t=a.Md5.hashAsciiStr(JSON.stringify(i));h.a.navigate(`../${t}`,{params:i})}ngOnDestroy(){var e;null===(e=this.updateSiteObserver)||void 0===e?void 0:e.off()}}return AddonPrivateFilesIndexPage.ɵfac=function AddonPrivateFilesIndexPage_Factory(e){return new(e||AddonPrivateFilesIndexPage)},AddonPrivateFilesIndexPage.ɵcmp=v.sc({type:AddonPrivateFilesIndexPage,selectors:[["page-addon-privatefiles-index"]],decls:14,vars:10,consts:[["slot","start"],[3,"text"],[1,"limited-width"],["slot","fixed",3,"disabled","ionRefresh"],[3,"pullingText"],[3,"hideUntil",4,"ngIf"],["slot","fixed","core-fab","","vertical","bottom","horizontal","end",4,"ngIf"],[3,"hideUntil"],[3,"selection","onChange",4,"ngIf"],["class","core-info-card",4,"ngIf"],[4,"ngIf"],["icon","far-folder-open",3,"message",4,"ngIf"],[3,"selection","onChange"],["value","my",1,"ion-text-wrap"],["value","site",1,"ion-text-wrap"],[1,"core-info-card"],[4,"ngFor","ngForOf"],["button","","class","ion-text-wrap item-file item-directory","detail","true",3,"click",4,"ngIf"],[3,"file","component","componentId",4,"ngIf"],["button","","detail","true",1,"ion-text-wrap","item-file","item-directory",3,"click"],["name","fas-folder","slot","start"],[3,"file","component","componentId"],["icon","far-folder-open",3,"message"],["slot","fixed","core-fab","","vertical","bottom","horizontal","end"],[3,"click"],["name","fas-plus","aria-hidden","true"],[1,"sr-only"]],template:function AddonPrivateFilesIndexPage_Template(e,i){1&e&&(v.Ec(0,"ion-header"),v.Ec(1,"ion-toolbar"),v.Ec(2,"ion-buttons",0),v.zc(3,"ion-back-button",1),v.Pc(4,"translate"),v.Dc(),v.Ec(5,"ion-title"),v.Ec(6,"h1"),v.pd(7),v.Dc(),v.Dc(),v.Dc(),v.Dc(),v.Ec(8,"ion-content",2),v.Ec(9,"ion-refresher",3),v.Mc("ionRefresh",(function AddonPrivateFilesIndexPage_Template_ion_refresher_ionRefresh_9_listener(e){return i.refreshData(e.target)})),v.zc(10,"ion-refresher-content",4),v.Pc(11,"translate"),v.Dc(),v.nd(12,AddonPrivateFilesIndexPage_core_loading_12_Template,5,5,"core-loading",5),v.nd(13,AddonPrivateFilesIndexPage_ion_fab_13_Template,7,6,"ion-fab",6),v.Dc()),2&e&&(v.lc(3),v.Vc("text",v.Qc(4,6,"core.back")),v.lc(4),v.qd(i.title),v.lc(2),v.Vc("disabled",!i.filesLoaded||!i.showPrivateFiles&&!i.showSiteFiles),v.lc(1),v.Wc("pullingText",v.Qc(11,8,"core.pulltorefresh")),v.lc(2),v.Vc("ngIf",i.showPrivateFiles||i.showSiteFiles),v.lc(1),v.Vc("ngIf",i.showUpload&&"site"!=i.root&&!i.path))},directives:[P.C,P.Ab,P.m,P.h,P.i,P.yb,b.a,P.v,P.bb,P.cb,F.t,I.a,x.a,P.mb,P.n,P.I,P.O,P.P,F.s,P.D,y.a,A.a,w.a,P.x,E.a,P.y],pipes:[T.d],encapsulation:2}),AddonPrivateFilesIndexPage})();var O=t("tyNb"),S=t("wG2S");function buildRoutes(e){return[{path:"root",component:D},{path:":hash",component:D},...Object(S.b)(e,{redirectTo:"root",pathMatch:"full"})]}let M=(()=>{class AddonPrivateFilesLazyModule{}return AddonPrivateFilesLazyModule.ɵmod=v.wc({type:AddonPrivateFilesLazyModule}),AddonPrivateFilesLazyModule.ɵinj=v.vc({factory:function AddonPrivateFilesLazyModule_Factory(e){return new(e||AddonPrivateFilesLazyModule)},providers:[{provide:O.g,multi:!0,deps:[v.x],useFactory:buildRoutes}],imports:[[o.a],O.m]}),AddonPrivateFilesLazyModule})();void(("undefined"==typeof ngJitMode||ngJitMode)&&v.kd(M,{declarations:[D],imports:[o.a],exports:[O.m]}))}}]);