(window.webpackJsonp=window.webpackJsonp||[]).push([[60],{T35R:function(t,e,i){"use strict";i.r(e),i.d(e,"AddonModQuizLazyModule",(function(){return ot}));var o=i("tyNb"),n=i("L3Fv"),a=i("PxMs"),d=i("ghUQ"),c=i("vM2p"),r=i("fXoL"),s=i("TEn/"),l=i("4JiN"),u=i("hMzs"),m=i("nt/U"),_=i("sYmb");let h=(()=>{class AddonModQuizIndexPage extends d.a{}return AddonModQuizIndexPage.ɵfac=function AddonModQuizIndexPage_Factory(t){return p(t||AddonModQuizIndexPage)},AddonModQuizIndexPage.ɵcmp=r.sc({type:AddonModQuizIndexPage,selectors:[["page-addon-mod-quiz-index"]],viewQuery:function AddonModQuizIndexPage_Query(t,e){var i;(1&t&&r.ud(c.a,!0),2&t)&&(r.dd(i=r.Nc())&&(e.activityComponent=i.first))},features:[r.ic],decls:14,vars:12,consts:[["collapsible",""],["slot","start"],[3,"text"],["contextLevel","module",3,"text","contextInstanceId","courseId"],["slot","end"],[1,"limited-width"],["slot","fixed",3,"disabled","ionRefresh"],[3,"pullingText"],[3,"module","courseId","dataRetrieved"]],template:function AddonModQuizIndexPage_Template(t,e){1&t&&(r.Ec(0,"ion-header",0),r.Ec(1,"ion-toolbar"),r.Ec(2,"ion-buttons",1),r.zc(3,"ion-back-button",2),r.Pc(4,"translate"),r.Dc(),r.Ec(5,"ion-title"),r.Ec(6,"h1"),r.zc(7,"core-format-text",3),r.Dc(),r.Dc(),r.zc(8,"ion-buttons",4),r.Dc(),r.Dc(),r.Ec(9,"ion-content",5),r.Ec(10,"ion-refresher",6),r.Mc("ionRefresh",(function AddonModQuizIndexPage_Template_ion_refresher_ionRefresh_10_listener(t){return null==e.activityComponent?null:e.activityComponent.doRefresh(t.target)})),r.zc(11,"ion-refresher-content",7),r.Pc(12,"translate"),r.Dc(),r.Ec(13,"addon-mod-quiz-index",8),r.Mc("dataRetrieved",(function AddonModQuizIndexPage_Template_addon_mod_quiz_index_dataRetrieved_13_listener(t){return e.updateData(t)})),r.Dc(),r.Dc()),2&t&&(r.lc(3),r.Vc("text",r.Qc(4,8,"core.back")),r.lc(4),r.Vc("text",e.title)("contextInstanceId",null==e.module?null:e.module.id)("courseId",e.courseId),r.lc(3),r.Vc("disabled",null==e.activityComponent?null:e.activityComponent.showLoading),r.lc(1),r.Wc("pullingText",r.Qc(12,10,"core.pulltorefresh")),r.lc(2),r.Vc("module",e.module)("courseId",e.courseId))},directives:[s.C,l.b,s.Ab,s.m,s.h,s.i,s.yb,u.a,m.a,s.v,s.bb,s.cb,c.a],pipes:[_.d],encapsulation:2}),AddonModQuizIndexPage})();const p=r.Gc(h);var g=i("mrSG"),f=i("+VLr"),v=i("93ts"),z=i("pHTc"),P=i("3LXp"),b=i("bFG1"),A=i("j3ag"),q=i("Ohwm"),w=i("+8pu"),M=i("ofXK"),y=i("PgjG"),I=i("3jOR"),Q=i("ACYt"),E=i("3CSS");function AddonModQuizAttemptPage_core_format_text_7_Template(t,e){if(1&t&&r.zc(0,"core-format-text",9),2&t){const t=r.Oc();r.Vc("text",t.quiz.name)("contextInstanceId",t.quiz.coursemodule)("courseId",t.courseId)}}function AddonModQuizAttemptPage_ion_list_13_p_6_Template(t,e){1&t&&(r.Ec(0,"p"),r.pd(1),r.Pc(2,"translate"),r.Dc()),2&t&&(r.lc(1),r.qd(r.Qc(2,1,"addon.mod_quiz.preview")))}function AddonModQuizAttemptPage_ion_list_13_p_7_Template(t,e){if(1&t&&(r.Ec(0,"p"),r.pd(1),r.Dc()),2&t){const t=r.Oc(2);r.lc(1),r.qd(t.attempt.attempt)}}function AddonModQuizAttemptPage_ion_list_13_p_13_Template(t,e){if(1&t&&(r.Ec(0,"p"),r.pd(1),r.Dc()),2&t){const t=e.$implicit;r.lc(1),r.qd(t)}}function AddonModQuizAttemptPage_ion_list_13_ion_item_14_Template(t,e){if(1&t&&(r.Ec(0,"ion-item",10),r.Ec(1,"ion-label"),r.Ec(2,"p",11),r.pd(3),r.Pc(4,"translate"),r.Dc(),r.Ec(5,"p"),r.pd(6),r.Dc(),r.Dc(),r.Dc()),2&t){const t=r.Oc(2);r.lc(3),r.sd("",r.Qc(4,3,"addon.mod_quiz.marks")," / ",t.quiz.sumGradesFormatted,""),r.lc(3),r.qd(t.attempt.readableMark)}}function AddonModQuizAttemptPage_ion_list_13_ion_item_15_Template(t,e){if(1&t&&(r.Ec(0,"ion-item",10),r.Ec(1,"ion-label"),r.Ec(2,"p",11),r.pd(3),r.Pc(4,"translate"),r.Dc(),r.Ec(5,"p"),r.pd(6),r.Dc(),r.Dc(),r.Dc()),2&t){const t=r.Oc(2);r.lc(3),r.sd("",r.Qc(4,3,"addon.mod_quiz.grade")," / ",t.quiz.gradeFormatted,""),r.lc(3),r.qd(t.attempt.readableGrade)}}function AddonModQuizAttemptPage_ion_list_13_ion_item_16_Template(t,e){if(1&t&&(r.Ec(0,"ion-item",10),r.Ec(1,"ion-label"),r.Ec(2,"p",11),r.pd(3),r.Pc(4,"translate"),r.Dc(),r.Ec(5,"p"),r.zc(6,"core-format-text",15),r.Dc(),r.Dc(),r.Dc()),2&t){const t=r.Oc(2);r.lc(3),r.qd(r.Qc(4,6,"addon.mod_quiz.feedback")),r.lc(3),r.Vc("component",t.component)("componentId",t.componentId)("text",t.feedback)("contextInstanceId",t.cmId)("courseId",t.courseId)}}function AddonModQuizAttemptPage_ion_list_13_ion_item_17_Template(t,e){1&t&&(r.Ec(0,"ion-item",16),r.Ec(1,"ion-label"),r.Ec(2,"p"),r.pd(3),r.Pc(4,"translate"),r.Dc(),r.Dc(),r.Dc()),2&t&&(r.lc(3),r.qd(r.Qc(4,1,"addon.mod_quiz.noreviewattempt")))}function AddonModQuizAttemptPage_ion_list_13_Template(t,e){if(1&t&&(r.Ec(0,"ion-list"),r.Ec(1,"ion-item",10),r.Ec(2,"ion-label"),r.Ec(3,"p",11),r.pd(4),r.Pc(5,"translate"),r.Dc(),r.nd(6,AddonModQuizAttemptPage_ion_list_13_p_6_Template,3,3,"p",7),r.nd(7,AddonModQuizAttemptPage_ion_list_13_p_7_Template,2,1,"p",7),r.Dc(),r.Dc(),r.Ec(8,"ion-item",10),r.Ec(9,"ion-label"),r.Ec(10,"p",11),r.pd(11),r.Pc(12,"translate"),r.Dc(),r.nd(13,AddonModQuizAttemptPage_ion_list_13_p_13_Template,2,1,"p",12),r.Dc(),r.Dc(),r.nd(14,AddonModQuizAttemptPage_ion_list_13_ion_item_14_Template,7,5,"ion-item",13),r.nd(15,AddonModQuizAttemptPage_ion_list_13_ion_item_15_Template,7,5,"ion-item",13),r.nd(16,AddonModQuizAttemptPage_ion_list_13_ion_item_16_Template,7,8,"ion-item",13),r.nd(17,AddonModQuizAttemptPage_ion_list_13_ion_item_17_Template,5,3,"ion-item",14),r.Dc()),2&t){const t=r.Oc();r.lc(4),r.qd(r.Qc(5,9,"addon.mod_quiz.attemptnumber")),r.lc(2),r.Vc("ngIf",t.attempt.preview),r.lc(1),r.Vc("ngIf",!t.attempt.preview),r.lc(4),r.qd(r.Qc(12,11,"addon.mod_quiz.attemptstate")),r.lc(2),r.Vc("ngForOf",t.attempt.readableState),r.lc(1),r.Vc("ngIf",t.quiz.showMarkColumn&&""!==t.attempt.readableMark),r.lc(1),r.Vc("ngIf",t.quiz.showGradeColumn&&""!==t.attempt.readableGrade),r.lc(1),r.Vc("ngIf",t.quiz.showFeedbackColumn&&t.feedback),r.lc(1),r.Vc("ngIf",!t.showReviewColumn)}}function AddonModQuizAttemptPage_div_14_Template(t,e){if(1&t){const t=r.Fc();r.Ec(0,"div",17),r.Ec(1,"div",18),r.Ec(2,"ion-button",19),r.Mc("click",(function AddonModQuizAttemptPage_div_14_Template_ion_button_click_2_listener(){r.fd(t);return r.Oc().reviewAttempt()})),r.zc(3,"ion-icon",20),r.pd(4),r.Pc(5,"translate"),r.Dc(),r.Dc(),r.Dc()}2&t&&(r.lc(4),r.rd(" ",r.Qc(5,1,"addon.mod_quiz.review")," "))}let T=(()=>{class AddonModQuizAttemptPage{constructor(){this.component=q.b.COMPONENT,this.loaded=!1,this.showReviewColumn=!1}ngOnInit(){try{this.cmId=z.a.getRequiredRouteNumberParam("cmId"),this.courseId=z.a.getRequiredRouteNumberParam("courseId"),this.attemptId=z.a.getRequiredRouteNumberParam("attemptId")}catch(t){return P.a.showErrorModal(t),z.a.back(),void 0}this.fetchQuizData().finally((()=>{this.loaded=!0}))}doRefresh(t){this.refreshData().finally((()=>{t.complete()}))}fetchQuizData(){return Object(g.a)(this,void 0,void 0,(function*(){try{this.quiz=yield q.a.getQuiz(this.courseId,this.cmId),this.componentId=this.quiz.coursemodule;const[t,e,i]=yield Promise.all([q.a.getCombinedReviewOptions(this.quiz.id,{cmId:this.quiz.coursemodule}),this.fetchAccessInfo(this.quiz),this.fetchAttempt(this.quiz.id)]);this.showReviewColumn=e.canreviewmyattempts,w.a.setQuizCalculatedData(this.quiz,t),this.attempt=yield w.a.setAttemptCalculatedData(this.quiz,i,!1,void 0,!0);const o=Number(this.attempt.rescaledGrade);if(this.quiz.showFeedbackColumn&&q.a.isAttemptFinished(this.attempt.state)&&t.someoptions.overallfeedback&&Object(f.a)(o)){const t=yield q.a.getFeedbackForGrade(this.quiz.id,o,{cmId:this.quiz.coursemodule});this.feedback=t.feedbacktext}else delete this.feedback}catch(t){P.a.showErrorModalDefault(t,"addon.mod_quiz.errorgetattempt",!0)}}))}fetchAttempt(t){return Object(g.a)(this,void 0,void 0,(function*(){const e=(yield q.a.getUserAttempts(t,{cmId:this.cmId})).find((t=>t.id==this.attemptId));if(!e)throw this.attempt=void 0,new v.a(A.I.instant("addon.mod_quiz.errorgetattempt"));return e}))}fetchAccessInfo(t){return Object(g.a)(this,void 0,void 0,(function*(){const e=yield q.a.getQuizAccessInformation(t.id,{cmId:this.cmId});if(!e.canreviewmyattempts)return e;yield b.a.ignoreErrors(q.a.invalidateAttemptReviewForPage(this.attemptId,-1));try{yield q.a.getAttemptReview(this.attemptId,{page:-1,cmId:t.coursemodule})}catch(t){e.canreviewmyattempts=!1}return e}))}refreshData(){return Object(g.a)(this,void 0,void 0,(function*(){const t=[];t.push(q.a.invalidateQuizData(this.courseId)),t.push(q.a.invalidateAttemptReview(this.attemptId)),this.quiz&&(t.push(q.a.invalidateUserAttemptsForUser(this.quiz.id)),t.push(q.a.invalidateQuizAccessInformation(this.quiz.id)),t.push(q.a.invalidateCombinedReviewOptionsForUser(this.quiz.id)),this.attempt&&void 0!==this.feedback&&t.push(q.a.invalidateFeedback(this.quiz.id))),yield b.a.ignoreErrors(Promise.all(t)),yield this.fetchQuizData()}))}reviewAttempt(){return Object(g.a)(this,void 0,void 0,(function*(){this.attempt&&z.a.navigate(`../../review/${this.attempt.id}`)}))}}return AddonModQuizAttemptPage.ɵfac=function AddonModQuizAttemptPage_Factory(t){return new(t||AddonModQuizAttemptPage)},AddonModQuizAttemptPage.ɵcmp=r.sc({type:AddonModQuizAttemptPage,selectors:[["page-addon-mod-quiz-attempt"]],decls:15,vars:11,consts:[["slot","start"],[3,"text"],["contextLevel","module",3,"text","contextInstanceId","courseId",4,"ngIf"],[1,"limited-width"],["slot","fixed",3,"disabled","ionRefresh"],[3,"pullingText"],[3,"hideUntil"],[4,"ngIf"],["collapsible-footer","","appearOnBottom","","slot","fixed",4,"ngIf"],["contextLevel","module",3,"text","contextInstanceId","courseId"],[1,"ion-text-wrap"],[1,"item-heading"],[4,"ngFor","ngForOf"],["class","ion-text-wrap",4,"ngIf"],["class","ion-text-wrap core-danger-item",4,"ngIf"],["contextLevel","module",3,"component","componentId","text","contextInstanceId","courseId"],[1,"ion-text-wrap","core-danger-item"],["collapsible-footer","","appearOnBottom","","slot","fixed"],[1,"list-item-limited-width"],["expand","block",1,"ion-margin","ion-text-wrap",3,"click"],["name","fas-magnifying-glass","slot","start","aria-hidden","true"]],template:function AddonModQuizAttemptPage_Template(t,e){1&t&&(r.Ec(0,"ion-header"),r.Ec(1,"ion-toolbar"),r.Ec(2,"ion-buttons",0),r.zc(3,"ion-back-button",1),r.Pc(4,"translate"),r.Dc(),r.Ec(5,"ion-title"),r.Ec(6,"h1"),r.nd(7,AddonModQuizAttemptPage_core_format_text_7_Template,1,3,"core-format-text",2),r.Dc(),r.Dc(),r.Dc(),r.Dc(),r.Ec(8,"ion-content",3),r.Ec(9,"ion-refresher",4),r.Mc("ionRefresh",(function AddonModQuizAttemptPage_Template_ion_refresher_ionRefresh_9_listener(t){return e.doRefresh(t.target)})),r.zc(10,"ion-refresher-content",5),r.Pc(11,"translate"),r.Dc(),r.Ec(12,"core-loading",6),r.nd(13,AddonModQuizAttemptPage_ion_list_13_Template,18,13,"ion-list",7),r.nd(14,AddonModQuizAttemptPage_div_14_Template,6,3,"div",8),r.Dc(),r.Dc()),2&t&&(r.lc(3),r.Vc("text",r.Qc(4,7,"core.back")),r.lc(4),r.Vc("ngIf",e.quiz),r.lc(2),r.Vc("disabled",!e.loaded),r.lc(1),r.Wc("pullingText",r.Qc(11,9,"core.pulltorefresh")),r.lc(2),r.Vc("hideUntil",e.loaded),r.lc(1),r.Vc("ngIf",e.attempt),r.lc(1),r.Vc("ngIf",e.loaded&&e.attempt&&e.showReviewColumn&&e.attempt.finished))},directives:[s.C,s.Ab,s.m,s.h,s.i,s.yb,M.t,m.a,s.v,s.bb,s.cb,y.a,u.a,s.P,s.I,s.O,M.s,I.a,Q.a,s.l,s.D,E.a],pipes:[_.d],encapsulation:2}),AddonModQuizAttemptPage})();var D=i("uNPo"),O=i("Zl5n"),x=i("qRov"),k=i("9+EE"),S=i("uT8i"),R=i("fjkH"),C=i("2Vo4"),V=i("3j9v"),F=i("+/ys");class auto_save_AddonModQuizAutoSave{constructor(t,e){this.formName=t,this.buttonSelector=e,this.CHECK_CHANGES_INTERVAL=5e3,this.popoverShown=!1,this.logger=V.a.getInstance("AddonModQuizAutoSave"),this.errorObservable=new C.a(!1)}cancelAutoSave(){clearTimeout(this.autoSaveTimeout),this.autoSaveTimeout=void 0}checkChanges(t,e,i,o){if(this.autoSaveTimeout)return;const n=this.getAnswers();if(!this.previousAnswers)return this.previousAnswers=n,void 0;let a=!0;for(const t in n)if(this.previousAnswers[t]!=n[t]){a=!1;break}a||this.setAutoSaveTimer(t,e,i,o),this.previousAnswers=n}getAnswers(){return x.a.getAnswersFromForm(document.forms[this.formName])}hideAutoSaveError(){var t;this.errorObservable.next(!1),null===(t=this.popover)||void 0===t||t.dismiss()}onError(){return this.errorObservable}setAutoSaveTimer(t,e,i,o){!t.autosaveperiod||this.autoSaveTimeout||q.a.isAttemptTimeNearlyOver(t,e)||(this.autoSaveTimeout=window.setTimeout((()=>Object(g.a)(this,void 0,void 0,(function*(){const n=this.getAnswers();this.cancelAutoSave(),this.previousAnswers=n;try{yield q.a.saveAttempt(t,e,n,i,o),this.hideAutoSaveError()}catch(n){this.logger.warn("Error auto-saving data.",n),this.errorObservable.getValue()||(this.errorObservable.next(!0),this.showAutoSaveError()),this.setAutoSaveTimer(t,e,i,o)}}))),1e3*t.autosaveperiod))}showAutoSaveError(t){return Object(g.a)(this,void 0,void 0,(function*(){if(this.popoverShown)return;const e=t||{target:document.querySelector(this.buttonSelector),stopPropagation:()=>{},preventDefault:()=>{}};this.popoverShown=!0,this.popover=yield P.a.openPopover({component:F.a,event:e}),this.popoverShown=!1}))}startCheckChangesProcess(t,e,i,o){!this.checkChangesInterval&&t.autosaveperiod&&(this.previousAnswers=void 0,this.loadPreviousAnswersTimeout=window.setTimeout((()=>{this.checkChanges(t,e,i,o)}),2500),this.checkChangesInterval=window.setInterval((()=>{this.checkChanges(t,e,i,o)}),this.CHECK_CHANGES_INTERVAL))}stopCheckChangesProcess(){clearTimeout(this.loadPreviousAnswersTimeout),clearInterval(this.checkChangesInterval),this.loadPreviousAnswersTimeout=void 0,this.checkChangesInterval=void 0}}var N=i("6GiP"),L=i("hh6U"),j=i("4reR"),$=i("6s78"),U=i("8vmT"),G=i("rxAF"),H=i("EKRw"),B=i("D7J2"),W=i("rztj"),J=i("3Pt+"),X=i("iSJP");const K=["quizForm"];function AddonModQuizPlayerPage_core_format_text_7_Template(t,e){if(1&t&&r.zc(0,"core-format-text",16),2&t){const t=r.Oc();r.Vc("text",t.quiz.name)("contextInstanceId",t.quiz.coursemodule)("courseId",t.courseId)}}function AddonModQuizPlayerPage_ion_button_12_Template(t,e){if(1&t){const t=r.Fc();r.Ec(0,"ion-button",17),r.Mc("click",(function AddonModQuizPlayerPage_ion_button_12_Template_ion_button_click_0_listener(){r.fd(t);return r.Oc().openNavigation()})),r.Pc(1,"translate"),r.zc(2,"ion-icon",18),r.Dc()}2&t&&r.mc("aria-label",r.Qc(1,1,"addon.mod_quiz.opentoc"))}function AddonModQuizPlayerPage_core_timer_13_Template(t,e){if(1&t){const t=r.Fc();r.Ec(0,"core-timer",19),r.Mc("finished",(function AddonModQuizPlayerPage_core_timer_13_Template_core_timer_finished_0_listener(){r.fd(t);return r.Oc().timeUp()})),r.Pc(1,"translate"),r.Dc()}if(2&t){const t=r.Oc();r.Vc("endTime",t.endTime)("timerText",r.Qc(1,3,"addon.mod_quiz.timeleft"))("hiddable",!0)}}function AddonModQuizPlayerPage_ion_button_16_Template(t,e){if(1&t){const t=r.Fc();r.Ec(0,"ion-button",20),r.Mc("click",(function AddonModQuizPlayerPage_ion_button_16_Template_ion_button_click_0_listener(){r.fd(t);return r.Oc().start()})),r.pd(1),r.Pc(2,"translate"),r.Dc()}2&t&&(r.lc(1),r.rd(" ",r.Qc(2,1,"addon.mod_quiz.startattempt")," "))}const _c1=function(t){return{$a:t}};function AddonModQuizPlayerPage_form_17_div_2_h2_4_Template(t,e){if(1&t&&(r.Ec(0,"h2",29),r.pd(1),r.Pc(2,"translate"),r.Dc()),2&t){const t=r.Oc().$implicit;r.lc(1),r.rd(" ",r.Rc(2,1,"core.question.questionno",r.ad(4,_c1,t.questionnumber))," ")}}function AddonModQuizPlayerPage_form_17_div_2_h2_5_Template(t,e){1&t&&(r.Ec(0,"h2",29),r.pd(1),r.Pc(2,"translate"),r.Dc()),2&t&&(r.lc(1),r.rd(" ",r.Qc(2,1,"core.question.information")," "))}function AddonModQuizPlayerPage_form_17_div_2_div_6_p_1_Template(t,e){if(1&t&&(r.Ec(0,"p",33),r.pd(1),r.Dc()),2&t){const t=r.Oc(2).$implicit;r.lc(1),r.qd(t.status)}}function AddonModQuizPlayerPage_form_17_div_2_div_6_p_2_Template(t,e){if(1&t&&r.zc(0,"p",34),2&t){const t=r.Oc(2).$implicit;r.Vc("innerHTML",t.readableMark,r.gd)}}function AddonModQuizPlayerPage_form_17_div_2_div_6_Template(t,e){if(1&t&&(r.Ec(0,"div",30),r.nd(1,AddonModQuizPlayerPage_form_17_div_2_div_6_p_1_Template,2,1,"p",31),r.nd(2,AddonModQuizPlayerPage_form_17_div_2_div_6_p_2_Template,1,1,"p",32),r.Dc()),2&t){const t=r.Oc().$implicit;r.lc(1),r.Vc("ngIf",t.status),r.lc(1),r.Vc("ngIf",t.readableMark)}}function AddonModQuizPlayerPage_form_17_div_2_Template(t,e){if(1&t){const t=r.Fc();r.Ec(0,"div"),r.Ec(1,"ion-card",24),r.Ec(2,"ion-item-divider"),r.Ec(3,"ion-label",25),r.nd(4,AddonModQuizPlayerPage_form_17_div_2_h2_4_Template,3,6,"h2",26),r.nd(5,AddonModQuizPlayerPage_form_17_div_2_h2_5_Template,3,3,"h2",26),r.Dc(),r.nd(6,AddonModQuizPlayerPage_form_17_div_2_div_6_Template,3,2,"div",27),r.Dc(),r.Ec(7,"core-question",28),r.Mc("onAbort",(function AddonModQuizPlayerPage_form_17_div_2_Template_core_question_onAbort_7_listener(){r.fd(t);return r.Oc(2).abortQuiz()}))("buttonClicked",(function AddonModQuizPlayerPage_form_17_div_2_Template_core_question_buttonClicked_7_listener(e){r.fd(t);return r.Oc(2).behaviourButtonClicked(e)})),r.Dc(),r.Dc(),r.Dc()}if(2&t){const t=e.$implicit,i=r.Oc(2);r.lc(1),r.Xc("id","addon-mod_quiz-question-",t.slot,""),r.lc(3),r.Vc("ngIf","description"!==t.type&&t.questionnumber),r.lc(1),r.Vc("ngIf","description"===t.type||!t.questionnumber),r.lc(1),r.Vc("ngIf",t.status||t.readableMark),r.lc(1),r.Vc("question",t)("component",i.component)("componentId",i.cmId)("attemptId",i.attempt.id)("usageId",i.attempt.uniqueid)("offlineEnabled",i.offline)("contextInstanceId",i.cmId)("courseId",i.courseId)("preferredBehaviour",i.quiz.preferredbehaviour)("review",!1)}}function AddonModQuizPlayerPage_form_17_Template(t,e){if(1&t&&(r.Ec(0,"form",21,22),r.nd(2,AddonModQuizPlayerPage_form_17_div_2_Template,8,14,"div",23),r.Dc()),2&t){const t=r.Oc();r.lc(2),r.Vc("ngForOf",t.questions)}}function AddonModQuizPlayerPage_ion_row_18_ion_col_1_Template(t,e){if(1&t){const t=r.Fc();r.Ec(0,"ion-col"),r.Ec(1,"ion-button",36),r.Mc("click",(function AddonModQuizPlayerPage_ion_row_18_ion_col_1_Template_ion_button_click_1_listener(){r.fd(t);const e=r.Oc(2);return e.changePage(e.previousPage)})),r.zc(2,"ion-icon",37),r.pd(3),r.Pc(4,"translate"),r.Dc(),r.Dc()}2&t&&(r.lc(3),r.rd(" ",r.Qc(4,1,"core.previous")," "))}function AddonModQuizPlayerPage_ion_row_18_ion_col_2_ion_button_1_Template(t,e){if(1&t){const t=r.Fc();r.Ec(0,"ion-button",39),r.Mc("click",(function AddonModQuizPlayerPage_ion_row_18_ion_col_2_ion_button_1_Template_ion_button_click_0_listener(){r.fd(t);const e=r.Oc(3);return e.changePage(e.nextPage)})),r.pd(1),r.Pc(2,"translate"),r.zc(3,"ion-icon",40),r.Dc()}2&t&&(r.lc(1),r.rd(" ",r.Qc(2,1,"core.next")," "))}function AddonModQuizPlayerPage_ion_row_18_ion_col_2_ion_button_2_Template(t,e){if(1&t){const t=r.Fc();r.Ec(0,"ion-button",39),r.Mc("click",(function AddonModQuizPlayerPage_ion_row_18_ion_col_2_ion_button_2_Template_ion_button_click_0_listener(){r.fd(t);const e=r.Oc(3);return e.changePage(e.nextPage)})),r.pd(1),r.Pc(2,"translate"),r.Dc()}2&t&&(r.lc(1),r.rd(" ",r.Qc(2,1,"core.submit")," "))}function AddonModQuizPlayerPage_ion_row_18_ion_col_2_Template(t,e){if(1&t&&(r.Ec(0,"ion-col"),r.nd(1,AddonModQuizPlayerPage_ion_row_18_ion_col_2_ion_button_1_Template,4,3,"ion-button",38),r.nd(2,AddonModQuizPlayerPage_ion_row_18_ion_col_2_ion_button_2_Template,3,3,"ion-button",38),r.Dc()),2&t){const t=r.Oc(2);r.lc(1),r.Vc("ngIf",t.nextPage>0),r.lc(1),r.Vc("ngIf",-1==t.nextPage)}}function AddonModQuizPlayerPage_ion_row_18_Template(t,e){if(1&t&&(r.Ec(0,"ion-row",35),r.nd(1,AddonModQuizPlayerPage_ion_row_18_ion_col_1_Template,5,3,"ion-col",14),r.nd(2,AddonModQuizPlayerPage_ion_row_18_ion_col_2_Template,3,2,"ion-col",14),r.Dc()),2&t){const t=r.Oc();r.lc(1),r.Vc("ngIf",t.previousPage>=0),r.lc(1),r.Vc("ngIf",t.nextPage>=-1)}}function AddonModQuizPlayerPage_ion_card_19_ng_container_19_ion_item_1_Template(t,e){if(1&t){const t=r.Fc();r.Ec(0,"ion-item",49),r.Mc("click",(function AddonModQuizPlayerPage_ion_card_19_ng_container_19_ion_item_1_Template_ion_item_click_0_listener(){r.fd(t);const e=r.Oc().$implicit;return r.Oc(2).changePage(e.page,!1,e.slot)})),r.Pc(1,"translate"),r.Ec(2,"ion-label"),r.Ec(3,"ion-row",42),r.Ec(4,"ion-col",50),r.pd(5),r.Dc(),r.Ec(6,"ion-col",51),r.pd(7),r.Dc(),r.Dc(),r.Dc(),r.Dc()}if(2&t){const t=r.Oc().$implicit,e=r.Oc(2);r.Vc("detail",!e.isSequential&&e.canReturn)("button",!e.isSequential&&e.canReturn),r.mc("aria-label",r.Rc(1,5,"core.question.questionno",r.ad(8,_c1,t.questionnumber))),r.lc(5),r.qd(t.questionnumber),r.lc(2),r.qd(t.status)}}function AddonModQuizPlayerPage_ion_card_19_ng_container_19_Template(t,e){if(1&t&&(r.Cc(0),r.nd(1,AddonModQuizPlayerPage_ion_card_19_ng_container_19_ion_item_1_Template,8,10,"ion-item",48),r.Bc()),2&t){const t=e.$implicit;r.lc(1),r.Vc("ngIf","description"!==t.type&&t.questionnumber)}}function AddonModQuizPlayerPage_ion_card_19_ion_item_20_Template(t,e){if(1&t&&(r.Ec(0,"ion-item",25),r.Ec(1,"ion-label"),r.pd(2),r.Dc(),r.Dc()),2&t){const t=r.Oc(2);r.lc(2),r.qd(t.dueDateWarning)}}function AddonModQuizPlayerPage_ion_card_19_core_timer_21_Template(t,e){if(1&t){const t=r.Fc();r.Ec(0,"core-timer",52),r.Mc("finished",(function AddonModQuizPlayerPage_ion_card_19_core_timer_21_Template_core_timer_finished_0_listener(){r.fd(t);return r.Oc(2).timeUp()})),r.Pc(1,"translate"),r.Dc()}if(2&t){const t=r.Oc(2);r.Vc("endTime",t.endTime)("timerText",r.Qc(1,2,"addon.mod_quiz.timeleft"))}}function AddonModQuizPlayerPage_ion_card_19_ion_item_22_p_5_Template(t,e){if(1&t&&(r.Ec(0,"p"),r.pd(1),r.Dc()),2&t){const t=e.$implicit;r.lc(1),r.qd(t)}}function AddonModQuizPlayerPage_ion_card_19_ion_item_22_Template(t,e){if(1&t&&(r.Ec(0,"ion-item",25),r.Ec(1,"ion-label"),r.Ec(2,"p",53),r.pd(3),r.Pc(4,"translate"),r.Dc(),r.nd(5,AddonModQuizPlayerPage_ion_card_19_ion_item_22_p_5_Template,2,1,"p",23),r.Dc(),r.Dc()),2&t){const t=r.Oc(2);r.lc(3),r.qd(r.Qc(4,2,"addon.mod_quiz.cannotsubmitquizdueto")),r.lc(2),r.Vc("ngForOf",t.preventSubmitMessages)}}function AddonModQuizPlayerPage_ion_card_19_Template(t,e){if(1&t&&(r.Ec(0,"ion-card",41),r.Ec(1,"ion-card-header",25),r.Ec(2,"ion-card-title"),r.pd(3),r.Pc(4,"translate"),r.Dc(),r.Dc(),r.Ec(5,"ion-item",25),r.Ec(6,"ion-label"),r.Ec(7,"ion-row",42),r.Ec(8,"ion-col",43),r.Ec(9,"strong"),r.pd(10),r.Pc(11,"translate"),r.Dc(),r.Dc(),r.Ec(12,"ion-col",44),r.Ec(13,"strong"),r.pd(14,"#"),r.Dc(),r.Dc(),r.Ec(15,"ion-col",45),r.Ec(16,"strong"),r.pd(17),r.Pc(18,"translate"),r.Dc(),r.Dc(),r.Dc(),r.Dc(),r.Dc(),r.nd(19,AddonModQuizPlayerPage_ion_card_19_ng_container_19_Template,2,1,"ng-container",23),r.nd(20,AddonModQuizPlayerPage_ion_card_19_ion_item_20_Template,3,1,"ion-item",46),r.nd(21,AddonModQuizPlayerPage_ion_card_19_core_timer_21_Template,2,4,"core-timer",47),r.nd(22,AddonModQuizPlayerPage_ion_card_19_ion_item_22_Template,6,4,"ion-item",46),r.Dc()),2&t){const t=r.Oc();r.lc(3),r.qd(r.Qc(4,7,"addon.mod_quiz.summaryofattempt")),r.lc(7),r.qd(r.Qc(11,9,"addon.mod_quiz.question")),r.lc(7),r.qd(r.Qc(18,11,"addon.mod_quiz.status")),r.lc(2),r.Vc("ngForOf",t.summaryQuestions),r.lc(1),r.Vc("ngIf",t.dueDateWarning),r.lc(1),r.Vc("ngIf",t.endTime),r.lc(1),r.Vc("ngIf",t.preventSubmitMessages.length)}}function AddonModQuizPlayerPage_ion_card_20_ion_button_5_Template(t,e){if(1&t){const t=r.Fc();r.Ec(0,"ion-button",55),r.Mc("click",(function AddonModQuizPlayerPage_ion_card_20_ion_button_5_Template_ion_button_click_0_listener(){r.fd(t);const e=r.Oc(2);return e.changePage(e.attempt.currentpage)})),r.pd(1),r.Pc(2,"translate"),r.Dc()}2&t&&(r.lc(1),r.rd(" ",r.Qc(2,1,"addon.mod_quiz.returnattempt")," "))}function AddonModQuizPlayerPage_ion_card_20_Template(t,e){if(1&t&&(r.Ec(0,"ion-card"),r.Ec(1,"ion-item",25),r.Ec(2,"ion-label"),r.pd(3),r.Pc(4,"translate"),r.Dc(),r.Dc(),r.nd(5,AddonModQuizPlayerPage_ion_card_20_ion_button_5_Template,3,3,"ion-button",54),r.Dc()),2&t){const t=r.Oc();r.lc(3),r.qd(r.Qc(4,2,"addon.mod_quiz.errorparsequestions")),r.lc(2),r.Vc("ngIf",t.canReturn)}}function AddonModQuizPlayerPage_div_21_ion_button_2_Template(t,e){if(1&t&&(r.Ec(0,"ion-button",60),r.pd(1),r.Pc(2,"translate"),r.zc(3,"ion-icon",61),r.Dc()),2&t){const t=r.Oc(2);r.Vc("href",t.moduleUrl)("showBrowserWarning",!1),r.lc(1),r.rd(" ",r.Qc(2,3,"core.openinbrowser")," ")}}function AddonModQuizPlayerPage_div_21_ion_button_3_Template(t,e){if(1&t){const t=r.Fc();r.Ec(0,"ion-button",62),r.Mc("click",(function AddonModQuizPlayerPage_div_21_ion_button_3_Template_ion_button_click_0_listener(){r.fd(t);return r.Oc(2).finishAttempt(!0)})),r.pd(1),r.Pc(2,"translate"),r.Dc()}2&t&&(r.lc(1),r.rd(" ",r.Qc(2,1,"addon.mod_quiz.submitallandfinish")," "))}function AddonModQuizPlayerPage_div_21_Template(t,e){if(1&t&&(r.Ec(0,"div",56),r.Ec(1,"div",57),r.nd(2,AddonModQuizPlayerPage_div_21_ion_button_2_Template,4,5,"ion-button",58),r.nd(3,AddonModQuizPlayerPage_div_21_ion_button_3_Template,3,3,"ion-button",59),r.Dc(),r.Dc()),2&t){const t=r.Oc();r.lc(2),r.Vc("ngIf",t.preventSubmitMessages.length),r.lc(1),r.Vc("ngIf",!t.attempt.finishedOffline&&!t.preventSubmitMessages.length)}}let Y=(()=>{class AddonModQuizPlayerPage{constructor(t,e){this.changeDetector=t,this.elementRef=e,this.component=q.b.COMPONENT,this.loaded=!1,this.quizAborted=!1,this.offline=!1,this.navigation=[],this.questions=[],this.nextPage=-2,this.previousPage=-1,this.showSummary=!1,this.summaryQuestions=[],this.canReturn=!1,this.preventSubmitMessages=[],this.autoSaveError=!1,this.isSequential=!1,this.preflightData={},this.newAttempt=!1,this.quizDataLoaded=!1,this.timeUpCalled=!1,this.forceLeave=!1,this.reloadNavigation=!1}ngOnInit(){try{this.cmId=z.a.getRequiredRouteNumberParam("cmId"),this.courseId=z.a.getRequiredRouteNumberParam("courseId"),this.moduleUrl=z.a.getRouteParam("moduleUrl")}catch(t){return P.a.showErrorModal(t),z.a.back(),void 0}this.autoSave=new auto_save_AddonModQuizAutoSave("addon-mod_quiz-player-form","#addon-mod_quiz-connection-error-button"),this.start(),this.autoSaveErrorSubscription=this.autoSave.onError().subscribe((t=>{this.autoSaveError=t,this.changeDetector.detectChanges()}))}ngOnDestroy(){this.stopAutoSave(),this.quiz&&S.a.unblockOperation(q.b.COMPONENT,this.quiz.id)}canLeave(){return Object(g.a)(this,void 0,void 0,(function*(){if(this.forceLeave||this.quizAborted||!this.questions.length||this.showSummary)return!0;const t=yield P.a.showModalLoading("core.sending",!0);try{yield this.processAttempt(!1,!1)}catch(e){t.dismiss(),yield P.a.showConfirm(A.I.instant("addon.mod_quiz.confirmleavequizonerror")),j.a.triggerFormCancelledEvent(this.formElement,k.b.getCurrentSiteId())}finally{t.dismiss()}return!0}))}ionViewWillLeave(){return Object(g.a)(this,void 0,void 0,(function*(){const t=yield A.w.getTop();null==t?void 0:t.dismiss()}))}abortQuiz(){this.quizAborted=!0}behaviourButtonClicked(t){var e,i,o;return Object(g.a)(this,void 0,void 0,(function*(){if(!this.quiz||!this.attempt)return;let n;try{yield P.a.showConfirm(A.I.instant("core.areyousure")),n=yield P.a.showModalLoading("core.sending",!0);const a=yield this.prepareAnswers(this.quiz.coursemodule);a[t.name]=t.value,yield q.a.processAttempt(this.quiz,this.attempt,a,this.preflightData),this.reloadNavigation=!0;const d=yield null===(e=this.content)||void 0===e?void 0:e.getScrollElement(),c=(null==d?void 0:d.scrollTop)||-1;this.loaded=!1,null===(i=this.content)||void 0===i||i.scrollToTop();try{yield this.loadPage(null!==(o=this.attempt.currentpage)&&void 0!==o?o:0)}finally{this.loaded=!0,-1!=c&&setTimeout((()=>{var t;null===(t=this.content)||void 0===t?void 0:t.scrollToPoint(0,c)}),50)}}catch(t){P.a.showErrorModalDefault(t,"Error performing action.")}finally{null==n?void 0:n.dismiss()}}))}changePage(t,e,i){var o;return Object(g.a)(this,void 0,void 0,(function*(){if(this.attempt&&(-1==t||this.attempt.state!=q.b.ATTEMPT_OVERDUE&&!this.attempt.finishedOffline)){if(t==this.attempt.currentpage&&!this.showSummary&&void 0!==i)return yield this.scrollToQuestion(i),void 0;if(!(t==this.attempt.currentpage&&!this.showSummary||e&&this.isSequential&&-1!=t||-1===t&&this.showSummary)){if(null===(o=this.content)||void 0===o?void 0:o.scrollToTop(),!this.showSummary){const t=yield P.a.showModalLoading("core.sending",!0);try{yield this.processAttempt(!1,!1),t.dismiss()}catch(e){return P.a.showErrorModalDefault(e,"addon.mod_quiz.errorsaveattempt",!0),t.dismiss(),void 0}this.reloadNavigation=!0}this.loaded=!1;try{this.autoSave.stopCheckChangesProcess(),-1===t?yield this.loadSummary():yield this.loadPage(t)}catch(t){!this.showSummary&&this.quiz&&this.autoSave.startCheckChangesProcess(this.quiz,this.attempt,this.preflightData,this.offline),P.a.showErrorModalDefault(t,"addon.mod_quiz.errorgetquestions",!0)}finally{this.loaded=!0,void 0!==i&&(yield this.scrollToQuestion(i))}}}}))}fetchData(){return Object(g.a)(this,void 0,void 0,(function*(){this.quiz=yield q.a.getQuiz(this.courseId,this.cmId),S.a.blockOperation(q.b.COMPONENT,this.quiz.id),yield L.a.waitForSync(this.quiz.id),this.isSequential=q.a.isNavigationSequential(this.quiz),this.offline=!!q.a.isQuizOffline(this.quiz)||(yield q.a.isLastAttemptOfflineUnfinished(this.quiz)),this.quiz.timelimit&&this.quiz.timelimit>0&&(this.readableTimeLimit=U.a.formatTime(this.quiz.timelimit)),this.quizAccessInfo=yield q.a.getQuizAccessInformation(this.quiz.id,{cmId:this.quiz.coursemodule,readingStrategy:this.offline?1:2});const t=yield q.a.getUserAttempts(this.quiz.id,{cmId:this.quiz.coursemodule,readingStrategy:this.offline?1:2});if(!t.length)return this.newAttempt=!0,void 0;this.lastAttempt=yield w.a.setAttemptCalculatedData(this.quiz,t[t.length-1],!1,void 0,!0),this.newAttempt=q.a.isAttemptFinished(this.lastAttempt.state)}))}finishAttempt(t,e){return Object(g.a)(this,void 0,void 0,(function*(){if(!this.quiz||!this.attempt)return;let i;try{if(!e&&this.attempt.state==q.b.ATTEMPT_IN_PROGRESS){let t=A.I.instant("addon.mod_quiz.confirmclose");const e=this.summaryQuestions.filter((t=>"todo"===t.state||"invalid"===t.state)).length;if(e>0){t+=`\n                        <ion-card class="core-warning-card">\n                            <ion-item>\n                                <ion-label>\n                                    ${A.I.instant("addon.mod_quiz.submission_confirmation_unanswered",{$a:e})}\n                                </ion-label>\n                            </ion-item>\n                        </ion-card>\n                    `}yield P.a.showConfirm(t,A.I.instant("addon.mod_quiz.submitallandfinish"),A.I.instant("core.submit"))}i=yield P.a.showModalLoading("core.sending",!0),yield this.processAttempt(t,e),R.b.trigger(q.b.ATTEMPT_FINISHED_EVENT,{quizId:this.quiz.id,attemptId:this.attempt.id,synced:!this.offline},k.b.getCurrentSiteId()),R.b.trigger(R.b.ACTIVITY_DATA_SENT,{module:"quiz"}),e&&this.quiz.graceperiod?(this.stopAutoSave(),this.clearTimer(),yield this.refreshAttempt(),yield this.loadSummary()):(this.forceLeave=!0,z.a.back())}catch(t){P.a.showErrorModalDefault(t,"addon.mod_quiz.errorsaveattempt",!0).then((e=>Object(g.a)(this,void 0,void 0,(function*(){yield null==e?void 0:e.onWillDismiss(),t instanceof H.a&&"attemptalreadyclosed"===t.errorcode&&z.a.back()}))))}finally{null==i?void 0:i.dismiss()}}))}fixSequenceChecks(){var t,e,i;return Object(g.a)(this,void 0,void 0,(function*(){if(!this.attempt)return;const o=yield q.a.getAttemptData(this.attempt.id,null!==(t=this.attempt.currentpage)&&void 0!==t?t:0,this.preflightData,{cmId:null===(e=this.quiz)||void 0===e?void 0:e.coursemodule,readingStrategy:this.offline?1:2}),n={};o.questions.forEach((t=>{const e=x.a.getQuestionSequenceCheckFromHtml(t.html);e&&(n[t.slot]=e)})),null===(i=this.questionComponents)||void 0===i||i.forEach((t=>{t.updateSequenceCheck(n)}))}))}getAnswers(){return x.a.getAnswersFromForm(document.forms["addon-mod_quiz-player-form"])}initTimer(){var t;if(!this.quizAccessInfo||!this.attempt||!(null===(t=this.attemptAccessInfo)||void 0===t?void 0:t.endtime)||this.attemptAccessInfo.endtime<0)return;q.a.shouldShowTimeLeft(this.quizAccessInfo.activerulenames,this.attempt,this.attemptAccessInfo.endtime)?this.endTime=this.attemptAccessInfo.endtime:delete this.endTime}clearTimer(){delete this.endTime}loadPage(t){return Object(g.a)(this,void 0,void 0,(function*(){if(!this.quiz||!this.attempt)return;this.isSequential&&(yield this.logViewPage(t));const e=yield q.a.getAttemptData(this.attempt.id,t,this.preflightData,{cmId:this.quiz.coursemodule,readingStrategy:this.offline?1:2});this.attempt=e.attempt,this.attempt.currentpage=t,this.questions=e.questions,this.nextPage=e.nextpage,this.previousPage=this.isSequential?-1:t-1,this.showSummary=!1,this.questions.forEach((t=>{t.readableMark=w.a.getQuestionMarkFromHtml(t.html),x.a.extractQuestionInfoBox(t,".info"),q.a.isQuestionBlocked(t)&&(t.type="description")})),this.isSequential||(yield this.logViewPage(t)),this.autoSave.startCheckChangesProcess(this.quiz,this.attempt,this.preflightData,this.offline)}))}logViewPage(t){return Object(g.a)(this,void 0,void 0,(function*(){this.quiz&&this.attempt&&(yield b.a.ignoreErrors(q.a.logViewAttempt(this.attempt.id,t,this.preflightData,this.offline)),B.a.logEvent({type:B.b.VIEW_ITEM,ws:"mod_quiz_view_attempt",name:this.quiz.name,data:{id:this.attempt.id,quizid:this.quiz.id,page:t,category:"quiz"},url:`/mod/quiz/attempt.php?attempt=${this.attempt.id}&cmid=${this.cmId}`+(t>0?`&page=${t}`:"")}))}))}logViewSummary(){return Object(g.a)(this,void 0,void 0,(function*(){this.quiz&&this.attempt&&(yield b.a.ignoreErrors(q.a.logViewAttemptSummary(this.attempt.id,this.preflightData,this.quiz.id)),B.a.logEvent({type:B.b.VIEW_ITEM,ws:"mod_quiz_view_attempt_summary",name:this.quiz.name,data:{id:this.attempt.id,quizid:this.quiz.id,category:"quiz"},url:`/mod/quiz/summary.php?attempt=${this.attempt.id}&cmid=${this.cmId}`}))}))}refreshAttempt(){return Object(g.a)(this,void 0,void 0,(function*(){if(!this.quiz)return;const t=yield q.a.getUserAttempts(this.quiz.id,{cmId:this.quiz.coursemodule,readingStrategy:this.offline?1:2});this.attempt=t.find((t=>{var e;return t.id===(null===(e=this.attempt)||void 0===e?void 0:e.id)}))}))}loadSummary(){return Object(g.a)(this,void 0,void 0,(function*(){this.quiz&&this.attempt&&(this.summaryQuestions=[],this.summaryQuestions=yield q.a.getAttemptSummary(this.attempt.id,this.preflightData,{cmId:this.quiz.coursemodule,loadLocal:this.offline,readingStrategy:this.offline?1:2}),this.showSummary=!0,this.canReturn=this.attempt.state==q.b.ATTEMPT_IN_PROGRESS&&!this.attempt.finishedOffline,this.preventSubmitMessages=q.a.getPreventSubmitMessages(this.summaryQuestions),this.dueDateWarning=q.a.getAttemptDueDateWarning(this.quiz,this.attempt),this.logViewSummary())}))}loadNavigation(){var t;return Object(g.a)(this,void 0,void 0,(function*(){this.attempt&&(this.navigation=yield q.a.getAttemptSummary(this.attempt.id,this.preflightData,{cmId:null===(t=this.quiz)||void 0===t?void 0:t.coursemodule,loadLocal:this.offline,readingStrategy:this.offline?1:2}),this.navigation.forEach((t=>{t.stateClass=x.a.getQuestionStateClass(t.state||"")})))}))}openNavigation(){var t;return Object(g.a)(this,void 0,void 0,(function*(){if(this.reloadNavigation){const t=yield P.a.showModalLoading();yield b.a.ignoreErrors(this.loadNavigation()),t.dismiss(),this.reloadNavigation=!1}const e=yield P.a.openSideModal({component:N.a,componentProps:{navigation:this.navigation,summaryShown:this.showSummary,currentPage:null===(t=this.attempt)||void 0===t?void 0:t.currentpage,isReview:!1}});e&&this.changePage(e.page,!0,e.slot)}))}prepareAnswers(t){return x.a.prepareAnswers(this.questions,this.getAnswers(),this.offline,this.component,t)}processAttempt(t,e,i){return Object(g.a)(this,void 0,void 0,(function*(){if(!this.quiz||!this.attempt)return;let o={};this.showSummary||(o=yield this.prepareAnswers(this.quiz.coursemodule));try{yield q.a.processAttempt(this.quiz,this.attempt,o,this.preflightData,t,e,this.offline)}catch(o){if(!o||"submissionoutofsequencefriendlymessage"!=o.errorcode)throw o;try{yield this.fixSequenceChecks()}catch(t){throw o}if(i)throw o;return this.processAttempt(t,e,!0)}return this.autoSave.cancelAutoSave(),this.autoSave.hideAutoSaveError(),this.formElement&&j.a.triggerFormSubmittedEvent(this.formElement,!this.offline,k.b.getCurrentSiteId()),x.a.clearTmpData(this.questions,this.component,this.quiz.coursemodule)}))}scrollToQuestion(t){return Object(g.a)(this,void 0,void 0,(function*(){yield b.a.nextTick(),yield G.a.waitDirectivesReady(this.elementRef.nativeElement,"core-question"),yield $.a.scrollToElement(this.elementRef.nativeElement,"#addon-mod_quiz-question-"+t)}))}showConnectionError(t){this.autoSave.showAutoSaveError(t)}start(){return Object(g.a)(this,void 0,void 0,(function*(){try{this.loaded=!1,this.quizDataLoaded||(yield this.fetchData(),this.quizDataLoaded=!0),yield this.startOrContinueAttempt()}catch(t){P.a.showErrorModalDefault(t,"addon.mod_quiz.errorgetquiz",!0)}finally{this.loaded=!0}}))}startOrContinueAttempt(){var t;return Object(g.a)(this,void 0,void 0,(function*(){if(!this.quiz||!this.quizAccessInfo)return;let e=this.newAttempt?void 0:this.lastAttempt;e=yield w.a.getAndCheckPreflightData(this.quiz,this.quizAccessInfo,this.preflightData,e,this.offline,!1,"addon.mod_quiz.startattempt"),this.attemptAccessInfo=yield q.a.getAttemptAccessInformation(this.quiz.id,e.id,{cmId:this.quiz.coursemodule,readingStrategy:this.offline?1:2}),this.attempt=e,yield this.loadNavigation(),this.attempt.state==q.b.ATTEMPT_OVERDUE||this.attempt.finishedOffline?yield this.loadSummary():(yield this.loadPage(null!==(t=this.attempt.currentpage)&&void 0!==t?t:0),this.initTimer())}))}timeUp(){this.timeUpCalled||(this.timeUpCalled=!0,this.finishAttempt(!1,!0))}stopAutoSave(){var t;this.autoSave.cancelAutoSave(),this.autoSave.stopCheckChangesProcess(),null===(t=this.autoSaveErrorSubscription)||void 0===t||t.unsubscribe()}}return AddonModQuizPlayerPage.ɵfac=function AddonModQuizPlayerPage_Factory(t){return new(t||AddonModQuizPlayerPage)(r.yc(r.j),r.yc(r.r))},AddonModQuizPlayerPage.ɵcmp=r.sc({type:AddonModQuizPlayerPage,selectors:[["page-addon-mod-quiz-player"]],viewQuery:function AddonModQuizPlayerPage_Query(t,e){var i;(1&t&&(r.ud(s.v,!0),r.ud(K,!0),r.ud(O.a,!0)),2&t)&&(r.dd(i=r.Nc())&&(e.content=i.first),r.dd(i=r.Nc())&&(e.formElement=i.first),r.dd(i=r.Nc())&&(e.questionComponents=i))},decls:22,vars:17,consts:[["slot","start"],[3,"text"],["contextLevel","module",3,"text","contextInstanceId","courseId",4,"ngIf"],["slot","end"],["fill","clear","id","addon-mod_quiz-connection-error-button","aria-haspopup","dialog",3,"hidden","click"],["name","fas-circle-exclamation","slot","icon-only","aria-hidden","true"],[3,"click",4,"ngIf"],[3,"endTime","timerText","hiddable","finished",4,"ngIf"],[1,"limited-width"],[1,"has-spacer",3,"hideUntil"],["expand","block","class","ion-margin",3,"click",4,"ngIf"],["name","addon-mod_quiz-player-form",4,"ngIf"],["class","spacer-top",4,"ngIf"],["class","addon-mod_quiz-table",4,"ngIf"],[4,"ngIf"],["collapsible-footer","","appearOnBottom","","slot","fixed",4,"ngIf"],["contextLevel","module",3,"text","contextInstanceId","courseId"],[3,"click"],["name","fas-bookmark","slot","icon-only","aria-hidden","true"],[3,"endTime","timerText","hiddable","finished"],["expand","block",1,"ion-margin",3,"click"],["name","addon-mod_quiz-player-form"],["quizForm",""],[4,"ngFor","ngForOf"],[3,"id"],[1,"ion-text-wrap"],["class","inline",4,"ngIf"],["slot","end","class","ion-text-wrap ion-margin-horizontal addon-mod_quiz-question-note",4,"ngIf"],["contextLevel","module",1,"ion-text-wrap",3,"question","component","componentId","attemptId","usageId","offlineEnabled","contextInstanceId","courseId","preferredBehaviour","review","onAbort","buttonClicked"],[1,"inline"],["slot","end",1,"ion-text-wrap","ion-margin-horizontal","addon-mod_quiz-question-note"],["class","block",4,"ngIf"],[3,"innerHTML",4,"ngIf"],[1,"block"],[3,"innerHTML"],[1,"spacer-top"],["expand","block","fill","outline",1,"ion-text-wrap",3,"click"],["name","fas-chevron-left","slot","start","aria-hidden","true"],["expand","block","class","ion-text-wrap",3,"click",4,"ngIf"],["expand","block",1,"ion-text-wrap",3,"click"],["name","fas-chevron-right","slot","end","aria-hidden","true"],[1,"addon-mod_quiz-table"],[1,"ion-align-items-center"],["size","3",1,"ion-text-center","ion-hide-md-down"],["size","3",1,"ion-text-center","ion-hide-md-up"],["size","9",1,"ion-text-center"],["class","ion-text-wrap",4,"ngIf"],[3,"endTime","timerText","finished",4,"ngIf"],[3,"detail","button","click",4,"ngIf"],[3,"detail","button","click"],["size","3",1,"ion-text-center","ion-text-wrap"],["size","9",1,"ion-text-center","ion-text-wrap"],[3,"endTime","timerText","finished"],[1,"item-heading"],["expand","block","class","ion-margin ion-text-wrap","fill","outline",3,"click",4,"ngIf"],["expand","block","fill","outline",1,"ion-margin","ion-text-wrap",3,"click"],["collapsible-footer","","appearOnBottom","","slot","fixed"],[1,"list-item-limited-width"],["expand","block","class","ion-margin ion-text-wrap","core-link","",3,"href","showBrowserWarning",4,"ngIf"],["expand","block","class","ion-margin ion-text-wrap",3,"click",4,"ngIf"],["expand","block","core-link","",1,"ion-margin","ion-text-wrap",3,"href","showBrowserWarning"],["name","fas-up-right-from-square","slot","end","aria-hidden","true"],["expand","block",1,"ion-margin","ion-text-wrap",3,"click"]],template:function AddonModQuizPlayerPage_Template(t,e){1&t&&(r.Ec(0,"ion-header"),r.Ec(1,"ion-toolbar"),r.Ec(2,"ion-buttons",0),r.zc(3,"ion-back-button",1),r.Pc(4,"translate"),r.Dc(),r.Ec(5,"ion-title"),r.Ec(6,"h1"),r.nd(7,AddonModQuizPlayerPage_core_format_text_7_Template,1,3,"core-format-text",2),r.Dc(),r.Dc(),r.Ec(8,"ion-buttons",3),r.Ec(9,"ion-button",4),r.Mc("click",(function AddonModQuizPlayerPage_Template_ion_button_click_9_listener(t){return e.showConnectionError(t)})),r.Pc(10,"translate"),r.zc(11,"ion-icon",5),r.Dc(),r.nd(12,AddonModQuizPlayerPage_ion_button_12_Template,3,3,"ion-button",6),r.Dc(),r.Dc(),r.nd(13,AddonModQuizPlayerPage_core_timer_13_Template,2,5,"core-timer",7),r.Dc(),r.Ec(14,"ion-content",8),r.Ec(15,"core-loading",9),r.nd(16,AddonModQuizPlayerPage_ion_button_16_Template,3,3,"ion-button",10),r.nd(17,AddonModQuizPlayerPage_form_17_Template,3,1,"form",11),r.nd(18,AddonModQuizPlayerPage_ion_row_18_Template,3,2,"ion-row",12),r.nd(19,AddonModQuizPlayerPage_ion_card_19_Template,23,13,"ion-card",13),r.nd(20,AddonModQuizPlayerPage_ion_card_20_Template,6,4,"ion-card",14),r.nd(21,AddonModQuizPlayerPage_div_21_Template,4,2,"div",15),r.Dc(),r.Dc()),2&t&&(r.lc(3),r.Vc("text",r.Qc(4,13,"core.back")),r.lc(4),r.Vc("ngIf",e.quiz),r.lc(2),r.Vc("hidden",!e.autoSaveError),r.mc("aria-label",r.Qc(10,15,"addon.mod_quiz.connectionerror")),r.lc(3),r.Vc("ngIf",e.navigation.length),r.lc(1),r.Vc("ngIf",e.loaded&&e.endTime&&e.questions.length&&!e.quizAborted&&!e.showSummary),r.lc(2),r.Vc("hideUntil",e.loaded),r.lc(1),r.Vc("ngIf",!e.attempt),r.lc(1),r.Vc("ngIf",e.questions.length&&!e.quizAborted&&!e.showSummary),r.lc(1),r.Vc("ngIf",e.questions.length&&!e.quizAborted&&!e.showSummary),r.lc(1),r.Vc("ngIf",!e.quizAborted&&e.showSummary&&e.summaryQuestions.length),r.lc(1),r.Vc("ngIf",e.attempt&&(!e.questions.length&&!e.showSummary||e.quizAborted)),r.lc(1),r.Vc("ngIf",!e.quizAborted&&e.showSummary&&e.summaryQuestions.length&&e.loaded))},directives:[s.C,s.Ab,s.m,s.h,s.i,s.yb,M.t,Q.a,s.l,s.D,E.a,m.a,s.v,y.a,u.a,W.a,J.H,J.s,J.t,M.s,s.n,s.J,s.O,O.a,s.hb,s.u,s.p,s.r,s.I,I.a,X.a],pipes:[_.d],styles:["[_nghost-%COMP%]   .addon-mod_quiz-question-note[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{margin-top:2px;margin-bottom:2px}[_nghost-%COMP%]   core-timer.core-timer-timeleft-0[_ngcontent-%COMP%]{--timer-background:#ca3120;--timer-text-color:var(--white)}[_nghost-%COMP%]   core-timer.core-timer-timeleft-1[_ngcontent-%COMP%]{--timer-background:rgba(202,49,32,0.9333333333);--timer-text-color:var(--white)}[_nghost-%COMP%]   core-timer.core-timer-timeleft-2[_ngcontent-%COMP%]{--timer-background:rgba(202,49,32,0.8666666667);--timer-text-color:var(--white)}[_nghost-%COMP%]   core-timer.core-timer-timeleft-3[_ngcontent-%COMP%]{--timer-background:rgba(202,49,32,0.8);--timer-text-color:var(--white)}[_nghost-%COMP%]   core-timer.core-timer-timeleft-4[_ngcontent-%COMP%]{--timer-background:rgba(202,49,32,0.7333333333);--timer-text-color:var(--white)}[_nghost-%COMP%]   core-timer.core-timer-timeleft-5[_ngcontent-%COMP%]{--timer-background:rgba(202,49,32,0.6666666667);--timer-text-color:var(--white)}[_nghost-%COMP%]   core-timer.core-timer-timeleft-6[_ngcontent-%COMP%]{--timer-background:rgba(202,49,32,0.6);--timer-text-color:var(--white)}[_nghost-%COMP%]   core-timer.core-timer-timeleft-7[_ngcontent-%COMP%]{--timer-background:rgba(202,49,32,0.5333333333);--timer-text-color:var(--white)}[_nghost-%COMP%]   core-timer.core-timer-timeleft-8[_ngcontent-%COMP%]{--timer-background:rgba(202,49,32,0.4666666667)}[_nghost-%COMP%]   core-timer.core-timer-timeleft-9[_ngcontent-%COMP%]{--timer-background:rgba(202,49,32,0.4)}[_nghost-%COMP%]   core-timer.core-timer-timeleft-10[_ngcontent-%COMP%]{--timer-background:rgba(202,49,32,0.3333333333)}[_nghost-%COMP%]   core-timer.core-timer-timeleft-11[_ngcontent-%COMP%]{--timer-background:rgba(202,49,32,0.2666666667)}[_nghost-%COMP%]   core-timer.core-timer-timeleft-12[_ngcontent-%COMP%]{--timer-background:rgba(202,49,32,0.2)}[_nghost-%COMP%]   core-timer.core-timer-timeleft-13[_ngcontent-%COMP%]{--timer-background:rgba(202,49,32,0.1333333333)}[_nghost-%COMP%]   core-timer.core-timer-timeleft-14[_ngcontent-%COMP%]{--timer-background:rgba(202,49,32,0.0666666667)}[_nghost-%COMP%]   core-timer.core-timer-timeleft-15[_ngcontent-%COMP%]{--timer-background:rgba(202,49,32,0)}"]}),AddonModQuizPlayerPage})();var Z=i("MLi9"),tt=i("uYHD");function AddonModQuizReviewPage_ion_button_10_Template(t,e){if(1&t){const t=r.Fc();r.Ec(0,"ion-button",10),r.Mc("click",(function AddonModQuizReviewPage_ion_button_10_Template_ion_button_click_0_listener(){r.fd(t);return r.Oc().openNavigation()})),r.Pc(1,"translate"),r.zc(2,"ion-icon",11),r.Dc()}2&t&&r.mc("aria-label",r.Qc(1,1,"addon.mod_quiz.opentoc"))}function AddonModQuizReviewPage_ion_card_16_ion_item_17_Template(t,e){if(1&t&&(r.Ec(0,"ion-item",12),r.Ec(1,"ion-label"),r.Ec(2,"p",13),r.pd(3),r.Pc(4,"translate"),r.Dc(),r.Ec(5,"p"),r.pd(6),r.Pc(7,"coreFormatDate"),r.Dc(),r.Dc(),r.Dc()),2&t){const t=r.Oc(2);r.lc(3),r.qd(r.Qc(4,2,"addon.mod_quiz.completedon")),r.lc(3),r.qd(r.Qc(7,4,1e3*t.attempt.timefinish))}}function AddonModQuizReviewPage_ion_card_16_ion_item_18_Template(t,e){if(1&t&&(r.Ec(0,"ion-item",12),r.Ec(1,"ion-label"),r.Ec(2,"p",13),r.pd(3),r.Pc(4,"translate"),r.Dc(),r.Ec(5,"p"),r.pd(6),r.Dc(),r.Dc(),r.Dc()),2&t){const t=r.Oc(2);r.lc(3),r.qd(r.Qc(4,2,"addon.mod_quiz.timetaken")),r.lc(3),r.qd(t.timeTaken)}}function AddonModQuizReviewPage_ion_card_16_ion_item_19_Template(t,e){if(1&t&&(r.Ec(0,"ion-item",12),r.Ec(1,"ion-label"),r.Ec(2,"p",13),r.pd(3),r.Pc(4,"translate"),r.Dc(),r.Ec(5,"p"),r.pd(6),r.Dc(),r.Dc(),r.Dc()),2&t){const t=r.Oc(2);r.lc(3),r.qd(r.Qc(4,2,"addon.mod_quiz.overdue")),r.lc(3),r.qd(t.overTime)}}function AddonModQuizReviewPage_ion_card_16_ion_item_20_Template(t,e){if(1&t&&(r.Ec(0,"ion-item",12),r.Ec(1,"ion-label"),r.Ec(2,"p",13),r.pd(3),r.Pc(4,"translate"),r.Dc(),r.Ec(5,"p"),r.pd(6),r.Dc(),r.Dc(),r.Dc()),2&t){const t=r.Oc(2);r.lc(3),r.qd(r.Qc(4,2,"addon.mod_quiz.marks")),r.lc(3),r.qd(t.readableMark)}}function AddonModQuizReviewPage_ion_card_16_ion_item_21_Template(t,e){if(1&t&&(r.Ec(0,"ion-item",12),r.Ec(1,"ion-label"),r.Ec(2,"p",13),r.pd(3),r.Pc(4,"translate"),r.Dc(),r.Ec(5,"p"),r.pd(6),r.Dc(),r.Dc(),r.Dc()),2&t){const t=r.Oc(2);r.lc(3),r.qd(r.Qc(4,2,"addon.mod_quiz.grade")),r.lc(3),r.qd(t.readableGrade)}}function AddonModQuizReviewPage_ion_card_16_ion_item_22_Template(t,e){if(1&t&&(r.Ec(0,"ion-item",12),r.Ec(1,"ion-label"),r.Ec(2,"p",13),r.pd(3),r.Dc(),r.zc(4,"core-format-text",16),r.Dc(),r.Dc()),2&t){const t=e.$implicit,i=r.Oc(2);r.lc(3),r.qd(t.title),r.lc(1),r.Vc("component",i.component)("componentId",i.cmId)("text",t.content)("contextInstanceId",i.cmId)("courseId",i.courseId)}}function AddonModQuizReviewPage_ion_card_16_Template(t,e){if(1&t&&(r.Ec(0,"ion-card"),r.Ec(1,"ion-list"),r.Ec(2,"ion-item",12),r.Ec(3,"ion-label"),r.Ec(4,"p",13),r.pd(5),r.Pc(6,"translate"),r.Dc(),r.Ec(7,"p"),r.pd(8),r.Pc(9,"coreFormatDate"),r.Dc(),r.Dc(),r.Dc(),r.Ec(10,"ion-item",12),r.Ec(11,"ion-label"),r.Ec(12,"p",13),r.pd(13),r.Pc(14,"translate"),r.Dc(),r.Ec(15,"p"),r.pd(16),r.Dc(),r.Dc(),r.Dc(),r.nd(17,AddonModQuizReviewPage_ion_card_16_ion_item_17_Template,8,6,"ion-item",14),r.nd(18,AddonModQuizReviewPage_ion_card_16_ion_item_18_Template,7,4,"ion-item",14),r.nd(19,AddonModQuizReviewPage_ion_card_16_ion_item_19_Template,7,4,"ion-item",14),r.nd(20,AddonModQuizReviewPage_ion_card_16_ion_item_20_Template,7,4,"ion-item",14),r.nd(21,AddonModQuizReviewPage_ion_card_16_ion_item_21_Template,7,4,"ion-item",14),r.nd(22,AddonModQuizReviewPage_ion_card_16_ion_item_22_Template,5,6,"ion-item",15),r.Dc(),r.Dc()),2&t){const t=r.Oc();r.lc(5),r.qd(r.Qc(6,10,"addon.mod_quiz.startedon")),r.lc(3),r.qd(r.Qc(9,12,1e3*t.attempt.timestart)),r.lc(5),r.qd(r.Qc(14,14,"addon.mod_quiz.attemptstate")),r.lc(3),r.qd(t.readableState),r.lc(1),r.Vc("ngIf",t.showCompleted),r.lc(1),r.Vc("ngIf",t.timeTaken),r.lc(1),r.Vc("ngIf",t.overTime),r.lc(1),r.Vc("ngIf",t.readableMark),r.lc(1),r.Vc("ngIf",t.readableGrade),r.lc(1),r.Vc("ngForOf",t.additionalData)}}const review_c0=function(t){return{$a:t}};function AddonModQuizReviewPage_div_17_div_1_h2_4_Template(t,e){if(1&t&&(r.Ec(0,"h2"),r.pd(1),r.Pc(2,"translate"),r.Dc()),2&t){const t=r.Oc().$implicit;r.lc(1),r.rd(" ",r.Rc(2,1,"core.question.questionno",r.ad(4,review_c0,t.questionnumber))," ")}}function AddonModQuizReviewPage_div_17_div_1_h2_5_Template(t,e){1&t&&(r.Ec(0,"h2"),r.pd(1),r.Pc(2,"translate"),r.Dc()),2&t&&(r.lc(1),r.rd(" ",r.Qc(2,1,"core.question.information")," "))}function AddonModQuizReviewPage_div_17_div_1_div_6_p_1_Template(t,e){if(1&t&&(r.Ec(0,"p"),r.pd(1),r.Dc()),2&t){const t=r.Oc(2).$implicit;r.lc(1),r.qd(t.status)}}function AddonModQuizReviewPage_div_17_div_1_div_6_p_2_Template(t,e){if(1&t&&r.zc(0,"p",23),2&t){const t=r.Oc(2).$implicit;r.Vc("innerHTML",t.readableMark,r.gd)}}function AddonModQuizReviewPage_div_17_div_1_div_6_Template(t,e){if(1&t&&(r.Ec(0,"div",21),r.nd(1,AddonModQuizReviewPage_div_17_div_1_div_6_p_1_Template,2,1,"p",8),r.nd(2,AddonModQuizReviewPage_div_17_div_1_div_6_p_2_Template,1,1,"p",22),r.Dc()),2&t){const t=r.Oc().$implicit;r.lc(1),r.Vc("ngIf",t.status),r.lc(1),r.Vc("ngIf",t.readableMark)}}function AddonModQuizReviewPage_div_17_div_1_Template(t,e){if(1&t&&(r.Ec(0,"div"),r.Ec(1,"ion-card",18),r.Ec(2,"ion-item-divider"),r.Ec(3,"ion-label",12),r.nd(4,AddonModQuizReviewPage_div_17_div_1_h2_4_Template,3,6,"h2",8),r.nd(5,AddonModQuizReviewPage_div_17_div_1_h2_5_Template,3,3,"h2",8),r.Dc(),r.nd(6,AddonModQuizReviewPage_div_17_div_1_div_6_Template,3,2,"div",19),r.Dc(),r.zc(7,"core-question",20),r.Dc(),r.Dc()),2&t){const t=e.$implicit,i=r.Oc(2);r.lc(1),r.Xc("id","addon-mod_quiz-question-",t.slot,""),r.lc(3),r.Vc("ngIf","description"!==t.type&&t.questionnumber),r.lc(1),r.Vc("ngIf","description"===t.type||!t.questionnumber),r.lc(1),r.Vc("ngIf",t.status||t.readableMark),r.lc(1),r.Vc("question",t)("component",i.component)("componentId",i.cmId)("attemptId",i.attempt.id)("usageId",i.attempt.uniqueid)("offlineEnabled",!1)("contextInstanceId",i.cmId)("courseId",i.courseId)("review",!0)("preferredBehaviour",null==i.quiz?null:i.quiz.preferredbehaviour)}}function AddonModQuizReviewPage_div_17_Template(t,e){if(1&t&&(r.Ec(0,"div"),r.nd(1,AddonModQuizReviewPage_div_17_div_1_Template,8,14,"div",17),r.Dc()),2&t){const t=r.Oc();r.lc(1),r.Vc("ngForOf",t.questions)}}function AddonModQuizReviewPage_div_18_ion_col_2_Template(t,e){if(1&t){const t=r.Fc();r.Ec(0,"ion-col",30),r.Ec(1,"ion-button",31),r.Mc("click",(function AddonModQuizReviewPage_div_18_ion_col_2_Template_ion_button_click_1_listener(){r.fd(t);const e=r.Oc(2);return e.changePage(e.previousPage)})),r.Pc(2,"translate"),r.zc(3,"ion-icon",32),r.Dc(),r.Dc()}if(2&t){const t=r.Oc(2);r.lc(1),r.Vc("disabled",t.previousPage<0),r.mc("aria-label",r.Qc(2,2,"core.previous"))}}function AddonModQuizReviewPage_div_18_ion_button_4_span_1_Template(t,e){1&t&&(r.Ec(0,"span"),r.pd(1),r.Pc(2,"translate"),r.Dc()),2&t&&(r.lc(1),r.qd(r.Qc(2,1,"addon.mod_quiz.showall")))}function AddonModQuizReviewPage_div_18_ion_button_4_span_2_Template(t,e){1&t&&(r.Ec(0,"span"),r.pd(1),r.Pc(2,"translate"),r.Dc()),2&t&&(r.lc(1),r.qd(r.Qc(2,1,"addon.mod_quiz.showeachpage")))}function AddonModQuizReviewPage_div_18_ion_button_4_Template(t,e){if(1&t){const t=r.Fc();r.Ec(0,"ion-button",33),r.Mc("click",(function AddonModQuizReviewPage_div_18_ion_button_4_Template_ion_button_click_0_listener(){r.fd(t);return r.Oc(2).switchMode()})),r.nd(1,AddonModQuizReviewPage_div_18_ion_button_4_span_1_Template,3,3,"span",8),r.nd(2,AddonModQuizReviewPage_div_18_ion_button_4_span_2_Template,3,3,"span",8),r.Dc()}if(2&t){const t=r.Oc(2);r.lc(1),r.Vc("ngIf",!t.showAll),r.lc(1),r.Vc("ngIf",t.showAll)}}function AddonModQuizReviewPage_div_18_ion_col_5_Template(t,e){if(1&t){const t=r.Fc();r.Ec(0,"ion-col",34),r.Ec(1,"ion-button",31),r.Mc("click",(function AddonModQuizReviewPage_div_18_ion_col_5_Template_ion_button_click_1_listener(){r.fd(t);const e=r.Oc(2);return e.changePage(e.nextPage)})),r.Pc(2,"translate"),r.zc(3,"ion-icon",35),r.Dc(),r.Dc()}if(2&t){const t=r.Oc(2);r.lc(1),r.Vc("disabled",t.nextPage>=t.numPages),r.mc("aria-label",r.Qc(2,2,"core.next"))}}function AddonModQuizReviewPage_div_18_Template(t,e){if(1&t&&(r.Ec(0,"div",24),r.Ec(1,"ion-row",25),r.nd(2,AddonModQuizReviewPage_div_18_ion_col_2_Template,4,4,"ion-col",26),r.Ec(3,"ion-col",27),r.nd(4,AddonModQuizReviewPage_div_18_ion_button_4_Template,3,2,"ion-button",28),r.Dc(),r.nd(5,AddonModQuizReviewPage_div_18_ion_col_5_Template,4,4,"ion-col",29),r.Dc(),r.Dc()),2&t){const t=r.Oc();r.lc(2),r.Vc("ngIf",!t.showAll),r.lc(2),r.Vc("ngIf",t.numPages>1),r.lc(1),r.Vc("ngIf",!t.showAll)}}let et=(()=>{class AddonModQuizReviewPage{constructor(t){this.elementRef=t,this.component=q.b.COMPONENT,this.showAll=!1,this.numPages=1,this.showCompleted=!1,this.loaded=!1,this.navigation=[],this.questions=[],this.nextPage=-2,this.previousPage=-2,this.logView=U.a.once((()=>this.performLogView(!0,{showAllDisabled:!this.showAll,page:this.currentPage})))}ngOnInit(){return Object(g.a)(this,void 0,void 0,(function*(){try{this.cmId=z.a.getRequiredRouteNumberParam("cmId"),this.courseId=z.a.getRequiredRouteNumberParam("courseId"),this.attemptId=z.a.getRequiredRouteNumberParam("attemptId"),this.currentPage=z.a.getRouteNumberParam("page")||-1,this.showAll=-1==this.currentPage}catch(t){return P.a.showErrorModal(t),z.a.back(),void 0}try{yield this.fetchData()}finally{this.loaded=!0}}))}changePage(t,e){var i,o;return Object(g.a)(this,void 0,void 0,(function*(){if(void 0!==e&&(-1==(null===(i=this.attempt)||void 0===i?void 0:i.currentpage)||t==this.currentPage))return this.scrollToQuestion(e),void 0;if(t!=this.currentPage){this.loaded=!1,null===(o=this.content)||void 0===o||o.scrollToTop();try{yield this.loadPage(t),this.performLogView(!1,{page:t})}catch(t){P.a.showErrorModalDefault(t,"addon.mod_quiz.errorgetquestions",!0)}finally{this.loaded=!0,void 0!==e&&this.scrollToQuestion(e)}}}))}fetchData(){return Object(g.a)(this,void 0,void 0,(function*(){try{this.quiz=yield q.a.getQuiz(this.courseId,this.cmId),this.options=yield q.a.getCombinedReviewOptions(this.quiz.id,{cmId:this.cmId}),yield this.loadNavigation(),yield this.loadPage(this.currentPage),this.logView()}catch(t){P.a.showErrorModalDefault(t,"addon.mod_quiz.errorgetquiz",!0)}}))}loadPage(t){var e;return Object(g.a)(this,void 0,void 0,(function*(){const i=yield q.a.getAttemptReview(this.attemptId,{page:t,cmId:null===(e=this.quiz)||void 0===e?void 0:e.coursemodule});this.attempt=i.attempt,this.attempt.currentpage=t,this.currentPage=t,this.setSummaryCalculatedData(i),this.questions=i.questions,this.nextPage=t+1,this.previousPage=t-1,this.questions.forEach((t=>{t.readableMark=w.a.getQuestionMarkFromHtml(t.html),x.a.extractQuestionInfoBox(t,".info")}))}))}loadNavigation(){var t;return Object(g.a)(this,void 0,void 0,(function*(){const e=yield q.a.getAttemptReview(this.attemptId,{page:-1,cmId:null===(t=this.quiz)||void 0===t?void 0:t.coursemodule});this.navigation=e.questions,this.navigation.forEach((t=>{t.stateClass=x.a.getQuestionStateClass(t.state||"")}));const i=e.questions[e.questions.length-1];this.numPages=i?i.page+1:0}))}refreshData(t){return Object(g.a)(this,void 0,void 0,(function*(){const e=[];e.push(q.a.invalidateQuizData(this.courseId)),e.push(q.a.invalidateAttemptReview(this.attemptId)),this.quiz&&e.push(q.a.invalidateCombinedReviewOptionsForUser(this.quiz.id)),yield b.a.ignoreErrors(Promise.all(e));try{yield this.fetchData()}finally{t.complete()}}))}scrollToQuestion(t){$.a.scrollToElement(this.elementRef.nativeElement,`#addon-mod_quiz-question-${t}`)}setSummaryCalculatedData(t){var e,i,o;if(!this.attempt||!this.quiz)return;if(this.readableState=q.a.getAttemptReadableStateName(null!==(e=this.attempt.state)&&void 0!==e?e:""),this.attempt.state!=q.b.ATTEMPT_FINISHED)return;this.showCompleted=!0,this.additionalData=t.additionaldata;const n=(this.attempt.timefinish||0)-(this.attempt.timestart||0);if(n>0?(this.timeTaken=U.a.formatTime(n),this.quiz.timelimit&&n>this.quiz.timelimit+60&&(this.overTime=U.a.formatTime(n-this.quiz.timelimit))):this.timeTaken=void 0,this.options&&this.options.someoptions.marks>=q.b.QUESTION_OPTIONS_MARK_AND_MAX&&q.a.quizHasGrades(this.quiz))if(null==t.grade)this.readableGrade=q.a.formatGrade(t.grade,this.quiz.decimalpoints);else{this.quiz.grade!=this.quiz.sumgrades&&(this.readableMark=A.I.instant("addon.mod_quiz.outofshort",{$a:{grade:q.a.formatGrade(this.attempt.sumgrades,this.quiz.decimalpoints),maxgrade:q.a.formatGrade(this.quiz.sumgrades,this.quiz.decimalpoints)}}));const e={grade:q.a.formatGrade(Number(t.grade),this.quiz.decimalpoints),maxgrade:q.a.formatGrade(this.quiz.grade,this.quiz.decimalpoints)};100!=this.quiz.grade?(e.percent=q.a.formatGrade(100*(null!==(i=this.attempt.sumgrades)&&void 0!==i?i:0)/(null!==(o=this.quiz.sumgrades)&&void 0!==o?o:1),this.quiz.decimalpoints),this.readableGrade=A.I.instant("addon.mod_quiz.outofpercent",{$a:e})):this.readableGrade=A.I.instant("addon.mod_quiz.outof",{$a:e})}this.additionalData.forEach((t=>{t.content=P.a.removeElementFromHtml(t.content,".helptooltip")}))}switchMode(){return Object(g.a)(this,void 0,void 0,(function*(){this.showAll=!this.showAll,yield this.loadPage(this.showAll?-1:0),this.performLogView(!1,{showAllDisabled:!this.showAll})}))}openNavigation(){var t;return Object(g.a)(this,void 0,void 0,(function*(){const e=yield P.a.openSideModal({component:N.a,componentProps:{navigation:this.navigation,summaryShown:!1,currentPage:null===(t=this.attempt)||void 0===t?void 0:t.currentpage,isReview:!0}});e&&this.changePage(e.page,e.slot)}))}performLogView(t=!1,e={}){return Object(g.a)(this,void 0,void 0,(function*(){if(!this.quiz)return;t&&(yield b.a.ignoreErrors(q.a.logViewAttemptReview(this.attemptId,this.quiz.id)));let i=`/mod/quiz/review.php?attempt=${this.attemptId}&cmid=${this.cmId}`;e.showAllDisabled?i+="&showall=0":e.page&&e.page>0&&(i+=`&page=${e.page}`),B.a.logEvent({type:B.b.VIEW_ITEM,ws:"mod_quiz_view_attempt_review",name:this.quiz.name,data:{id:this.attemptId,quizid:this.quiz.id,page:e.page,category:"quiz"},url:i})}))}}return AddonModQuizReviewPage.ɵfac=function AddonModQuizReviewPage_Factory(t){return new(t||AddonModQuizReviewPage)(r.yc(r.r))},AddonModQuizReviewPage.ɵcmp=r.sc({type:AddonModQuizReviewPage,selectors:[["page-addon-mod-quiz-review"]],viewQuery:function AddonModQuizReviewPage_Query(t,e){var i;(1&t&&r.ud(s.v,!0),2&t)&&(r.dd(i=r.Nc())&&(e.content=i.first))},decls:19,vars:15,consts:[["slot","start"],[3,"text"],["slot","end"],["fill","clear","aria-haspopup","true",3,"click",4,"ngIf"],[1,"limited-width"],["slot","fixed",3,"disabled","ionRefresh"],[3,"pullingText"],[3,"hideUntil"],[4,"ngIf"],["collapsible-footer","","appearOnBottom","","slot","fixed",4,"ngIf"],["fill","clear","aria-haspopup","true",3,"click"],["name","fas-bookmark","slot","icon-only","aria-hidden","true"],[1,"ion-text-wrap"],[1,"item-heading"],["class","ion-text-wrap",4,"ngIf"],["class","ion-text-wrap",4,"ngFor","ngForOf"],["contextLevel","module",3,"component","componentId","text","contextInstanceId","courseId"],[4,"ngFor","ngForOf"],[3,"id"],["class","ion-text-wrap ion-margin-horizontal addon-mod_quiz-question-note","slot","end",4,"ngIf"],["contextLevel","module",1,"ion-text-wrap",3,"question","component","componentId","attemptId","usageId","offlineEnabled","contextInstanceId","courseId","review","preferredBehaviour"],["slot","end",1,"ion-text-wrap","ion-margin-horizontal","addon-mod_quiz-question-note"],[3,"innerHTML",4,"ngIf"],[3,"innerHTML"],["collapsible-footer","","appearOnBottom","","slot","fixed"],[1,"ion-justify-content-between","ion-align-items-center","ion-no-padding","ion-wrap"],["class","ion-text-start ion-no-padding core-navigation-arrow","size","auto",4,"ngIf"],[1,"ion-text-center"],["class","ion-text-wrap","fill","outline",3,"click",4,"ngIf"],["class","ion-text-end ion-no-padding core-navigation-arrow","size","auto",4,"ngIf"],["size","auto",1,"ion-text-start","ion-no-padding","core-navigation-arrow"],["fill","clear",3,"disabled","click"],["name","fas-chevron-left","slot","icon-only","aria-hidden","true"],["fill","outline",1,"ion-text-wrap",3,"click"],["size","auto",1,"ion-text-end","ion-no-padding","core-navigation-arrow"],["name","fas-chevron-right","slot","icon-only","aria-hidden","true"]],template:function AddonModQuizReviewPage_Template(t,e){1&t&&(r.Ec(0,"ion-header"),r.Ec(1,"ion-toolbar"),r.Ec(2,"ion-buttons",0),r.zc(3,"ion-back-button",1),r.Pc(4,"translate"),r.Dc(),r.Ec(5,"ion-title"),r.Ec(6,"h1"),r.pd(7),r.Pc(8,"translate"),r.Dc(),r.Dc(),r.Ec(9,"ion-buttons",2),r.nd(10,AddonModQuizReviewPage_ion_button_10_Template,3,3,"ion-button",3),r.Dc(),r.Dc(),r.Dc(),r.Ec(11,"ion-content",4),r.Ec(12,"ion-refresher",5),r.Mc("ionRefresh",(function AddonModQuizReviewPage_Template_ion_refresher_ionRefresh_12_listener(t){return e.refreshData(t.target)})),r.zc(13,"ion-refresher-content",6),r.Pc(14,"translate"),r.Dc(),r.Ec(15,"core-loading",7),r.nd(16,AddonModQuizReviewPage_ion_card_16_Template,23,16,"ion-card",8),r.nd(17,AddonModQuizReviewPage_div_17_Template,2,1,"div",8),r.nd(18,AddonModQuizReviewPage_div_18_Template,6,3,"div",9),r.Dc(),r.Dc()),2&t&&(r.lc(3),r.Vc("text",r.Qc(4,9,"core.back")),r.lc(4),r.qd(r.Qc(8,11,"addon.mod_quiz.review")),r.lc(3),r.Vc("ngIf",e.navigation.length),r.lc(2),r.Vc("disabled",!e.loaded),r.lc(1),r.Wc("pullingText",r.Qc(14,13,"core.pulltorefresh")),r.lc(2),r.Vc("hideUntil",e.loaded),r.lc(1),r.Vc("ngIf",e.attempt),r.lc(1),r.Vc("ngIf",e.attempt&&e.questions.length),r.lc(1),r.Vc("ngIf",e.loaded&&e.numPages>1))},directives:[s.C,s.Ab,s.m,s.h,s.i,s.yb,M.t,m.a,s.v,s.bb,s.cb,y.a,Q.a,s.l,s.D,E.a,s.n,s.P,s.I,s.O,M.s,u.a,s.J,O.a,I.a,s.hb,s.u],pipes:[_.d,tt.a],styles:["[_nghost-%COMP%]   .addon-mod_quiz-question-note[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{margin-top:2px;margin-bottom:2px}"]}),AddonModQuizReviewPage})();const it=[{path:":courseId/:cmId",component:h},{path:":courseId/:cmId/player",component:Y,canDeactivate:[Z.a]},{path:":courseId/:cmId/attempt/:attemptId",component:T},{path:":courseId/:cmId/review/:attemptId",component:et}];let ot=(()=>{class AddonModQuizLazyModule{}return AddonModQuizLazyModule.ɵmod=r.wc({type:AddonModQuizLazyModule}),AddonModQuizLazyModule.ɵinj=r.vc({factory:function AddonModQuizLazyModule_Factory(t){return new(t||AddonModQuizLazyModule)},imports:[[o.m.forChild(it),n.a,a.a,D.a]]}),AddonModQuizLazyModule})();void(("undefined"==typeof ngJitMode||ngJitMode)&&r.kd(ot,{declarations:[h,T,Y,et],imports:[o.m,n.a,a.a,D.a]}))}}]);