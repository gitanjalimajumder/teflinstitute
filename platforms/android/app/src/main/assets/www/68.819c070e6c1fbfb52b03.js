(window.webpackJsonp=window.webpackJsonp||[]).push([[68],{EyWp:function(e,t,s){"use strict";s.r(t),s.d(t,"AddonModWorkshopOfflineProvider",(function(){return b})),s.d(t,"AddonModWorkshopOffline",(function(){return g}));var i=s("mrSG"),o=s("EmGO"),n=s("9+EE"),d=s("vuGA"),r=s("Q98t"),a=s("j3ag"),c=s("qgEA"),u=s("jtJJ"),l=s("fXoL");let b=(()=>{class AddonModWorkshopOfflineProvider{getAllWorkshops(e){return Object(i.a)(this,void 0,void 0,(function*(){const t=yield Promise.all([this.getAllSubmissions(e),this.getAllAssessments(e),this.getAllEvaluateSubmissions(e),this.getAllEvaluateAssessments(e)]),s={};return t.forEach((e=>{e.forEach((e=>{s[e.workshopid]=e.workshopid}))})),Object.values(s)}))}hasWorkshopOfflineData(e,t){return Object(i.a)(this,void 0,void 0,(function*(){try{return(yield Promise.all([this.getSubmissions(e,t),this.getAssessments(e,t),this.getEvaluateSubmissions(e,t),this.getEvaluateAssessments(e,t)])).some((e=>e&&e.length))}catch(e){return!1}}))}deleteSubmissionAction(e,t,s){return Object(i.a)(this,void 0,void 0,(function*(){const i=yield n.b.getSite(s),o={workshopid:e,action:t};yield i.getDb().deleteRecords(u.e,o)}))}deleteAllSubmissionActions(e,t){return Object(i.a)(this,void 0,void 0,(function*(){const s=yield n.b.getSite(t),i={workshopid:e};yield s.getDb().deleteRecords(u.e,i)}))}getAllSubmissions(e){return Object(i.a)(this,void 0,void 0,(function*(){const t=yield n.b.getSite(e);return(yield t.getDb().getRecords(u.e)).map((e=>this.parseSubmissionRecord(e)))}))}getSubmissions(e,t){return Object(i.a)(this,void 0,void 0,(function*(){const s=yield n.b.getSite(t),i={workshopid:e};return(yield s.getDb().getRecords(u.e,i)).map((e=>this.parseSubmissionRecord(e)))}))}getSubmissionAction(e,t,s){return Object(i.a)(this,void 0,void 0,(function*(){const i=yield n.b.getSite(s),o={workshopid:e,action:t},d=yield i.getDb().getRecord(u.e,o);return this.parseSubmissionRecord(d)}))}saveSubmission(e,t,s,o,d,a=0,c,l){return Object(i.a)(this,void 0,void 0,(function*(){const i=yield n.b.getSite(l),b=r.a.timestamp(),g={workshopid:e,courseid:t,title:s,content:o,attachmentsid:JSON.stringify(d),action:c,submissionid:a,timemodified:b};yield i.getDb().insertRecord(u.e,g)}))}parseSubmissionRecord(e){return Object.assign(Object.assign({},e),{attachmentsid:d.b.parseJSON(e.attachmentsid)})}deleteAssessment(e,t,s){return Object(i.a)(this,void 0,void 0,(function*(){const i=yield n.b.getSite(s),o={workshopid:e,assessmentid:t};yield i.getDb().deleteRecords(u.b,o)}))}getAllAssessments(e){return Object(i.a)(this,void 0,void 0,(function*(){const t=yield n.b.getSite(e);return(yield t.getDb().getRecords(u.b)).map((e=>this.parseAssessmentRecord(e)))}))}getAssessments(e,t){return Object(i.a)(this,void 0,void 0,(function*(){const s=yield n.b.getSite(t),i={workshopid:e};return(yield s.getDb().getRecords(u.b,i)).map((e=>this.parseAssessmentRecord(e)))}))}getAssessment(e,t,s){return Object(i.a)(this,void 0,void 0,(function*(){const i=yield n.b.getSite(s),o={workshopid:e,assessmentid:t},d=yield i.getDb().getRecord(u.b,o);return this.parseAssessmentRecord(d)}))}saveAssessment(e,t,s,o,d){return Object(i.a)(this,void 0,void 0,(function*(){const i=yield n.b.getSite(d),a={workshopid:e,courseid:s,inputdata:JSON.stringify(o),assessmentid:t,timemodified:r.a.timestamp()};yield i.getDb().insertRecord(u.b,a)}))}parseAssessmentRecord(e){return Object.assign(Object.assign({},e),{inputdata:d.b.parseJSON(e.inputdata)})}deleteEvaluateSubmission(e,t,s){return Object(i.a)(this,void 0,void 0,(function*(){const i={workshopid:e,submissionid:t},o=yield n.b.getSite(s);yield o.getDb().deleteRecords(u.d,i)}))}getAllEvaluateSubmissions(e){return Object(i.a)(this,void 0,void 0,(function*(){const t=yield n.b.getSite(e);return(yield t.getDb().getRecords(u.d)).map((e=>this.parseEvaluateSubmissionRecord(e)))}))}getEvaluateSubmissions(e,t){return Object(i.a)(this,void 0,void 0,(function*(){const s=yield n.b.getSite(t),i={workshopid:e};return(yield s.getDb().getRecords(u.d,i)).map((e=>this.parseEvaluateSubmissionRecord(e)))}))}getEvaluateSubmission(e,t,s){return Object(i.a)(this,void 0,void 0,(function*(){const i=yield n.b.getSite(s),o={workshopid:e,submissionid:t},d=yield i.getDb().getRecord(u.d,o);return this.parseEvaluateSubmissionRecord(d)}))}saveEvaluateSubmission(e,t,s,o="",d,a,c){return Object(i.a)(this,void 0,void 0,(function*(){const i=yield n.b.getSite(c),l={workshopid:e,courseid:s,submissionid:t,timemodified:r.a.timestamp(),feedbacktext:o,published:Number(d),gradeover:JSON.stringify(a)};yield i.getDb().insertRecord(u.d,l)}))}parseEvaluateSubmissionRecord(e){return Object.assign(Object.assign({},e),{published:Boolean(e.published),gradeover:d.b.parseJSON(e.gradeover)})}deleteEvaluateAssessment(e,t,s){return Object(i.a)(this,void 0,void 0,(function*(){const i=yield n.b.getSite(s),o={workshopid:e,assessmentid:t};yield i.getDb().deleteRecords(u.c,o)}))}getAllEvaluateAssessments(e){return Object(i.a)(this,void 0,void 0,(function*(){const t=yield n.b.getSite(e);return(yield t.getDb().getRecords(u.c)).map((e=>this.parseEvaluateAssessmentRecord(e)))}))}getEvaluateAssessments(e,t){return Object(i.a)(this,void 0,void 0,(function*(){const s=yield n.b.getSite(t),i={workshopid:e};return(yield s.getDb().getRecords(u.c,i)).map((e=>this.parseEvaluateAssessmentRecord(e)))}))}getEvaluateAssessment(e,t,s){return Object(i.a)(this,void 0,void 0,(function*(){const i=yield n.b.getSite(s),o={workshopid:e,assessmentid:t},d=yield i.getDb().getRecord(u.c,o);return this.parseEvaluateAssessmentRecord(d)}))}saveEvaluateAssessment(e,t,s,o,d=0,a,c){return Object(i.a)(this,void 0,void 0,(function*(){const i=yield n.b.getSite(c),l={workshopid:e,courseid:s,assessmentid:t,timemodified:r.a.timestamp(),feedbacktext:o||"",weight:d,gradinggradeover:JSON.stringify(a)};yield i.getDb().insertRecord(u.c,l)}))}parseEvaluateAssessmentRecord(e){return Object.assign(Object.assign({},e),{gradinggradeover:d.b.parseJSON(e.gradinggradeover)})}getWorkshopFolder(e,t){return Object(i.a)(this,void 0,void 0,(function*(){const s=yield n.b.getSite(t),i=o.a.getSiteFolder(s.getId());return c.a.concatenatePaths(i,"offlineworkshop/"+e+"/")}))}getSubmissionFolder(e,t){return Object(i.a)(this,void 0,void 0,(function*(){const s=yield this.getWorkshopFolder(e,t);return c.a.concatenatePaths(s,"submission")}))}getAssessmentFolder(e,t,s){return Object(i.a)(this,void 0,void 0,(function*(){let i=yield this.getWorkshopFolder(e,s);return i+="assessment/",c.a.concatenatePaths(i,String(t))}))}}return AddonModWorkshopOfflineProvider.ɵfac=function AddonModWorkshopOfflineProvider_Factory(e){return new(e||AddonModWorkshopOfflineProvider)},AddonModWorkshopOfflineProvider.ɵprov=l.uc({token:AddonModWorkshopOfflineProvider,factory:AddonModWorkshopOfflineProvider.ɵfac,providedIn:"root"}),AddonModWorkshopOfflineProvider})();const g=Object(a.M)(b)}}]);