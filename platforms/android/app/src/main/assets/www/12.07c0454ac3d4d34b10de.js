(window.webpackJsonp=window.webpackJsonp||[]).push([[12],{"0w4i":function(o,e,s){"use strict";s.d(e,"a",(function(){return h}));var n=s("mrSG"),i=s("bFG1"),t=s("j3ag"),d=s("fXoL"),a=s("TEn/"),c=s("ACYt"),r=s("3CSS"),l=s("nt/U"),_=s("ofXK"),m=s("sYmb");function AddonModWorkshopPhaseInfoComponent_ng_container_12_p_5_Template(o,e){1&o&&(d.Ec(0,"p",7),d.pd(1),d.Pc(2,"translate"),d.Dc()),2&o&&(d.lc(1),d.rd(" ",d.Qc(2,1,"addon.mod_workshop.userplancurrentphase")," "))}function AddonModWorkshopPhaseInfoComponent_ng_container_12_ion_item_6_Template(o,e){if(1&o&&(d.Ec(0,"ion-item",8),d.zc(1,"ion-icon",9),d.Ec(2,"ion-label"),d.Ec(3,"p"),d.pd(4),d.Pc(5,"translate"),d.Dc(),d.Dc(),d.zc(6,"ion-icon",10),d.Dc()),2&o){const o=d.Oc().$implicit;d.Vc("href",o.switchUrl),d.lc(4),d.qd(d.Qc(5,2,"addon.mod_workshop.switchphase"+o.code))}}function AddonModWorkshopPhaseInfoComponent_ng_container_12_ion_item_7_ion_icon_1_Template(o,e){1&o&&(d.zc(0,"ion-icon",19),d.Pc(1,"translate")),2&o&&d.mc("aria-label",d.Qc(1,1,"addon.mod_workshop.tasktodo"))}function AddonModWorkshopPhaseInfoComponent_ng_container_12_ion_item_7_ion_icon_2_Template(o,e){1&o&&(d.zc(0,"ion-icon",20),d.Pc(1,"translate")),2&o&&d.mc("aria-label",d.Qc(1,1,"addon.mod_workshop.taskfail"))}function AddonModWorkshopPhaseInfoComponent_ng_container_12_ion_item_7_ion_icon_3_Template(o,e){1&o&&(d.zc(0,"ion-icon",21),d.Pc(1,"translate")),2&o&&d.mc("aria-label",d.Qc(1,1,"addon.mod_workshop.taskinfo"))}function AddonModWorkshopPhaseInfoComponent_ng_container_12_ion_item_7_ion_icon_4_Template(o,e){1&o&&(d.zc(0,"ion-icon",22),d.Pc(1,"translate")),2&o&&d.mc("aria-label",d.Qc(1,1,"addon.mod_workshop.taskdone"))}function AddonModWorkshopPhaseInfoComponent_ng_container_12_ion_item_7_p_8_Template(o,e){if(1&o&&d.zc(0,"p",23),2&o){const o=d.Oc().$implicit;d.Vc("innerHTML",o.details,d.gd)}}function AddonModWorkshopPhaseInfoComponent_ng_container_12_ion_item_7_ion_icon_9_Template(o,e){1&o&&d.zc(0,"ion-icon",10)}function AddonModWorkshopPhaseInfoComponent_ng_container_12_ion_item_7_Template(o,e){if(1&o){const o=d.Fc();d.Ec(0,"ion-item",11),d.Mc("click",(function AddonModWorkshopPhaseInfoComponent_ng_container_12_ion_item_7_Template_ion_item_click_0_listener(){d.fd(o);const s=e.$implicit;return d.Oc(2).runTask(s)})),d.nd(1,AddonModWorkshopPhaseInfoComponent_ng_container_12_ion_item_7_ion_icon_1_Template,2,3,"ion-icon",12),d.nd(2,AddonModWorkshopPhaseInfoComponent_ng_container_12_ion_item_7_ion_icon_2_Template,2,3,"ion-icon",13),d.nd(3,AddonModWorkshopPhaseInfoComponent_ng_container_12_ion_item_7_ion_icon_3_Template,2,3,"ion-icon",14),d.nd(4,AddonModWorkshopPhaseInfoComponent_ng_container_12_ion_item_7_ion_icon_4_Template,2,3,"ion-icon",15),d.Ec(5,"ion-label"),d.Ec(6,"p",16),d.pd(7),d.Dc(),d.nd(8,AddonModWorkshopPhaseInfoComponent_ng_container_12_ion_item_7_p_8_Template,1,1,"p",17),d.Dc(),d.nd(9,AddonModWorkshopPhaseInfoComponent_ng_container_12_ion_item_7_ion_icon_9_Template,1,0,"ion-icon",18),d.Dc()}if(2&o){const o=e.$implicit,s=d.Oc().$implicit,n=d.Oc();d.qc("item-dimmed",s.code!=n.workshopPhase||"submit"==o.code&&!n.showSubmit),d.lc(1),d.Vc("ngIf",null==o.completed),d.lc(1),d.Vc("ngIf",""==o.completed),d.lc(1),d.Vc("ngIf","info"==o.completed),d.lc(1),d.Vc("ngIf","1"==o.completed),d.lc(3),d.qd(o.title),d.lc(1),d.Vc("ngIf",o.details),d.lc(1),d.Vc("ngIf",o.link&&"submit"!=o.code)}}function AddonModWorkshopPhaseInfoComponent_ng_container_12_Template(o,e){if(1&o&&(d.Cc(0),d.Ec(1,"ion-item-divider"),d.Ec(2,"ion-label"),d.Ec(3,"h2"),d.pd(4),d.Dc(),d.nd(5,AddonModWorkshopPhaseInfoComponent_ng_container_12_p_5_Template,3,3,"p",4),d.Dc(),d.Dc(),d.nd(6,AddonModWorkshopPhaseInfoComponent_ng_container_12_ion_item_6_Template,7,4,"ion-item",5),d.nd(7,AddonModWorkshopPhaseInfoComponent_ng_container_12_ion_item_7_Template,10,9,"ion-item",6),d.Bc()),2&o){const o=e.$implicit,s=d.Oc();d.lc(1),d.mc("aria-current",s.workshopPhase==o.code?"page":"false"),d.lc(3),d.qd(o.title),d.lc(1),d.Vc("ngIf",s.workshopPhase==o.code),d.lc(1),d.Vc("ngIf",o.switchUrl),d.lc(1),d.Vc("ngForOf",o.tasks)}}let h=(()=>{class AddonModWorkshopPhaseInfoComponent{constructor(){this.showSubmit=!1}ngOnInit(){for(const o in this.phases){this.phases[o].tasks.forEach((o=>{o.link||"examples"!=o.code&&"prepareexamples"!=o.code||(o.link=this.externalUrl)}));const e=this.phases[o].actions.find((o=>o.url&&"switchphase"==o.type));this.phases[o].switchUrl=e?e.url:""}}closeModal(){t.w.dismiss()}runTask(o){return Object(n.a)(this,void 0,void 0,(function*(){"submit"==o.code?t.w.dismiss(!0):o.link&&i.a.openInBrowser(o.link)}))}}return AddonModWorkshopPhaseInfoComponent.ɵfac=function AddonModWorkshopPhaseInfoComponent_Factory(o){return new(o||AddonModWorkshopPhaseInfoComponent)},AddonModWorkshopPhaseInfoComponent.ɵcmp=d.sc({type:AddonModWorkshopPhaseInfoComponent,selectors:[["ng-component"]],inputs:{phases:"phases",workshopPhase:"workshopPhase",showSubmit:"showSubmit",externalUrl:"externalUrl"},decls:13,vars:7,consts:[["slot","end"],["fill","clear",3,"click"],["name","fas-xmark","slot","icon-only","aria-hidden","true"],[4,"ngFor","ngForOf"],["class","ion-text-wrap",4,"ngIf"],["class","ion-text-wrap","detail","false",3,"href",4,"ngIf"],["class","ion-text-wrap","detail","false","button","",3,"item-dimmed","click",4,"ngFor","ngForOf"],[1,"ion-text-wrap"],["detail","false",1,"ion-text-wrap",3,"href"],["slot","start","name","fas-right-left","aria-hidden","true"],["slot","end","name","fas-up-right-from-square","aria-hidden","true"],["detail","false","button","",1,"ion-text-wrap",3,"click"],["slot","start","name","far-circle",4,"ngIf"],["slot","start","name","fas-circle-xmark","color","danger",4,"ngIf"],["slot","start","name","fas-circle-info","color","info",4,"ngIf"],["slot","start","name","fas-circle-check","color","success",4,"ngIf"],[1,"item-heading","ion-text-wrap"],[3,"innerHTML",4,"ngIf"],["slot","end","name","fas-up-right-from-square","aria-hidden","true",4,"ngIf"],["slot","start","name","far-circle"],["slot","start","name","fas-circle-xmark","color","danger"],["slot","start","name","fas-circle-info","color","info"],["slot","start","name","fas-circle-check","color","success"],[3,"innerHTML"]],template:function AddonModWorkshopPhaseInfoComponent_Template(o,e){1&o&&(d.Ec(0,"ion-header"),d.Ec(1,"ion-toolbar"),d.Ec(2,"ion-title"),d.Ec(3,"h1"),d.pd(4),d.Pc(5,"translate"),d.Dc(),d.Dc(),d.Ec(6,"ion-buttons",0),d.Ec(7,"ion-button",1),d.Mc("click",(function AddonModWorkshopPhaseInfoComponent_Template_ion_button_click_7_listener(){return e.closeModal()})),d.Pc(8,"translate"),d.zc(9,"ion-icon",2),d.Dc(),d.Dc(),d.Dc(),d.Dc(),d.Ec(10,"ion-content"),d.Ec(11,"ion-list"),d.nd(12,AddonModWorkshopPhaseInfoComponent_ng_container_12_Template,8,5,"ng-container",3),d.Dc(),d.Dc()),2&o&&(d.lc(4),d.qd(d.Qc(5,3,"addon.mod_workshop.userplan")),d.lc(3),d.mc("aria-label",d.Qc(8,5,"core.close")),d.lc(5),d.Vc("ngForOf",e.phases))},directives:[a.C,a.Ab,a.yb,a.m,c.a,a.l,a.D,r.a,l.a,a.v,a.P,_.s,a.J,a.O,_.t,a.I],pipes:[m.d],encapsulation:2}),AddonModWorkshopPhaseInfoComponent})()},"20uA":function(o,e,s){"use strict";s.r(e),s.d(e,"AddonModWorkshopIndexComponent",(function(){return O}));var n=s("mrSG"),i=s("93ts"),t=s("Q2Ls"),d=s("mWdr"),a=s("pHTc"),c=s("r2Z7"),r=s("3LXp"),l=s("bFG1"),_=s("fjkH"),m=s("i1f9"),h=s("8/zp"),p=s("EyWp"),u=s("GuJL"),f=s("0w4i"),g=s("DJrq"),k=s("fXoL"),b=s("TEn/"),I=s("YUBR"),v=s("ACV2"),A=s("ACYt"),w=s("3CSS"),M=s("PgjG"),S=s("xDoo"),W=s("ofXK"),E=s("hMzs"),P=s("edOc"),C=s("Uzd6"),D=s("WPIK"),T=s("3jOR"),y=s("NkYY"),x=s("sYmb");function AddonModWorkshopIndexComponent_ion_card_6_ng_container_5_ion_item_1_ion_icon_1_Template(o,e){1&o&&(k.zc(0,"ion-icon",18),k.Pc(1,"translate")),2&o&&k.mc("aria-label",k.Qc(1,1,"addon.mod_workshop.tasktodo"))}function AddonModWorkshopIndexComponent_ion_card_6_ng_container_5_ion_item_1_ion_icon_2_Template(o,e){1&o&&(k.zc(0,"ion-icon",19),k.Pc(1,"translate")),2&o&&k.mc("aria-label",k.Qc(1,1,"addon.mod_workshop.taskfail"))}function AddonModWorkshopIndexComponent_ion_card_6_ng_container_5_ion_item_1_ion_icon_3_Template(o,e){1&o&&(k.zc(0,"ion-icon",20),k.Pc(1,"translate")),2&o&&k.mc("aria-label",k.Qc(1,1,"addon.mod_workshop.taskinfo"))}function AddonModWorkshopIndexComponent_ion_card_6_ng_container_5_ion_item_1_ion_icon_4_Template(o,e){1&o&&(k.zc(0,"ion-icon",21),k.Pc(1,"translate")),2&o&&k.mc("aria-label",k.Qc(1,1,"addon.mod_workshop.taskdone"))}function AddonModWorkshopIndexComponent_ion_card_6_ng_container_5_ion_item_1_p_8_Template(o,e){if(1&o&&k.zc(0,"p",22),2&o){const o=k.Oc().$implicit;k.Vc("innerHTML",o.details,k.gd)}}function AddonModWorkshopIndexComponent_ion_card_6_ng_container_5_ion_item_1_ion_icon_9_Template(o,e){1&o&&k.zc(0,"ion-icon",23)}function AddonModWorkshopIndexComponent_ion_card_6_ng_container_5_ion_item_1_Template(o,e){if(1&o){const o=k.Fc();k.Ec(0,"ion-item",10),k.Mc("click",(function AddonModWorkshopIndexComponent_ion_card_6_ng_container_5_ion_item_1_Template_ion_item_click_0_listener(){k.fd(o);const s=e.$implicit;return k.Oc(3).runTask(s)})),k.nd(1,AddonModWorkshopIndexComponent_ion_card_6_ng_container_5_ion_item_1_ion_icon_1_Template,2,3,"ion-icon",11),k.nd(2,AddonModWorkshopIndexComponent_ion_card_6_ng_container_5_ion_item_1_ion_icon_2_Template,2,3,"ion-icon",12),k.nd(3,AddonModWorkshopIndexComponent_ion_card_6_ng_container_5_ion_item_1_ion_icon_3_Template,2,3,"ion-icon",13),k.nd(4,AddonModWorkshopIndexComponent_ion_card_6_ng_container_5_ion_item_1_ion_icon_4_Template,2,3,"ion-icon",14),k.Ec(5,"ion-label"),k.Ec(6,"p",15),k.pd(7),k.Dc(),k.nd(8,AddonModWorkshopIndexComponent_ion_card_6_ng_container_5_ion_item_1_p_8_Template,1,1,"p",16),k.Dc(),k.nd(9,AddonModWorkshopIndexComponent_ion_card_6_ng_container_5_ion_item_1_ion_icon_9_Template,1,0,"ion-icon",17),k.Dc()}if(2&o){const o=e.$implicit,s=k.Oc(3);k.qc("item-dimmed","submit"==o.code&&!s.showSubmit),k.lc(1),k.Vc("ngIf",null==o.completed),k.lc(1),k.Vc("ngIf",""==o.completed),k.lc(1),k.Vc("ngIf","info"==o.completed),k.lc(1),k.Vc("ngIf","1"==o.completed),k.lc(3),k.qd(o.title),k.lc(1),k.Vc("ngIf",o.details),k.lc(1),k.Vc("ngIf",o.link&&"submit"!=o.code)}}function AddonModWorkshopIndexComponent_ion_card_6_ng_container_5_Template(o,e){if(1&o&&(k.Cc(0),k.nd(1,AddonModWorkshopIndexComponent_ion_card_6_ng_container_5_ion_item_1_Template,10,9,"ion-item",9),k.Bc()),2&o){const o=k.Oc(2);k.lc(1),k.Vc("ngForOf",o.phases[o.workshop.phase].tasks)}}function AddonModWorkshopIndexComponent_ion_card_6_Template(o,e){if(1&o){const o=k.Fc();k.Ec(0,"ion-card"),k.Ec(1,"ion-item",7),k.Mc("click",(function AddonModWorkshopIndexComponent_ion_card_6_Template_ion_item_click_1_listener(){k.fd(o);return k.Oc().viewPhaseInfo()})),k.Ec(2,"ion-label"),k.Ec(3,"h2",8),k.pd(4),k.Dc(),k.Dc(),k.Dc(),k.nd(5,AddonModWorkshopIndexComponent_ion_card_6_ng_container_5_Template,2,1,"ng-container",5),k.Dc()}if(2&o){const o=k.Oc();k.lc(4),k.qd(o.phases[o.workshop.phase].title),k.lc(1),k.Vc("ngIf",o.phases&&o.phases[o.workshop.phase]&&o.phases[o.workshop.phase].tasks&&o.phases[o.workshop.phase].tasks.length)}}function AddonModWorkshopIndexComponent_ion_card_7_Template(o,e){if(1&o&&(k.Ec(0,"ion-card"),k.Ec(1,"ion-item",8),k.Ec(2,"ion-label"),k.Ec(3,"h3",15),k.pd(4),k.Pc(5,"translate"),k.Dc(),k.zc(6,"core-format-text",24),k.Dc(),k.Dc(),k.Dc()),2&o){const o=k.Oc();k.lc(4),k.qd(k.Qc(5,6,"core.description")),k.lc(2),k.Vc("text",o.description)("component",o.component)("componentId",o.componentId)("contextInstanceId",o.module.id)("courseId",o.courseId)}}function AddonModWorkshopIndexComponent_div_8_ng_container_1_ion_card_1_Template(o,e){if(1&o&&(k.Ec(0,"ion-card"),k.Ec(1,"ion-item",8),k.Ec(2,"ion-label"),k.Ec(3,"h3",15),k.pd(4),k.Pc(5,"translate"),k.Dc(),k.zc(6,"core-format-text",25),k.Dc(),k.Dc(),k.Dc()),2&o){const o=k.Oc(3);k.lc(4),k.qd(k.Qc(5,6,"addon.mod_workshop.conclusion")),k.lc(2),k.Vc("component",o.component)("componentId",o.module.id)("text",o.workshop.conclusion)("contextInstanceId",o.module.id)("courseId",o.courseId)}}function AddonModWorkshopIndexComponent_div_8_ng_container_1_ion_card_2_ion_item_6_Template(o,e){if(1&o&&(k.Ec(0,"ion-item",8),k.Ec(1,"ion-label"),k.Ec(2,"p",15),k.pd(3),k.Pc(4,"translate"),k.Dc(),k.Ec(5,"p"),k.pd(6),k.Dc(),k.Dc(),k.Dc()),2&o){const o=k.Oc(4);k.lc(3),k.qd(k.Qc(4,2,"addon.mod_workshop.submissiongrade")),k.lc(3),k.qd(o.userGrades.submissionlongstrgrade)}}function AddonModWorkshopIndexComponent_div_8_ng_container_1_ion_card_2_ion_item_7_Template(o,e){if(1&o&&(k.Ec(0,"ion-item",8),k.Ec(1,"ion-label"),k.Ec(2,"p",15),k.pd(3),k.Pc(4,"translate"),k.Dc(),k.Ec(5,"p"),k.pd(6),k.Dc(),k.Dc(),k.Dc()),2&o){const o=k.Oc(4);k.lc(3),k.qd(k.Qc(4,2,"addon.mod_workshop.gradinggrade")),k.lc(3),k.qd(o.userGrades.assessmentlongstrgrade)}}function AddonModWorkshopIndexComponent_div_8_ng_container_1_ion_card_2_Template(o,e){if(1&o&&(k.Ec(0,"ion-card"),k.Ec(1,"ion-item-divider",8),k.Ec(2,"ion-label"),k.Ec(3,"h3",15),k.pd(4),k.Pc(5,"translate"),k.Dc(),k.Dc(),k.Dc(),k.nd(6,AddonModWorkshopIndexComponent_div_8_ng_container_1_ion_card_2_ion_item_6_Template,7,4,"ion-item",26),k.nd(7,AddonModWorkshopIndexComponent_div_8_ng_container_1_ion_card_2_ion_item_7_Template,7,4,"ion-item",26),k.Dc()),2&o){const o=k.Oc(3);k.lc(4),k.qd(k.Qc(5,3,"addon.mod_workshop.yourgrades")),k.lc(2),k.Vc("ngIf",o.userGrades.submissionlongstrgrade),k.lc(1),k.Vc("ngIf",o.userGrades.assessmentlongstrgrade)}}function AddonModWorkshopIndexComponent_div_8_ng_container_1_Template(o,e){if(1&o&&(k.Cc(0),k.nd(1,AddonModWorkshopIndexComponent_div_8_ng_container_1_ion_card_1_Template,7,8,"ion-card",5),k.nd(2,AddonModWorkshopIndexComponent_div_8_ng_container_1_ion_card_2_Template,8,5,"ion-card",5),k.Bc()),2&o){const o=k.Oc(2);k.lc(1),k.Vc("ngIf",o.workshop.conclusion),k.lc(1),k.Vc("ngIf",o.userGrades)}}function AddonModWorkshopIndexComponent_div_8_ion_card_2_Template(o,e){if(1&o&&(k.Ec(0,"ion-card"),k.Ec(1,"ion-item",8),k.Ec(2,"ion-label"),k.Ec(3,"h3",15),k.pd(4),k.Pc(5,"translate"),k.Dc(),k.zc(6,"core-format-text",25),k.Dc(),k.Dc(),k.Dc()),2&o){const o=k.Oc(2);k.lc(4),k.qd(k.Qc(5,6,"addon.mod_workshop.areainstructauthors")),k.lc(2),k.Vc("component",o.component)("componentId",o.module.id)("text",o.workshop.instructauthors)("contextInstanceId",o.module.id)("courseId",o.courseId)}}function AddonModWorkshopIndexComponent_div_8_ion_card_3_h3_3_Template(o,e){1&o&&(k.Ec(0,"h3",15),k.pd(1),k.Pc(2,"translate"),k.Dc()),2&o&&(k.lc(1),k.rd(" ",k.Qc(2,1,"addon.mod_workshop.yoursubmission")," "))}function AddonModWorkshopIndexComponent_div_8_ion_card_3_h3_4_Template(o,e){1&o&&(k.Ec(0,"h3",15),k.pd(1),k.Pc(2,"translate"),k.Dc()),2&o&&(k.lc(1),k.rd(" ",k.Qc(2,1,"addon.mod_workshop.yoursubmissionwithassessments")," "))}function AddonModWorkshopIndexComponent_div_8_ion_card_3_ion_item_5_p_2_Template(o,e){1&o&&(k.Ec(0,"p"),k.pd(1),k.Pc(2,"translate"),k.Dc()),2&o&&(k.lc(1),k.qd(k.Qc(2,1,"addon.mod_workshop.noyoursubmission")))}function AddonModWorkshopIndexComponent_div_8_ion_card_3_ion_item_5_Template(o,e){if(1&o&&(k.Ec(0,"ion-item",8),k.Ec(1,"ion-label"),k.nd(2,AddonModWorkshopIndexComponent_div_8_ion_card_3_ion_item_5_p_2_Template,3,3,"p",5),k.Dc(),k.Dc()),2&o){const o=k.Oc(3);k.lc(2),k.Vc("ngIf",!o.submission)}}function AddonModWorkshopIndexComponent_div_8_ion_card_3_addon_mod_workshop_submission_6_Template(o,e){if(1&o&&k.zc(0,"addon-mod-workshop-submission",29),2&o){const o=k.Oc(3);k.Vc("submission",o.submission)("courseId",o.workshop.course)("module",o.module)("workshop",o.workshop)("access",o.access)}}function AddonModWorkshopIndexComponent_div_8_ion_card_3_Template(o,e){if(1&o&&(k.Ec(0,"ion-card"),k.Ec(1,"ion-item-divider",8),k.Ec(2,"ion-label"),k.nd(3,AddonModWorkshopIndexComponent_div_8_ion_card_3_h3_3_Template,3,3,"h3",27),k.nd(4,AddonModWorkshopIndexComponent_div_8_ion_card_3_h3_4_Template,3,3,"h3",27),k.Dc(),k.Dc(),k.nd(5,AddonModWorkshopIndexComponent_div_8_ion_card_3_ion_item_5_Template,3,1,"ion-item",26),k.nd(6,AddonModWorkshopIndexComponent_div_8_ion_card_3_addon_mod_workshop_submission_6_Template,1,5,"addon-mod-workshop-submission",28),k.Dc()),2&o){const o=k.Oc(2);k.lc(3),k.Vc("ngIf",o.workshop.phase!=o.PHASE_CLOSED||!o.submission),k.lc(1),k.Vc("ngIf",o.workshop.phase==o.PHASE_CLOSED&&o.submission),k.lc(1),k.Vc("ngIf",!o.submission),k.lc(1),k.Vc("ngIf",o.submission)}}function AddonModWorkshopIndexComponent_div_8_ng_container_4_ion_card_1_ng_container_6_Template(o,e){if(1&o&&(k.Cc(0),k.zc(1,"addon-mod-workshop-submission",31),k.Bc()),2&o){const o=e.$implicit,s=k.Oc(4);k.lc(1),k.Vc("submission",o)("courseId",s.workshop.course)("module",s.module)("workshop",s.workshop)("access",s.access)}}function AddonModWorkshopIndexComponent_div_8_ng_container_4_ion_card_1_Template(o,e){if(1&o&&(k.Ec(0,"ion-card"),k.Ec(1,"ion-item-divider",8),k.Ec(2,"ion-label"),k.Ec(3,"h3",15),k.pd(4),k.Pc(5,"translate"),k.Dc(),k.Dc(),k.Dc(),k.nd(6,AddonModWorkshopIndexComponent_div_8_ng_container_4_ion_card_1_ng_container_6_Template,2,5,"ng-container",30),k.Dc()),2&o){const o=k.Oc(3);k.lc(4),k.qd(k.Qc(5,2,"addon.mod_workshop.publishedsubmissions")),k.lc(2),k.Vc("ngForOf",o.publishedSubmissions)}}function AddonModWorkshopIndexComponent_div_8_ng_container_4_Template(o,e){if(1&o&&(k.Cc(0),k.nd(1,AddonModWorkshopIndexComponent_div_8_ng_container_4_ion_card_1_Template,7,4,"ion-card",5),k.Bc()),2&o){const o=k.Oc(2);k.lc(1),k.Vc("ngIf",o.publishedSubmissions&&o.publishedSubmissions.length)}}function AddonModWorkshopIndexComponent_div_8_ng_container_5_ion_card_1_Template(o,e){if(1&o&&(k.Ec(0,"ion-card"),k.Ec(1,"ion-item",8),k.Ec(2,"ion-label"),k.Ec(3,"h3",15),k.pd(4),k.Pc(5,"translate"),k.Dc(),k.zc(6,"core-format-text",25),k.Dc(),k.Dc(),k.Dc()),2&o){const o=k.Oc(3);k.lc(4),k.qd(k.Qc(5,6,"addon.mod_workshop.areainstructreviewers")),k.lc(2),k.Vc("component",o.component)("componentId",o.module.id)("text",o.workshop.instructreviewers)("contextInstanceId",o.module.id)("courseId",o.courseId)}}function AddonModWorkshopIndexComponent_div_8_ng_container_5_ion_card_2_ion_item_6_Template(o,e){1&o&&(k.Ec(0,"ion-item",8),k.Ec(1,"ion-label"),k.Ec(2,"p"),k.pd(3),k.Pc(4,"translate"),k.Dc(),k.Dc(),k.Dc()),2&o&&(k.lc(3),k.qd(k.Qc(4,1,"addon.mod_workshop.assignedassessmentsnone")))}function AddonModWorkshopIndexComponent_div_8_ng_container_5_ion_card_2_ng_container_7_Template(o,e){if(1&o&&(k.Cc(0),k.zc(1,"addon-mod-workshop-submission",32),k.Bc()),2&o){const o=e.$implicit,s=k.Oc(4);k.lc(1),k.Vc("submission",o.submission)("assessment",o)("courseId",s.workshop.course)("module",s.module)("workshop",s.workshop)("access",s.access)}}const _c0=function(){return[]};function AddonModWorkshopIndexComponent_div_8_ng_container_5_ion_card_2_Template(o,e){if(1&o&&(k.Ec(0,"ion-card"),k.Ec(1,"ion-item-divider",8),k.Ec(2,"ion-label"),k.Ec(3,"h3",15),k.pd(4),k.Pc(5,"translate"),k.Dc(),k.Dc(),k.Dc(),k.nd(6,AddonModWorkshopIndexComponent_div_8_ng_container_5_ion_card_2_ion_item_6_Template,5,3,"ion-item",26),k.nd(7,AddonModWorkshopIndexComponent_div_8_ng_container_5_ion_card_2_ng_container_7_Template,2,6,"ng-container",30),k.Dc()),2&o){const o=k.Oc(3);k.lc(4),k.qd(k.Qc(5,3,"addon.mod_workshop.assignedassessments")),k.lc(2),k.Vc("ngIf",!o.assessments||!o.assessments.length),k.lc(1),k.Vc("ngForOf",o.assessments||k.Zc(5,_c0))}}function AddonModWorkshopIndexComponent_div_8_ng_container_5_Template(o,e){if(1&o&&(k.Cc(0),k.nd(1,AddonModWorkshopIndexComponent_div_8_ng_container_5_ion_card_1_Template,7,8,"ion-card",5),k.nd(2,AddonModWorkshopIndexComponent_div_8_ng_container_5_ion_card_2_Template,8,6,"ion-card",5),k.Bc()),2&o){const o=k.Oc(2);k.lc(1),k.Vc("ngIf",o.workshop.phase==o.PHASE_ASSESSMENT&&o.workshop.instructreviewers),k.lc(1),k.Vc("ngIf",o.canAssess)}}function AddonModWorkshopIndexComponent_div_8_ion_card_6_h3_3_Template(o,e){1&o&&(k.Ec(0,"h3",15),k.pd(1),k.Pc(2,"translate"),k.Dc()),2&o&&(k.lc(1),k.qd(k.Qc(2,1,"addon.mod_workshop.submissionsreport")))}function AddonModWorkshopIndexComponent_div_8_ion_card_6_h3_4_Template(o,e){1&o&&(k.Ec(0,"h3",15),k.pd(1),k.Pc(2,"translate"),k.Dc()),2&o&&(k.lc(1),k.rd("",k.Qc(2,1,"addon.mod_workshop.gradesreport")," "))}function AddonModWorkshopIndexComponent_div_8_ion_card_6_ng_container_6_Template(o,e){if(1&o&&(k.Cc(0),k.zc(1,"addon-mod-workshop-submission",31),k.Bc()),2&o){const o=e.$implicit,s=k.Oc(3);k.lc(1),k.Vc("submission",o)("courseId",s.workshop.course)("module",s.module)("workshop",s.workshop)("access",s.access)}}function AddonModWorkshopIndexComponent_div_8_ion_card_6_ion_grid_7_ion_col_2_Template(o,e){if(1&o){const o=k.Fc();k.Ec(0,"ion-col"),k.Ec(1,"ion-button",35),k.Mc("click",(function AddonModWorkshopIndexComponent_div_8_ion_card_6_ion_grid_7_ion_col_2_Template_ion_button_click_1_listener(){k.fd(o);const e=k.Oc(4);return e.gotoSubmissionsPage(e.page-1)})),k.zc(2,"ion-icon",36),k.pd(3),k.Pc(4,"translate"),k.Dc(),k.Dc()}2&o&&(k.lc(3),k.rd(" ",k.Qc(4,1,"core.previous")," "))}function AddonModWorkshopIndexComponent_div_8_ion_card_6_ion_grid_7_ion_col_3_Template(o,e){if(1&o){const o=k.Fc();k.Ec(0,"ion-col"),k.Ec(1,"ion-button",37),k.Mc("click",(function AddonModWorkshopIndexComponent_div_8_ion_card_6_ion_grid_7_ion_col_3_Template_ion_button_click_1_listener(){k.fd(o);const e=k.Oc(4);return e.gotoSubmissionsPage(e.page+1)})),k.pd(2),k.Pc(3,"translate"),k.zc(4,"ion-icon",38),k.Dc(),k.Dc()}2&o&&(k.lc(2),k.rd(" ",k.Qc(3,1,"core.next")," "))}function AddonModWorkshopIndexComponent_div_8_ion_card_6_ion_grid_7_Template(o,e){if(1&o&&(k.Ec(0,"ion-grid"),k.Ec(1,"ion-row",34),k.nd(2,AddonModWorkshopIndexComponent_div_8_ion_card_6_ion_grid_7_ion_col_2_Template,5,3,"ion-col",5),k.nd(3,AddonModWorkshopIndexComponent_div_8_ion_card_6_ion_grid_7_ion_col_3_Template,5,3,"ion-col",5),k.Dc(),k.Dc()),2&o){const o=k.Oc(3);k.lc(2),k.Vc("ngIf",o.page>0),k.lc(1),k.Vc("ngIf",o.hasNextPage)}}function AddonModWorkshopIndexComponent_div_8_ion_card_6_Template(o,e){if(1&o){const o=k.Fc();k.Ec(0,"ion-card"),k.Ec(1,"ion-item-divider",8),k.Ec(2,"ion-label"),k.nd(3,AddonModWorkshopIndexComponent_div_8_ion_card_6_h3_3_Template,3,3,"h3",27),k.nd(4,AddonModWorkshopIndexComponent_div_8_ion_card_6_h3_4_Template,3,3,"h3",27),k.Dc(),k.Dc(),k.Ec(5,"core-group-selector",33),k.Mc("selectedChange",(function AddonModWorkshopIndexComponent_div_8_ion_card_6_Template_core_group_selector_selectedChange_5_listener(e){k.fd(o);return k.Oc(2).group=e}))("selectedChange",(function AddonModWorkshopIndexComponent_div_8_ion_card_6_Template_core_group_selector_selectedChange_5_listener(){k.fd(o);const e=k.Oc(2);return e.setGroup(e.group)})),k.Dc(),k.nd(6,AddonModWorkshopIndexComponent_div_8_ion_card_6_ng_container_6_Template,2,5,"ng-container",30),k.nd(7,AddonModWorkshopIndexComponent_div_8_ion_card_6_ion_grid_7_Template,4,2,"ion-grid",5),k.Dc()}if(2&o){const o=k.Oc(2);k.lc(3),k.Vc("ngIf",o.workshop.phase==o.PHASE_SUBMISSION),k.lc(1),k.Vc("ngIf",o.workshop.phase>o.PHASE_SUBMISSION),k.lc(1),k.Vc("groupInfo",o.groupInfo)("selected",o.group)("courseId",o.courseId),k.lc(1),k.Vc("ngForOf",o.grades),k.lc(1),k.Vc("ngIf",o.page>0||o.hasNextPage)}}function AddonModWorkshopIndexComponent_div_8_Template(o,e){if(1&o&&(k.Ec(0,"div"),k.nd(1,AddonModWorkshopIndexComponent_div_8_ng_container_1_Template,3,2,"ng-container",5),k.nd(2,AddonModWorkshopIndexComponent_div_8_ion_card_2_Template,7,8,"ion-card",5),k.nd(3,AddonModWorkshopIndexComponent_div_8_ion_card_3_Template,7,4,"ion-card",5),k.nd(4,AddonModWorkshopIndexComponent_div_8_ng_container_4_Template,2,1,"ng-container",5),k.nd(5,AddonModWorkshopIndexComponent_div_8_ng_container_5_Template,3,2,"ng-container",5),k.nd(6,AddonModWorkshopIndexComponent_div_8_ion_card_6_Template,8,7,"ion-card",5),k.Dc()),2&o){const o=k.Oc();k.lc(1),k.Vc("ngIf",o.workshop.phase>=o.PHASE_CLOSED),k.lc(1),k.Vc("ngIf",o.workshop.phase==o.PHASE_SUBMISSION&&o.workshop.instructauthors),k.lc(1),k.Vc("ngIf",o.canSubmit),k.lc(1),k.Vc("ngIf",o.workshop.phase>=o.PHASE_CLOSED),k.lc(1),k.Vc("ngIf",o.workshop.phase>=o.PHASE_ASSESSMENT),k.lc(1),k.Vc("ngIf",o.access.canviewallsubmissions&&o.workshop.phase>=o.PHASE_SUBMISSION&&(o.grades&&o.grades.length||o.groupInfo&&(o.groupInfo.separateGroups||o.groupInfo.visibleGroups)))}}function AddonModWorkshopIndexComponent_div_9_div_1_ion_button_1_Template(o,e){if(1&o){const o=k.Fc();k.Ec(0,"ion-button",44),k.Mc("click",(function AddonModWorkshopIndexComponent_div_9_div_1_ion_button_1_Template_ion_button_click_0_listener(){k.fd(o);return k.Oc(3).gotoSubmit()})),k.zc(1,"ion-icon",45),k.pd(2),k.Pc(3,"translate"),k.Dc()}2&o&&(k.lc(2),k.rd(" ",k.Qc(3,1,"addon.mod_workshop.createsubmission")," "))}function AddonModWorkshopIndexComponent_div_9_div_1_ion_button_2_Template(o,e){if(1&o){const o=k.Fc();k.Ec(0,"ion-button",44),k.Mc("click",(function AddonModWorkshopIndexComponent_div_9_div_1_ion_button_2_Template_ion_button_click_0_listener(){k.fd(o);return k.Oc(3).gotoSubmit()})),k.zc(1,"ion-icon",46),k.pd(2),k.Pc(3,"translate"),k.Dc()}2&o&&(k.lc(2),k.rd(" ",k.Qc(3,1,"addon.mod_workshop.editsubmission")," "))}function AddonModWorkshopIndexComponent_div_9_div_1_Template(o,e){if(1&o&&(k.Ec(0,"div",42),k.nd(1,AddonModWorkshopIndexComponent_div_9_div_1_ion_button_1_Template,4,3,"ion-button",43),k.nd(2,AddonModWorkshopIndexComponent_div_9_div_1_ion_button_2_Template,4,3,"ion-button",43),k.Dc()),2&o){const o=k.Oc(2);k.lc(1),k.Vc("ngIf",o.access.creatingsubmissionallowed&&!o.submission),k.lc(1),k.Vc("ngIf",o.access.modifyingsubmissionallowed&&o.submission)}}function AddonModWorkshopIndexComponent_div_9_Template(o,e){if(1&o&&(k.Ec(0,"div",39),k.nd(1,AddonModWorkshopIndexComponent_div_9_div_1_Template,3,2,"div",40),k.zc(2,"core-course-module-navigation",41),k.Dc()),2&o){const o=k.Oc();k.lc(1),k.Vc("ngIf",o.access&&(null==o.workshop?null:o.workshop.phase)>=o.PHASE_SUBMISSION&&o.canSubmit&&o.showSubmit&&(o.access.creatingsubmissionallowed&&!o.submission||o.access.modifyingsubmissionallowed&&o.submission)),k.lc(1),k.Vc("courseId",o.courseId)("currentModuleId",o.module.id)}}let O=(()=>{class AddonModWorkshopIndexComponent extends t.a{constructor(o,e){super("AddonModWorkshopIndexComponent",o,e),this.group=0,this.component=g.a,this.pluginName="workshop",this.page=0,this.grades=[],this.assessments=[],this.publishedSubmissions=[],this.groupInfo={groups:[],separateGroups:!1,visibleGroups:!1,defaultGroupId:0,canAccessAllGroups:!1},this.canSubmit=!1,this.showSubmit=!1,this.canAssess=!1,this.hasNextPage=!1,this.PHASE_SETUP=m.AddonModWorkshopPhase.PHASE_SETUP,this.PHASE_SUBMISSION=m.AddonModWorkshopPhase.PHASE_SUBMISSION,this.PHASE_ASSESSMENT=m.AddonModWorkshopPhase.PHASE_ASSESSMENT,this.PHASE_EVALUATION=m.AddonModWorkshopPhase.PHASE_EVALUATION,this.PHASE_CLOSED=m.AddonModWorkshopPhase.PHASE_CLOSED,this.offlineSubmissions=[],this.syncEventName=u.AddonModWorkshopSyncProvider.AUTO_SYNCED,this.obsSubmissionChanged=_.b.on(m.AddonModWorkshopProvider.SUBMISSION_CHANGED,(o=>{this.eventReceived(o)}),this.siteId),this.obsAssessmentSaved=_.b.on(m.AddonModWorkshopProvider.ASSESSMENT_SAVED,(o=>{this.eventReceived(o)}),this.siteId),this.appResumeSubscription=c.a.resume.subscribe((()=>{this.showLoadingAndRefresh(!0)})),this.syncObserver=_.b.on(u.AddonModWorkshopSyncProvider.AUTO_SYNCED,(o=>{this.eventReceived(o)}),this.siteId)}ngOnInit(){const o=Object.create(null,{ngOnInit:{get:()=>super.ngOnInit}});return Object(n.a)(this,void 0,void 0,(function*(){o.ngOnInit.call(this),yield this.loadContent(!1,!0)}))}eventReceived(o){var e;(null===(e=this.workshop)||void 0===e?void 0:e.id)===o.workshopId&&(this.showLoadingAndRefresh(!0),this.checkCompletion())}invalidateContent(){var o;return Object(n.a)(this,void 0,void 0,(function*(){const e=[];e.push(m.AddonModWorkshop.invalidateWorkshopData(this.courseId)),this.workshop&&(e.push(m.AddonModWorkshop.invalidateWorkshopAccessInformationData(this.workshop.id)),e.push(m.AddonModWorkshop.invalidateUserPlanPhasesData(this.workshop.id)),this.canSubmit&&e.push(m.AddonModWorkshop.invalidateSubmissionsData(this.workshop.id)),(null===(o=this.access)||void 0===o?void 0:o.canviewallsubmissions)&&(e.push(m.AddonModWorkshop.invalidateGradeReportData(this.workshop.id)),e.push(d.a.invalidateActivityAllowedGroups(this.workshop.coursemodule)),e.push(d.a.invalidateActivityGroupMode(this.workshop.coursemodule))),this.canAssess&&e.push(m.AddonModWorkshop.invalidateReviewerAssesmentsData(this.workshop.id)),e.push(m.AddonModWorkshop.invalidateGradesData(this.workshop.id)),e.push(m.AddonModWorkshop.invalidateWorkshopWSData(this.workshop.id))),yield Promise.all(e)}))}isRefreshSyncNeeded(o){var e;return!(!this.workshop||o.workshopId!=this.workshop.id)&&(null===(e=this.content)||void 0===e?void 0:e.scrollToTop(),!0)}fetchContent(o,e=!1,s=!1){return Object(n.a)(this,void 0,void 0,(function*(){this.workshop=yield m.AddonModWorkshop.getWorkshop(this.courseId,this.module.id),this.description=this.workshop.intro,this.dataRetrieved.emit(this.workshop),e&&(yield this.syncActivity(s)),this.access=yield m.AddonModWorkshop.getWorkshopAccessInformation(this.workshop.id,{cmId:this.module.id}),this.access.canviewallsubmissions&&(this.groupInfo=yield d.a.getActivityGroupInfo(this.workshop.coursemodule),this.group=d.a.validateGroupId(this.group,this.groupInfo)),this.phases=yield m.AddonModWorkshop.getUserPlanPhases(this.workshop.id,{cmId:this.module.id}),this.phases[this.workshop.phase].tasks.forEach((o=>{o.link||"examples"!=o.code&&"prepareexamples"!=o.code||(o.link=this.module.url||"")})),this.hasOffline=yield p.AddonModWorkshopOffline.hasWorkshopOfflineData(this.workshop.id),this.offlineSubmissions=this.hasOffline?yield p.AddonModWorkshopOffline.getSubmissions(this.workshop.id):[],yield this.setPhaseInfo()}))}logActivity(){return Object(n.a)(this,void 0,void 0,(function*(){this.workshop&&(yield l.a.ignoreErrors(m.AddonModWorkshop.logView(this.workshop.id)),this.analyticsLogEvent("mod_workshop_view_workshop"))}))}gotoSubmissionsPage(o){return Object(n.a)(this,void 0,void 0,(function*(){if(!this.workshop)return;const e=this.workshop,s=yield m.AddonModWorkshop.getGradesReport(e.id,{groupId:this.group,page:o,cmId:this.module.id}),i=s&&s.grades&&s.grades.length||0;this.page=o,this.hasNextPage=i>=m.AddonModWorkshopProvider.PER_PAGE&&(this.page+1)*m.AddonModWorkshopProvider.PER_PAGE<s.totalcount;const t=s.grades||[];this.grades=[],yield Promise.all(t.map((o=>Object(n.a)(this,void 0,void 0,(function*(){var s,n,i,t;const d={id:o.submissionid,workshopid:e.id,example:!1,authorid:o.userid,timecreated:o.submissionmodified,timemodified:o.submissionmodified,title:o.submissiontitle,content:"",contenttrust:0,attachment:0,grade:o.submissiongrade,gradeover:o.submissiongradeover,gradeoverby:o.submissiongradeoverby,published:!!o.submissionpublished,gradinggrade:o.gradinggrade,late:0,reviewedby:this.parseReviewer(o.reviewedby),reviewerof:this.parseReviewer(o.reviewerof)};e.phase==m.AddonModWorkshopPhase.PHASE_ASSESSMENT&&(d.reviewedbydone=(null===(s=o.reviewedby)||void 0===s?void 0:s.reduce(((o,e)=>o+(e.grade?1:0)),0))||0,d.reviewerofdone=(null===(n=o.reviewerof)||void 0===n?void 0:n.reduce(((o,e)=>o+(e.grade?1:0)),0))||0,d.reviewedbycount=(null===(i=o.reviewedby)||void 0===i?void 0:i.length)||0,d.reviewerofcount=(null===(t=o.reviewerof)||void 0===t?void 0:t.length)||0);const a=yield h.AddonModWorkshopHelper.applyOfflineData(d,this.offlineSubmissions);void 0!==a&&this.grades.push(a)})))))}))}parseReviewer(o=[]){return o.map((o=>({grade:o.grade,gradinggrade:o.gradinggrade,gradinggradeover:o.gradinggradeover,id:o.assessmentid,reviewerid:o.userid,submissionid:o.submissionid,weight:o.weight,timecreated:0,timemodified:0,feedbackauthor:"",gradinggradeoverby:0,feedbackattachmentfiles:[],feedbackcontentfiles:[],feedbackauthorattachment:0})))}runTask(o){return Object(n.a)(this,void 0,void 0,(function*(){"submit"==o.code?this.gotoSubmit():o.link&&l.a.openInBrowser(o.link)}))}gotoSubmit(){var o;if(this.canSubmit&&this.access&&(this.access.creatingsubmissionallowed&&!this.submission||this.access.modifyingsubmissionallowed&&this.submission)){const e=(null===(o=this.submission)||void 0===o?void 0:o.id)||0;a.a.navigateToSitePath(`${g.b}/${this.courseId}/${this.module.id}/${e}/edit`,{params:{module:this.module,access:this.access}})}}viewPhaseInfo(){return Object(n.a)(this,void 0,void 0,(function*(){if(!this.phases||!this.workshop)return;!0===(yield r.a.openModal({component:f.a,componentProps:{phases:l.a.objectToArray(this.phases),workshopPhase:this.workshop.phase,externalUrl:this.module.url,showSubmit:this.showSubmit}}))&&this.gotoSubmit()}))}setGroup(o){return Object(n.a)(this,void 0,void 0,(function*(){this.group=o,yield this.gotoSubmissionsPage(0)}))}setPhaseInfo(){return Object(n.a)(this,void 0,void 0,(function*(){if(!this.phases||!this.workshop||!this.access)return;this.submission=void 0,this.canAssess=!1,this.assessments=[],this.userGrades=void 0,this.publishedSubmissions=[];const o=this.workshop;this.canSubmit=h.AddonModWorkshopHelper.canSubmit(this.workshop,this.access,this.phases[m.AddonModWorkshopPhase.PHASE_SUBMISSION].tasks),this.showSubmit=this.canSubmit&&(this.access.creatingsubmissionallowed&&!this.submission||this.access.modifyingsubmissionallowed&&!!this.submission);const e=[];this.canSubmit&&e.push(h.AddonModWorkshopHelper.getUserSubmission(this.workshop.id,{cmId:this.module.id}).then((o=>Object(n.a)(this,void 0,void 0,(function*(){this.submission=yield h.AddonModWorkshopHelper.applyOfflineData(o,this.offlineSubmissions)}))))),this.access.canviewallsubmissions&&this.workshop.phase>=m.AddonModWorkshopPhase.PHASE_SUBMISSION&&e.push(this.gotoSubmissionsPage(this.page));let s=Promise.resolve();this.workshop.phase>=m.AddonModWorkshopPhase.PHASE_ASSESSMENT&&(this.canAssess=h.AddonModWorkshopHelper.canAssess(this.workshop,this.access),this.canAssess&&(s=h.AddonModWorkshopHelper.getReviewerAssessments(this.workshop.id,{cmId:this.module.id}).then((e=>Object(n.a)(this,void 0,void 0,(function*(){yield Promise.all(e.map((e=>Object(n.a)(this,void 0,void 0,(function*(){if(e.strategy=o.strategy,this.hasOffline)try{const s=yield p.AddonModWorkshopOffline.getAssessment(o.id,e.id);e.offline=!0,e.timemodified=Math.floor(s.timemodified/1e3)}catch(o){}}))))),this.assessments=e})))))),this.workshop.phase===m.AddonModWorkshopPhase.PHASE_CLOSED&&(e.push(m.AddonModWorkshop.getGrades(this.workshop.id,{cmId:this.module.id}).then((o=>{this.userGrades=o.submissionlongstrgrade||o.assessmentlongstrgrade?o:void 0}))),this.access.canviewpublishedsubmissions&&e.push(s.then((()=>Object(n.a)(this,void 0,void 0,(function*(){const e=yield m.AddonModWorkshop.getSubmissions(o.id,{cmId:this.module.id});this.publishedSubmissions=e.filter((e=>!!e.published&&(e.reviewedby=this.assessments.filter((o=>o.submissionid===e.id)).map((e=>h.AddonModWorkshopHelper.realGradeValue(o,e))),!0)))})))))),yield Promise.all(e)}))}sync(){if(!this.workshop)throw new i.a("Cannot sync without a workshop.");return u.AddonModWorkshopSync.syncWorkshop(this.workshop.id)}ngOnDestroy(){var o,e,s;super.ngOnDestroy(),null===(o=this.obsSubmissionChanged)||void 0===o||o.off(),null===(e=this.obsAssessmentSaved)||void 0===e||e.off(),null===(s=this.appResumeSubscription)||void 0===s||s.unsubscribe()}}return AddonModWorkshopIndexComponent.ɵfac=function AddonModWorkshopIndexComponent_Factory(o){return new(o||AddonModWorkshopIndexComponent)(k.yc(b.v,8),k.yc(I.a,8))},AddonModWorkshopIndexComponent.ɵcmp=k.sc({type:AddonModWorkshopIndexComponent,selectors:[["addon-mod-workshop-index"]],inputs:{group:"group"},features:[k.ic],decls:10,vars:13,consts:[["slot","end"],["fill","clear","aria-haspopup","true",3,"click"],["name","fas-circle-info","slot","icon-only","aria-hidden","true"],[3,"hideUntil"],[3,"module","component","componentId","courseId","hasDataToSync","completionChanged"],[4,"ngIf"],["collapsible-footer","","slot","fixed",4,"ngIf"],["button","","detail","true",3,"click"],[1,"ion-text-wrap"],["button","","class","ion-text-wrap","detail","false",3,"item-dimmed","click",4,"ngFor","ngForOf"],["button","","detail","false",1,"ion-text-wrap",3,"click"],["slot","start","name","far-circle",4,"ngIf"],["slot","start","name","fas-circle-xmark","color","danger",4,"ngIf"],["slot","start","name","fas-circle-info","color","info",4,"ngIf"],["slot","start","name","fas-circle-check","color","success",4,"ngIf"],[1,"item-heading"],[3,"innerHTML",4,"ngIf"],["slot","end","name","fas-up-right-from-square","aria-hidden","true",4,"ngIf"],["slot","start","name","far-circle"],["slot","start","name","fas-circle-xmark","color","danger"],["slot","start","name","fas-circle-info","color","info"],["slot","start","name","fas-circle-check","color","success"],[3,"innerHTML"],["slot","end","name","fas-up-right-from-square","aria-hidden","true"],["contextLevel","module",3,"text","component","componentId","contextInstanceId","courseId"],["collapsible-item","","contextLevel","module",3,"component","componentId","text","contextInstanceId","courseId"],["class","ion-text-wrap",4,"ngIf"],["class","item-heading",4,"ngIf"],[3,"submission","courseId","module","workshop","access",4,"ngIf"],[3,"submission","courseId","module","workshop","access"],[4,"ngFor","ngForOf"],["summary","true",1,"core-as-item",3,"submission","courseId","module","workshop","access"],["summary","true",1,"core-as-item",3,"submission","assessment","courseId","module","workshop","access"],[3,"groupInfo","selected","courseId","selectedChange"],[1,"ion-align-items-center"],["expand","block","fill","outline",3,"click"],["name","fas-chevron-left","slot","start","aria-hidden","true"],["expand","block",3,"click"],["name","fas-chevron-right","slot","end","aria-hidden","true"],["collapsible-footer","","slot","fixed"],["class","list-item-limited-width",4,"ngIf"],[3,"courseId","currentModuleId"],[1,"list-item-limited-width"],["expand","block","class","ion-text-wrap ion-margin",3,"click",4,"ngIf"],["expand","block",1,"ion-text-wrap","ion-margin",3,"click"],["slot","start","name","fas-plus","aria-hidden","true"],["slot","start","name","fas-pen","aria-hidden","true"]],template:function AddonModWorkshopIndexComponent_Template(o,e){1&o&&(k.Ec(0,"core-navbar-buttons",0),k.Ec(1,"ion-button",1),k.Mc("click",(function AddonModWorkshopIndexComponent_Template_ion_button_click_1_listener(){return e.openModuleSummary()})),k.Pc(2,"translate"),k.zc(3,"ion-icon",2),k.Dc(),k.Dc(),k.Ec(4,"core-loading",3),k.Ec(5,"core-course-module-info",4),k.Mc("completionChanged",(function AddonModWorkshopIndexComponent_Template_core_course_module_info_completionChanged_5_listener(){return e.onCompletionChange()})),k.Dc(),k.nd(6,AddonModWorkshopIndexComponent_ion_card_6_Template,6,2,"ion-card",5),k.nd(7,AddonModWorkshopIndexComponent_ion_card_7_Template,7,8,"ion-card",5),k.nd(8,AddonModWorkshopIndexComponent_div_8_Template,7,6,"div",5),k.nd(9,AddonModWorkshopIndexComponent_div_9_Template,3,3,"div",6),k.Dc()),2&o&&(k.lc(1),k.mc("aria-label",k.Qc(2,11,"core.info")),k.lc(3),k.Vc("hideUntil",!e.showLoading),k.lc(1),k.Vc("module",e.module)("component",e.component)("componentId",e.componentId)("courseId",e.courseId)("hasDataToSync",e.hasOffline),k.lc(1),k.Vc("ngIf",e.phases),k.lc(1),k.Vc("ngIf",e.description&&e.workshop&&e.workshop.phase==e.PHASE_SETUP),k.lc(1),k.Vc("ngIf",e.access&&e.workshop&&e.workshop.phase>=e.PHASE_SUBMISSION),k.lc(1),k.Vc("ngIf",!e.showLoading))},directives:[v.a,A.a,b.l,b.D,w.a,M.a,S.a,W.t,b.n,b.I,b.O,W.s,E.a,P.a,b.J,C.a,D.a,b.B,b.hb,b.u,T.a,y.a],pipes:[x.d],encapsulation:2}),AddonModWorkshopIndexComponent})()},"3UD+":function(o,e){o.exports=function(o){if(!o.webpackPolyfill){var e=Object.create(o);e.children||(e.children=[]),Object.defineProperty(e,"loaded",{enumerable:!0,get:function(){return e.l}}),Object.defineProperty(e,"id",{enumerable:!0,get:function(){return e.i}}),Object.defineProperty(e,"exports",{enumerable:!0}),e.webpackPolyfill=1}return e}},Lkkz:function(o,e,s){"use strict";s.d(e,"a",(function(){return S}));var n=s("mrSG"),i=s("3Pt+"),t=s("93ts"),d=s("hSQQ"),a=s("EmGO"),c=s("L2dF"),r=s("By5z"),l=s("9+EE"),_=s("uT8i"),m=s("3LXp"),h=s("vuGA"),p=s("bFG1"),u=s("j3ag"),f=s("fjkH"),g=s("4reR"),k=s("49BL"),b=s("i1f9"),I=s("8/zp"),v=s("EyWp"),A=s("DJrq"),w=s("fXoL");const M=["assessmentForm"];function AddonModWorkshopAssessmentStrategyComponent_ng_container_6_Template(o,e){if(1&o&&(w.Cc(0),w.zc(1,"core-dynamic-component",6),w.Bc()),2&o){const o=w.Oc();w.lc(1),w.Vc("component",o.componentClass)("data",o.data)}}const _c1=function(o){return{$a:o}};function AddonModWorkshopAssessmentStrategyComponent_ion_card_7_Template(o,e){if(1&o&&(w.Ec(0,"ion-card",7),w.Ec(1,"ion-item"),w.Ec(2,"ion-label"),w.Ec(3,"p"),w.pd(4),w.Pc(5,"translate"),w.Dc(),w.Dc(),w.Dc(),w.Dc()),2&o){const o=w.Oc();w.lc(4),w.qd(w.Rc(5,1,"addon.mod_workshop.assessmentstrategynotsupported",w.ad(4,_c1,o.strategy)))}}function AddonModWorkshopAssessmentStrategyComponent_ion_card_8_ion_item_6_core_input_errors_6_Template(o,e){if(1&o&&w.zc(0,"core-input-errors",17),2&o){const o=w.Oc(3);w.Vc("errorText",o.data.fieldErrors.feedbackauthor)}}const _c2=function(o){return{asid:o}};function AddonModWorkshopAssessmentStrategyComponent_ion_card_8_ion_item_6_Template(o,e){if(1&o){const o=w.Fc();w.Ec(0,"ion-item",13),w.Ec(1,"ion-label",13),w.Ec(2,"span",14),w.pd(3),w.Pc(4,"translate"),w.Dc(),w.Dc(),w.Ec(5,"core-rich-text-editor",15),w.Mc("contentChanged",(function AddonModWorkshopAssessmentStrategyComponent_ion_card_8_ion_item_6_Template_core_rich_text_editor_contentChanged_5_listener(e){w.fd(o);return w.Oc(2).onFeedbackChange(e)})),w.Dc(),w.nd(6,AddonModWorkshopAssessmentStrategyComponent_ion_card_8_ion_item_6_core_input_errors_6_Template,1,1,"core-input-errors",16),w.Dc()}if(2&o){const o=w.Oc(2);w.lc(2),w.Vc("core-mark-required",o.overallFeedkbackRequired),w.lc(1),w.rd(" ",w.Qc(4,9,"addon.mod_workshop.feedbackauthor")," "),w.lc(2),w.Vc("control",o.feedbackControl)("component",o.component)("componentId",o.workshop.coursemodule)("autoSave",!0)("contextInstanceId",o.workshop.coursemodule)("draftExtraParams",w.ad(11,_c2,o.assessmentId)),w.lc(1),w.Vc("ngIf",o.overallFeedkbackRequired&&o.data.fieldErrors&&o.data.fieldErrors.feedbackauthor)}}function AddonModWorkshopAssessmentStrategyComponent_ion_card_8_core_attachments_7_Template(o,e){if(1&o&&w.zc(0,"core-attachments",18),2&o){const o=w.Oc(2);w.Vc("files",null==o.data.assessment?null:o.data.assessment.feedbackattachmentfiles)("maxSize",o.workshop.overallfeedbackmaxbytes)("maxSubmissions",o.workshop.overallfeedbackfiles)("component",o.component)("componentId",o.componentId)("allowOffline",!0)("courseId",o.workshop.course)}}function AddonModWorkshopAssessmentStrategyComponent_ion_card_8_ion_item_8_ion_select_option_8_Template(o,e){if(1&o&&(w.Ec(0,"ion-select-option",21),w.pd(1),w.Dc()),2&o){const o=e.$implicit;w.Vc("value",o),w.lc(1),w.qd(o)}}const _c3=function(o){return{header:o}};function AddonModWorkshopAssessmentStrategyComponent_ion_card_8_ion_item_8_Template(o,e){if(1&o){const o=w.Fc();w.Ec(0,"ion-item"),w.Ec(1,"ion-label",13),w.Ec(2,"span",14),w.pd(3),w.Pc(4,"translate"),w.Dc(),w.Dc(),w.Ec(5,"ion-select",19),w.Mc("ngModelChange",(function AddonModWorkshopAssessmentStrategyComponent_ion_card_8_ion_item_8_Template_ion_select_ngModelChange_5_listener(e){w.fd(o);return w.Oc(2).weight=e})),w.Pc(6,"translate"),w.Pc(7,"translate"),w.nd(8,AddonModWorkshopAssessmentStrategyComponent_ion_card_8_ion_item_8_ion_select_option_8_Template,2,2,"ion-select-option",20),w.Dc(),w.Dc()}if(2&o){const o=w.Oc(2);w.lc(2),w.Vc("core-mark-required",!0),w.lc(1),w.rd(" ",w.Qc(4,6,"addon.mod_workshop.assessmentweight")," "),w.lc(2),w.Vc("ngModel",o.weight)("cancelText",w.Qc(6,8,"core.cancel"))("interfaceOptions",w.ad(12,_c3,w.Qc(7,10,"addon.mod_workshop.assessmentweight"))),w.lc(3),w.Vc("ngForOf",o.weights)}}function AddonModWorkshopAssessmentStrategyComponent_ion_card_8_ion_item_9_Template(o,e){if(1&o&&(w.Ec(0,"ion-item",8),w.Ec(1,"ion-label"),w.zc(2,"core-format-text",22),w.Dc(),w.Dc()),2&o){const o=w.Oc(2);w.lc(2),w.Vc("component",o.component)("componentId",o.componentId)("text",null==o.data.assessment?null:o.data.assessment.feedbackauthor)("contextInstanceId",o.workshop.coursemodule)("courseId",o.workshop.course)}}function AddonModWorkshopAssessmentStrategyComponent_ion_card_8_ion_item_10_Template(o,e){if(1&o&&(w.Ec(0,"ion-item"),w.Ec(1,"ion-label"),w.zc(2,"core-files",23),w.Dc(),w.Dc()),2&o){const o=w.Oc(2);w.lc(2),w.Vc("files",null==o.data.assessment?null:o.data.assessment.feedbackattachmentfiles)("component",o.component)("componentId",o.componentId)}}function AddonModWorkshopAssessmentStrategyComponent_ion_card_8_Template(o,e){if(1&o&&(w.Ec(0,"ion-card"),w.Ec(1,"ion-item",8),w.Ec(2,"ion-label"),w.Ec(3,"h3",9),w.pd(4),w.Pc(5,"translate"),w.Dc(),w.Dc(),w.Dc(),w.nd(6,AddonModWorkshopAssessmentStrategyComponent_ion_card_8_ion_item_6_Template,7,13,"ion-item",10),w.nd(7,AddonModWorkshopAssessmentStrategyComponent_ion_card_8_core_attachments_7_Template,1,7,"core-attachments",11),w.nd(8,AddonModWorkshopAssessmentStrategyComponent_ion_card_8_ion_item_8_Template,9,14,"ion-item",4),w.nd(9,AddonModWorkshopAssessmentStrategyComponent_ion_card_8_ion_item_9_Template,3,5,"ion-item",12),w.nd(10,AddonModWorkshopAssessmentStrategyComponent_ion_card_8_ion_item_10_Template,3,3,"ion-item",4),w.Dc()),2&o){const o=w.Oc();w.lc(4),w.qd(w.Qc(5,6,"addon.mod_workshop.overallfeedback")),w.lc(2),w.Vc("ngIf",o.edit),w.lc(1),w.Vc("ngIf",o.edit&&o.workshop.overallfeedbackfiles),w.lc(1),w.Vc("ngIf",o.edit&&o.access&&o.access.canallocate),w.lc(1),w.Vc("ngIf",!o.edit&&(null==o.data.assessment?null:o.data.assessment.feedbackauthor)),w.lc(1),w.Vc("ngIf",!o.edit&&o.workshop.overallfeedbackfiles&&(null==o.data.assessment||null==o.data.assessment.feedbackattachmentfiles?null:o.data.assessment.feedbackattachmentfiles.length))}}let S=(()=>{class AddonModWorkshopAssessmentStrategyComponent{constructor(){this.edit=!1,this.data={workshopId:0,assessment:void 0,edit:!1,selectedValues:[],fieldErrors:{},strategy:"",moduleId:0,courseId:void 0},this.assessmentStrategyLoaded=!1,this.notSupported=!1,this.feedbackText="",this.feedbackControl=new i.g,this.overallFeedkback=!1,this.overallFeedkbackRequired=!1,this.component=A.a,this.weights=[],this.hasOffline=!1,this.originalData={text:"",files:[],weight:1,selectedValues:[]}}ngOnInit(){return Object(n.a)(this,void 0,void 0,(function*(){if(!this.assessmentId||!this.strategy)return this.assessmentStrategyLoaded=!0,void 0;if(this.data.workshopId=this.workshop.id,this.data.edit=this.edit,this.data.strategy=this.strategy,this.data.moduleId=this.workshop.coursemodule,this.data.courseId=this.workshop.course,this.componentClass=yield k.AddonWorkshopAssessmentStrategyDelegate.getComponentForPlugin(this.strategy),this.componentClass){if(this.overallFeedkback=this.workshop.overallfeedbackmode!=b.AddonModWorkshopOverallFeedbackMode.DISABLED,this.overallFeedkbackRequired=this.workshop.overallfeedbackmode==b.AddonModWorkshopOverallFeedbackMode.ENABLED_REQUIRED,this.componentId=this.workshop.coursemodule,this.edit&&this.access.canallocate){this.weights=[];for(let o=16;o>=0;o--)this.weights[o]=o}this.edit&&_.a.blockOperation(A.a,this.workshop.id);try{yield this.load(),this.obsInvalidated=f.b.on(b.AddonModWorkshopProvider.ASSESSMENT_INVALIDATED,(()=>this.load()),l.b.getCurrentSiteId())}catch(o){this.componentClass=void 0,m.a.showErrorModalDefault(o,"Error loading assessment.")}finally{this.assessmentStrategyLoaded=!0}}else this.notSupported=!k.AddonWorkshopAssessmentStrategyDelegate.isPluginSupported(this.strategy),this.assessmentStrategyLoaded=!0}))}load(){return Object(n.a)(this,void 0,void 0,(function*(){if(this.data.assessment=yield I.AddonModWorkshopHelper.getReviewerAssessmentById(this.workshop.id,this.assessmentId,{userId:this.userId,cmId:this.workshop.coursemodule}),this.data.assessment.form){if(this.edit)try{const o=(yield v.AddonModWorkshopOffline.getAssessment(this.workshop.id,this.assessmentId)).inputdata;this.hasOffline=!0,this.data.assessment.feedbackauthor=o.feedbackauthor,this.access.canallocate&&(this.data.assessment.weight=o.weight),this.data.assessment.form.current=b.AddonModWorkshop.parseFields(p.a.objectToArrayOfObjects(o,"name","value")),o&&(this.data.assessment.feedbackattachmentfiles=yield I.AddonModWorkshopHelper.getAssessmentFilesFromOfflineFilesObject(o.feedbackauthorattachmentsid,this.workshop.id,this.assessmentId))}catch(o){this.hasOffline=!1}finally{this.feedbackText=this.data.assessment.feedbackauthor,this.feedbackControl.setValue(this.feedbackText),this.originalData.text=this.data.assessment.feedbackauthor,this.access.canallocate&&(this.originalData.weight=this.data.assessment.weight),this.originalData.files=[],this.data.assessment.feedbackattachmentfiles.forEach((o=>{let e=a.a.getFileName(o);e||(e=c.a.getFilenameFromPath(o)||""),this.originalData.files.push({filename:e,fileurl:""})}))}try{this.data.selectedValues=yield k.AddonWorkshopAssessmentStrategyDelegate.getOriginalValues(this.strategy,this.data.assessment.form,this.workshop.id)}finally{this.originalData.selectedValues=p.a.clone(this.data.selectedValues),this.edit&&(r.a.setFiles(A.a,this.workshop.id+"_"+this.assessmentId,this.data.assessment.feedbackattachmentfiles),this.access.canallocate&&(this.weight=this.data.assessment.weight))}}}))}hasDataChanged(){var o;if(!this.assessmentStrategyLoaded||!this.workshop.strategy)return!1;const e=h.b.restorePluginfileUrls(this.feedbackText,(null===(o=this.data.assessment)||void 0===o?void 0:o.feedbackcontentfiles)||[]);if(this.originalData.text!=e)return!0;if(this.access.canallocate&&this.originalData.weight!=this.weight)return!0;const s=r.a.getFiles(A.a,this.workshop.id+"_"+this.assessmentId)||[];return!!d.a.areFileListDifferent(s,this.originalData.files)||k.AddonWorkshopAssessmentStrategyDelegate.hasDataChanged(this.workshop.strategy,this.originalData.selectedValues,this.data.selectedValues)}saveAssessment(){var o,e;return Object(n.a)(this,void 0,void 0,(function*(){if(!(null===(o=this.data.assessment)||void 0===o?void 0:o.form))return;const s=r.a.getFiles(A.a,this.workshop.id+"_"+this.assessmentId)||[];let n=!1,i=!s.length;const a=yield m.a.showModalLoading("core.sending",!0);this.data.fieldErrors={};try{let o;try{o=yield I.AddonModWorkshopHelper.uploadOrStoreAssessmentFiles(this.workshop.id,this.assessmentId,s,n)}catch(e){if(p.a.isWebServiceError(e))throw e;n=!0,i=!0,o=yield I.AddonModWorkshopHelper.uploadOrStoreAssessmentFiles(this.workshop.id,this.assessmentId,s,n)}const a=h.b.restorePluginfileUrls(this.feedbackText,(null===(e=this.data.assessment)||void 0===e?void 0:e.feedbackcontentfiles)||[]);let c;try{c=yield I.AddonModWorkshopHelper.prepareAssessmentData(this.workshop,this.data.selectedValues,a,this.data.assessment.form,o)}catch(o){throw this.data.fieldErrors=o,new t.a(u.I.instant("core.errorinvalidform"))}let r=!1;n?yield v.AddonModWorkshopOffline.saveAssessment(this.workshop.id,this.assessmentId,this.workshop.course,c):r=yield b.AddonModWorkshop.updateAssessment(this.workshop.id,this.assessmentId,this.workshop.course,c,void 0,i),g.a.triggerFormSubmittedEvent(this.formElement,!!r,l.b.getCurrentSiteId());const _=[];r&&(_.push(I.AddonModWorkshopHelper.deleteAssessmentStoredFiles(this.workshop.id,this.assessmentId)),_.push(b.AddonModWorkshop.invalidateAssessmentFormData(this.workshop.id,this.assessmentId)),_.push(b.AddonModWorkshop.invalidateAssessmentData(this.workshop.id,this.assessmentId))),yield p.a.ignoreErrors(Promise.all(_)),f.b.trigger(b.AddonModWorkshopProvider.ASSESSMENT_SAVED,{workshopId:this.workshop.id,assessmentId:this.assessmentId,userId:l.b.getCurrentSiteUserId()},l.b.getCurrentSiteId()),s&&d.a.clearTmpFiles(s)}catch(o){m.a.showErrorModalDefault(o,"Error saving assessment.")}finally{a.dismiss()}}))}onFeedbackChange(o){this.feedbackText=null!=o?o:""}ngOnDestroy(){var o,e;null===(o=this.obsInvalidated)||void 0===o?void 0:o.off(),(null===(e=this.data.assessment)||void 0===e?void 0:e.feedbackattachmentfiles)&&d.a.clearTmpFiles(this.data.assessment.feedbackattachmentfiles)}}return AddonModWorkshopAssessmentStrategyComponent.ɵfac=function AddonModWorkshopAssessmentStrategyComponent_Factory(o){return new(o||AddonModWorkshopAssessmentStrategyComponent)},AddonModWorkshopAssessmentStrategyComponent.ɵcmp=w.sc({type:AddonModWorkshopAssessmentStrategyComponent,selectors:[["addon-mod-workshop-assessment-strategy"]],viewQuery:function AddonModWorkshopAssessmentStrategyComponent_Query(o,e){var s;(1&o&&w.ud(M,!0),2&o)&&(w.dd(s=w.Nc())&&(e.formElement=s.first))},inputs:{workshop:"workshop",access:"access",assessmentId:"assessmentId",userId:"userId",strategy:"strategy",edit:"edit"},decls:9,vars:7,consts:[[1,"ion-padding"],["name","mma-mod_workshop-assessment-form"],["assessmentForm",""],[3,"hideUntil"],[4,"ngIf"],["class","core-info-card",4,"ngIf"],[3,"component","data"],[1,"core-info-card"],[1,"ion-text-wrap"],[1,"item-heading"],["position","stacked",4,"ngIf"],[3,"files","maxSize","maxSubmissions","component","componentId","allowOffline","courseId",4,"ngIf"],["class","ion-text-wrap",4,"ngIf"],["position","stacked"],[3,"core-mark-required"],["contextLevel","module","elementId","feedbackauthor_editor",3,"control","component","componentId","autoSave","contextInstanceId","draftExtraParams","contentChanged"],[3,"errorText",4,"ngIf"],[3,"errorText"],[3,"files","maxSize","maxSubmissions","component","componentId","allowOffline","courseId"],["interface","action-sheet","name","weight",3,"ngModel","cancelText","interfaceOptions","ngModelChange"],[3,"value",4,"ngFor","ngForOf"],[3,"value"],["contextLevel","module",3,"component","componentId","text","contextInstanceId","courseId"],[3,"files","component","componentId"]],template:function AddonModWorkshopAssessmentStrategyComponent_Template(o,e){1&o&&(w.Ec(0,"h2",0),w.pd(1),w.Pc(2,"translate"),w.Dc(),w.Ec(3,"form",1,2),w.Ec(5,"core-loading",3),w.nd(6,AddonModWorkshopAssessmentStrategyComponent_ng_container_6_Template,2,2,"ng-container",4),w.nd(7,AddonModWorkshopAssessmentStrategyComponent_ion_card_7_Template,6,6,"ion-card",5),w.nd(8,AddonModWorkshopAssessmentStrategyComponent_ion_card_8_Template,11,8,"ion-card",4),w.Dc(),w.Dc()),2&o&&(w.lc(1),w.qd(w.Qc(2,5,"addon.mod_workshop.assessmentform")),w.lc(4),w.Vc("hideUntil",e.assessmentStrategyLoaded),w.lc(1),w.Vc("ngIf",e.componentClass&&e.assessmentStrategyLoaded),w.lc(1),w.Vc("ngIf",e.notSupported),w.lc(1),w.Vc("ngIf",e.assessmentStrategyLoaded&&e.overallFeedkback&&(e.edit||(null==e.data.assessment?null:e.data.assessment.feedbackauthor)||(null==e.data.assessment||null==e.data.assessment.feedbackattachmentfiles?null:e.data.assessment.feedbackattachmentfiles.length))))},encapsulation:2}),AddonModWorkshopAssessmentStrategyComponent})()},Uzd6:function(o,e,s){"use strict";s.d(e,"a",(function(){return A}));var n=s("4pns"),i=s("pHTc"),t=s("9+EE"),d=s("WoAp"),a=s("i1f9"),c=s("8/zp"),r=s("EyWp"),l=s("DJrq"),_=s("fXoL"),m=s("PgjG"),h=s("ofXK"),p=s("TEn/"),u=s("FeAf"),f=s("hMzs"),g=s("W5pS"),k=s("3CSS"),b=s("ACYt"),I=s("sYmb"),v=s("Cg42");function AddonModWorkshopSubmissionComponent_div_1_p_6_Template(o,e){if(1&o&&(_.Ec(0,"p"),_.pd(1),_.Dc()),2&o){const o=_.Oc(2);_.lc(1),_.qd(o.profile.fullname)}}const _c0=function(o){return{$a:o}};function AddonModWorkshopSubmissionComponent_div_1_p_7_Template(o,e){if(1&o&&(_.Ec(0,"p"),_.pd(1),_.Pc(2,"translate"),_.Dc()),2&o){const o=_.Oc(2);_.qc("addon-has-overriden-grade",o.showGrade(o.submission.gradeover)),_.lc(1),_.sd(" ",_.Rc(2,4,"addon.mod_workshop.submissiongradeof",_.ad(7,_c0,o.workshop.grade)),": ",o.submission.grade," ")}}function AddonModWorkshopSubmissionComponent_div_1_p_8_Template(o,e){if(1&o&&(_.Ec(0,"p",11),_.pd(1),_.Pc(2,"translate"),_.Dc()),2&o){const o=_.Oc(2);_.lc(1),_.sd(" ",_.Qc(2,2,"addon.mod_workshop.gradeover"),": ",o.submission.gradeover," ")}}function AddonModWorkshopSubmissionComponent_div_1_p_9_Template(o,e){if(1&o&&(_.Ec(0,"p"),_.pd(1),_.Pc(2,"translate"),_.Dc()),2&o){const o=_.Oc(2);_.lc(1),_.sd(" ",_.Rc(2,2,"addon.mod_workshop.gradinggradeof",_.ad(5,_c0,o.workshop.gradinggrade)),": ",o.submission.gradinggrade," ")}}function AddonModWorkshopSubmissionComponent_div_1_ion_note_10_Template(o,e){1&o&&(_.Ec(0,"ion-note",12),_.zc(1,"ion-icon",13),_.pd(2),_.Pc(3,"translate"),_.Dc()),2&o&&(_.lc(2),_.rd(" ",_.Qc(3,1,"core.notsent")," "))}function AddonModWorkshopSubmissionComponent_div_1_ion_note_11_ng_container_3_Template(o,e){1&o&&(_.Cc(0),_.zc(1,"ion-icon",13),_.pd(2),_.Pc(3,"translate"),_.Bc()),2&o&&(_.lc(2),_.rd(" ",_.Qc(3,1,"core.notsent")," "))}function AddonModWorkshopSubmissionComponent_div_1_ion_note_11_ng_container_4_Template(o,e){1&o&&(_.Cc(0),_.zc(1,"ion-icon",14),_.pd(2),_.Pc(3,"translate"),_.Bc()),2&o&&(_.lc(2),_.rd(" ",_.Qc(3,1,"core.deletedoffline")," "))}function AddonModWorkshopSubmissionComponent_div_1_ion_note_11_Template(o,e){if(1&o&&(_.Ec(0,"ion-note",12),_.pd(1),_.Pc(2,"coreDateDayOrTime"),_.nd(3,AddonModWorkshopSubmissionComponent_div_1_ion_note_11_ng_container_3_Template,4,3,"ng-container",1),_.nd(4,AddonModWorkshopSubmissionComponent_div_1_ion_note_11_ng_container_4_Template,4,3,"ng-container",1),_.Dc()),2&o){const o=_.Oc(2);_.lc(1),_.rd(" ",_.Qc(2,3,o.submission.timemodified)," "),_.lc(2),_.Vc("ngIf",o.submission.offline),_.lc(1),_.Vc("ngIf",o.submission.deleted)}}function AddonModWorkshopSubmissionComponent_div_1_ion_item_12_Template(o,e){if(1&o&&(_.Ec(0,"ion-item",15),_.Ec(1,"ion-label"),_.zc(2,"core-format-text",16),_.Dc(),_.Dc()),2&o){const o=_.Oc(2);_.lc(2),_.Vc("component",o.component)("componentId",o.componentId)("text",o.submission.content)("contextInstanceId",o.module.id)("courseId",o.courseId)}}function AddonModWorkshopSubmissionComponent_div_1_ion_item_14_core_user_avatar_1_Template(o,e){if(1&o&&_.zc(0,"core-user-avatar",4),2&o){const o=_.Oc(3);_.Vc("user",o.evaluateByProfile)("courseId",o.courseId)("userId",o.evaluateByProfile.id)}}function AddonModWorkshopSubmissionComponent_div_1_ion_item_14_p_3_Template(o,e){if(1&o&&(_.Ec(0,"p",19),_.pd(1),_.Pc(2,"translate"),_.Dc()),2&o){const o=_.Oc(3);_.lc(1),_.rd(" ",_.Rc(2,1,"addon.mod_workshop.feedbackby",_.ad(4,_c0,o.evaluateByProfile.fullname))," ")}}function AddonModWorkshopSubmissionComponent_div_1_ion_item_14_Template(o,e){if(1&o&&(_.Ec(0,"ion-item",15),_.nd(1,AddonModWorkshopSubmissionComponent_div_1_ion_item_14_core_user_avatar_1_Template,1,3,"core-user-avatar",17),_.Ec(2,"ion-label"),_.nd(3,AddonModWorkshopSubmissionComponent_div_1_ion_item_14_p_3_Template,3,6,"p",18),_.zc(4,"core-format-text",5),_.Dc(),_.Dc()),2&o){const o=_.Oc(2);_.lc(1),_.Vc("ngIf",o.evaluateByProfile),_.lc(2),_.Vc("ngIf",o.evaluateByProfile&&o.evaluateByProfile.fullname),_.lc(1),_.Vc("text",o.submission.feedbackauthor)("contextInstanceId",o.module.id)("courseId",o.courseId)}}function AddonModWorkshopSubmissionComponent_div_1_ion_item_15_Template(o,e){if(1&o){const o=_.Fc();_.Ec(0,"ion-item"),_.Ec(1,"ion-label"),_.Ec(2,"ion-button",20),_.Mc("click",(function AddonModWorkshopSubmissionComponent_div_1_ion_item_15_Template_ion_button_click_2_listener(){_.fd(o);return _.Oc(2).gotoSubmission()})),_.pd(3),_.Pc(4,"translate"),_.zc(5,"ion-icon",21),_.Dc(),_.Dc(),_.Dc()}2&o&&(_.lc(3),_.rd(" ",_.Qc(4,1,"core.showmore")," "))}function AddonModWorkshopSubmissionComponent_div_1_Template(o,e){if(1&o&&(_.Ec(0,"div"),_.Ec(1,"ion-item",3),_.zc(2,"core-user-avatar",4),_.Ec(3,"ion-label"),_.Ec(4,"h2"),_.zc(5,"core-format-text",5),_.Dc(),_.nd(6,AddonModWorkshopSubmissionComponent_div_1_p_6_Template,2,1,"p",1),_.nd(7,AddonModWorkshopSubmissionComponent_div_1_p_7_Template,3,9,"p",6),_.nd(8,AddonModWorkshopSubmissionComponent_div_1_p_8_Template,3,4,"p",7),_.nd(9,AddonModWorkshopSubmissionComponent_div_1_p_9_Template,3,7,"p",1),_.Dc(),_.nd(10,AddonModWorkshopSubmissionComponent_div_1_ion_note_10_Template,4,3,"ion-note",8),_.nd(11,AddonModWorkshopSubmissionComponent_div_1_ion_note_11_Template,5,5,"ion-note",8),_.Dc(),_.nd(12,AddonModWorkshopSubmissionComponent_div_1_ion_item_12_Template,3,5,"ion-item",9),_.zc(13,"core-files",10),_.nd(14,AddonModWorkshopSubmissionComponent_div_1_ion_item_14_Template,5,5,"ion-item",9),_.nd(15,AddonModWorkshopSubmissionComponent_div_1_ion_item_15_Template,6,3,"ion-item",1),_.Dc()),2&o){const o=_.Oc();_.lc(2),_.Vc("user",o.profile)("courseId",o.courseId)("userId",null==o.profile?null:o.profile.id),_.lc(3),_.Vc("text",o.submission.title)("contextInstanceId",o.module.id)("courseId",o.courseId),_.lc(1),_.Vc("ngIf",o.profile&&(null==o.profile?null:o.profile.fullname)),_.lc(1),_.Vc("ngIf",o.showGrade(o.submission.grade)),_.lc(1),_.Vc("ngIf",o.showGrade(o.submission.gradeover)),_.lc(1),_.Vc("ngIf",o.access.canviewallsubmissions&&o.showGrade(o.submission.gradinggrade)),_.lc(1),_.Vc("ngIf",!o.submission.timemodified),_.lc(1),_.Vc("ngIf",o.submission.timemodified),_.lc(1),_.Vc("ngIf",o.submission.content),_.lc(1),_.Vc("files",o.submission.attachmentfiles)("component",o.component)("componentId",o.componentId),_.lc(1),_.Vc("ngIf",o.viewDetails&&o.submission.feedbackauthor),_.lc(1),_.Vc("ngIf",o.viewDetails)}}function AddonModWorkshopSubmissionComponent_ion_item_2_p_5_Template(o,e){if(1&o&&(_.Ec(0,"p"),_.pd(1),_.Dc()),2&o){const o=_.Oc(2);_.lc(1),_.qd(o.profile.fullname)}}function AddonModWorkshopSubmissionComponent_ion_item_2_p_6_Template(o,e){if(1&o&&(_.Ec(0,"p"),_.pd(1),_.Pc(2,"translate"),_.Dc()),2&o){const o=_.Oc(2);_.lc(1),_.td(" ",_.Qc(2,3,"addon.mod_workshop.receivedgrades"),": ",o.submission.reviewedbydone," / ",o.submission.reviewedbycount," ")}}function AddonModWorkshopSubmissionComponent_ion_item_2_p_7_Template(o,e){if(1&o&&(_.Ec(0,"p"),_.pd(1),_.Pc(2,"translate"),_.Dc()),2&o){const o=_.Oc(2);_.lc(1),_.td(" ",_.Qc(2,3,"addon.mod_workshop.givengrades"),": ",o.submission.reviewerofdone," / ",o.submission.reviewerofcount," ")}}function AddonModWorkshopSubmissionComponent_ion_item_2_p_8_Template(o,e){if(1&o&&(_.Ec(0,"p"),_.pd(1),_.Pc(2,"translate"),_.Dc()),2&o){const o=_.Oc(2);_.lc(1),_.sd(" ",_.Rc(2,2,"addon.mod_workshop.submissiongradeof",_.ad(5,_c0,o.workshop.grade)),": ",o.submission.grade," ")}}function AddonModWorkshopSubmissionComponent_ion_item_2_p_9_Template(o,e){if(1&o&&(_.Ec(0,"p",11),_.pd(1),_.Pc(2,"translate"),_.Dc()),2&o){const o=_.Oc(2);_.lc(1),_.sd(" ",_.Rc(2,2,"addon.mod_workshop.submissiongradeof",_.ad(5,_c0,o.workshop.grade)),": ",o.submission.gradeover," ")}}function AddonModWorkshopSubmissionComponent_ion_item_2_p_10_Template(o,e){if(1&o&&(_.Ec(0,"p"),_.pd(1),_.Pc(2,"translate"),_.Dc()),2&o){const o=_.Oc(2);_.lc(1),_.sd(" ",_.Rc(2,2,"addon.mod_workshop.gradinggradeof",_.ad(5,_c0,o.workshop.gradinggrade)),": ",o.submission.gradinggrade," ")}}function AddonModWorkshopSubmissionComponent_ion_item_2_ion_badge_11_Template(o,e){1&o&&(_.Ec(0,"ion-badge",25),_.pd(1),_.Pc(2,"translate"),_.Dc()),2&o&&(_.lc(1),_.rd(" ",_.Qc(2,1,"addon.mod_workshop.assessedsubmission")," "))}function AddonModWorkshopSubmissionComponent_ion_item_2_ion_badge_12_Template(o,e){1&o&&(_.Ec(0,"ion-badge",26),_.pd(1),_.Pc(2,"translate"),_.Dc()),2&o&&(_.lc(1),_.rd(" ",_.Qc(2,1,"addon.mod_workshop.notassessed")," "))}function AddonModWorkshopSubmissionComponent_ion_item_2_ion_note_13_div_3_Template(o,e){1&o&&(_.Ec(0,"div"),_.zc(1,"ion-icon",13),_.pd(2),_.Pc(3,"translate"),_.Dc()),2&o&&(_.lc(2),_.rd(" ",_.Qc(3,1,"core.notsent")," "))}function AddonModWorkshopSubmissionComponent_ion_item_2_ion_note_13_div_4_Template(o,e){1&o&&(_.Ec(0,"div"),_.zc(1,"ion-icon",14),_.pd(2),_.Pc(3,"translate"),_.Dc()),2&o&&(_.lc(2),_.rd(" ",_.Qc(3,1,"core.deletedoffline")," "))}function AddonModWorkshopSubmissionComponent_ion_item_2_ion_note_13_Template(o,e){if(1&o&&(_.Ec(0,"ion-note",12),_.pd(1),_.Pc(2,"coreDateDayOrTime"),_.nd(3,AddonModWorkshopSubmissionComponent_ion_item_2_ion_note_13_div_3_Template,4,3,"div",1),_.nd(4,AddonModWorkshopSubmissionComponent_ion_item_2_ion_note_13_div_4_Template,4,3,"div",1),_.Dc()),2&o){const o=_.Oc(2);_.lc(1),_.rd(" ",_.Qc(2,3,o.submission.timemodified)," "),_.lc(2),_.Vc("ngIf",o.offline),_.lc(1),_.Vc("ngIf",o.submission.deleted)}}function AddonModWorkshopSubmissionComponent_ion_item_2_Template(o,e){if(1&o){const o=_.Fc();_.Ec(0,"ion-item",22),_.Mc("click",(function AddonModWorkshopSubmissionComponent_ion_item_2_Template_ion_item_click_0_listener(){_.fd(o);return _.Oc().gotoSubmission()})),_.zc(1,"core-user-avatar",4),_.Ec(2,"ion-label"),_.Ec(3,"h2"),_.zc(4,"core-format-text",5),_.Dc(),_.nd(5,AddonModWorkshopSubmissionComponent_ion_item_2_p_5_Template,2,1,"p",1),_.nd(6,AddonModWorkshopSubmissionComponent_ion_item_2_p_6_Template,3,5,"p",1),_.nd(7,AddonModWorkshopSubmissionComponent_ion_item_2_p_7_Template,3,5,"p",1),_.nd(8,AddonModWorkshopSubmissionComponent_ion_item_2_p_8_Template,3,7,"p",1),_.nd(9,AddonModWorkshopSubmissionComponent_ion_item_2_p_9_Template,3,7,"p",7),_.nd(10,AddonModWorkshopSubmissionComponent_ion_item_2_p_10_Template,3,7,"p",1),_.nd(11,AddonModWorkshopSubmissionComponent_ion_item_2_ion_badge_11_Template,3,3,"ion-badge",23),_.nd(12,AddonModWorkshopSubmissionComponent_ion_item_2_ion_badge_12_Template,3,3,"ion-badge",24),_.Dc(),_.nd(13,AddonModWorkshopSubmissionComponent_ion_item_2_ion_note_13_Template,5,5,"ion-note",8),_.Dc()}if(2&o){const o=_.Oc();_.Vc("detail",o.submission.timemodified)("button",o.submission.timemodified),_.lc(1),_.Vc("user",o.profile)("courseId",o.courseId)("userId",null==o.profile?null:o.profile.id),_.lc(3),_.Vc("text",o.submission.title)("contextInstanceId",o.module.id)("courseId",o.courseId),_.lc(1),_.Vc("ngIf",o.profile&&o.profile.fullname),_.lc(1),_.Vc("ngIf",o.submission.reviewedbydone),_.lc(1),_.Vc("ngIf",o.submission.reviewerofdone),_.lc(1),_.Vc("ngIf",!o.showGrade(o.submission.gradeover)&&o.showGrade(o.submission.grade)),_.lc(1),_.Vc("ngIf",o.showGrade(o.submission.gradeover)),_.lc(1),_.Vc("ngIf",o.access.canviewallsubmissions&&o.showGrade(o.submission.gradinggrade)),_.lc(1),_.Vc("ngIf",o.assessment&&(o.showGrade(o.assessment.grade)||o.assessment.offline)),_.lc(1),_.Vc("ngIf",o.assessment&&!o.showGrade(o.assessment.grade)&&!o.assessment.offline),_.lc(1),_.Vc("ngIf",o.submission.timemodified)}}let A=(()=>{class AddonModWorkshopSubmissionComponent{constructor(){this.summary=!1,this.component=l.a,this.loaded=!1,this.offline=!1,this.viewDetails=!1,this.userId=t.b.getCurrentSiteUserId(),this.showGrade=c.AddonModWorkshopHelper.showGrade}ngOnInit(){var o,e;this.componentId=this.module.instance,this.userId=this.submission.authorid||this.userId;const s=[];this.offline=!!(null===(o=this.submission)||void 0===o?void 0:o.offline)||!!(null===(e=this.assessment)||void 0===e?void 0:e.offline),this.submission.id&&s.push(r.AddonModWorkshopOffline.getEvaluateSubmission(this.workshop.id,this.submission.id).then((o=>{this.submission.gradeover=parseInt(o.gradeover,10),this.offline=!0})).catch((()=>{}))),this.userId&&s.push(n.a.getProfile(this.userId,this.courseId,!0).then((o=>{this.profile=o}))),this.viewDetails=!this.summary&&this.workshop.phase==a.AddonModWorkshopPhase.PHASE_CLOSED&&i.a.getCurrentRoute().component!=d.a,this.viewDetails&&this.submission.gradeoverby&&s.push(n.a.getProfile(this.submission.gradeoverby,this.courseId,!0).then((o=>{this.evaluateByProfile=o}))),Promise.all(s).finally((()=>{this.loaded=!0}))}gotoSubmission(){if(this.submission.timemodified){i.a.navigateToSitePath(`${l.b}/${this.courseId}/${this.module.id}/${this.submission.id}`,{params:{module:this.module,workshop:this.workshop,access:this.access,profile:this.profile,submission:this.submission,assessment:this.assessment}})}}}return AddonModWorkshopSubmissionComponent.ɵfac=function AddonModWorkshopSubmissionComponent_Factory(o){return new(o||AddonModWorkshopSubmissionComponent)},AddonModWorkshopSubmissionComponent.ɵcmp=_.sc({type:AddonModWorkshopSubmissionComponent,selectors:[["addon-mod-workshop-submission"]],inputs:{submission:"submission",module:"module",workshop:"workshop",access:"access",courseId:"courseId",assessment:"assessment",summary:"summary"},decls:3,vars:3,consts:[[3,"hideUntil"],[4,"ngIf"],["class","ion-text-wrap",3,"detail","button","click",4,"ngIf"],[1,"ion-text-wrap","addon-workshop-submission-title"],["slot","start",3,"user","courseId","userId"],["contextLevel","module",3,"text","contextInstanceId","courseId"],[3,"addon-has-overriden-grade",4,"ngIf"],["class","addon-overriden-grade",4,"ngIf"],["slot","end",4,"ngIf"],["class","ion-text-wrap",4,"ngIf"],[3,"files","component","componentId"],[1,"addon-overriden-grade"],["slot","end"],["name","fas-clock","aria-hidden","true"],["name","fas-trash","aria-hidden","true"],[1,"ion-text-wrap"],["contextLevel","module",3,"component","componentId","text","contextInstanceId","courseId"],["slot","start",3,"user","courseId","userId",4,"ngIf"],["class","item-heading",4,"ngIf"],[1,"item-heading"],["expand","block",3,"click"],["name","fas-chevron-right","slot","end","aria-hidden","true"],[1,"ion-text-wrap",3,"detail","button","click"],["color","success","class","ion-text-wrap",4,"ngIf"],["color","danger","class","ion-text-wrap",4,"ngIf"],["color","success",1,"ion-text-wrap"],["color","danger",1,"ion-text-wrap"]],template:function AddonModWorkshopSubmissionComponent_Template(o,e){1&o&&(_.Ec(0,"core-loading",0),_.nd(1,AddonModWorkshopSubmissionComponent_div_1_Template,16,18,"div",1),_.nd(2,AddonModWorkshopSubmissionComponent_ion_item_2_Template,14,17,"ion-item",2),_.Dc()),2&o&&(_.Vc("hideUntil",e.loaded),_.lc(1),_.Vc("ngIf",!e.summary),_.lc(1),_.Vc("ngIf",e.summary))},directives:[m.a,h.t,p.I,u.a,p.O,f.a,g.a,p.W,p.D,k.a,b.a,p.l,p.k],pipes:[I.d,v.a],styles:["[_nghost-%COMP%]   p.addon-overriden-grade[_ngcontent-%COMP%]{color:var(--success)}[_nghost-%COMP%]   p.addon-has-overriden-grade[_ngcontent-%COMP%]{color:var(--danger);text-decoration:line-through}"]}),AddonModWorkshopSubmissionComponent})()},WoAp:function(o,e,s){"use strict";(function(o){s.d(e,"a",(function(){return E}));var n=s("mrSG"),i=s("3Pt+"),t=s("ULAo"),d=s("FvYb"),a=s("4pns"),c=s("pHTc"),r=s("9+EE"),l=s("uT8i"),_=s("3LXp"),m=s("vuGA"),h=s("j3ag"),p=s("fjkH"),u=s("4reR"),f=s("Lkkz"),g=s("i1f9"),k=s("8/zp"),b=s("EyWp"),I=s("GuJL"),v=s("D7J2"),A=s("8vmT"),w=s("DJrq"),M=s("fXoL"),S=s("TEn/");const W=["feedbackFormEl"];function AddonModWorkshopSubmissionPage_core_format_text_7_Template(o,e){if(1&o&&M.zc(0,"core-format-text",11),2&o){const o=M.Oc();M.Vc("text",o.title)("contextInstanceId",o.module.id)("courseId",o.courseId)}}function AddonModWorkshopSubmissionPage_ion_button_9_Template(o,e){if(1&o){const o=M.Fc();M.Ec(0,"ion-button",12),M.Mc("click",(function AddonModWorkshopSubmissionPage_ion_button_9_Template_ion_button_click_0_listener(){M.fd(o);return M.Oc().saveAssessment()})),M.Pc(1,"translate"),M.pd(2),M.Pc(3,"translate"),M.Dc()}2&o&&(M.mc("aria-label",M.Qc(1,2,"core.save")),M.lc(2),M.rd(" ",M.Qc(3,4,"core.save")," "))}function AddonModWorkshopSubmissionPage_ion_button_10_Template(o,e){if(1&o){const o=M.Fc();M.Ec(0,"ion-button",12),M.Mc("click",(function AddonModWorkshopSubmissionPage_ion_button_10_Template_ion_button_click_0_listener(){M.fd(o);return M.Oc().saveEvaluation()})),M.pd(1),M.Pc(2,"translate"),M.Dc()}2&o&&(M.lc(1),M.rd(" ",M.Qc(2,1,"core.save")," "))}function AddonModWorkshopSubmissionPage_ion_refresher_12_Template(o,e){if(1&o){const o=M.Fc();M.Ec(0,"ion-refresher",13),M.Mc("ionRefresh",(function AddonModWorkshopSubmissionPage_ion_refresher_12_Template_ion_refresher_ionRefresh_0_listener(e){M.fd(o);return M.Oc().refreshSubmission(e.target)})),M.zc(1,"ion-refresher-content",14),M.Pc(2,"translate"),M.Dc()}if(2&o){const o=M.Oc();M.Vc("disabled",!o.loaded),M.lc(1),M.Wc("pullingText",M.Qc(2,2,"core.pulltorefresh"))}}function AddonModWorkshopSubmissionPage_ion_list_14_ion_item_2_ion_button_2_Template(o,e){if(1&o){const o=M.Fc();M.Ec(0,"ion-button",21),M.Mc("click",(function AddonModWorkshopSubmissionPage_ion_list_14_ion_item_2_ion_button_2_Template_ion_button_click_0_listener(){M.fd(o);return M.Oc(3).editSubmission()})),M.zc(1,"ion-icon",22),M.pd(2),M.Pc(3,"translate"),M.Dc()}2&o&&(M.lc(2),M.rd(" ",M.Qc(3,1,"addon.mod_workshop.editsubmission")," "))}function AddonModWorkshopSubmissionPage_ion_list_14_ion_item_2_ion_button_3_Template(o,e){if(1&o){const o=M.Fc();M.Ec(0,"ion-button",23),M.Mc("click",(function AddonModWorkshopSubmissionPage_ion_list_14_ion_item_2_ion_button_3_Template_ion_button_click_0_listener(){M.fd(o);return M.Oc(3).deleteSubmission()})),M.zc(1,"ion-icon",24),M.pd(2),M.Pc(3,"translate"),M.Dc()}2&o&&(M.lc(2),M.rd(" ",M.Qc(3,1,"addon.mod_workshop.deletesubmission")," "))}function AddonModWorkshopSubmissionPage_ion_list_14_ion_item_2_ion_button_4_Template(o,e){if(1&o){const o=M.Fc();M.Ec(0,"ion-button",25),M.Mc("click",(function AddonModWorkshopSubmissionPage_ion_list_14_ion_item_2_ion_button_4_Template_ion_button_click_0_listener(){M.fd(o);return M.Oc(3).undoDeleteSubmission()})),M.zc(1,"ion-icon",26),M.pd(2),M.Pc(3,"translate"),M.Dc()}2&o&&(M.lc(2),M.rd(" ",M.Qc(3,1,"core.restore")," "))}function AddonModWorkshopSubmissionPage_ion_list_14_ion_item_2_Template(o,e){if(1&o&&(M.Ec(0,"ion-item",17),M.Ec(1,"ion-label"),M.nd(2,AddonModWorkshopSubmissionPage_ion_list_14_ion_item_2_ion_button_2_Template,4,3,"ion-button",18),M.nd(3,AddonModWorkshopSubmissionPage_ion_list_14_ion_item_2_ion_button_3_Template,4,3,"ion-button",19),M.nd(4,AddonModWorkshopSubmissionPage_ion_list_14_ion_item_2_ion_button_4_Template,4,3,"ion-button",20),M.Dc(),M.Dc()),2&o){const o=M.Oc(2);M.lc(2),M.Vc("ngIf",o.canEdit),M.lc(1),M.Vc("ngIf",!o.submission.deleted&&o.canDelete),M.lc(1),M.Vc("ngIf",o.submission.deleted&&o.canDelete)}}function AddonModWorkshopSubmissionPage_ion_list_14_Template(o,e){if(1&o&&(M.Ec(0,"ion-list"),M.zc(1,"addon-mod-workshop-submission",15),M.nd(2,AddonModWorkshopSubmissionPage_ion_list_14_ion_item_2_Template,5,3,"ion-item",16),M.Dc()),2&o){const o=M.Oc();M.lc(1),M.Vc("submission",o.submission)("courseId",o.courseId)("module",o.module)("workshop",o.workshop)("access",o.access),M.lc(1),M.Vc("ngIf",o.canEdit||o.canDelete)}}function AddonModWorkshopSubmissionPage_ion_list_15_core_user_avatar_2_Template(o,e){if(1&o&&M.zc(0,"core-user-avatar",28),2&o){const o=M.Oc(2);M.Vc("user",o.evaluateByProfile)("courseId",o.courseId)("userId",o.evaluateByProfile.id)}}const _c1=function(o){return{$a:o}};function AddonModWorkshopSubmissionPage_ion_list_15_h2_4_Template(o,e){if(1&o&&(M.Ec(0,"h2"),M.pd(1),M.Pc(2,"translate"),M.Dc()),2&o){const o=M.Oc(2);M.lc(1),M.rd(" ",M.Rc(2,1,"addon.mod_workshop.feedbackby",M.ad(4,_c1,o.evaluateByProfile.fullname))," ")}}function AddonModWorkshopSubmissionPage_ion_list_15_Template(o,e){if(1&o&&(M.Ec(0,"ion-list"),M.Ec(1,"ion-item",17),M.nd(2,AddonModWorkshopSubmissionPage_ion_list_15_core_user_avatar_2_Template,1,3,"core-user-avatar",27),M.Ec(3,"ion-label"),M.nd(4,AddonModWorkshopSubmissionPage_ion_list_15_h2_4_Template,3,6,"h2",8),M.zc(5,"core-format-text",11),M.Dc(),M.Dc(),M.Dc()),2&o){const o=M.Oc();M.lc(2),M.Vc("ngIf",o.evaluateByProfile),M.lc(2),M.Vc("ngIf",o.evaluateByProfile&&o.evaluateByProfile.fullname),M.lc(1),M.Vc("text",null==o.evaluate?null:o.evaluate.text)("contextInstanceId",o.module.id)("courseId",o.courseId)}}function AddonModWorkshopSubmissionPage_ion_list_16_Template(o,e){if(1&o&&(M.Ec(0,"ion-list"),M.Ec(1,"ion-item",17),M.Ec(2,"ion-label"),M.Ec(3,"h2"),M.pd(4),M.Pc(5,"translate"),M.Dc(),M.Dc(),M.Dc(),M.zc(6,"addon-mod-workshop-assessment",29),M.Dc()),2&o){const o=M.Oc();M.lc(4),M.qd(M.Qc(5,7,"addon.mod_workshop.yourassessment")),M.lc(2),M.Vc("submission",o.submission)("assessment",o.ownAssessment)("courseId",o.courseId)("access",o.access)("module",o.module)("workshop",o.workshop)}}function AddonModWorkshopSubmissionPage_ion_list_17_ng_container_6_addon_mod_workshop_assessment_1_Template(o,e){if(1&o&&M.zc(0,"addon-mod-workshop-assessment",29),2&o){const o=M.Oc().$implicit,e=M.Oc(2);M.Vc("submission",e.submission)("assessment",o)("courseId",e.courseId)("access",e.access)("module",e.module)("workshop",e.workshop)}}function AddonModWorkshopSubmissionPage_ion_list_17_ng_container_6_Template(o,e){if(1&o&&(M.Cc(0),M.nd(1,AddonModWorkshopSubmissionPage_ion_list_17_ng_container_6_addon_mod_workshop_assessment_1_Template,1,6,"addon-mod-workshop-assessment",32),M.Bc()),2&o){const o=e.$implicit;M.lc(1),M.Vc("ngIf",!o.ownAssessment)}}function AddonModWorkshopSubmissionPage_ion_list_17_Template(o,e){if(1&o&&(M.Ec(0,"ion-list"),M.Ec(1,"ion-item",17),M.Ec(2,"ion-label"),M.Ec(3,"h3",30),M.pd(4),M.Pc(5,"translate"),M.Dc(),M.Dc(),M.Dc(),M.nd(6,AddonModWorkshopSubmissionPage_ion_list_17_ng_container_6_Template,2,1,"ng-container",31),M.Dc()),2&o){const o=M.Oc();M.lc(4),M.qd(M.Qc(5,2,"addon.mod_workshop.receivedgrades")),M.lc(2),M.Vc("ngForOf",o.submissionInfo.reviewedby)}}function AddonModWorkshopSubmissionPage_ion_list_18_addon_mod_workshop_assessment_6_Template(o,e){if(1&o&&M.zc(0,"addon-mod-workshop-assessment",34),2&o){const o=e.$implicit,s=M.Oc(2);M.Vc("assessment",o)("courseId",s.courseId)("module",s.module)("workshop",s.workshop)("access",s.access)}}function AddonModWorkshopSubmissionPage_ion_list_18_Template(o,e){if(1&o&&(M.Ec(0,"ion-list"),M.Ec(1,"ion-item",17),M.Ec(2,"ion-label"),M.Ec(3,"h3",30),M.pd(4),M.Pc(5,"translate"),M.Dc(),M.Dc(),M.Dc(),M.nd(6,AddonModWorkshopSubmissionPage_ion_list_18_addon_mod_workshop_assessment_6_Template,1,5,"addon-mod-workshop-assessment",33),M.Dc()),2&o){const o=M.Oc();M.lc(4),M.qd(M.Qc(5,2,"addon.mod_workshop.givengrades")),M.lc(2),M.Vc("ngForOf",o.submissionInfo.reviewerof)}}function AddonModWorkshopSubmissionPage_form_19_ion_item_7_Template(o,e){1&o&&(M.Ec(0,"ion-item",17),M.Ec(1,"ion-label"),M.pd(2),M.Pc(3,"translate"),M.Dc(),M.zc(4,"ion-toggle",41),M.Ec(5,"p",42),M.pd(6),M.Pc(7,"translate"),M.Dc(),M.Dc()),2&o&&(M.lc(2),M.qd(M.Qc(3,2,"addon.mod_workshop.publishsubmission")),M.lc(4),M.qd(M.Qc(7,4,"addon.mod_workshop.publishsubmission_help")))}function AddonModWorkshopSubmissionPage_form_19_ion_select_option_22_Template(o,e){if(1&o&&(M.Ec(0,"ion-select-option",43),M.pd(1),M.Dc()),2&o){const o=e.$implicit;M.Vc("value",o.value),M.lc(1),M.rd(" ",o.label," ")}}const _c2=function(o){return{header:o}},_c3=function(o){return{id:o}};function AddonModWorkshopSubmissionPage_form_19_Template(o,e){if(1&o&&(M.Ec(0,"form",35,36),M.Ec(2,"ion-item",17),M.Ec(3,"ion-label"),M.Ec(4,"h3",30),M.pd(5),M.Pc(6,"translate"),M.Dc(),M.Dc(),M.Dc(),M.nd(7,AddonModWorkshopSubmissionPage_form_19_ion_item_7_Template,8,6,"ion-item",16),M.Ec(8,"ion-item",17),M.Ec(9,"ion-label"),M.Ec(10,"h3",30),M.pd(11),M.Pc(12,"translate"),M.Dc(),M.Ec(13,"p"),M.pd(14),M.Dc(),M.Dc(),M.Dc(),M.Ec(15,"ion-item",17),M.Ec(16,"ion-label",37),M.pd(17),M.Pc(18,"translate"),M.Dc(),M.Ec(19,"ion-select",38),M.Pc(20,"translate"),M.Pc(21,"translate"),M.nd(22,AddonModWorkshopSubmissionPage_form_19_ion_select_option_22_Template,2,2,"ion-select-option",39),M.Dc(),M.Dc(),M.Ec(23,"ion-item"),M.Ec(24,"ion-label",37),M.pd(25),M.Pc(26,"translate"),M.Dc(),M.zc(27,"core-rich-text-editor",40),M.Dc(),M.Dc()),2&o){const o=M.Oc();M.Vc("formGroup",o.feedbackForm),M.lc(5),M.qd(M.Qc(6,14,"addon.mod_workshop.feedbackauthor")),M.lc(2),M.Vc("ngIf",o.access.canpublishsubmissions),M.lc(4),M.qd(M.Qc(12,16,"addon.mod_workshop.gradecalculated")),M.lc(3),M.qd(o.submission.grade),M.lc(3),M.qd(M.Qc(18,18,"addon.mod_workshop.gradeover")),M.lc(2),M.Vc("cancelText",M.Qc(20,20,"core.cancel"))("interfaceOptions",M.ad(26,_c2,M.Qc(21,22,"addon.mod_workshop.gradeover"))),M.lc(3),M.Vc("ngForOf",o.evaluationGrades),M.lc(3),M.qd(M.Qc(26,24,"addon.mod_workshop.feedbackauthor")),M.lc(2),M.Vc("control",o.feedbackForm.controls.text)("autoSave",!0)("contextInstanceId",o.module.id)("draftExtraParams",M.ad(28,_c3,o.submissionId))}}function AddonModWorkshopSubmissionPage_addon_mod_workshop_assessment_strategy_20_Template(o,e){if(1&o&&M.zc(0,"addon-mod-workshop-assessment-strategy",44),2&o){const o=M.Oc();M.Vc("workshop",o.workshop)("access",o.access)("assessmentId",o.assessmentId)("userId",o.assessmentUserId)("strategy",o.strategy)("edit",o.access.assessingallowed)}}function AddonModWorkshopSubmissionPage_ion_list_21_core_user_avatar_2_Template(o,e){if(1&o&&M.zc(0,"core-user-avatar",28),2&o){const o=M.Oc(2);M.Vc("user",o.evaluateGradingByProfile)("courseId",o.courseId)("userId",o.evaluateGradingByProfile.id)}}function AddonModWorkshopSubmissionPage_ion_list_21_h3_4_Template(o,e){if(1&o&&(M.Ec(0,"h3",30),M.pd(1),M.Pc(2,"translate"),M.Dc()),2&o){const o=M.Oc(2);M.lc(1),M.rd(" ",M.Rc(2,1,"addon.mod_workshop.feedbackby",M.ad(4,_c1,o.evaluateGradingByProfile.fullname))," ")}}function AddonModWorkshopSubmissionPage_ion_list_21_Template(o,e){if(1&o&&(M.Ec(0,"ion-list"),M.Ec(1,"ion-item",17),M.nd(2,AddonModWorkshopSubmissionPage_ion_list_21_core_user_avatar_2_Template,1,3,"core-user-avatar",27),M.Ec(3,"ion-label"),M.nd(4,AddonModWorkshopSubmissionPage_ion_list_21_h3_4_Template,3,6,"h3",45),M.zc(5,"core-format-text",11),M.Dc(),M.Dc(),M.Dc()),2&o){const o=M.Oc();M.lc(2),M.Vc("ngIf",o.evaluateGradingByProfile),M.lc(2),M.Vc("ngIf",o.evaluateGradingByProfile&&o.evaluateGradingByProfile.fullname),M.lc(1),M.Vc("text",o.assessment.feedbackreviewer)("contextInstanceId",o.module.id)("courseId",o.courseId)}}let E=(()=>{class AddonModWorkshopSubmissionPage{constructor(o,e){this.fb=o,this.content=e,this.loaded=!1,this.canAddFeedback=!1,this.canEdit=!1,this.canDelete=!1,this.evaluationGrades=[],this.originalEvaluation={published:!1,text:"",grade:""},this.hasOffline=!1,this.component=w.a,this.forceLeave=!1,this.isDestroyed=!1,this.currentUserId=r.b.getCurrentSiteUserId(),this.siteId=r.b.getCurrentSiteId(),this.feedbackForm=new i.j({}),this.feedbackForm.addControl("published",this.fb.control("")),this.feedbackForm.addControl("grade",this.fb.control("")),this.feedbackForm.addControl("text",this.fb.control("")),this.obsAssessmentSaved=p.b.on(g.AddonModWorkshopProvider.ASSESSMENT_SAVED,(o=>{this.eventReceived(o)}),this.siteId),this.syncObserver=p.b.on(I.AddonModWorkshopSyncProvider.AUTO_SYNCED,(o=>{this.eventReceived(o)}),this.siteId),this.logView=A.a.once((()=>this.performLogView()))}ngOnInit(){var o,e,s;return Object(n.a)(this,void 0,void 0,(function*(){try{this.submissionId=c.a.getRequiredRouteNumberParam("submissionId"),this.module=c.a.getRequiredRouteParam("module"),this.workshop=c.a.getRequiredRouteParam("workshop"),this.access=c.a.getRequiredRouteParam("access"),this.courseId=c.a.getRequiredRouteNumberParam("courseId"),this.profile=c.a.getRouteParam("profile"),this.submissionInfo=c.a.getRequiredRouteParam("submission"),this.assessment=c.a.getRouteParam("assessment")}catch(o){return _.a.showErrorModal(o),c.a.back(),void 0}this.title=this.module.name,this.workshopId=this.module.instance||this.workshop.id,this.userId=null===(o=this.submissionInfo)||void 0===o?void 0:o.authorid,this.strategy=this.assessment&&this.assessment.strategy||this.workshop&&this.workshop.strategy,this.assessmentId=null===(e=this.assessment)||void 0===e?void 0:e.id,this.assessmentUserId=null===(s=this.assessment)||void 0===s?void 0:s.reviewerid,yield this.fetchSubmissionData(),this.logView()}))}canLeave(){var o;return Object(n.a)(this,void 0,void 0,(function*(){const e=null===(o=this.assessmentStrategy)||void 0===o?void 0:o.hasDataChanged();return this.forceLeave||!this.hasEvaluationChanged()&&!e||(yield _.a.showConfirm(h.I.instant("core.confirmcanceledit")),u.a.triggerFormCancelledEvent(this.formElement,this.siteId)),!0}))}editSubmission(){const e={module:o,access:this.access};c.a.navigate(String(this.submissionId)+"/edit",e)}eventReceived(o){var e;this.workshopId===o.workshopId&&(null===(e=this.content)||void 0===e?void 0:e.scrollToTop(),this.loaded=!1,this.refreshAllData())}fetchSubmissionData(){var o,e,s;return Object(n.a)(this,void 0,void 0,(function*(){try{this.submission=yield k.AddonModWorkshopHelper.getSubmissionById(this.workshopId,this.submissionId,{cmId:this.module.id});const n=[];if(this.submission.grade=null===(o=this.submissionInfo)||void 0===o?void 0:o.grade,this.submission.gradinggrade=null===(e=this.submissionInfo)||void 0===e?void 0:e.gradinggrade,this.submission.gradeover=null===(s=this.submissionInfo)||void 0===s?void 0:s.gradeover,this.userId=this.submission.authorid||this.userId,this.canEdit=this.currentUserId==this.userId&&this.access.cansubmit&&this.access.modifyingsubmissionallowed,this.canDelete=this.access.candeletesubmissions,this.canAddFeedback=!this.assessmentId&&this.workshop.phase>g.AddonModWorkshopPhase.PHASE_ASSESSMENT&&this.workshop.phase<g.AddonModWorkshopPhase.PHASE_CLOSED&&this.access.canoverridegrades,this.ownAssessment=void 0,this.access.canviewallassessments)n.push(g.AddonModWorkshop.getSubmissionAssessments(this.workshopId,this.submissionId,{cmId:this.module.id}).then((o=>{this.canDelete&&(this.canDelete=!o.length),this.submissionInfo.reviewedby=o,this.submissionInfo.reviewedby.forEach((o=>{o=k.AddonModWorkshopHelper.realGradeValue(this.workshop,o),this.currentUserId==o.reviewerid&&(this.ownAssessment=o,o.ownAssessment=!0)}))})));else if(this.currentUserId===this.userId&&this.assessmentId)n.push(g.AddonModWorkshop.getAssessment(this.workshopId,this.assessmentId,{cmId:this.module.id}).then((o=>{this.canDelete&&(this.canDelete=!o),this.submissionInfo.reviewedby=[this.parseAssessment(o)]})));else if(this.workshop.phase===g.AddonModWorkshopPhase.PHASE_CLOSED&&this.userId===this.currentUserId){const o=yield g.AddonModWorkshop.getSubmissionAssessments(this.workshopId,this.submissionId,{cmId:this.module.id});this.submissionInfo.reviewedby=o.map((o=>this.parseAssessment(o)))}(this.canAddFeedback||this.workshop.phase===g.AddonModWorkshopPhase.PHASE_CLOSED)&&(this.evaluate={published:this.submission.published,text:this.submission.feedbackauthor||""}),this.canAddFeedback?(this.isDestroyed||l.a.blockOperation(this.component,this.workshopId),n.push(this.fillEvaluationsGrades())):this.workshop.phase===g.AddonModWorkshopPhase.PHASE_CLOSED&&this.submission.gradeoverby&&this.evaluate&&this.evaluate.text&&n.push(a.a.getProfile(this.submission.gradeoverby,this.courseId,!0).then((o=>{this.evaluateByProfile=o}))),this.assessment&&!this.access.assessingallowed&&this.assessment.feedbackreviewer&&this.assessment.gradinggradeoverby&&n.push(a.a.getProfile(this.assessment.gradinggradeoverby,this.courseId,!0).then((o=>{this.evaluateGradingByProfile=o}))),yield Promise.all(n);const i=yield b.AddonModWorkshopOffline.getSubmissions(this.workshopId);this.submission=yield k.AddonModWorkshopHelper.applyOfflineData(this.submission,i)}catch(o){_.a.showErrorModalDefault(o,"core.course.errorgetmodule",!0)}finally{this.loaded=!0}}))}fillEvaluationsGrades(){return Object(n.a)(this,void 0,void 0,(function*(){const o=h.I.instant("addon.mod_workshop.notoverridden");if(this.evaluationGrades=yield d.a.makeGradesMenu(this.workshop.grade||0,void 0,o,-1),this.evaluate){this.evaluate.grade={label:d.a.getGradeLabelFromValue(this.evaluationGrades,this.submissionInfo.gradeover)||o,value:this.submissionInfo.gradeover||-1};try{const e=yield b.AddonModWorkshopOffline.getEvaluateSubmission(this.workshopId,this.submissionId);this.hasOffline=!0,this.evaluate.published=e.published,this.evaluate.text=e.feedbacktext,this.evaluate.grade={label:d.a.getGradeLabelFromValue(this.evaluationGrades,parseInt(e.gradeover,10))||o,value:e.gradeover||-1}}catch(o){this.hasOffline=!1}finally{this.originalEvaluation.published=this.evaluate.published,this.originalEvaluation.text=this.evaluate.text,this.originalEvaluation.grade=this.evaluate.grade.value,this.feedbackForm.controls.published.setValue(this.evaluate.published),this.feedbackForm.controls.grade.setValue(this.evaluate.grade.value),this.feedbackForm.controls.text.setValue(this.evaluate.text)}}}))}parseAssessment(o){return o=k.AddonModWorkshopHelper.realGradeValue(this.workshop,o),this.currentUserId==o.reviewerid&&(this.ownAssessment=o,o.ownAssessment=!0),o}forceLeavePage(){this.forceLeave=!0,c.a.back()}hasEvaluationChanged(){if(!this.loaded||!this.access.canoverridegrades)return!1;const o=this.feedbackForm.value;return this.originalEvaluation.published!=o.published||(this.originalEvaluation.text!=o.text||this.originalEvaluation.grade!=o.grade)}refreshAllData(){return Object(n.a)(this,void 0,void 0,(function*(){const o=[];o.push(g.AddonModWorkshop.invalidateSubmissionData(this.workshopId,this.submissionId)),o.push(g.AddonModWorkshop.invalidateSubmissionsData(this.workshopId)),o.push(g.AddonModWorkshop.invalidateSubmissionAssesmentsData(this.workshopId,this.submissionId)),this.assessmentId&&(o.push(g.AddonModWorkshop.invalidateAssessmentFormData(this.workshopId,this.assessmentId)),o.push(g.AddonModWorkshop.invalidateAssessmentData(this.workshopId,this.assessmentId))),this.assessmentUserId&&o.push(g.AddonModWorkshop.invalidateReviewerAssesmentsData(this.workshopId,this.assessmentId));try{yield Promise.all(o)}finally{p.b.trigger(g.AddonModWorkshopProvider.ASSESSMENT_INVALIDATED,null,this.siteId),yield this.fetchSubmissionData(),this.logView()}}))}refreshSubmission(o){this.loaded&&this.refreshAllData().finally((()=>{null==o?void 0:o.complete()}))}saveAssessment(){var o;return Object(n.a)(this,void 0,void 0,(function*(){if(null===(o=this.assessmentStrategy)||void 0===o?void 0:o.hasDataChanged())try{yield this.assessmentStrategy.saveAssessment(),this.forceLeavePage()}catch(o){}else this.forceLeavePage()}))}saveEvaluation(){return Object(n.a)(this,void 0,void 0,(function*(){this.hasEvaluationChanged()?(yield this.sendEvaluation(),this.forceLeavePage()):this.forceLeavePage()}))}sendEvaluation(){return Object(n.a)(this,void 0,void 0,(function*(){const o=yield _.a.showModalLoading("core.sending",!0),e=this.feedbackForm.value;e.grade=e.grade>=0?e.grade:"",e.text=m.b.formatHtmlLines(e.text);try{const o=yield g.AddonModWorkshop.evaluateSubmission(this.workshopId,this.submissionId,this.courseId,e.text,e.published,String(e.grade));u.a.triggerFormSubmittedEvent(this.formElement,!!o,this.siteId),yield g.AddonModWorkshop.invalidateSubmissionData(this.workshopId,this.submissionId).finally((()=>{p.b.trigger(g.AddonModWorkshopProvider.SUBMISSION_CHANGED,{workshopId:this.workshopId,submissionId:this.submissionId},this.siteId)}))}catch(o){_.a.showErrorModalDefault(o,"Cannot save submission evaluation")}finally{o.dismiss()}}))}deleteSubmission(){return Object(n.a)(this,void 0,void 0,(function*(){try{yield _.a.showDeleteConfirm("addon.mod_workshop.submissiondeleteconfirm")}catch(o){return}const o=yield _.a.showModalLoading("core.deleting",!0);let e=!1;try{yield g.AddonModWorkshop.deleteSubmission(this.workshopId,this.submissionId,this.courseId),e=!0,yield g.AddonModWorkshop.invalidateSubmissionData(this.workshopId,this.submissionId)}catch(o){_.a.showErrorModalDefault(o,"Cannot delete submission")}finally{if(o.dismiss(),e){p.b.trigger(g.AddonModWorkshopProvider.SUBMISSION_CHANGED,{workshopId:this.workshopId,submissionId:this.submissionId},this.siteId),this.forceLeavePage()}}}))}undoDeleteSubmission(){return Object(n.a)(this,void 0,void 0,(function*(){yield b.AddonModWorkshopOffline.deleteSubmissionAction(this.workshopId,g.AddonModWorkshopAction.DELETE).finally((()=>Object(n.a)(this,void 0,void 0,(function*(){p.b.trigger(g.AddonModWorkshopProvider.SUBMISSION_CHANGED,{workshopId:this.workshopId,submissionId:this.submissionId},this.siteId),yield this.refreshAllData()}))))}))}performLogView(){return Object(n.a)(this,void 0,void 0,(function*(){try{yield g.AddonModWorkshop.logViewSubmission(this.submissionId,this.workshopId),t.a.checkModuleCompletion(this.courseId,this.module.completiondata)}catch(o){}v.a.logEvent({type:v.b.VIEW_ITEM,ws:"mod_workshop_view_submission",name:this.workshop.name,data:{id:this.workshop.id,submissionid:this.submissionId,category:"workshop"},url:`/mod/workshop/submission.php?cmid=${this.module.id}&id=${this.submissionId}`})}))}ngOnDestroy(){var o,e;this.isDestroyed=!0,null===(o=this.syncObserver)||void 0===o||o.off(),null===(e=this.obsAssessmentSaved)||void 0===e||e.off(),l.a.unblockOperation(this.component,this.workshopId)}}return AddonModWorkshopSubmissionPage.ɵfac=function AddonModWorkshopSubmissionPage_Factory(o){return new(o||AddonModWorkshopSubmissionPage)(M.yc(i.f),M.yc(S.v,8))},AddonModWorkshopSubmissionPage.ɵcmp=M.sc({type:AddonModWorkshopSubmissionPage,selectors:[["page-addon-mod-workshop-submission-page"]],viewQuery:function AddonModWorkshopSubmissionPage_Query(o,e){var s;(1&o&&(M.ud(f.a,!0),M.ud(W,!0)),2&o)&&(M.dd(s=M.Nc())&&(e.assessmentStrategy=s.first),M.dd(s=M.Nc())&&(e.formElement=s.first))},decls:22,vars:17,consts:[["slot","start"],[3,"text"],["contextLevel","module",3,"text","contextInstanceId","courseId",4,"ngIf"],["slot","end",3,"hidden"],["fill","clear",3,"click",4,"ngIf"],[1,"limited-width"],["slot","fixed",3,"disabled","ionRefresh",4,"ngIf"],[3,"hideUntil"],[4,"ngIf"],[3,"formGroup",4,"ngIf"],[3,"workshop","access","assessmentId","userId","strategy","edit",4,"ngIf"],["contextLevel","module",3,"text","contextInstanceId","courseId"],["fill","clear",3,"click"],["slot","fixed",3,"disabled","ionRefresh"],[3,"pullingText"],[3,"submission","courseId","module","workshop","access"],["class","ion-text-wrap",4,"ngIf"],[1,"ion-text-wrap"],["expand","block",3,"click",4,"ngIf"],["expand","block","color","danger",3,"click",4,"ngIf"],["expand","block","fill","outline","color","danger",3,"click",4,"ngIf"],["expand","block",3,"click"],["name","fas-pen","slot","start","aria-hidden","true"],["expand","block","color","danger",3,"click"],["name","fas-trash","slot","start","aria-hidden","true"],["expand","block","fill","outline","color","danger",3,"click"],["name","fas-rotate-left","slot","start","aria-hidden","true"],["slot","start",3,"user","courseId","userId",4,"ngIf"],["slot","start",3,"user","courseId","userId"],[3,"submission","assessment","courseId","access","module","workshop"],[1,"item-heading"],[4,"ngFor","ngForOf"],[3,"submission","assessment","courseId","access","module","workshop",4,"ngIf"],[3,"assessment","courseId","module","workshop","access",4,"ngFor","ngForOf"],[3,"assessment","courseId","module","workshop","access"],[3,"formGroup"],["feedbackFormEl",""],["position","stacked"],["formControlName","grade","interface","action-sheet",3,"cancelText","interfaceOptions"],[3,"value",4,"ngFor","ngForOf"],["name","text","contextLevel","module","elementId","feedbackauthor_editor",3,"control","autoSave","contextInstanceId","draftExtraParams"],["formControlName","published"],[1,"item-help"],[3,"value"],[3,"workshop","access","assessmentId","userId","strategy","edit"],["class","item-heading",4,"ngIf"]],template:function AddonModWorkshopSubmissionPage_Template(o,e){1&o&&(M.Ec(0,"ion-header"),M.Ec(1,"ion-toolbar"),M.Ec(2,"ion-buttons",0),M.zc(3,"ion-back-button",1),M.Pc(4,"translate"),M.Dc(),M.Ec(5,"ion-title"),M.Ec(6,"h1"),M.nd(7,AddonModWorkshopSubmissionPage_core_format_text_7_Template,1,3,"core-format-text",2),M.Dc(),M.Dc(),M.Ec(8,"ion-buttons",3),M.nd(9,AddonModWorkshopSubmissionPage_ion_button_9_Template,4,6,"ion-button",4),M.nd(10,AddonModWorkshopSubmissionPage_ion_button_10_Template,3,3,"ion-button",4),M.Dc(),M.Dc(),M.Dc(),M.Ec(11,"ion-content",5),M.nd(12,AddonModWorkshopSubmissionPage_ion_refresher_12_Template,3,4,"ion-refresher",6),M.Ec(13,"core-loading",7),M.nd(14,AddonModWorkshopSubmissionPage_ion_list_14_Template,3,6,"ion-list",8),M.nd(15,AddonModWorkshopSubmissionPage_ion_list_15_Template,6,5,"ion-list",8),M.nd(16,AddonModWorkshopSubmissionPage_ion_list_16_Template,7,9,"ion-list",8),M.nd(17,AddonModWorkshopSubmissionPage_ion_list_17_Template,7,4,"ion-list",8),M.nd(18,AddonModWorkshopSubmissionPage_ion_list_18_Template,7,4,"ion-list",8),M.nd(19,AddonModWorkshopSubmissionPage_form_19_Template,28,30,"form",9),M.nd(20,AddonModWorkshopSubmissionPage_addon_mod_workshop_assessment_strategy_20_Template,1,6,"addon-mod-workshop-assessment-strategy",10),M.nd(21,AddonModWorkshopSubmissionPage_ion_list_21_Template,6,5,"ion-list",8),M.Dc(),M.Dc()),2&o&&(M.lc(3),M.Vc("text",M.Qc(4,15,"core.back")),M.lc(4),M.Vc("ngIf",e.title),M.lc(1),M.Vc("hidden",!e.loaded),M.lc(1),M.Vc("ngIf",e.assessmentId&&e.access.assessingallowed),M.lc(1),M.Vc("ngIf",e.canAddFeedback),M.lc(2),M.Vc("ngIf",!(e.assessmentId&&e.access.assessingallowed||e.canAddFeedback)),M.lc(1),M.Vc("hideUntil",e.loaded),M.lc(1),M.Vc("ngIf",e.submission),M.lc(1),M.Vc("ngIf",!e.canAddFeedback&&(null==e.evaluate?null:e.evaluate.text)),M.lc(1),M.Vc("ngIf",e.ownAssessment&&!e.assessment),M.lc(1),M.Vc("ngIf",e.submissionInfo&&e.submissionInfo.reviewedby&&e.submissionInfo.reviewedby.length&&!e.assessment),M.lc(1),M.Vc("ngIf",e.submissionInfo&&e.submissionInfo.reviewerof&&e.submissionInfo.reviewerof.length&&!e.assessment),M.lc(1),M.Vc("ngIf",e.canAddFeedback&&e.submission),M.lc(1),M.Vc("ngIf",e.assessmentId),M.lc(1),M.Vc("ngIf",e.assessmentId&&!e.access.assessingallowed&&(null==e.assessment?null:e.assessment.feedbackreviewer)))},encapsulation:2}),AddonModWorkshopSubmissionPage})()}).call(this,s("3UD+")(o))}}]);