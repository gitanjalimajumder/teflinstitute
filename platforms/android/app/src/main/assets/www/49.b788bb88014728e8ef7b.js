(window.webpackJsonp=window.webpackJsonp||[]).push([[49],{IODR:function(e,t,n){"use strict";n.r(t),n.d(t,"AddonModChatLazyModule",(function(){return se}));var s=n("tyNb"),o=n("L3Fv"),a=n("ef6k"),i=n("ghUQ"),c=n("e1dt"),d=n("fXoL"),r=n("TEn/"),l=n("4JiN"),g=n("hMzs"),_=n("nt/U"),h=n("sYmb");let m=(()=>{class AddonModChatIndexPage extends i.a{}return AddonModChatIndexPage.ɵfac=function AddonModChatIndexPage_Factory(e){return u(e||AddonModChatIndexPage)},AddonModChatIndexPage.ɵcmp=d.sc({type:AddonModChatIndexPage,selectors:[["page-addon-mod-chat-index"]],viewQuery:function AddonModChatIndexPage_Query(e,t){var n;(1&e&&d.ud(c.a,!0),2&e)&&(d.dd(n=d.Nc())&&(t.activityComponent=n.first))},features:[d.ic],decls:14,vars:12,consts:[["collapsible",""],["slot","start"],[3,"text"],["contextLevel","module",3,"text","contextInstanceId","courseId"],["slot","end"],[1,"limited-width"],["slot","fixed",3,"disabled","ionRefresh"],[3,"pullingText"],[3,"module","courseId","dataRetrieved"]],template:function AddonModChatIndexPage_Template(e,t){1&e&&(d.Ec(0,"ion-header",0),d.Ec(1,"ion-toolbar"),d.Ec(2,"ion-buttons",1),d.zc(3,"ion-back-button",2),d.Pc(4,"translate"),d.Dc(),d.Ec(5,"ion-title"),d.Ec(6,"h1"),d.zc(7,"core-format-text",3),d.Dc(),d.Dc(),d.zc(8,"ion-buttons",4),d.Dc(),d.Dc(),d.Ec(9,"ion-content",5),d.Ec(10,"ion-refresher",6),d.Mc("ionRefresh",(function AddonModChatIndexPage_Template_ion_refresher_ionRefresh_10_listener(e){return null==t.activityComponent?null:t.activityComponent.doRefresh(e.target)})),d.zc(11,"ion-refresher-content",7),d.Pc(12,"translate"),d.Dc(),d.Ec(13,"addon-mod-chat-index",8),d.Mc("dataRetrieved",(function AddonModChatIndexPage_Template_addon_mod_chat_index_dataRetrieved_13_listener(e){return t.updateData(e)})),d.Dc(),d.Dc()),2&e&&(d.lc(3),d.Vc("text",d.Qc(4,8,"core.back")),d.lc(4),d.Vc("text",t.title)("contextInstanceId",null==t.module?null:t.module.id)("courseId",t.courseId),d.lc(3),d.Vc("disabled",null==t.activityComponent?null:t.activityComponent.showLoading),d.lc(1),d.Wc("pullingText",d.Qc(12,10,"core.pulltorefresh")),d.lc(2),d.Vc("module",t.module)("courseId",t.courseId))},directives:[r.C,l.b,r.Ab,r.m,r.h,r.i,r.yb,g.a,_.a,r.v,r.bb,r.cb,c.a],pipes:[h.d],encapsulation:2}),AddonModChatIndexPage})();const u=d.Gc(m);var p=n("mrSG"),f=n("O4u7"),b=n("nvXB"),M=n("GGba"),I=n("pHTc"),C=n("9+EE"),P=n("3LXp"),v=n("bFG1"),A=n("j3ag"),D=n("fjkH"),y=n("5E3q"),x=n("g4DX"),E=n("btSF"),T=n("8vmT"),O=n("D7J2"),S=n("ofXK"),w=n("PgjG"),R=n("ACYt"),V=n("3CSS"),k=n("9pYf"),F=n("r8G5"),U=n("uYHD");function AddonModChatChatPage_ion_button_9_Template(e,t){if(1&e){const e=d.Fc();d.Ec(0,"ion-button",14),d.Mc("click",(function AddonModChatChatPage_ion_button_9_Template_ion_button_click_0_listener(){d.fd(e);return d.Oc().showChatUsers()})),d.Pc(1,"translate"),d.zc(2,"ion-icon",15),d.Dc()}2&e&&d.mc("aria-label",d.Qc(1,1,"core.users"))}function AddonModChatChatPage_ng_container_13_p_1_Template(e,t){if(1&e&&(d.Ec(0,"p",19),d.pd(1),d.Pc(2,"coreFormatDate"),d.Dc()),2&e){const e=d.Oc().$implicit;d.lc(1),d.rd(" ",d.Rc(2,1,1e3*e.timestamp,"strftimedayshort")," ")}}const _c0=function(e){return{$a:e}};function AddonModChatChatPage_ng_container_13_div_2_ion_badge_1_Template(e,t){if(1&e&&(d.Ec(0,"ion-badge",26),d.Ec(1,"span"),d.zc(2,"ion-icon",27),d.pd(3),d.Pc(4,"coreFormatDate"),d.Pc(5,"translate"),d.Dc(),d.Dc()),2&e){const e=d.Oc(2).$implicit;d.lc(3),d.sd(" ",d.Rc(4,2,1e3*e.timestamp,"strftimetime")," ",d.Rc(5,5,"addon.mod_chat.messageenter",d.ad(8,_c0,e.userfullname))," ")}}function AddonModChatChatPage_ng_container_13_div_2_ion_badge_2_Template(e,t){if(1&e&&(d.Ec(0,"ion-badge",28),d.Ec(1,"span"),d.zc(2,"ion-icon",29),d.pd(3),d.Pc(4,"coreFormatDate"),d.Pc(5,"translate"),d.Dc(),d.Dc()),2&e){const e=d.Oc(2).$implicit;d.lc(3),d.sd(" ",d.Rc(4,2,1e3*e.timestamp,"strftimetime")," ",d.Rc(5,5,"addon.mod_chat.messageexit",d.ad(8,_c0,e.userfullname))," ")}}function AddonModChatChatPage_ng_container_13_div_2_ion_badge_3_Template(e,t){if(1&e&&(d.Ec(0,"ion-badge",30),d.Ec(1,"span"),d.zc(2,"ion-icon",31),d.pd(3),d.Pc(4,"coreFormatDate"),d.Pc(5,"translate"),d.Dc(),d.Dc()),2&e){const e=d.Oc(2).$implicit;d.lc(3),d.sd(" ",d.Rc(4,2,1e3*e.timestamp,"strftimetime")," ",d.Rc(5,5,"addon.mod_chat.messagebeepseveryone",d.ad(8,_c0,e.userfullname))," ")}}function AddonModChatChatPage_ng_container_13_div_2_ion_badge_4_Template(e,t){if(1&e&&(d.Ec(0,"ion-badge",30),d.Ec(1,"span"),d.zc(2,"ion-icon",31),d.pd(3),d.Pc(4,"coreFormatDate"),d.Pc(5,"translate"),d.Dc(),d.Dc()),2&e){const e=d.Oc(2).$implicit;d.lc(3),d.sd(" ",d.Rc(4,2,1e3*e.timestamp,"strftimetime")," ",d.Rc(5,5,"addon.mod_chat.messagebeepsyou",d.ad(8,_c0,e.userfullname))," ")}}function AddonModChatChatPage_ng_container_13_div_2_ion_badge_5_Template(e,t){if(1&e&&(d.Ec(0,"ion-badge",32),d.Ec(1,"span"),d.zc(2,"ion-icon",31),d.pd(3),d.Pc(4,"coreFormatDate"),d.Pc(5,"translate"),d.Dc(),d.Dc()),2&e){const e=d.Oc(2).$implicit;d.lc(3),d.sd(" ",d.Rc(4,2,1e3*e.timestamp,"strftimetime")," ",d.Rc(5,5,"addon.mod_chat.messageyoubeep",d.ad(8,_c0,e.beepWho))," ")}}function AddonModChatChatPage_ng_container_13_div_2_ion_badge_6_Template(e,t){if(1&e){const e=d.Fc();d.Ec(0,"ion-badge",33),d.Ec(1,"span"),d.zc(2,"ion-icon",34),d.pd(3),d.Pc(4,"coreFormatDate"),d.Ec(5,"strong"),d.pd(6),d.Ec(7,"core-format-text",35),d.Mc("afterRender",(function AddonModChatChatPage_ng_container_13_div_2_ion_badge_6_Template_core_format_text_afterRender_7_listener(){d.fd(e);const t=d.Oc(2).last,n=d.Oc();return t&&n.scrollToBottom()})),d.Dc(),d.Dc(),d.Dc(),d.Dc()}if(2&e){const e=d.Oc(2).$implicit,t=d.Oc();d.lc(3),d.rd(" ",d.Rc(4,5,1e3*e.timestamp,"strftimetime")," "),d.lc(3),d.rd(" ",e.userfullname," "),d.lc(1),d.Vc("text",e.message)("contextInstanceId",t.cmId)("courseId",t.courseId)}}function AddonModChatChatPage_ng_container_13_div_2_Template(e,t){if(1&e&&(d.Ec(0,"div",20),d.nd(1,AddonModChatChatPage_ng_container_13_div_2_ion_badge_1_Template,6,10,"ion-badge",21),d.nd(2,AddonModChatChatPage_ng_container_13_div_2_ion_badge_2_Template,6,10,"ion-badge",22),d.nd(3,AddonModChatChatPage_ng_container_13_div_2_ion_badge_3_Template,6,10,"ion-badge",23),d.nd(4,AddonModChatChatPage_ng_container_13_div_2_ion_badge_4_Template,6,10,"ion-badge",23),d.nd(5,AddonModChatChatPage_ng_container_13_div_2_ion_badge_5_Template,6,10,"ion-badge",24),d.nd(6,AddonModChatChatPage_ng_container_13_div_2_ion_badge_6_Template,8,8,"ion-badge",25),d.Dc()),2&e){const e=d.Oc().$implicit,t=d.Oc();d.lc(1),d.Vc("ngIf",e.system&&"enter"==e.message),d.lc(1),d.Vc("ngIf",e.system&&"exit"==e.message),d.lc(1),d.Vc("ngIf","all"==e.beep),d.lc(1),d.Vc("ngIf",e.userid!=t.currentUserId&&e.beep==t.currentUserId),d.lc(1),d.Vc("ngIf",e.userid==t.currentUserId&&e.beep&&"all"!=e.beep),d.lc(1),d.Vc("ngIf",!e.system&&!e.beep)}}function AddonModChatChatPage_ng_container_13_core_message_3_Template(e,t){if(1&e){const e=d.Fc();d.Ec(0,"core-message",36),d.Mc("afterRender",(function AddonModChatChatPage_ng_container_13_core_message_3_Template_core_message_afterRender_0_listener(){d.fd(e);const t=d.Oc().last,n=d.Oc();return t&&n.scrollToBottom()})),d.Dc()}if(2&e){const e=d.Oc().$implicit,t=d.Oc();d.Vc("message",e)("user",e)("text",e.message)("time",1e3*e.timestamp)("instanceId",t.cmId)("courseId",t.courseId)}}function AddonModChatChatPage_ng_container_13_Template(e,t){if(1&e&&(d.Cc(0),d.nd(1,AddonModChatChatPage_ng_container_13_p_1_Template,3,4,"p",16),d.nd(2,AddonModChatChatPage_ng_container_13_div_2_Template,7,6,"div",17),d.nd(3,AddonModChatChatPage_ng_container_13_core_message_3_Template,1,6,"core-message",18),d.Bc()),2&e){const e=t.$implicit;d.lc(1),d.Vc("ngIf",e.showDate),d.lc(1),d.Vc("ngIf",e.special),d.lc(1),d.Vc("ngIf",!e.special)}}function AddonModChatChatPage_core_empty_box_14_Template(e,t){1&e&&(d.zc(0,"core-empty-box",37),d.Pc(1,"translate")),2&e&&d.Vc("message",d.Qc(1,1,"addon.mod_chat.nomessages"))}function AddonModChatChatPage_p_17_Template(e,t){1&e&&(d.Ec(0,"p",38),d.pd(1),d.Pc(2,"translate"),d.Dc()),2&e&&(d.lc(1),d.rd(" ",d.Qc(2,1,"addon.mod_chat.mustbeonlinetosendmessages")," "))}function AddonModChatChatPage_core_send_message_form_18_Template(e,t){if(1&e){const e=d.Fc();d.Ec(0,"core-send-message-form",39),d.Mc("onSubmit",(function AddonModChatChatPage_core_send_message_form_18_Template_core_send_message_form_onSubmit_0_listener(t){d.fd(e);return d.Oc().sendMessage(t)})),d.Pc(1,"translate"),d.Dc()}if(2&e){const e=d.Oc();d.Vc("sendDisabled",e.sending)("message",e.newMessage)("placeholder",d.Qc(1,3,"addon.messages.newmessage"))}}function AddonModChatChatPage_ion_button_19_Template(e,t){if(1&e){const e=d.Fc();d.Ec(0,"ion-button",40),d.Mc("click",(function AddonModChatChatPage_ion_button_19_Template_ion_button_click_0_listener(){d.fd(e);return d.Oc().reconnect()})),d.pd(1),d.Pc(2,"translate"),d.Dc()}2&e&&(d.lc(1),d.rd(" ",d.Qc(2,1,"core.login.reconnect")," "))}let z=(()=>{class AddonModChatChatPage{constructor(){this.loaded=!1,this.title="",this.messages=[],this.sending=!1,this.lastTime=0,this.oldContentHeight=0,this.viewDestroyed=!1,this.pollingRunning=!1,this.users=[],this.currentUserId=C.b.getCurrentSiteUserId(),this.isOnline=M.a.isOnline(),this.onlineSubscription=M.a.onChange().subscribe((()=>{A.z.run((()=>{this.isOnline=M.a.isOnline()}))})),this.logView=T.a.once((()=>{O.a.logEvent({type:O.b.VIEW_ITEM_LIST,ws:"mod_chat_get_chat_latest_messages",name:this.title,data:{chatid:this.chatId,category:"chat"},url:`/mod/chat/gui_ajax/index.php?id=${this.chatId}`})}))}ngOnInit(){return Object(p.a)(this,void 0,void 0,(function*(){try{this.courseId=I.a.getRequiredRouteNumberParam("courseId"),this.cmId=I.a.getRequiredRouteNumberParam("cmId"),this.chatId=I.a.getRequiredRouteNumberParam("chatId"),this.title=I.a.getRouteParam("title")||"",yield this.loginUser(),yield this.fetchMessages(),this.startPolling(),this.logView()}catch(e){P.a.showErrorModalDefault(e,"addon.mod_chat.errorwhileconnecting",!0),I.a.back()}finally{this.loaded=!0}}))}ionViewDidEnter(){this.startPolling()}ionViewWillLeave(){D.b.trigger(D.b.ACTIVITY_DATA_SENT,{module:"chat"}),this.stopPolling()}loginUser(){return Object(p.a)(this,void 0,void 0,(function*(){this.sessionId=yield x.a.loginUser(this.chatId)}))}fetchMessages(){return Object(p.a)(this,void 0,void 0,(function*(){const e=yield x.a.getLatestMessages(this.sessionId,this.lastTime);this.lastTime=e.chatnewlasttime||0;const t=yield x.a.getMessagesUserData(e.messages,this.courseId);if(!t.length)return;const n=this.messages.length;this.messages=this.messages.concat(t);for(let e=n;e<this.messages.length;e++){this.messages[e]=E.a.formatMessage(this.currentUserId,this.messages[e],e>0?this.messages[e-1]:void 0);const t=this.messages[e];t.beep&&t.beep!=String(this.currentUserId)&&this.loadMessageBeepWho(t)}this.messages[this.messages.length-1].showTail=!0,this.scrollToBottom()}))}loadMessageBeepWho(e){return Object(p.a)(this,void 0,void 0,(function*(){e.beepWho=yield this.getUserFullname(e.beep)}))}showChatUsers(){var e;return Object(p.a)(this,void 0,void 0,(function*(){const t=yield P.a.openSideModal({component:y.a,componentProps:{sessionId:this.sessionId,cmId:this.cmId}});t&&(t.talkTo&&(this.newMessage=`To ${t.talkTo}: `+((null===(e=this.sendMessageForm)||void 0===e?void 0:e.message)||"")),t.beepTo&&this.sendMessage("",t.beepTo),this.users=t.users)}))}getUserFullname(e){return Object(p.a)(this,void 0,void 0,(function*(){const t=parseInt(e,10);if(isNaN(t))return e;const n=this.users.find((e=>e.id==t));if(n)return n.fullname;try{const n=yield x.a.getChatUsers(this.sessionId,{cmId:this.cmId});this.users=n.users;const s=this.users.find((e=>e.id==t));return s?s.fullname:e}catch(t){return e}}))}startPolling(){this.polling||(this.polling=window.setInterval((()=>{v.a.ignoreErrors(this.fetchMessagesInterval())}),x.b.POLL_INTERVAL))}stopPolling(){clearInterval(this.polling),this.polling=void 0}fetchMessagesInterval(){return Object(p.a)(this,void 0,void 0,(function*(){if(this.isOnline&&!this.pollingRunning){this.pollingRunning=!0;try{yield this.fetchMessages()}catch(e){try{yield this.loginUser(),yield this.fetchMessages()}catch(e){throw this.stopPolling(),P.a.showErrorModalDefault(e,"addon.mod_chat.errorwhileretrievingmessages",!0),e}}finally{this.pollingRunning=!1}}}))}sendMessage(e,t=0){return Object(p.a)(this,void 0,void 0,(function*(){if(this.isOnline&&(0!==t||e.trim())){this.sending=!0;try{yield x.a.sendMessage(this.sessionId,e,t),v.a.ignoreErrors(this.fetchMessagesInterval())}catch(t){b.a.closeKeyboard(),this.newMessage=e,P.a.showErrorModalDefault(t,"addon.mod_chat.errorwhilesendingmessage",!0)}finally{this.sending=!1}}}))}reconnect(){return Object(p.a)(this,void 0,void 0,(function*(){const e=yield P.a.showModalLoading();try{yield this.fetchMessagesInterval(),this.startPolling()}catch(e){}finally{e.dismiss()}}))}scrollToBottom(){var e;return Object(p.a)(this,void 0,void 0,(function*(){yield v.a.nextTick(),this.viewDestroyed||null===(e=this.content)||void 0===e||e.scrollToBottom()}))}canLeave(){return Object(p.a)(this,void 0,void 0,(function*(){return!this.messages.some((e=>!e.special))||(yield P.a.showConfirm(A.I.instant("addon.mod_chat.confirmloss")),!0)}))}ngOnDestroy(){this.onlineSubscription&&this.onlineSubscription.unsubscribe(),this.stopPolling(),this.viewDestroyed=!0}}return AddonModChatChatPage.ɵfac=function AddonModChatChatPage_Factory(e){return new(e||AddonModChatChatPage)},AddonModChatChatPage.ɵcmp=d.sc({type:AddonModChatChatPage,selectors:[["page-addon-mod-chat-chat"]],viewQuery:function AddonModChatChatPage_Query(e,t){var n;(1&e&&(d.ud(r.v,!0),d.ud(f.a,!0)),2&e)&&(d.dd(n=d.Nc())&&(t.content=n.first),d.dd(n=d.Nc())&&(t.sendMessageForm=n.first))},decls:20,vars:14,consts:[["slot","start"],[3,"text"],["contextLevel","module",3,"text","contextInstanceId","courseId"],["slot","end"],["fill","clear",3,"click",4,"ngIf"],[3,"hideUntil"],["aria-live","polite",1,"addon-messages-discussion-container"],[4,"ngFor","ngForOf"],["icon","far-comments",3,"message",4,"ngIf"],[1,"footer-adjustable"],[3,"color"],["class","ion-text-center",4,"ngIf"],[3,"sendDisabled","message","placeholder","onSubmit",4,"ngIf"],["expand","block","fill","outline",3,"click",4,"ngIf"],["fill","clear",3,"click"],["name","fas-users","slot","icon-only","aria-hidden","true"],["class","ion-text-center addon-messages-date",4,"ngIf"],["class","ion-text-center addon-mod_chat-notice",4,"ngIf"],["contextLevel","module",3,"message","user","text","time","instanceId","courseId","afterRender",4,"ngIf"],[1,"ion-text-center","addon-messages-date"],[1,"ion-text-center","addon-mod_chat-notice"],["class","ion-text-wrap","color","success",4,"ngIf"],["class","ion-text-wrap","color","danger",4,"ngIf"],["class","ion-text-wrap","color","primary",4,"ngIf"],["class","ion-text-wrap","color","light",4,"ngIf"],["class","ion-text-wrap","color","info",4,"ngIf"],["color","success",1,"ion-text-wrap"],["name","fas-right-to-bracket","aria-hidden","true"],["color","danger",1,"ion-text-wrap"],["name","fas-right-from-bracket","aria-hidden","true"],["color","primary",1,"ion-text-wrap"],["name","fas-bell","aria-hidden","true"],["color","light",1,"ion-text-wrap"],["color","info",1,"ion-text-wrap"],["name","fas-asterisk","aria-hidden","true"],["contextLevel","module",3,"text","contextInstanceId","courseId","afterRender"],["contextLevel","module",3,"message","user","text","time","instanceId","courseId","afterRender"],["icon","far-comments",3,"message"],[1,"ion-text-center"],[3,"sendDisabled","message","placeholder","onSubmit"],["expand","block","fill","outline",3,"click"]],template:function AddonModChatChatPage_Template(e,t){1&e&&(d.Ec(0,"ion-header"),d.Ec(1,"ion-toolbar"),d.Ec(2,"ion-buttons",0),d.zc(3,"ion-back-button",1),d.Pc(4,"translate"),d.Dc(),d.Ec(5,"ion-title"),d.Ec(6,"h1"),d.zc(7,"core-format-text",2),d.Dc(),d.Dc(),d.Ec(8,"ion-buttons",3),d.nd(9,AddonModChatChatPage_ion_button_9_Template,3,3,"ion-button",4),d.Dc(),d.Dc(),d.Dc(),d.Ec(10,"ion-content"),d.Ec(11,"core-loading",5),d.Ec(12,"ion-list",6),d.nd(13,AddonModChatChatPage_ng_container_13_Template,4,3,"ng-container",7),d.Dc(),d.nd(14,AddonModChatChatPage_core_empty_box_14_Template,2,3,"core-empty-box",8),d.Dc(),d.Dc(),d.Ec(15,"ion-footer",9),d.Ec(16,"ion-toolbar",10),d.nd(17,AddonModChatChatPage_p_17_Template,3,3,"p",11),d.nd(18,AddonModChatChatPage_core_send_message_form_18_Template,2,5,"core-send-message-form",12),d.nd(19,AddonModChatChatPage_ion_button_19_Template,3,3,"ion-button",13),d.Dc(),d.Dc()),2&e&&(d.lc(3),d.Vc("text",d.Qc(4,12,"core.back")),d.lc(4),d.Vc("text",t.title)("contextInstanceId",t.cmId)("courseId",t.courseId),d.lc(2),d.Vc("ngIf",t.loaded),d.lc(2),d.Vc("hideUntil",t.loaded),d.lc(2),d.Vc("ngForOf",t.messages),d.lc(1),d.Vc("ngIf",!t.messages||t.messages.length<=0),d.lc(2),d.Vc("color",t.isOnline&&t.polling&&t.loaded?null:"light"),d.lc(1),d.Vc("ngIf",!t.isOnline),d.lc(1),d.Vc("ngIf",t.isOnline&&t.polling&&t.loaded),d.lc(1),d.Vc("ngIf",t.isOnline&&!t.polling&&t.loaded))},directives:[r.C,r.Ab,r.m,r.h,r.i,r.yb,g.a,S.t,_.a,r.v,w.a,r.P,S.s,r.A,R.a,r.l,r.D,V.a,r.k,k.a,F.a,f.a],pipes:[h.d,U.a],styles:[".ios[_nghost-%COMP%]   ion-footer[_ngcontent-%COMP%]   .toolbar[_ngcontent-%COMP%]:last-child, .ios   [_nghost-%COMP%]   ion-footer[_ngcontent-%COMP%]   .toolbar[_ngcontent-%COMP%]:last-child{padding-bottom:4px;min-height:0}ion-content[_ngcontent-%COMP%]{--content-background:var(--background-alternative);--background:var(--content-background)}ion-content[_ngcontent-%COMP%]::part(scroll){padding-bottom:0!important}.addon-messages-discussion-container[_ngcontent-%COMP%]{display:flex;flex-direction:column;padding-bottom:16px!important;background:var(--content-background)}.addon-messages-date[_ngcontent-%COMP%]{font-weight:400;font-size:.9rem}[_nghost-%COMP%]   .addon-mod_chat-notice[_ngcontent-%COMP%]{margin-top:8px;margin-bottom:8px}"]}),AddonModChatChatPage})();var $=n("4pns");function AddonModChatSessionMessagesPage_ng_container_15_div_1_Template(e,t){if(1&e&&(d.Ec(0,"div",10),d.pd(1),d.Pc(2,"coreFormatDate"),d.Dc()),2&e){const e=d.Oc().$implicit;d.lc(1),d.rd(" ",d.Rc(2,1,1e3*e.timestamp,"strftimedayshort")," ")}}const session_messages_c0=function(e){return{$a:e}};function AddonModChatSessionMessagesPage_ng_container_15_div_2_ion_badge_1_Template(e,t){if(1&e&&(d.Ec(0,"ion-badge",17),d.Ec(1,"span"),d.zc(2,"ion-icon",18),d.pd(3),d.Pc(4,"coreFormatDate"),d.Pc(5,"translate"),d.Dc(),d.Dc()),2&e){const e=d.Oc(2).$implicit;d.lc(3),d.sd(" ",d.Rc(4,2,1e3*e.timestamp,"strftimetime")," ",d.Rc(5,5,"addon.mod_chat.messageenter",d.ad(8,session_messages_c0,e.userfullname))," ")}}function AddonModChatSessionMessagesPage_ng_container_15_div_2_ion_badge_2_Template(e,t){if(1&e&&(d.Ec(0,"ion-badge",19),d.Ec(1,"span"),d.zc(2,"ion-icon",20),d.pd(3),d.Pc(4,"coreFormatDate"),d.Pc(5,"translate"),d.Dc(),d.Dc()),2&e){const e=d.Oc(2).$implicit;d.lc(3),d.sd(" ",d.Rc(4,2,1e3*e.timestamp,"strftimetime")," ",d.Rc(5,5,"addon.mod_chat.messageexit",d.ad(8,session_messages_c0,e.userfullname))," ")}}function AddonModChatSessionMessagesPage_ng_container_15_div_2_ion_badge_3_Template(e,t){if(1&e&&(d.Ec(0,"ion-badge",21),d.Ec(1,"span"),d.zc(2,"ion-icon",22),d.pd(3),d.Pc(4,"coreFormatDate"),d.Pc(5,"translate"),d.Dc(),d.Dc()),2&e){const e=d.Oc(2).$implicit;d.lc(3),d.sd(" ",d.Rc(4,2,1e3*e.timestamp,"strftimetime")," ",d.Rc(5,5,"addon.mod_chat.messagebeepseveryone",d.ad(8,session_messages_c0,e.userfullname))," ")}}function AddonModChatSessionMessagesPage_ng_container_15_div_2_ion_badge_4_Template(e,t){if(1&e&&(d.Ec(0,"ion-badge",21),d.Ec(1,"span"),d.zc(2,"ion-icon",22),d.pd(3),d.Pc(4,"coreFormatDate"),d.Pc(5,"translate"),d.Dc(),d.Dc()),2&e){const e=d.Oc(2).$implicit;d.lc(3),d.sd(" ",d.Rc(4,2,1e3*e.timestamp,"strftimetime")," ",d.Rc(5,5,"addon.mod_chat.messagebeepsyou",d.ad(8,session_messages_c0,e.userfullname))," ")}}function AddonModChatSessionMessagesPage_ng_container_15_div_2_ion_badge_5_Template(e,t){if(1&e&&(d.Ec(0,"ion-badge",23),d.Ec(1,"span"),d.zc(2,"ion-icon",22),d.pd(3),d.Pc(4,"coreFormatDate"),d.Pc(5,"translate"),d.Dc(),d.Dc()),2&e){const e=d.Oc(2).$implicit;d.lc(3),d.sd(" ",d.Rc(4,2,1e3*e.timestamp,"strftimetime")," ",d.Rc(5,5,"addon.mod_chat.messageyoubeep",d.ad(8,session_messages_c0,e.beepWho))," ")}}function AddonModChatSessionMessagesPage_ng_container_15_div_2_ion_badge_6_Template(e,t){if(1&e&&(d.Ec(0,"ion-badge",24),d.Ec(1,"span"),d.zc(2,"ion-icon",25),d.pd(3),d.Pc(4,"coreFormatDate"),d.Ec(5,"strong"),d.pd(6),d.zc(7,"core-format-text",26),d.Dc(),d.Dc(),d.Dc()),2&e){const e=d.Oc(2).$implicit,t=d.Oc();d.lc(3),d.rd(" ",d.Rc(4,5,1e3*e.timestamp,"strftimetime")," "),d.lc(3),d.rd(" ",e.userfullname," "),d.lc(1),d.Vc("text",e.message)("contextInstanceId",t.cmId)("courseId",t.courseId)}}function AddonModChatSessionMessagesPage_ng_container_15_div_2_Template(e,t){if(1&e&&(d.Ec(0,"div",11),d.nd(1,AddonModChatSessionMessagesPage_ng_container_15_div_2_ion_badge_1_Template,6,10,"ion-badge",12),d.nd(2,AddonModChatSessionMessagesPage_ng_container_15_div_2_ion_badge_2_Template,6,10,"ion-badge",13),d.nd(3,AddonModChatSessionMessagesPage_ng_container_15_div_2_ion_badge_3_Template,6,10,"ion-badge",14),d.nd(4,AddonModChatSessionMessagesPage_ng_container_15_div_2_ion_badge_4_Template,6,10,"ion-badge",14),d.nd(5,AddonModChatSessionMessagesPage_ng_container_15_div_2_ion_badge_5_Template,6,10,"ion-badge",15),d.nd(6,AddonModChatSessionMessagesPage_ng_container_15_div_2_ion_badge_6_Template,8,8,"ion-badge",16),d.Dc()),2&e){const e=d.Oc().$implicit,t=d.Oc();d.lc(1),d.Vc("ngIf",e.issystem&&"enter"==e.message),d.lc(1),d.Vc("ngIf",e.issystem&&"exit"==e.message),d.lc(1),d.Vc("ngIf","all"==e.beep),d.lc(1),d.Vc("ngIf",e.userid!=t.currentUserId&&e.beep==t.currentUserId),d.lc(1),d.Vc("ngIf",e.userid==t.currentUserId&&e.beep&&"all"!=e.beep),d.lc(1),d.Vc("ngIf",!e.issystem&&!e.beep)}}function AddonModChatSessionMessagesPage_ng_container_15_core_message_3_Template(e,t){if(1&e&&d.zc(0,"core-message",27),2&e){const e=d.Oc().$implicit,t=d.Oc();d.Vc("message",e)("user",e)("text",e.message)("time",1e3*e.timestamp)("instanceId",t.cmId)("courseId",t.courseId)}}function AddonModChatSessionMessagesPage_ng_container_15_Template(e,t){if(1&e&&(d.Cc(0),d.nd(1,AddonModChatSessionMessagesPage_ng_container_15_div_1_Template,3,4,"div",7),d.nd(2,AddonModChatSessionMessagesPage_ng_container_15_div_2_Template,7,6,"div",8),d.nd(3,AddonModChatSessionMessagesPage_ng_container_15_core_message_3_Template,1,6,"core-message",9),d.Bc()),2&e){const e=t.$implicit;d.lc(1),d.Vc("ngIf",e.showDate),d.lc(1),d.Vc("ngIf",e.special),d.lc(1),d.Vc("ngIf",!e.special)}}let j=(()=>{class AddonModChatSessionMessagesPage{constructor(){this.messages=[],this.loaded=!1,this.logView=T.a.once((()=>Object(p.a)(this,void 0,void 0,(function*(){yield v.a.ignoreErrors(x.a.logViewSessions(this.cmId,{start:this.sessionStart,end:this.sessionEnd})),O.a.logEvent({type:O.b.VIEW_ITEM,ws:"mod_chat_view_sessions",name:A.I.instant("addon.mod_chat.messages"),data:{chatid:this.chatId,category:"chat",start:this.sessionStart,end:this.sessionEnd},url:`/mod/chat/report.php?id=${this.cmId}&start=${this.sessionStart}&end=${this.sessionEnd}`})}))))}ngOnInit(){try{this.courseId=I.a.getRequiredRouteNumberParam("courseId"),this.cmId=I.a.getRequiredRouteNumberParam("cmId"),this.sessionStart=I.a.getRequiredRouteNumberParam("sessionStart"),this.sessionEnd=I.a.getRequiredRouteNumberParam("sessionEnd"),this.chatId=I.a.getRequiredRouteNumberParam("chatId"),this.groupId=I.a.getRouteNumberParam("groupId")||0}catch(e){return P.a.showErrorModal(e),I.a.back(),void 0}this.currentUserId=C.b.getCurrentSiteUserId(),this.fetchMessages()}fetchMessages(){return Object(p.a)(this,void 0,void 0,(function*(){try{const e=yield x.a.getSessionMessages(this.chatId,this.sessionStart,this.sessionEnd,this.groupId,{cmId:this.cmId});this.messages=yield x.a.getMessagesUserData(e,this.courseId);for(let e=0;e<this.messages.length;e++){this.messages[e]=E.a.formatMessage(this.currentUserId,this.messages[e],e>0?this.messages[e-1]:void 0);const t=this.messages[e];t.beep&&t.beep!=String(this.currentUserId)&&this.loadMessageBeepWho(t)}this.messages[this.messages.length-1].showTail=!0}catch(e){P.a.showErrorModalDefault(e,"core.errorloadingcontent",!0)}finally{this.loaded=!0}}))}loadMessageBeepWho(e){return Object(p.a)(this,void 0,void 0,(function*(){e.beepWho=yield this.getUserFullname(e.beep)}))}getUserFullname(e){return Object(p.a)(this,void 0,void 0,(function*(){const t=parseInt(e,10);if(isNaN(t))return e;try{return(yield $.a.getProfile(t,this.courseId,!0)).fullname}catch(t){return e}}))}refreshMessages(e){return Object(p.a)(this,void 0,void 0,(function*(){try{yield v.a.ignoreErrors(x.a.invalidateSessionMessages(this.chatId,this.sessionStart,this.groupId)),yield this.fetchMessages()}finally{e.complete()}}))}}return AddonModChatSessionMessagesPage.ɵfac=function AddonModChatSessionMessagesPage_Factory(e){return new(e||AddonModChatSessionMessagesPage)},AddonModChatSessionMessagesPage.ɵcmp=d.sc({type:AddonModChatSessionMessagesPage,selectors:[["page-addon-mod-chat-session-messages"]],decls:16,vars:12,consts:[["slot","start"],[3,"text"],["slot","fixed",3,"disabled","ionRefresh"],[3,"pullingText"],[3,"hideUntil"],[1,"addon-messages-discussion-container"],[4,"ngFor","ngForOf"],["class","ion-text-center addon-messages-date",4,"ngIf"],["class","ion-text-center addon-mod_chat-notice",4,"ngIf"],["contextLevel","module",3,"message","user","text","time","instanceId","courseId",4,"ngIf"],[1,"ion-text-center","addon-messages-date"],[1,"ion-text-center","addon-mod_chat-notice"],["class","ion-text-wrap","color","success",4,"ngIf"],["class","ion-text-wrap","color","danger",4,"ngIf"],["class","ion-text-wrap","color","primary",4,"ngIf"],["class","ion-text-wrap","color","light",4,"ngIf"],["class","ion-text-wrap","color","info",4,"ngIf"],["color","success",1,"ion-text-wrap"],["name","fas-right-to-bracket","aria-hidden","true"],["color","danger",1,"ion-text-wrap"],["name","fas-right-from-bracket","aria-hidden","true"],["color","primary",1,"ion-text-wrap"],["name","fas-bell","aria-hidden","true"],["color","light",1,"ion-text-wrap"],["color","info",1,"ion-text-wrap"],["name","fas-asterisk","aria-hidden","true"],["contextLevel","module",3,"text","contextInstanceId","courseId"],["contextLevel","module",3,"message","user","text","time","instanceId","courseId"]],template:function AddonModChatSessionMessagesPage_Template(e,t){1&e&&(d.Ec(0,"ion-header"),d.Ec(1,"ion-toolbar"),d.Ec(2,"ion-buttons",0),d.zc(3,"ion-back-button",1),d.Pc(4,"translate"),d.Dc(),d.Ec(5,"ion-title"),d.Ec(6,"h1"),d.pd(7),d.Pc(8,"translate"),d.Dc(),d.Dc(),d.Dc(),d.Dc(),d.Ec(9,"ion-content"),d.Ec(10,"ion-refresher",2),d.Mc("ionRefresh",(function AddonModChatSessionMessagesPage_Template_ion_refresher_ionRefresh_10_listener(e){return t.refreshMessages(e.target)})),d.zc(11,"ion-refresher-content",3),d.Pc(12,"translate"),d.Dc(),d.Ec(13,"core-loading",4),d.Ec(14,"ion-list",5),d.nd(15,AddonModChatSessionMessagesPage_ng_container_15_Template,4,3,"ng-container",6),d.Dc(),d.Dc(),d.Dc()),2&e&&(d.lc(3),d.Vc("text",d.Qc(4,6,"core.back")),d.lc(4),d.qd(d.Qc(8,8,"addon.mod_chat.messages")),d.lc(3),d.Vc("disabled",!t.loaded),d.lc(1),d.Wc("pullingText",d.Qc(12,10,"core.pulltorefresh")),d.lc(2),d.Vc("hideUntil",t.loaded),d.lc(2),d.Vc("ngForOf",t.messages))},directives:[r.C,r.Ab,r.m,r.h,r.i,r.yb,_.a,r.v,r.bb,r.cb,w.a,r.P,S.s,S.t,r.k,r.D,V.a,g.a,k.a],pipes:[h.d,U.a],styles:[".ios[_nghost-%COMP%]   ion-footer[_ngcontent-%COMP%]   .toolbar[_ngcontent-%COMP%]:last-child, .ios   [_nghost-%COMP%]   ion-footer[_ngcontent-%COMP%]   .toolbar[_ngcontent-%COMP%]:last-child{padding-bottom:4px;min-height:0}ion-content[_ngcontent-%COMP%]{--content-background:var(--background-alternative);--background:var(--content-background)}ion-content[_ngcontent-%COMP%]::part(scroll){padding-bottom:0!important}.addon-messages-discussion-container[_ngcontent-%COMP%]{display:flex;flex-direction:column;padding-bottom:16px!important;background:var(--content-background)}.addon-messages-date[_ngcontent-%COMP%]{font-weight:400;font-size:.9rem}[_nghost-%COMP%]   .addon-mod_chat-notice[_ngcontent-%COMP%]{margin-top:8px;margin-bottom:8px}"]}),AddonModChatSessionMessagesPage})();var L=n("Y+03"),Q=n("vY5A"),N=n("EoRH"),q=n("baaQ"),W=n("46ml"),B=n("CvRw"),G=n("mWdr");class chat_sessions_source_AddonModChatSessionsSource extends B.a{constructor(e,t,n){super(),this.showAll=!1,this.groupId=0,this.COURSE_ID=e,this.CHAT_ID=t,this.CM_ID=n}invalidateCache(){return Object(p.a)(this,void 0,void 0,(function*(){yield v.a.ignoreErrors(v.a.allPromises([G.a.invalidateActivityGroupInfo(this.CM_ID),x.a.invalidateSessions(this.CHAT_ID,this.groupId,this.showAll)]))}))}loadPageItems(){return Object(p.a)(this,void 0,void 0,(function*(){this.groupInfo=yield G.a.getActivityGroupInfo(this.CM_ID,!1),this.groupId=G.a.validateGroupId(this.groupId,this.groupInfo);const e=yield x.a.getSessions(this.CHAT_ID,this.groupId,this.showAll,{cmId:this.CM_ID}),t=[],n=e.map((e=>(e.duration=e.sessionend-e.sessionstart,e.sessionusers.forEach((e=>{t.push(this.loadUserFullname(e))})),e.allsessionusers=e.sessionusers,e.sessionusers.length>4&&(e.sessionusers=e.allsessionusers.slice(0,3)),e)));return yield Promise.all(t),{items:n}}))}getItemPath(e){return`${e.sessionstart}/${e.sessionend}`}getItemQueryParams(){return{chatId:this.CHAT_ID,groupId:this.groupId}}loadUserFullname(e){return Object(p.a)(this,void 0,void 0,(function*(){if(!e.userfullname)try{const t=yield $.a.getProfile(e.userid,this.COURSE_ID,!0);e.userfullname=t.fullname}catch(t){e.userfullname=A.I.instant("core.deleteduser")+" "+e.userid}}))}}var H=n("WPIK"),Y=n("3Pt+"),J=n("llyR");function AddonModChatSessionsPage_ion_card_21_p_6_Template(e,t){if(1&e&&(d.Ec(0,"p"),d.pd(1),d.Pc(2,"coreDuration"),d.Dc()),2&e){const e=d.Oc().$implicit;d.lc(1),d.qd(d.Qc(2,1,e.duration))}}function AddonModChatSessionsPage_ion_card_21_ion_item_8_span_3_Template(e,t){if(1&e&&(d.Ec(0,"span"),d.pd(1),d.Dc()),2&e){const e=d.Oc().$implicit;d.lc(1),d.rd("(",e.messagecount,")")}}function AddonModChatSessionsPage_ion_card_21_ion_item_8_Template(e,t){if(1&e&&(d.Ec(0,"ion-item"),d.Ec(1,"ion-label"),d.pd(2),d.nd(3,AddonModChatSessionsPage_ion_card_21_ion_item_8_span_3_Template,2,1,"span",12),d.Dc(),d.Dc()),2&e){const e=t.$implicit;d.lc(2),d.rd(" ",e.userfullname," "),d.lc(1),d.Vc("ngIf",e.messagecount)}}function AddonModChatSessionsPage_ion_card_21_ion_button_9_Template(e,t){if(1&e){const e=d.Fc();d.Ec(0,"ion-button",15),d.Mc("click",(function AddonModChatSessionsPage_ion_card_21_ion_button_9_Template_ion_button_click_0_listener(t){d.fd(e);const n=d.Oc().$implicit;return d.Oc().showMoreUsers(n,t)})),d.pd(1),d.Pc(2,"translate"),d.Dc()}2&e&&(d.lc(1),d.rd(" ",d.Qc(2,1,"core.showmore")," "))}function AddonModChatSessionsPage_ion_card_21_Template(e,t){if(1&e){const e=d.Fc();d.Ec(0,"ion-card",9),d.Mc("click",(function AddonModChatSessionsPage_ion_card_21_Template_ion_card_click_0_listener(){d.fd(e);const n=t.$implicit;return d.Oc().sessions.select(n)})),d.Ec(1,"ion-item",10),d.Ec(2,"ion-label"),d.Ec(3,"p",11),d.pd(4),d.Pc(5,"coreFormatDate"),d.Dc(),d.nd(6,AddonModChatSessionsPage_ion_card_21_p_6_Template,3,3,"p",12),d.Dc(),d.Dc(),d.Ec(7,"ion-card-content"),d.nd(8,AddonModChatSessionsPage_ion_card_21_ion_item_8_Template,4,2,"ion-item",13),d.Dc(),d.nd(9,AddonModChatSessionsPage_ion_card_21_ion_button_9_Template,3,3,"ion-button",14),d.Dc()}if(2&e){const e=t.$implicit,n=d.Oc();d.qc("addon-mod-chat-session-show-more",e.sessionusers.length<e.allsessionusers.length),d.mc("aria-current",n.sessions.getItemAriaCurrent(e)),d.lc(4),d.qd(d.Qc(5,7,1e3*e.sessionstart)),d.lc(2),d.Vc("ngIf",e.duration),d.lc(2),d.Vc("ngForOf",e.sessionusers),d.lc(1),d.Vc("ngIf",e.sessionusers.length<e.allsessionusers.length)}}function AddonModChatSessionsPage_core_empty_box_22_Template(e,t){1&e&&(d.zc(0,"core-empty-box",16),d.Pc(1,"translate")),2&e&&d.Vc("message",d.Qc(1,1,"addon.mod_chat.nosessionsfound"))}let X=(()=>{class AddonModChatSessionsPage{constructor(){this.logView=T.a.once((()=>Object(p.a)(this,void 0,void 0,(function*(){const e=this.sessions.getSource();yield v.a.ignoreErrors(x.a.logViewSessions(this.sessions.getSource().CM_ID)),O.a.logEvent({type:O.b.VIEW_ITEM_LIST,ws:"mod_chat_view_sessions",name:A.I.instant("addon.mod_chat.chatreport"),data:{chatid:e.CHAT_ID,category:"chat"},url:`/mod/chat/report.php?id=${e.CM_ID}`})}))))}ngOnInit(){try{this.courseId=I.a.getRequiredRouteNumberParam("courseId");const e=I.a.getRequiredRouteNumberParam("chatId"),t=I.a.getRequiredRouteNumberParam("cmId"),n=q.a.getOrCreateSource(chat_sessions_source_AddonModChatSessionsSource,[this.courseId,e,t]);this.sessions=new N.a(n,AddonModChatSessionsPage)}catch(e){return P.a.showErrorModal(e),I.a.back(),void 0}}get groupId(){return this.sessions.getSource().groupId}set groupId(e){this.sessions.getSource().groupId=e}get showAll(){return this.sessions.getSource().showAll}set showAll(e){this.sessions.getSource().showAll=e}get groupInfo(){return this.sessions.getSource().groupInfo}ngAfterViewInit(){return Object(p.a)(this,void 0,void 0,(function*(){yield this.fetchSessions(),this.sessions.start(this.splitView)}))}fetchSessions(){return Object(p.a)(this,void 0,void 0,(function*(){try{yield this.sessions.load(),this.logView()}catch(e){P.a.showErrorModalDefault(e,"core.errorloadingcontent",!0)}}))}reloadSessions(){return Object(p.a)(this,void 0,void 0,(function*(){const e=yield P.a.showModalLoading();try{yield this.sessions.reload()}catch(e){P.a.showErrorModalDefault(e,"core.errorloadingcontent",!0)}finally{e.dismiss()}}))}refreshSessions(e){return Object(p.a)(this,void 0,void 0,(function*(){try{this.sessions.getSource().setDirty(!0),yield this.sessions.getSource().invalidateCache(),yield this.fetchSessions()}finally{e.complete()}}))}showMoreUsers(e,t){e.allsessionusers&&(e.sessionusers=e.allsessionusers),t.stopPropagation()}ngOnDestroy(){this.sessions.destroy()}}return AddonModChatSessionsPage.ɵfac=function AddonModChatSessionsPage_Factory(e){return new(e||AddonModChatSessionsPage)},AddonModChatSessionsPage.ɵcmp=d.sc({type:AddonModChatSessionsPage,selectors:[["page-addon-mod-chat-sessions"]],viewQuery:function AddonModChatSessionsPage_Query(e,t){var n;(1&e&&d.ud(W.a,!0),2&e)&&(d.dd(n=d.Nc())&&(t.splitView=n.first))},decls:23,vars:20,consts:[["slot","start"],[3,"text"],["slot","fixed",3,"disabled","ionRefresh"],[3,"pullingText"],[3,"hideUntil"],[3,"groupInfo","selected","courseId","selectedChange"],[3,"ngModel","ngModelChange","ionChange"],["button","",3,"addon-mod-chat-session-show-more","click",4,"ngFor","ngForOf"],["icon","far-comments",3,"message",4,"ngIf"],["button","",3,"click"],[1,"ion-text-wrap"],[1,"item-heading"],[4,"ngIf"],[4,"ngFor","ngForOf"],["fill","clear","expand","block",3,"click",4,"ngIf"],["fill","clear","expand","block",3,"click"],["icon","far-comments",3,"message"]],template:function AddonModChatSessionsPage_Template(e,t){1&e&&(d.Ec(0,"ion-header"),d.Ec(1,"ion-toolbar"),d.Ec(2,"ion-buttons",0),d.zc(3,"ion-back-button",1),d.Pc(4,"translate"),d.Dc(),d.Ec(5,"ion-title"),d.Ec(6,"h1"),d.pd(7),d.Pc(8,"translate"),d.Dc(),d.Dc(),d.Dc(),d.Dc(),d.Ec(9,"ion-content"),d.Ec(10,"core-split-view"),d.Ec(11,"ion-refresher",2),d.Mc("ionRefresh",(function AddonModChatSessionsPage_Template_ion_refresher_ionRefresh_11_listener(e){return t.refreshSessions(e.target)})),d.zc(12,"ion-refresher-content",3),d.Pc(13,"translate"),d.Dc(),d.Ec(14,"core-loading",4),d.Ec(15,"core-group-selector",5),d.Mc("selectedChange",(function AddonModChatSessionsPage_Template_core_group_selector_selectedChange_15_listener(e){return t.groupId=e}))("selectedChange",(function AddonModChatSessionsPage_Template_core_group_selector_selectedChange_15_listener(){return t.reloadSessions()})),d.Dc(),d.Ec(16,"ion-item"),d.Ec(17,"ion-label"),d.pd(18),d.Pc(19,"translate"),d.Dc(),d.Ec(20,"ion-toggle",6),d.Mc("ngModelChange",(function AddonModChatSessionsPage_Template_ion_toggle_ngModelChange_20_listener(e){return t.showAll=e}))("ionChange",(function AddonModChatSessionsPage_Template_ion_toggle_ionChange_20_listener(){return t.reloadSessions()})),d.Dc(),d.Dc(),d.nd(21,AddonModChatSessionsPage_ion_card_21_Template,10,9,"ion-card",7),d.nd(22,AddonModChatSessionsPage_core_empty_box_22_Template,2,3,"core-empty-box",8),d.Dc(),d.Dc(),d.Dc()),2&e&&(d.lc(3),d.Vc("text",d.Qc(4,12,"core.back")),d.lc(4),d.qd(d.Qc(8,14,"addon.mod_chat.chatreport")),d.lc(4),d.Vc("disabled",!t.sessions.loaded),d.lc(1),d.Wc("pullingText",d.Qc(13,16,"core.pulltorefresh")),d.lc(2),d.Vc("hideUntil",t.sessions.loaded),d.lc(1),d.Vc("groupInfo",t.groupInfo)("selected",t.groupId)("courseId",t.courseId),d.lc(3),d.qd(d.Qc(19,18,"addon.mod_chat.showincompletesessions")),d.lc(2),d.Vc("ngModel",t.showAll),d.lc(1),d.Vc("ngForOf",t.sessions.items),d.lc(1),d.Vc("ngIf",t.sessions.empty))},directives:[r.C,r.Ab,r.m,r.h,r.i,r.yb,_.a,r.v,W.a,r.bb,r.cb,w.a,H.a,r.I,r.O,r.zb,r.d,Y.r,Y.u,S.s,S.t,r.n,r.o,R.a,r.l,F.a],pipes:[h.d,U.a,J.a],encapsulation:2}),AddonModChatSessionsPage})();var K=n("MLi9");const Z=[{path:":courseId/:cmId",component:m},{path:":courseId/:cmId/chat",component:z,canDeactivate:[K.a]}],ee=[...Z,{path:":courseId/:cmId/sessions",component:X},{path:":courseId/:cmId/sessions/:sessionStart/:sessionEnd",component:j}],te=[...Z,{path:":courseId/:cmId/sessions",component:X,children:[{path:":sessionStart/:sessionEnd",component:j}]}],ne=[...Object(Q.c)(ee,(()=>L.a.isMobile)),...Object(Q.c)(te,(()=>L.a.isTablet))];let se=(()=>{class AddonModChatLazyModule{}return AddonModChatLazyModule.ɵmod=d.wc({type:AddonModChatLazyModule}),AddonModChatLazyModule.ɵinj=d.vc({factory:function AddonModChatLazyModule_Factory(e){return new(e||AddonModChatLazyModule)},imports:[[s.m.forChild(ne),o.a,a.a]]}),AddonModChatLazyModule})();void(("undefined"==typeof ngJitMode||ngJitMode)&&d.kd(se,{declarations:[m,z,X,j],imports:[s.m,o.a,a.a]}))}}]);