(window.webpackJsonp=window.webpackJsonp||[]).push([[46],{muSn:function(e,s,n){"use strict";n.r(s),n.d(s,"AddonMessagesLazyModule",(function(){return fe}));var t=n("vY5A"),o=n("L3Fv"),i=n("mrSG"),a=n("9+EE"),c=n("KMk0"),r=n("3LXp"),d=n("nvXB"),l=n("fjkH"),g=n("j3ag"),_=n("Y+03"),u=n("pHTc"),m=n("46ml"),h=n("fXoL"),f=n("tyNb"),p=n("TEn/"),M=n("fQ68"),v=n("nt/U"),P=n("9zps"),C=n("PgjG"),b=n("ofXK"),O=n("r8G5"),I=n("FeAf"),D=n("sYmb");function AddonMessagesContacts35Page_core_empty_box_19_Template(e,s){1&e&&(h.zc(0,"core-empty-box",9),h.Pc(1,"translate")),2&e&&h.Vc("message",h.Qc(1,1,"addon.messages.contactlistempty"))}function AddonMessagesContacts35Page_core_empty_box_20_Template(e,s){1&e&&(h.zc(0,"core-empty-box",9),h.Pc(1,"translate")),2&e&&h.Vc("message",h.Qc(1,1,"addon.messages.nousersfound"))}function AddonMessagesContacts35Page_ion_list_21_ng_container_1_ng_container_9_ion_item_1_Template(e,s){if(1&e){const e=h.Fc();h.Ec(0,"ion-item",16),h.Mc("click",(function AddonMessagesContacts35Page_ion_list_21_ng_container_1_ng_container_9_ion_item_1_Template_ion_item_click_0_listener(){h.fd(e);const s=h.Oc().$implicit;return h.Oc(3).gotoDiscussion(s.id)})),h.zc(1,"core-user-avatar",17),h.Ec(2,"ion-label"),h.Ec(3,"p",12),h.pd(4),h.Dc(),h.Dc(),h.Dc()}if(2&e){const e=h.Oc().$implicit,s=h.Oc(3);h.mc("aria-label",e.fullname)("aria-current",e.id==s.discussionUserId?"page":"false"),h.lc(1),h.Vc("user",e)("checkOnline",e.showonlinestatus),h.lc(3),h.qd(e.fullname)}}function AddonMessagesContacts35Page_ion_list_21_ng_container_1_ng_container_9_Template(e,s){if(1&e&&(h.Cc(0),h.nd(1,AddonMessagesContacts35Page_ion_list_21_ng_container_1_ng_container_9_ion_item_1_Template,5,5,"ion-item",15),h.Bc()),2&e){const e=s.$implicit;h.lc(1),h.Vc("ngIf",e.profileimageurl||e.profileimageurlsmall)}}function AddonMessagesContacts35Page_ion_list_21_ng_container_1_Template(e,s){if(1&e&&(h.Cc(0),h.Ec(1,"ion-item-divider"),h.Ec(2,"ion-label"),h.Ec(3,"p",12),h.pd(4),h.Pc(5,"translate"),h.Dc(),h.Dc(),h.Ec(6,"ion-note",13),h.Ec(7,"ion-badge"),h.pd(8),h.Dc(),h.Dc(),h.Dc(),h.nd(9,AddonMessagesContacts35Page_ion_list_21_ng_container_1_ng_container_9_Template,2,1,"ng-container",14),h.Bc()),2&e){const e=h.Oc().$implicit,s=h.Oc();h.lc(4),h.qd(h.Qc(5,3,"addon.messages.type_"+e)),h.lc(4),h.qd(s.contacts[e].length),h.lc(1),h.Vc("ngForOf",s.contacts[e])}}function AddonMessagesContacts35Page_ion_list_21_Template(e,s){if(1&e&&(h.Ec(0,"ion-list",10),h.nd(1,AddonMessagesContacts35Page_ion_list_21_ng_container_1_Template,10,5,"ng-container",11),h.Dc()),2&e){const e=s.$implicit,n=h.Oc();h.lc(1),h.Vc("ngIf",n.contacts[e]&&(n.contacts[e].length>0||e===n.searchType))}}let E=(()=>{class AddonMessagesContacts35Page{constructor(e){this.route=e,this.noSearchTypes=["online","offline","blocked","strangers"],this.loaded=!1,this.contactTypes=["online","offline","blocked","strangers"],this.searchType="search",this.loadingMessage="",this.hasContacts=!1,this.contacts={online:[],offline:[],strangers:[],search:[]},this.searchString="",this.siteId=a.b.getCurrentSiteId(),this.searchingMessages=g.I.instant("core.searching"),this.loadingMessages=g.I.instant("core.loading"),this.loadingMessage=this.loadingMessages,this.memberInfoObserver=l.b.on(c.b.MEMBER_INFO_CHANGED_EVENT,(e=>{e.contactRequestConfirmed&&this.refreshData()}),a.b.getCurrentSiteId())}ngOnInit(){return Object(i.a)(this,void 0,void 0,(function*(){const e=u.a.getRouteNumberParam("discussionUserId")||u.a.getRouteNumberParam("userId")||void 0;if(!this.loaded||this.discussionUserId!=e){this.discussionUserId=e,this.discussionUserId&&this.gotoDiscussion(this.discussionUserId);try{if(yield this.fetchData(),!this.discussionUserId&&this.hasContacts&&_.a.isTablet){let e;for(const s in this.contacts)if(this.contacts[s].length>0){e=this.contacts[s][0];break}e&&this.gotoDiscussion(e.id)}}finally{this.loaded=!0}}}))}refreshData(e){return Object(i.a)(this,void 0,void 0,(function*(){try{this.searchString?yield this.performSearch(this.searchString):(yield c.a.invalidateAllContactsCache(),yield this.fetchData())}finally{null==e?void 0:e.complete()}}))}fetchData(){return Object(i.a)(this,void 0,void 0,(function*(){this.loadingMessage=this.loadingMessages;try{const e=yield c.a.getAllContacts();for(const s in e)this.contacts[s]=e[s].length>0?this.sortUsers(e[s]):[];this.clearSearch()}catch(e){r.a.showErrorModalDefault(e,"addon.messages.errorwhileretrievingcontacts",!0)}}))}sortUsers(e){return e.sort(((e,s)=>{const n=e.fullname.toLowerCase(),t=s.fullname.toLowerCase();return n.localeCompare(t)}))}clearSearch(){this.searchString="",this.contactTypes=this.noSearchTypes,this.hasContacts=!1;for(const e in this.contacts)if(this.contacts[e].length>0)return this.hasContacts=!0,void 0}search(e){return d.a.closeKeyboard(),this.loaded=!1,this.loadingMessage=this.searchingMessages,this.performSearch(e).finally((()=>{this.loaded=!0}))}performSearch(e){return Object(i.a)(this,void 0,void 0,(function*(){try{const s=yield c.a.searchContacts(e);this.hasContacts=s.length>0,this.searchString=e,this.contactTypes=["search"],this.contacts.search=this.sortUsers(s)}catch(e){r.a.showErrorModalDefault(e,"addon.messages.errorwhileretrievingcontacts",!0)}}))}gotoDiscussion(e){this.discussionUserId=e;const s=u.a.getRelativePathToParent("/messages/contacts-35")+`discussion/user/${e}`;u.a.navigate(s,{reset:_.a.isTablet&&!!this.splitView&&!this.splitView.isNested})}ngOnDestroy(){var e;null===(e=this.memberInfoObserver)||void 0===e?void 0:e.off()}}return AddonMessagesContacts35Page.ɵfac=function AddonMessagesContacts35Page_Factory(e){return new(e||AddonMessagesContacts35Page)(h.yc(f.a))},AddonMessagesContacts35Page.ɵcmp=h.sc({type:AddonMessagesContacts35Page,selectors:[["addon-messages-contacts"]],viewQuery:function AddonMessagesContacts35Page_Query(e,s){var n;(1&e&&h.ud(m.a,!0),2&e)&&(h.dd(n=h.Nc())&&(s.splitView=n.first))},decls:22,vars:19,consts:[["slot","start"],[3,"text"],["slot","end"],["slot","fixed",3,"disabled","ionRefresh"],[3,"pullingText"],["autocorrect","off","spellcheck","false","lengthCheck","2","searchArea","AddonMessagesContacts",3,"placeholder","disabled","onSubmit","onClear"],[3,"hideUntil","message"],["icon","fas-address-book",3,"message",4,"ngIf"],["class","ion-no-margin",4,"ngFor","ngForOf"],["icon","fas-address-book",3,"message"],[1,"ion-no-margin"],[4,"ngIf"],[1,"item-heading"],["slot","end",1,"ion-padding-end"],[4,"ngFor","ngForOf"],["class","ion-text-wrap addon-messages-conversation-item","detail","true","button","",3,"click",4,"ngIf"],["detail","true","button","",1,"ion-text-wrap","addon-messages-conversation-item",3,"click"],["slot","start",3,"user","checkOnline"]],template:function AddonMessagesContacts35Page_Template(e,s){1&e&&(h.Ec(0,"ion-header"),h.Ec(1,"ion-toolbar"),h.Ec(2,"ion-buttons",0),h.zc(3,"ion-back-button",1),h.Pc(4,"translate"),h.Dc(),h.Ec(5,"ion-title"),h.Ec(6,"h1"),h.pd(7),h.Pc(8,"translate"),h.Dc(),h.Dc(),h.Ec(9,"ion-buttons",2),h.zc(10,"core-context-menu"),h.Dc(),h.Dc(),h.Dc(),h.Ec(11,"ion-content"),h.Ec(12,"core-split-view"),h.Ec(13,"ion-refresher",3),h.Mc("ionRefresh",(function AddonMessagesContacts35Page_Template_ion_refresher_ionRefresh_13_listener(e){return s.refreshData(e.target)})),h.zc(14,"ion-refresher-content",4),h.Pc(15,"translate"),h.Dc(),h.Ec(16,"core-search-box",5),h.Mc("onSubmit",(function AddonMessagesContacts35Page_Template_core_search_box_onSubmit_16_listener(e){return s.search(e)}))("onClear",(function AddonMessagesContacts35Page_Template_core_search_box_onClear_16_listener(){return s.clearSearch()})),h.Pc(17,"translate"),h.Dc(),h.Ec(18,"core-loading",6),h.nd(19,AddonMessagesContacts35Page_core_empty_box_19_Template,2,3,"core-empty-box",7),h.nd(20,AddonMessagesContacts35Page_core_empty_box_20_Template,2,3,"core-empty-box",7),h.nd(21,AddonMessagesContacts35Page_ion_list_21_Template,2,1,"ion-list",8),h.Dc(),h.Dc(),h.Dc()),2&e&&(h.lc(3),h.Vc("text",h.Qc(4,11,"core.back")),h.lc(4),h.qd(h.Qc(8,13,"addon.messages.contacts")),h.lc(6),h.Vc("disabled",!s.loaded),h.lc(1),h.Wc("pullingText",h.Qc(15,15,"core.pulltorefresh")),h.lc(2),h.Vc("placeholder",h.Qc(17,17,"addon.messages.contactname"))("disabled",!s.loaded),h.lc(2),h.Vc("hideUntil",s.loaded)("message",s.loadingMessage),h.lc(1),h.Vc("ngIf",!s.hasContacts&&""==s.searchString),h.lc(1),h.Vc("ngIf",!s.hasContacts&&""!=s.searchString),h.lc(1),h.Vc("ngForOf",s.contactTypes))},directives:[p.C,p.Ab,p.m,p.h,p.i,p.yb,M.a,v.a,p.v,m.a,p.bb,p.cb,P.a,C.a,b.t,b.s,O.a,p.P,p.J,p.O,p.W,p.k,p.I,I.a],pipes:[D.d],styles:["[_nghost-%COMP%]   .addon-message-discussion[_ngcontent-%COMP%]   ion-label[_ngcontent-%COMP%], [_nghost-%COMP%]   .addon-messages-conversation-item[_ngcontent-%COMP%]   ion-label[_ngcontent-%COMP%]{margin-right:0;margin-left:0}[_nghost-%COMP%]   .addon-message-discussion[_ngcontent-%COMP%]   .item-heading[_ngcontent-%COMP%]   core-format-text[_ngcontent-%COMP%], [_nghost-%COMP%]   .addon-messages-conversation-item[_ngcontent-%COMP%]   .item-heading[_ngcontent-%COMP%]   core-format-text[_ngcontent-%COMP%]{font-weight:700}[_nghost-%COMP%]   .addon-message-discussion[_ngcontent-%COMP%]   .item-heading[_ngcontent-%COMP%]   ion-icon[_ngcontent-%COMP%], [_nghost-%COMP%]   .addon-messages-conversation-item[_ngcontent-%COMP%]   .item-heading[_ngcontent-%COMP%]   ion-icon[_ngcontent-%COMP%]{margin-left:2px}@supports ((-webkit-margin-start:0) or (margin-inline-start:0)) or (-webkit-margin-start:0){[_nghost-%COMP%]   .addon-message-discussion[_ngcontent-%COMP%]   .item-heading[_ngcontent-%COMP%]   ion-icon[_ngcontent-%COMP%], [_nghost-%COMP%]   .addon-messages-conversation-item[_ngcontent-%COMP%]   .item-heading[_ngcontent-%COMP%]   ion-icon[_ngcontent-%COMP%]{margin-left:unset;-webkit-margin-start:2px;margin-inline-start:2px}}[_nghost-%COMP%]   .addon-message-discussion[_ngcontent-%COMP%]   ion-note[_ngcontent-%COMP%], [_nghost-%COMP%]   .addon-messages-conversation-item[_ngcontent-%COMP%]   ion-note[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-self:flex-start;margin-left:2px}@supports ((-webkit-margin-start:0) or (margin-inline-start:0)) or (-webkit-margin-start:0){[_nghost-%COMP%]   .addon-message-discussion[_ngcontent-%COMP%]   ion-note[_ngcontent-%COMP%], [_nghost-%COMP%]   .addon-messages-conversation-item[_ngcontent-%COMP%]   ion-note[_ngcontent-%COMP%]{margin-left:unset;-webkit-margin-start:2px;margin-inline-start:2px}}[_nghost-%COMP%]   .addon-message-discussion[_ngcontent-%COMP%]   ion-note[_ngcontent-%COMP%]   ion-badge[_ngcontent-%COMP%], [_nghost-%COMP%]   .addon-message-discussion[_ngcontent-%COMP%]   ion-note[_ngcontent-%COMP%]   ion-icon[_ngcontent-%COMP%], [_nghost-%COMP%]   .addon-messages-conversation-item[_ngcontent-%COMP%]   ion-note[_ngcontent-%COMP%]   ion-badge[_ngcontent-%COMP%], [_nghost-%COMP%]   .addon-messages-conversation-item[_ngcontent-%COMP%]   ion-note[_ngcontent-%COMP%]   ion-icon[_ngcontent-%COMP%]{margin-top:3px;align-self:flex-end}[_nghost-%COMP%]   .addon-message-discussion[_ngcontent-%COMP%]   ion-note[_ngcontent-%COMP%]   .addon-message-last-message-date[_ngcontent-%COMP%], [_nghost-%COMP%]   .addon-messages-conversation-item[_ngcontent-%COMP%]   ion-note[_ngcontent-%COMP%]   .addon-message-last-message-date[_ngcontent-%COMP%]{white-space:nowrap;font-size:11px}[_nghost-%COMP%]   .addon-message-discussion[_ngcontent-%COMP%]   .addon-message-last-message[_ngcontent-%COMP%], [_nghost-%COMP%]   .addon-messages-conversation-item[_ngcontent-%COMP%]   .addon-message-last-message[_ngcontent-%COMP%]{display:flex;justify-content:flex-start}[_nghost-%COMP%]   .addon-message-discussion[_ngcontent-%COMP%]   .addon-message-last-message-user[_ngcontent-%COMP%], [_nghost-%COMP%]   .addon-messages-conversation-item[_ngcontent-%COMP%]   .addon-message-last-message-user[_ngcontent-%COMP%]{white-space:nowrap;color:var(--ion-text-color);margin-right:2px}@supports ((-webkit-margin-start:0) or (margin-inline-start:0)) or (-webkit-margin-start:0){[_nghost-%COMP%]   .addon-message-discussion[_ngcontent-%COMP%]   .addon-message-last-message-user[_ngcontent-%COMP%], [_nghost-%COMP%]   .addon-messages-conversation-item[_ngcontent-%COMP%]   .addon-message-last-message-user[_ngcontent-%COMP%]{margin-right:unset;-webkit-margin-end:2px;margin-inline-end:2px}}[_nghost-%COMP%]   .addon-message-discussion[_ngcontent-%COMP%]   .addon-message-last-message-text[_ngcontent-%COMP%], [_nghost-%COMP%]   .addon-messages-conversation-item[_ngcontent-%COMP%]   .addon-message-last-message-text[_ngcontent-%COMP%]{overflow:hidden;text-overflow:ellipsis;white-space:nowrap;flex-shrink:1}[_nghost-%COMP%]   .addon-message-discussion[_ngcontent-%COMP%]   .item-heading[_ngcontent-%COMP%]{margin-top:10px}[_nghost-%COMP%]   ion-item-divider[_ngcontent-%COMP%]   ion-badge[_ngcontent-%COMP%]{margin-left:16px;margin-right:16px}"]}),AddonMessagesContacts35Page})();var y=n("ACYt"),A=n("3CSS"),x=n("vWwc"),T=n("JYLr"),w=n("xpMl"),k=n("hMzs");function AddonMessagesContactsPage_ng_template_19_ion_list_4_ion_item_1_ion_icon_5_Template(e,s){1&e&&(h.zc(0,"ion-icon",20),h.Pc(1,"translate")),2&e&&h.mc("aria-label",h.Qc(1,1,"addon.messages.contactblocked"))}function AddonMessagesContactsPage_ng_template_19_ion_list_4_ion_item_1_Template(e,s){if(1&e){const e=h.Fc();h.Ec(0,"ion-item",15),h.Mc("click",(function AddonMessagesContactsPage_ng_template_19_ion_list_4_ion_item_1_Template_ion_item_click_0_listener(){h.fd(e);const n=s.$implicit;return h.Oc(3).selectUser(n.id)})),h.zc(1,"core-user-avatar",16),h.Ec(2,"ion-label"),h.Ec(3,"p",17),h.zc(4,"core-format-text",18),h.nd(5,AddonMessagesContactsPage_ng_template_19_ion_list_4_ion_item_1_ion_icon_5_Template,2,3,"ion-icon",19),h.Dc(),h.Dc(),h.Dc()}if(2&e){const e=s.$implicit,n=h.Oc(3);h.mc("aria-label",e.fullname)("aria-current",e.id==n.selectedUserId?"page":"false"),h.lc(1),h.Vc("user",e)("checkOnline",e.showonlinestatus)("linkProfile",!1),h.lc(3),h.Vc("text",e.fullname)("contextInstanceId",0),h.lc(1),h.Vc("ngIf",e.isblocked)}}function AddonMessagesContactsPage_ng_template_19_ion_list_4_Template(e,s){if(1&e&&(h.Ec(0,"ion-list",13),h.nd(1,AddonMessagesContactsPage_ng_template_19_ion_list_4_ion_item_1_Template,6,8,"ion-item",14),h.Dc()),2&e){const e=h.Oc(2);h.lc(1),h.Vc("ngForOf",e.confirmedContacts)}}function AddonMessagesContactsPage_ng_template_19_core_empty_box_5_Template(e,s){1&e&&(h.zc(0,"core-empty-box",21),h.Pc(1,"translate")),2&e&&h.Vc("message",h.Qc(1,1,"addon.messages.nocontactsgetstarted"))}function AddonMessagesContactsPage_ng_template_19_Template(e,s){if(1&e){const e=h.Fc();h.Ec(0,"ion-refresher",8),h.Mc("ionRefresh",(function AddonMessagesContactsPage_ng_template_19_Template_ion_refresher_ionRefresh_0_listener(s){h.fd(e);return h.Oc().refreshData(s.target)})),h.zc(1,"ion-refresher-content",9),h.Pc(2,"translate"),h.Dc(),h.Ec(3,"core-loading",5),h.nd(4,AddonMessagesContactsPage_ng_template_19_ion_list_4_Template,2,1,"ion-list",10),h.nd(5,AddonMessagesContactsPage_ng_template_19_core_empty_box_5_Template,2,3,"core-empty-box",11),h.Ec(6,"core-infinite-loading",12),h.Mc("action",(function AddonMessagesContactsPage_ng_template_19_Template_core_infinite_loading_action_6_listener(s){h.fd(e);return h.Oc().loadMore(s)})),h.Dc(),h.Dc()}if(2&e){const e=h.Oc();h.Vc("disabled",!e.confirmedLoaded),h.lc(1),h.Wc("pullingText",h.Qc(2,7,"core.pulltorefresh")),h.lc(2),h.Vc("hideUntil",e.confirmedLoaded),h.lc(1),h.Vc("ngIf",e.confirmedContacts.length),h.lc(1),h.Vc("ngIf",!e.confirmedContacts.length),h.lc(1),h.Vc("enabled",e.confirmedCanLoadMore)("error",e.confirmedLoadMoreError)}}function AddonMessagesContactsPage_ng_template_22_ion_list_4_ion_item_1_p_4_Template(e,s){1&e&&(h.Ec(0,"p"),h.pd(1),h.Pc(2,"translate"),h.Dc()),2&e&&(h.lc(1),h.rd(" ",h.Qc(2,1,"addon.messages.wouldliketocontactyou")," "))}function AddonMessagesContactsPage_ng_template_22_ion_list_4_ion_item_1_Template(e,s){if(1&e){const e=h.Fc();h.Ec(0,"ion-item",15),h.Mc("click",(function AddonMessagesContactsPage_ng_template_22_ion_list_4_ion_item_1_Template_ion_item_click_0_listener(){h.fd(e);const n=s.$implicit;return h.Oc(3).selectUser(n.id)})),h.zc(1,"core-user-avatar",22),h.Ec(2,"ion-label"),h.zc(3,"core-format-text",18),h.nd(4,AddonMessagesContactsPage_ng_template_22_ion_list_4_ion_item_1_p_4_Template,3,3,"p",23),h.Dc(),h.Dc()}if(2&e){const e=s.$implicit,n=h.Oc(3);h.mc("aria-label",e.fullname)("aria-current",e.id==n.selectedUserId?"page":"false"),h.lc(1),h.Vc("user",e)("linkProfile",!1),h.lc(2),h.Vc("text",e.fullname)("contextInstanceId",0),h.lc(1),h.Vc("ngIf",!e.iscontact)}}function AddonMessagesContactsPage_ng_template_22_ion_list_4_Template(e,s){if(1&e&&(h.Ec(0,"ion-list",13),h.nd(1,AddonMessagesContactsPage_ng_template_22_ion_list_4_ion_item_1_Template,5,7,"ion-item",14),h.Dc()),2&e){const e=h.Oc(2);h.lc(1),h.Vc("ngForOf",e.requests)}}function AddonMessagesContactsPage_ng_template_22_core_empty_box_5_Template(e,s){1&e&&(h.zc(0,"core-empty-box",21),h.Pc(1,"translate")),2&e&&h.Vc("message",h.Qc(1,1,"addon.messages.nocontactrequests"))}function AddonMessagesContactsPage_ng_template_22_Template(e,s){if(1&e){const e=h.Fc();h.Ec(0,"ion-refresher",8),h.Mc("ionRefresh",(function AddonMessagesContactsPage_ng_template_22_Template_ion_refresher_ionRefresh_0_listener(s){h.fd(e);return h.Oc().refreshData(s.target)})),h.zc(1,"ion-refresher-content",9),h.Pc(2,"translate"),h.Dc(),h.Ec(3,"core-loading",5),h.nd(4,AddonMessagesContactsPage_ng_template_22_ion_list_4_Template,2,1,"ion-list",10),h.nd(5,AddonMessagesContactsPage_ng_template_22_core_empty_box_5_Template,2,3,"core-empty-box",11),h.Ec(6,"core-infinite-loading",12),h.Mc("action",(function AddonMessagesContactsPage_ng_template_22_Template_core_infinite_loading_action_6_listener(s){h.fd(e);return h.Oc().loadMore(s)})),h.Dc(),h.Dc()}if(2&e){const e=h.Oc();h.Vc("disabled",!e.requestsLoaded),h.lc(1),h.Wc("pullingText",h.Qc(2,7,"core.pulltorefresh")),h.lc(2),h.Vc("hideUntil",e.requestsLoaded),h.lc(1),h.Vc("ngIf",e.requests.length),h.lc(1),h.Vc("ngIf",!e.requests.length),h.lc(1),h.Vc("enabled",e.requestsCanLoadMore)("error",e.requestsLoadMoreError)}}let S=(()=>{class AddonMessagesContactsPage{constructor(){this.selected="confirmed",this.requestsBadge="",this.confirmedLoaded=!1,this.confirmedInitialising=!1,this.confirmedCanLoadMore=!1,this.confirmedLoadMoreError=!1,this.confirmedContacts=[],this.requestsLoaded=!1,this.requestsInitialising=!1,this.requestsCanLoadMore=!1,this.requestsLoadMoreError=!1,this.requests=[],this.siteId=a.b.getCurrentSiteId(),this.contactRequestsCountObserver=l.b.on(c.b.CONTACT_REQUESTS_COUNT_EVENT,(e=>{this.requestsBadge=e.count>0?String(e.count):""}),this.siteId),this.memberInfoObserver=l.b.on(c.b.MEMBER_INFO_CHANGED_EVENT,(e=>{if(e.userBlocked||e.userUnblocked){const s=this.confirmedContacts.find((s=>s.id==e.userId));s&&(s.isblocked=!!e.userBlocked)}else if(e.contactRemoved){const s=this.confirmedContacts.findIndex((s=>s.id==e.userId));s>=0&&this.confirmedContacts.splice(s,1)}else e.contactRequestConfirmed&&this.confirmedFetchData(!0);if(e.contactRequestConfirmed||e.contactRequestDeclined){const s=this.requests.findIndex((s=>s.id==e.userId));s>=0&&this.requests.splice(s,1)}}),a.b.getCurrentSiteId())}ngOnInit(){return Object(i.a)(this,void 0,void 0,(function*(){c.a.getContactRequestsCount(this.siteId),"confirmed"===this.selected?yield this.initConfirmed():yield this.initRequests()}))}initConfirmed(){return Object(i.a)(this,void 0,void 0,(function*(){if(!this.confirmedInitialising)try{this.confirmedInitialising=!0,yield this.confirmedFetchData(),this.confirmedContacts.length&&_.a.isTablet&&this.selectUser(this.confirmedContacts[0].id,!0)}finally{this.confirmedInitialising=!1,this.confirmedLoaded=!0}}))}initRequests(){return Object(i.a)(this,void 0,void 0,(function*(){if(!this.requestsInitialising)try{this.requestsInitialising=!0,yield this.requestsFetchData(),this.requests.length&&_.a.isTablet&&this.selectUser(this.requests[0].id,!0)}finally{this.requestsInitialising=!1,this.requestsLoaded=!0}}))}confirmedFetchData(e=!1){return Object(i.a)(this,void 0,void 0,(function*(){this.confirmedLoadMoreError=!1;const s=e?0:this.confirmedContacts.length;0===s&&(yield c.a.invalidateUserContacts());try{const n=yield c.a.getUserContacts(s);this.confirmedContacts=e?n.contacts:this.confirmedContacts.concat(n.contacts),this.confirmedCanLoadMore=n.canLoadMore}catch(e){this.confirmedLoadMoreError=!0,r.a.showErrorModalDefault(e,"addon.messages.errorwhileretrievingcontacts",!0)}}))}requestsFetchData(e=!1){return Object(i.a)(this,void 0,void 0,(function*(){this.requestsLoadMoreError=!1;const s=e?0:this.requests.length;0===s&&(yield c.a.invalidateContactRequestsCache());try{const n=yield c.a.getContactRequests(s);this.requests=e?n.requests:this.requests.concat(n.requests),this.requestsCanLoadMore=n.canLoadMore}catch(e){this.requestsLoadMoreError=!0,r.a.showErrorModalDefault(e,"addon.messages.errorwhileretrievingcontacts",!0)}}))}refreshData(e){return Object(i.a)(this,void 0,void 0,(function*(){try{"confirmed"==this.selected?yield this.confirmedFetchData(!0):(c.a.refreshContactRequestsCount(),yield this.requestsFetchData(!0))}finally{null==e?void 0:e.complete()}}))}loadMore(e){return Object(i.a)(this,void 0,void 0,(function*(){try{"confirmed"==this.selected?yield this.confirmedFetchData():yield this.requestsFetchData()}finally{e&&e()}}))}gotoSearch(){u.a.navigateToSitePath("search")}selectTab(e){"confirmed"!==e&&"requests"!==e||(this.selected=e,"confirmed"!=this.selected||this.confirmedLoaded||this.initConfirmed(),"requests"!=this.selected||this.requestsLoaded||this.initRequests())}selectUser(e,s=!1){if(e==this.selectedUserId&&_.a.isTablet)return;if(s&&_.a.isMobile)return;this.selectedUserId=e;const n=u.a.getRelativePathToParent("/messages/contacts")+`discussion/user/${e}`;u.a.navigate(n,{reset:_.a.isTablet&&!!this.splitView&&!this.splitView.isNested})}ngOnDestroy(){var e;null===(e=this.contactRequestsCountObserver)||void 0===e?void 0:e.off()}}return AddonMessagesContactsPage.ɵfac=function AddonMessagesContactsPage_Factory(e){return new(e||AddonMessagesContactsPage)},AddonMessagesContactsPage.ɵcmp=h.sc({type:AddonMessagesContactsPage,selectors:[["page-addon-messages-contacts"]],viewQuery:function AddonMessagesContactsPage_Query(e,s){var n;(1&e&&h.ud(m.a,!0),2&e)&&(h.dd(n=h.Nc())&&(s.splitView=n.first))},decls:23,vars:17,consts:[["slot","start"],[3,"text"],["slot","end"],["fill","clear",3,"click"],["name","fas-magnifying-glass","slot","icon-only","aria-hidden","true"],[3,"hideUntil"],[3,"title","ionSelect"],["badgeA11yText","addon.messages.pendingcontactrequests",3,"title","badge","ionSelect"],["slot","fixed",3,"disabled","ionRefresh"],[3,"pullingText"],["class","ion-no-margin",4,"ngIf"],["icon","far-address-book",3,"message",4,"ngIf"],["position","bottom",3,"enabled","error","action"],[1,"ion-no-margin"],["class","ion-text-wrap addon-messages-conversation-item","button","","detail","true",3,"click",4,"ngFor","ngForOf"],["button","","detail","true",1,"ion-text-wrap","addon-messages-conversation-item",3,"click"],["slot","start",3,"user","checkOnline","linkProfile"],[1,"item-heading"],["contextLevel","system",3,"text","contextInstanceId"],["name","fas-user-slash","slot","end",4,"ngIf"],["name","fas-user-slash","slot","end"],["icon","far-address-book",3,"message"],["slot","start",3,"user","linkProfile"],[4,"ngIf"]],template:function AddonMessagesContactsPage_Template(e,s){1&e&&(h.Ec(0,"ion-header"),h.Ec(1,"ion-toolbar"),h.Ec(2,"ion-buttons",0),h.zc(3,"ion-back-button",1),h.Pc(4,"translate"),h.Dc(),h.Ec(5,"ion-title"),h.Ec(6,"h1"),h.pd(7),h.Pc(8,"translate"),h.Dc(),h.Dc(),h.Ec(9,"ion-buttons",2),h.Ec(10,"ion-button",3),h.Mc("click",(function AddonMessagesContactsPage_Template_ion_button_click_10_listener(){return s.gotoSearch()})),h.Pc(11,"translate"),h.zc(12,"ion-icon",4),h.Dc(),h.zc(13,"core-context-menu"),h.Dc(),h.Dc(),h.Dc(),h.Ec(14,"ion-content"),h.Ec(15,"core-split-view"),h.Ec(16,"core-tabs",5),h.Ec(17,"core-tab",6),h.Mc("ionSelect",(function AddonMessagesContactsPage_Template_core_tab_ionSelect_17_listener(){return s.selectTab("confirmed")})),h.Pc(18,"translate"),h.nd(19,AddonMessagesContactsPage_ng_template_19_Template,7,9,"ng-template"),h.Dc(),h.Ec(20,"core-tab",7),h.Mc("ionSelect",(function AddonMessagesContactsPage_Template_core_tab_ionSelect_20_listener(){return s.selectTab("requests")})),h.Pc(21,"translate"),h.nd(22,AddonMessagesContactsPage_ng_template_22_Template,7,9,"ng-template"),h.Dc(),h.Dc(),h.Dc(),h.Dc()),2&e&&(h.lc(3),h.Vc("text",h.Qc(4,7,"core.back")),h.lc(4),h.qd(h.Qc(8,9,"addon.messages.contacts")),h.lc(3),h.mc("aria-label",h.Qc(11,11,"addon.messages.searchcombined")),h.lc(6),h.Vc("hideUntil",!0),h.lc(1),h.Vc("title",h.Qc(18,13,"addon.messages.contacts")),h.lc(3),h.Vc("title",h.Qc(21,15,"addon.messages.requests"))("badge",s.requestsBadge))},directives:[p.C,p.Ab,p.m,p.h,p.i,p.yb,y.a,p.l,p.D,A.a,M.a,v.a,p.v,m.a,x.a,T.a,p.bb,p.cb,C.a,b.t,w.a,p.P,b.s,p.I,I.a,p.O,k.a,O.a],pipes:[D.d],styles:["[_nghost-%COMP%]   .addon-message-discussion[_ngcontent-%COMP%]   ion-label[_ngcontent-%COMP%], [_nghost-%COMP%]   .addon-messages-conversation-item[_ngcontent-%COMP%]   ion-label[_ngcontent-%COMP%]{margin-right:0;margin-left:0}[_nghost-%COMP%]   .addon-message-discussion[_ngcontent-%COMP%]   .item-heading[_ngcontent-%COMP%]   core-format-text[_ngcontent-%COMP%], [_nghost-%COMP%]   .addon-messages-conversation-item[_ngcontent-%COMP%]   .item-heading[_ngcontent-%COMP%]   core-format-text[_ngcontent-%COMP%]{font-weight:700}[_nghost-%COMP%]   .addon-message-discussion[_ngcontent-%COMP%]   .item-heading[_ngcontent-%COMP%]   ion-icon[_ngcontent-%COMP%], [_nghost-%COMP%]   .addon-messages-conversation-item[_ngcontent-%COMP%]   .item-heading[_ngcontent-%COMP%]   ion-icon[_ngcontent-%COMP%]{margin-left:2px}@supports ((-webkit-margin-start:0) or (margin-inline-start:0)) or (-webkit-margin-start:0){[_nghost-%COMP%]   .addon-message-discussion[_ngcontent-%COMP%]   .item-heading[_ngcontent-%COMP%]   ion-icon[_ngcontent-%COMP%], [_nghost-%COMP%]   .addon-messages-conversation-item[_ngcontent-%COMP%]   .item-heading[_ngcontent-%COMP%]   ion-icon[_ngcontent-%COMP%]{margin-left:unset;-webkit-margin-start:2px;margin-inline-start:2px}}[_nghost-%COMP%]   .addon-message-discussion[_ngcontent-%COMP%]   ion-note[_ngcontent-%COMP%], [_nghost-%COMP%]   .addon-messages-conversation-item[_ngcontent-%COMP%]   ion-note[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-self:flex-start;margin-left:2px}@supports ((-webkit-margin-start:0) or (margin-inline-start:0)) or (-webkit-margin-start:0){[_nghost-%COMP%]   .addon-message-discussion[_ngcontent-%COMP%]   ion-note[_ngcontent-%COMP%], [_nghost-%COMP%]   .addon-messages-conversation-item[_ngcontent-%COMP%]   ion-note[_ngcontent-%COMP%]{margin-left:unset;-webkit-margin-start:2px;margin-inline-start:2px}}[_nghost-%COMP%]   .addon-message-discussion[_ngcontent-%COMP%]   ion-note[_ngcontent-%COMP%]   ion-badge[_ngcontent-%COMP%], [_nghost-%COMP%]   .addon-message-discussion[_ngcontent-%COMP%]   ion-note[_ngcontent-%COMP%]   ion-icon[_ngcontent-%COMP%], [_nghost-%COMP%]   .addon-messages-conversation-item[_ngcontent-%COMP%]   ion-note[_ngcontent-%COMP%]   ion-badge[_ngcontent-%COMP%], [_nghost-%COMP%]   .addon-messages-conversation-item[_ngcontent-%COMP%]   ion-note[_ngcontent-%COMP%]   ion-icon[_ngcontent-%COMP%]{margin-top:3px;align-self:flex-end}[_nghost-%COMP%]   .addon-message-discussion[_ngcontent-%COMP%]   ion-note[_ngcontent-%COMP%]   .addon-message-last-message-date[_ngcontent-%COMP%], [_nghost-%COMP%]   .addon-messages-conversation-item[_ngcontent-%COMP%]   ion-note[_ngcontent-%COMP%]   .addon-message-last-message-date[_ngcontent-%COMP%]{white-space:nowrap;font-size:11px}[_nghost-%COMP%]   .addon-message-discussion[_ngcontent-%COMP%]   .addon-message-last-message[_ngcontent-%COMP%], [_nghost-%COMP%]   .addon-messages-conversation-item[_ngcontent-%COMP%]   .addon-message-last-message[_ngcontent-%COMP%]{display:flex;justify-content:flex-start}[_nghost-%COMP%]   .addon-message-discussion[_ngcontent-%COMP%]   .addon-message-last-message-user[_ngcontent-%COMP%], [_nghost-%COMP%]   .addon-messages-conversation-item[_ngcontent-%COMP%]   .addon-message-last-message-user[_ngcontent-%COMP%]{white-space:nowrap;color:var(--ion-text-color);margin-right:2px}@supports ((-webkit-margin-start:0) or (margin-inline-start:0)) or (-webkit-margin-start:0){[_nghost-%COMP%]   .addon-message-discussion[_ngcontent-%COMP%]   .addon-message-last-message-user[_ngcontent-%COMP%], [_nghost-%COMP%]   .addon-messages-conversation-item[_ngcontent-%COMP%]   .addon-message-last-message-user[_ngcontent-%COMP%]{margin-right:unset;-webkit-margin-end:2px;margin-inline-end:2px}}[_nghost-%COMP%]   .addon-message-discussion[_ngcontent-%COMP%]   .addon-message-last-message-text[_ngcontent-%COMP%], [_nghost-%COMP%]   .addon-messages-conversation-item[_ngcontent-%COMP%]   .addon-message-last-message-text[_ngcontent-%COMP%]{overflow:hidden;text-overflow:ellipsis;white-space:nowrap;flex-shrink:1}[_nghost-%COMP%]   .addon-message-discussion[_ngcontent-%COMP%]   .item-heading[_ngcontent-%COMP%]{margin-top:10px}[_nghost-%COMP%]   ion-item-divider[_ngcontent-%COMP%]   ion-badge[_ngcontent-%COMP%]{margin-left:16px;margin-right:16px}"]}),AddonMessagesContactsPage})();var V=n("nopL"),L=n("fTjU"),q=n("4pns"),R=n("bFG1"),N=n("vuGA"),G=n("3j9v"),U=n("kScs"),F=n("f0Wu"),Q=n.n(F),z=n("93ts"),j=n("BaYo"),B=n("6s78"),$=n("ACV2"),H=n("8/N+"),Y=n("NcPy"),W=n("9pYf"),K=n("yNDK"),J=n("O4u7"),X=n("uYHD");function AddonMessagesDiscussionPage_img_7_Template(e,s){if(1&e&&h.zc(0,"img",25),2&e){const e=h.Oc();h.Vc("src",e.conversationImage,h.id)("siteId",e.siteId||null)}}function AddonMessagesDiscussionPage_core_user_avatar_8_Template(e,s){if(1&e&&h.zc(0,"core-user-avatar",26),2&e){const e=h.Oc();h.Vc("user",e.otherMember)("linkProfile",!1)("checkOnline",e.otherMember.showonlinestatus)}}function AddonMessagesDiscussionPage_ion_icon_10_Template(e,s){1&e&&(h.zc(0,"ion-icon",27),h.Pc(1,"translate")),2&e&&h.mc("aria-label",h.Qc(1,1,"core.favourites"))}function AddonMessagesDiscussionPage_ion_icon_11_Template(e,s){1&e&&(h.zc(0,"ion-icon",28),h.Pc(1,"translate")),2&e&&h.mc("aria-label",h.Qc(1,1,"addon.messages.mutedconversation"))}function AddonMessagesDiscussionPage_ng_container_39_Template(e,s){1&e&&(h.Cc(0),h.Ec(1,"p",29),h.pd(2),h.Pc(3,"translate"),h.Dc(),h.Ec(4,"p",29),h.Ec(5,"em"),h.pd(6),h.Pc(7,"translate"),h.Dc(),h.Dc(),h.Bc()),2&e&&(h.lc(2),h.qd(h.Qc(3,2,"addon.messages.selfconversation")),h.lc(4),h.qd(h.Qc(7,4,"addon.messages.selfconversationdefaultmessage")))}function AddonMessagesDiscussionPage_ng_container_43_h3_1_Template(e,s){if(1&e&&(h.Ec(0,"h3",33),h.pd(1),h.Pc(2,"coreFormatDate"),h.Dc()),2&e){const e=h.Oc().$implicit;h.lc(1),h.rd(" ",h.Rc(2,1,e.timecreated,"strftimedayshort")," ")}}function AddonMessagesDiscussionPage_ng_container_43_ion_chip_2_Template(e,s){1&e&&(h.Ec(0,"ion-chip",34),h.Ec(1,"ion-label"),h.pd(2),h.Pc(3,"translate"),h.Dc(),h.zc(4,"ion-icon",35),h.Dc()),2&e&&(h.lc(2),h.qd(h.Qc(3,1,"addon.messages.newmessages")))}function AddonMessagesDiscussionPage_ng_container_43_Template(e,s){if(1&e){const e=h.Fc();h.Cc(0),h.nd(1,AddonMessagesDiscussionPage_ng_container_43_h3_1_Template,3,4,"h3",30),h.nd(2,AddonMessagesDiscussionPage_ng_container_43_ion_chip_2_Template,5,3,"ion-chip",31),h.Ec(3,"core-message",32),h.Mc("afterRender",(function AddonMessagesDiscussionPage_ng_container_43_Template_core_message_afterRender_3_listener(){h.fd(e);const n=s.last,t=h.Oc();return n&&t.scrollToBottom()}))("onDeleteMessage",(function AddonMessagesDiscussionPage_ng_container_43_Template_core_message_onDeleteMessage_3_listener(){h.fd(e);const n=s.$implicit,t=s.index;return h.Oc().deleteMessage(n,t)})),h.Dc(),h.Bc()}if(2&e){const e=s.$implicit,n=h.Oc();h.lc(1),h.Vc("ngIf",e.showDate),h.lc(1),h.Vc("ngIf",n.unreadMessageFrom>0&&e.id==n.unreadMessageFrom),h.lc(1),h.Vc("message",e)("user",n.members[e.useridfrom])("text",e.text)("showDelete",n.showDelete)("time",e.timecreated)}}function AddonMessagesDiscussionPage_core_empty_box_44_Template(e,s){1&e&&(h.zc(0,"core-empty-box",36),h.Pc(1,"translate")),2&e&&h.Vc("message",h.Qc(1,1,"addon.messages.nomessagesfound"))}function AddonMessagesDiscussionPage_ion_fab_45_Template(e,s){if(1&e){const e=h.Fc();h.Ec(0,"ion-fab",37),h.Ec(1,"ion-fab-button",38),h.Mc("click",(function AddonMessagesDiscussionPage_ion_fab_45_Template_ion_fab_button_click_1_listener(){h.fd(e);return h.Oc().scrollToFirstUnreadMessage()})),h.Pc(2,"translate"),h.zc(3,"ion-icon",35),h.Ec(4,"span",19),h.pd(5),h.Pc(6,"translate"),h.Dc(),h.Dc(),h.Ec(7,"ion-badge",39),h.pd(8),h.Dc(),h.Dc()}if(2&e){const e=h.Oc();h.lc(1),h.mc("aria-label",h.Qc(2,3,"addon.messages.newmessages")),h.lc(4),h.qd(h.Qc(6,5,"addon.messages.newmessages")),h.lc(3),h.qd(e.newMessages)}}function AddonMessagesDiscussionPage_ion_footer_46_p_2_Template(e,s){1&e&&(h.Ec(0,"p",45),h.pd(1),h.Pc(2,"translate"),h.Dc()),2&e&&(h.lc(1),h.rd(" ",h.Qc(2,1,"addon.messages.unabletomessage")," "))}function AddonMessagesDiscussionPage_ion_footer_46_div_3_Template(e,s){if(1&e){const e=h.Fc();h.Ec(0,"div",46),h.Ec(1,"p",29),h.pd(2),h.Pc(3,"translate"),h.Dc(),h.Ec(4,"ion-button",47),h.Mc("click",(function AddonMessagesDiscussionPage_ion_footer_46_div_3_Template_ion_button_click_4_listener(){h.fd(e);return h.Oc(2).unblockUser()})),h.pd(5),h.Pc(6,"translate"),h.Dc(),h.Dc()}2&e&&(h.lc(2),h.qd(h.Qc(3,2,"addon.messages.youhaveblockeduser")),h.lc(3),h.rd(" ",h.Qc(6,4,"addon.messages.unblockuser")," "))}const _c0=function(e){return{$a:e}};function AddonMessagesDiscussionPage_ion_footer_46_div_4_Template(e,s){if(1&e){const e=h.Fc();h.Ec(0,"div",46),h.Ec(1,"p",29),h.Ec(2,"strong"),h.pd(3),h.Pc(4,"translate"),h.Dc(),h.Dc(),h.Ec(5,"p",29),h.pd(6),h.Pc(7,"translate"),h.Dc(),h.Ec(8,"ion-button",47),h.Mc("click",(function AddonMessagesDiscussionPage_ion_footer_46_div_4_Template_ion_button_click_8_listener(){h.fd(e);return h.Oc(2).createContactRequest()})),h.pd(9),h.Pc(10,"translate"),h.Dc(),h.Dc()}if(2&e){const e=h.Oc(2);h.lc(3),h.qd(h.Rc(4,3,"addon.messages.isnotinyourcontacts",h.ad(11,_c0,e.otherMember.fullname))),h.lc(3),h.qd(h.Rc(7,6,"addon.messages.requirecontacttomessage",h.ad(13,_c0,e.otherMember.fullname))),h.lc(3),h.rd(" ",h.Qc(10,9,"addon.messages.sendcontactrequest")," ")}}function AddonMessagesDiscussionPage_ion_footer_46_div_5_Template(e,s){if(1&e){const e=h.Fc();h.Ec(0,"div",46),h.Ec(1,"p",29),h.pd(2),h.Pc(3,"translate"),h.Dc(),h.Ec(4,"ion-button",47),h.Mc("click",(function AddonMessagesDiscussionPage_ion_footer_46_div_5_Template_ion_button_click_4_listener(){h.fd(e);return h.Oc(2).confirmContactRequest()})),h.pd(5),h.Pc(6,"translate"),h.Dc(),h.Ec(7,"ion-button",48),h.Mc("click",(function AddonMessagesDiscussionPage_ion_footer_46_div_5_Template_ion_button_click_7_listener(){h.fd(e);return h.Oc(2).declineContactRequest()})),h.pd(8),h.Pc(9,"translate"),h.Dc(),h.Dc()}if(2&e){const e=h.Oc(2);h.lc(2),h.qd(h.Rc(3,3,"addon.messages.userwouldliketocontactyou",h.ad(10,_c0,e.otherMember.fullname))),h.lc(3),h.rd(" ",h.Qc(6,6,"addon.messages.acceptandaddcontact")," "),h.lc(3),h.rd(" ",h.Qc(9,8,"addon.messages.decline")," ")}}function AddonMessagesDiscussionPage_ion_footer_46_div_6_p_5_Template(e,s){if(1&e&&(h.Ec(0,"p",29),h.pd(1),h.Pc(2,"translate"),h.Dc()),2&e){const e=h.Oc(3);h.lc(1),h.rd(" ",h.Rc(2,1,"addon.messages.yourcontactrequestpending",h.ad(4,_c0,e.otherMember.fullname))," ")}}function AddonMessagesDiscussionPage_ion_footer_46_div_6_Template(e,s){if(1&e&&(h.Ec(0,"div",46),h.Ec(1,"p",29),h.Ec(2,"strong"),h.pd(3),h.Pc(4,"translate"),h.Dc(),h.Dc(),h.nd(5,AddonMessagesDiscussionPage_ion_footer_46_div_6_p_5_Template,3,6,"p",49),h.Dc()),2&e){const e=h.Oc(2);h.lc(3),h.qd(h.Qc(4,2,"addon.messages.contactrequestsent")),h.lc(2),h.Vc("ngIf",e.otherMember)}}function AddonMessagesDiscussionPage_ion_footer_46_core_send_message_form_7_Template(e,s){if(1&e){const e=h.Fc();h.Ec(0,"core-send-message-form",50),h.Mc("onSubmit",(function AddonMessagesDiscussionPage_ion_footer_46_core_send_message_form_7_Template_core_send_message_form_onSubmit_0_listener(s){h.fd(e);return h.Oc(2).sendMessage(s)})),h.Pc(1,"translate"),h.Dc()}if(2&e){const e=h.Oc(2);h.Vc("showKeyboard",e.showKeyboard)("placeholder",h.Qc(1,2,"addon.messages.newmessage"))}}function AddonMessagesDiscussionPage_ion_footer_46_Template(e,s){if(1&e&&(h.Ec(0,"ion-footer",40),h.Ec(1,"ion-toolbar",41),h.nd(2,AddonMessagesDiscussionPage_ion_footer_46_p_2_Template,3,3,"p",42),h.nd(3,AddonMessagesDiscussionPage_ion_footer_46_div_3_Template,7,6,"div",43),h.nd(4,AddonMessagesDiscussionPage_ion_footer_46_div_4_Template,11,15,"div",43),h.nd(5,AddonMessagesDiscussionPage_ion_footer_46_div_5_Template,10,12,"div",43),h.nd(6,AddonMessagesDiscussionPage_ion_footer_46_div_6_Template,6,4,"div",43),h.nd(7,AddonMessagesDiscussionPage_ion_footer_46_core_send_message_form_7_Template,2,4,"core-send-message-form",44),h.Dc(),h.Dc()),2&e){const e=h.Oc();h.lc(1),h.Vc("color","message"==e.footerType?null:"light"),h.lc(1),h.Vc("ngIf","unable"==e.footerType),h.lc(1),h.Vc("ngIf","blocked"==e.footerType),h.lc(1),h.Vc("ngIf","requiresContact"==e.footerType&&e.otherMember),h.lc(1),h.Vc("ngIf","requestReceived"==e.footerType&&e.otherMember),h.lc(1),h.Vc("ngIf","requestSent"==e.footerType||"message"==e.footerType&&e.requestContactSent),h.lc(1),h.Vc("ngIf","message"==e.footerType)}}let Z=(()=>{class AddonMessagesDiscussionPage{constructor(e,s){this.route=e,this.elementRef=s,this.fetching=!1,this.messagesBeingSent=0,this.pagesLoaded=1,this.lastMessage={text:"",timecreated:0},this.keepMessageMap={},this.oldContentHeight=0,this.scrollBottom=!0,this.viewDestroyed=!1,this.showLoadingModal=!1,this.showInfo=!1,this.loaded=!1,this.showKeyboard=!1,this.canLoadMore=!1,this.loadMoreError=!1,this.messages=[],this.showDelete=!1,this.canDelete=!1,this.isGroup=!1,this.members={},this.favouriteIcon="fa-star",this.deleteIcon="fas-trash",this.blockIcon="fas-user-lock",this.addRemoveIcon="fas-user-plus",this.muteIcon="fas-bell-slash",this.favouriteIconSlash=!1,this.muteEnabled=!1,this.footerType="unable",this.requestContactSent=!1,this.requestContactReceived=!1,this.isSelf=!1,this.newMessages=0,this.unreadMessageFrom=0,this.initialized=!1,this.hostElement=s.nativeElement,this.siteId=a.b.getCurrentSiteId(),this.currentUserId=a.b.getCurrentSiteUserId(),this.groupMessagingEnabled=c.a.isGroupMessagingEnabled(),this.muteEnabled=c.a.isMuteConversationEnabled(),this.logger=G.a.getInstance("AddonMessagesDiscussionPage"),this.syncObserver=l.b.on(L.b.AUTO_SYNCED,(e=>{(e.userId&&e.userId==this.userId||e.conversationId&&e.conversationId==this.conversationId)&&(this.fetchMessages(),e.warnings&&e.warnings[0]&&r.a.showAlert(void 0,e.warnings[0]))}),this.siteId),this.memberInfoObserver=l.b.on(c.b.MEMBER_INFO_CHANGED_EVENT,(e=>{e.userId&&(this.members[e.userId]||this.otherMember&&e.userId==this.otherMember.id)&&this.fetchData()}),this.siteId)}ngOnInit(){return Object(i.a)(this,void 0,void 0,(function*(){this.conversationId=u.a.getRouteNumberParam("conversationId"),this.userId=u.a.getRouteNumberParam("userId"),this.showInfo=!u.a.getRouteBooleanParam("hideInfo"),this.showKeyboard=!!u.a.getRouteBooleanParam("showKeyboard"),yield this.fetchData(),this.scrollToBottom(!0)}))}ngAfterViewInit(){var e;return Object(i.a)(this,void 0,void 0,(function*(){this.scrollElement=yield null===(e=this.content)||void 0===e?void 0:e.getScrollElement()}))}addMessage(e,s=!0){e.hash=U.Md5.hashAsciiStr(String(("id"in e?e.id:"")||e.text||""))+"#"+e.timecreated+"#"+e.useridfrom;let n=!1;return void 0===this.keepMessageMap[e.hash]&&(this.messages.push(e),n=e.useridfrom!=this.currentUserId),this.keepMessageMap[e.hash]=s,n}removeMessage(e){if(this.keepMessageMap[e])return this.keepMessageMap[e]=!1,void 0;delete this.keepMessageMap[e];const s=this.messages.findIndex((s=>s.hash==e));s>=0&&this.messages.splice(s,1)}fetchData(){return Object(i.a)(this,void 0,void 0,(function*(){let e;this.showLoadingModal&&(e=yield r.a.showModalLoading()),!this.groupMessagingEnabled&&this.userId&&q.a.getProfile(this.userId,void 0,!0).then((e=>{this.title||(this.title=e.fullname),this.conversationImage=e.profileimageurl,this.members[e.id]=e})).catch((()=>{}));try{const e=yield L.a.syncDiscussion(this.conversationId,this.userId);e.warnings&&e.warnings[0]&&r.a.showAlert(void 0,e.warnings[0])}catch(e){}try{const e=[];if(this.groupMessagingEnabled){const s=yield this.getConversation(this.conversationId,this.userId);if(s&&e.push(this.fetchMessages()),this.userId){const n=this.userId;e.push(c.a.invalidateMemberInfo(this.userId).then((()=>Object(i.a)(this,void 0,void 0,(function*(){this.otherMember=yield c.a.getMemberInfo(n),!s&&this.otherMember&&(this.conversationImage=this.otherMember.profileimageurl,this.title=this.otherMember.fullname),this.blockIcon=this.otherMember.isblocked?"fas-user-check":"fas-user-lock"})))))}else this.otherMember=void 0}else{if(this.userId){const s=this.userId;e.push(q.a.getProfile(this.userId).then((e=>Object(i.a)(this,void 0,void 0,(function*(){this.otherMember={id:e.id,fullname:e.fullname,profileurl:"",profileimageurl:e.profileimageurl||"",profileimageurlsmall:e.profileimageurlsmall||"",isonline:!1,showonlinestatus:!1,isblocked:!1,iscontact:!1,isdeleted:!1,canmessageevenifblocked:!0,canmessage:!0,requirescontact:!1},this.otherMember.isblocked=yield c.a.isBlocked(s),this.otherMember.iscontact=yield c.a.isContact(s),this.blockIcon=this.otherMember.isblocked?"fas-user-check":"fas-user-lock"})))))}e.push(this.fetchMessages().then((()=>{if(!this.title&&this.messages.length){const e=this.messages[0];"usertofullname"in e&&(this.title=e.useridto!=this.currentUserId?e.usertofullname||"":e.userfromfullname||"")}})))}yield Promise.all(e)}catch(e){r.a.showErrorModalDefault(e,"addon.messages.errorwhileretrievingmessages",!0)}finally{this.checkCanDelete(),this.loaded=!0,this.setPolling(),this.setContactRequestInfo(),this.setFooterType(),e&&e.dismiss()}}))}ionViewDidEnter(){this.setPolling()}ionViewWillLeave(){this.unsetPolling()}fetchMessages(e=!0){return Object(i.a)(this,void 0,void 0,(function*(){if(this.loadMoreError=!1,!(this.messagesBeingSent>0||this.fetching)){if(this.groupMessagingEnabled&&!this.conversationId)throw new z.a("No enough data provided to fetch messages");if(this.conversationId)this.logger.debug(`Polling new messages for conversation '${this.conversationId}'`);else{if(!this.userId)throw new z.a("No enough data provided to fetch messages");this.logger.debug(`Polling new messages for discussion with user '${this.userId}'`)}this.fetching=!0;try{yield L.a.waitForSyncConversation(this.conversationId,this.userId);let s=[];this.groupMessagingEnabled?(yield c.a.invalidateConversationMessages(this.conversationId),s=yield this.getConversationMessages(this.pagesLoaded)):(yield c.a.invalidateDiscussionCache(this.userId),s=yield this.getDiscussionMessages(this.pagesLoaded)),this.loadMessages(s,e)}finally{this.fetching=!1}}}))}loadMessages(e,s=!0){if(this.viewDestroyed)return;if(this.scrollBottom=B.a.scrollIsBottom(this.scrollElement,5),this.messagesBeingSent>0)return;const n=e.reduce(((e,s)=>e+(this.addMessage(s)?1:0)),0);s&&this.setNewMessagesBadge(this.newMessages+n);for(const e in this.keepMessageMap)this.removeMessage(e);c.a.sortMessages(this.messages),this.messages.forEach(((e,s)=>{e.showDate=this.showDate(e,this.messages[s-1]),e.showUserData=this.showUserData(e,this.messages[s-1]),e.showTail=this.showTail(e,this.messages[s+1])}));const t=this.messages[this.messages.length-1],o=this.groupMessagingEnabled&&t&&t.useridfrom!=this.currentUserId&&""!=this.lastMessage.text&&(t.text!==this.lastMessage.text||t.timecreated!==this.lastMessage.timecreated);this.notifyNewMessage(),this.markMessagesAsRead(o)}setNewMessagesBadge(e){0==this.newMessages&&e>0&&this.scrollFunction(),this.newMessages=e}scrollFunction(){var e;if(0==this.newMessages)return;if(B.a.scrollIsBottom(this.scrollElement,40))return this.setNewMessagesBadge(0),void 0;const s=null===(e=this.scrollElement)||void 0===e?void 0:e.getBoundingClientRect(),n=s&&s.bottom||0;if(0==n)return;const t=Array.from(this.hostElement.querySelectorAll("core-message:not(.is-mine)")).slice(-this.newMessages).reverse().findIndex((e=>{const s=e.getBoundingClientRect();return!!s&&s.bottom<=n}));t>0&&t<this.newMessages&&this.setNewMessagesBadge(t)}getConversation(e,s){return Object(i.a)(this,void 0,void 0,(function*(){let n;if(!e&&s)try{n=s===this.currentUserId&&c.a.isSelfConversationEnabled()?yield c.a.getSelfConversation():yield c.a.getConversationBetweenUsers(s,void 0,!0),e=n.id}catch(e){this.isSelf=s===this.currentUserId;const n=yield V.a.getMessages(s);if(n&&n.length)n.forEach((e=>{e.pending=!0,e.text=e.smallmessage})),this.loadMessages(n);else if("errorconversationdoesnotexist"!=e.errorcode)throw e;return!1}if(!e)return!1;yield c.a.invalidateConversation(e);try{this.conversation=yield c.a.getConversation(e,void 0,!0)}catch(e){if(!n)throw e;this.conversation=n}return!!this.conversation&&(this.conversationId=this.conversation.id,this.title=this.conversation.name,this.conversationImage=this.conversation.imageurl,this.isGroup=this.conversation.type==c.b.MESSAGE_CONVERSATION_TYPE_GROUP,this.favouriteIcon="fas-star",this.favouriteIconSlash=this.conversation.isfavourite,this.muteIcon=this.conversation.ismuted?"fas-bell":"fas-bell-slash",this.isGroup||(this.userId=this.conversation.userid),this.isSelf=this.conversation.type==c.b.MESSAGE_CONVERSATION_TYPE_SELF,!0)}))}getConversationMessages(e,s=0){return Object(i.a)(this,void 0,void 0,(function*(){if(!this.conversationId)return[];const n=s>0,t=yield c.a.getConversationMessages(this.conversationId,{excludePending:n,limitFrom:s});e--,t.members&&t.members.forEach((e=>{this.members[e.id]=e}));const o=t.messages;if(e>0&&t.canLoadMore){s+=c.b.LIMIT_MESSAGES;const n=yield this.getConversationMessages(e,s);return o.concat(n)}return this.canLoadMore=!!t.canLoadMore,o}))}getDiscussionMessages(e,s=0,n=0,t=0,o=0){return Object(i.a)(this,void 0,void 0,(function*(){const i=s>0||n>0||t>0||o>0,a=yield c.a.getDiscussion(this.userId,i,s,n,t,o);if(--e>0&&a.canLoadMore){a.messages.forEach((e=>{!e.pending&&"read"in e&&(e.useridfrom==this.userId?e.read?n++:s++:e.read?o++:t++)}));const i=yield this.getDiscussionMessages(e,s,n,t,o);return a.messages.concat(i)}return this.canLoadMore=a.canLoadMore,a.messages}))}markMessagesAsRead(e){var s,n;return Object(i.a)(this,void 0,void 0,(function*(){let t=!1,o=!1;o=!!e||(this.groupMessagingEnabled?!!((null===(s=this.conversation)||void 0===s?void 0:s.unreadcount)&&(null===(n=this.conversation)||void 0===n?void 0:n.unreadcount)>0&&this.conversationId&&this.conversationId>0):this.messages.some((e=>e.useridfrom!=this.currentUserId&&"read"in e&&!e.read))),o&&(this.setUnreadLabelPosition(),this.groupMessagingEnabled?yield c.a.markAllConversationMessagesRead(this.conversationId):(yield c.a.markAllMessagesRead(this.userId),this.messages.forEach((e=>{"read"in e&&(e.read=!0)}))),t=!0),t&&l.b.trigger(c.b.READ_CHANGED_EVENT,{conversationId:this.conversationId,userId:this.userId},this.siteId)}))}notifyNewMessage(){var e,s;const n=this.messages[this.messages.length-1];let t=!1;if(n?n.text===this.lastMessage.text&&n.timecreated===this.lastMessage.timecreated||(this.lastMessage={text:n.text||"",timecreated:n.timecreated},t=!0):(this.lastMessage={text:"",timecreated:0},t=!0),t){l.b.trigger(c.b.NEW_MESSAGE_EVENT,{conversationId:this.conversationId,userId:this.userId,message:this.lastMessage.text,timecreated:this.lastMessage.timecreated,isfavourite:!!(null===(e=this.conversation)||void 0===e?void 0:e.isfavourite),type:null===(s=this.conversation)||void 0===s?void 0:s.type},this.siteId);this.canDelete!=(n&&"id"in n&&n.id&&1==this.messages.length||this.messages.length>1)&&this.checkCanDelete()}}setUnreadLabelPosition(){var e,s;if(0==this.unreadMessageFrom){if(this.groupMessagingEnabled){if(this.conversation&&(null===(e=this.conversation)||void 0===e?void 0:e.unreadcount)&&(null===(s=this.conversation)||void 0===s?void 0:s.unreadcount)>0&&this.messages){let e=0;for(let s=this.messages.length-1;s>=0;s--){const n=this.messages[s];if(!n.pending&&n.useridfrom!=this.currentUserId&&"id"in n&&(e++,e==this.conversation.unreadcount)){this.unreadMessageFrom=Number(n.id);break}}}}else{let e=!1;for(const s in this.messages){const n=this.messages[s];if(n.useridfrom!=this.currentUserId&&"read"in n){if(!n.read&&e){this.unreadMessageFrom=Number(n.id);break}e=!!n.read}}}0==this.unreadMessageFrom&&(this.unreadMessageFrom=-1)}}checkCanDelete(){const e=this.messages[0];this.canDelete=e&&!e.sending}hideUnreadLabel(){this.unreadMessageFrom>0&&(this.unreadMessageFrom=-1)}waitForFetch(){return Object(i.a)(this,void 0,void 0,(function*(){this.fetching&&(yield R.a.wait(400),yield R.a.ignoreErrors(this.waitForFetch()))}))}setPolling(){this.groupMessagingEnabled&&!this.conversationId||this.polling||(this.polling=window.setInterval((()=>{this.fetchMessages().catch((()=>{}))}),c.b.POLL_INTERVAL))}unsetPolling(){this.polling&&(this.logger.debug(`Cancelling polling for conversation with user '${this.userId}'`),clearInterval(this.polling),this.polling=void 0)}copyMessage(e){R.a.copyToClipboard(N.b.decodeHTMLEntities("smallmessage"in e?e.smallmessage||e.text||"":e.text||""))}deleteMessage(e,s){return Object(i.a)(this,void 0,void 0,(function*(){const n=this.conversation&&this.conversation.candeletemessagesforallusers,t=e.pending||n||this.isSelf?"core.areyousure":"addon.messages.deletemessageconfirmation",o={};n&&!e.pending&&(o.inputs=[{type:"checkbox",name:"deleteforall",checked:!1,value:!0,label:g.I.instant("addon.messages.deleteforeveryone")}]);try{const n=yield r.a.showConfirm(g.I.instant(t),void 0,void 0,void 0,o),i=yield r.a.showModalLoading("core.deleting",!0);try{yield c.a.deleteMessage(e,n&&n[0]),this.messages.splice(s,1),this.removeMessage(e.hash),this.notifyNewMessage(),this.fetchMessages()}finally{i.dismiss()}}catch(e){r.a.showErrorModalDefault(e,"addon.messages.errordeletemessage",!0)}}))}loadPrevious(e){var s,n,t,o;return Object(i.a)(this,void 0,void 0,(function*(){if(!this.initialized)return e&&e(),void 0;let i=(null===(s=this.infinite)||void 0===s?void 0:s.hostElement.getBoundingClientRect().height)||0;const a=(null===(n=this.scrollElement)||void 0===n?void 0:n.scrollHeight)||0;try{yield this.waitForFetch()}finally{this.pagesLoaded++;try{yield this.fetchMessages(!1);const e=a-((null===(t=this.scrollElement)||void 0===t?void 0:t.scrollTop)||0),s=(null===(o=this.infinite)||void 0===o?void 0:o.hostElement.getBoundingClientRect().height)||0;this.canLoadMore&&i&&this.infinite?i-=s:this.canLoadMore||(i=i||s),this.keepScroll(a,e,i)}catch(e){this.loadMoreError=!0,this.pagesLoaded--,r.a.showErrorModalDefault(e,"addon.messages.errorwhileretrievingmessages",!0)}finally{e&&e()}}}))}keepScroll(e,s,n,t=0){setTimeout((()=>{var o;if(((null===(o=this.scrollElement)||void 0===o?void 0:o.scrollHeight)||0)==e)return t<=10&&this.keepScroll(e,s,n,t+1),void 0;setTimeout((()=>{var e;const t=(null===(e=this.scrollElement)||void 0===e?void 0:e.scrollHeight)||0;this.content.scrollToPoint(0,t-s+n,0)}),30)}),30)}scrollToBottom(e=!1){return Object(i.a)(this,void 0,void 0,(function*(){(this.scrollBottom||e)&&(this.scrollBottom=!1,this.setNewMessagesBadge(0),yield R.a.nextTicks(5),!this.viewDestroyed&&this.content&&this.content.scrollToBottom(0),e&&(this.initialized=!0))}))}scrollToFirstUnreadMessage(){if(this.newMessages>0){const e=Array.from(this.hostElement.querySelectorAll("core-message:not(.is-mine)"));B.a.scrollToElement(e[e.length-this.newMessages])}}sendMessage(e){return Object(i.a)(this,void 0,void 0,(function*(){this.hideUnreadLabel(),this.showDelete=!1,this.scrollBottom=!0,this.setNewMessagesBadge(0);const s={id:-1,pending:!0,sending:!0,useridfrom:this.currentUserId,smallmessage:e,text:e,timecreated:Date.now()};s.showDate=this.showDate(s,this.messages[this.messages.length-1]),this.addMessage(s,!1),this.messagesBeingSent++;try{yield this.waitForFetch()}finally{try{let n;n=this.conversationId?yield c.a.sendMessageToConversation(this.conversation,e):yield c.a.sendMessage(this.userId,e),this.messagesBeingSent--;let t=!1;if(n.sent)try{if(!this.conversationId&&n.message&&"conversationid"in n.message){yield this.getConversation(n.message.conversationid,this.userId);try{yield this.fetchMessages()}finally{this.setPolling()}}else yield this.fetchMessages()}catch(e){t=!0}!t&&n.sent||(s.sending=!1,n.sent?s.pending=!1:n.message&&(s.timecreated=n.message.timecreated||0),this.notifyNewMessage())}catch(e){this.messagesBeingSent--,d.a.closeKeyboard(),r.a.showErrorModalDefault(e,"addon.messages.messagenotsent",!0),this.removeMessage(s.hash)}}}))}showDate(e,s){return!s||!Q()(e.timecreated).isSame(s.timecreated,"day")}showUserData(e,s){return this.isGroup&&e.useridfrom!=this.currentUserId&&this.members[e.useridfrom||0]&&(!s||s.useridfrom!=e.useridfrom||!!e.showDate)}showTail(e,s){return!s||s.useridfrom!=e.useridfrom||!!s.showDate}viewInfo(){return Object(i.a)(this,void 0,void 0,(function*(){if(this.isGroup){const{AddonMessagesConversationInfoComponent:e}=yield n.e(45).then(n.bind(null,"TTDm")),s=yield r.a.openSideModal({component:e,componentProps:{conversationId:this.conversationId}});if(void 0!==s){u.a.isCurrentPathInTablet("**/messages/**/discussion/**")?l.b.trigger(c.b.OPEN_CONVERSATION_EVENT,{userId:s},this.siteId):u.a.navigateToSitePath(`/messages/discussion/user/${s}`)}}else u.a.navigateToSitePath("/user/profile",{params:{userId:this.userId}})}))}changeFavourite(e){return Object(i.a)(this,void 0,void 0,(function*(){if(this.conversation){this.favouriteIcon=j.a.ICON_LOADING;try{yield c.a.setFavouriteConversation(this.conversation.id,!this.conversation.isfavourite),this.conversation.isfavourite=!this.conversation.isfavourite,c.a.getConversation(this.conversation.id,void 0,!0),l.b.trigger(c.b.UPDATE_CONVERSATION_LIST_EVENT,{conversationId:this.conversation.id,action:"favourite",value:this.conversation.isfavourite},this.siteId)}catch(e){r.a.showErrorModalDefault(e,"Error changing favourite state.")}finally{this.favouriteIcon="fas-star",this.favouriteIconSlash=this.conversation.isfavourite,e&&e()}}}))}changeMute(e){return Object(i.a)(this,void 0,void 0,(function*(){if(this.conversation){this.muteIcon=j.a.ICON_LOADING;try{yield c.a.muteConversation(this.conversation.id,!this.conversation.ismuted),this.conversation.ismuted=!this.conversation.ismuted,c.a.getConversation(this.conversation.id,void 0,!0),l.b.trigger(c.b.UPDATE_CONVERSATION_LIST_EVENT,{conversationId:this.conversation.id,action:"mute",value:this.conversation.ismuted},this.siteId)}catch(e){r.a.showErrorModalDefault(e,"Error changing muted state.")}finally{this.muteIcon=this.conversation.ismuted?"fas-bell":"fas-bell-slash",e&&e()}}}))}setContactRequestInfo(){var e,s;this.requestContactSent=!1,this.requestContactReceived=!1,this.otherMember&&!this.otherMember.iscontact&&(this.requestContactSent=!!(null===(e=this.otherMember.contactrequests)||void 0===e?void 0:e.some((e=>e.userid==this.currentUserId&&e.requesteduserid==this.otherMember.id))),this.requestContactReceived=!!(null===(s=this.otherMember.contactrequests)||void 0===s?void 0:s.some((e=>e.userid==this.otherMember.id&&e.requesteduserid==this.currentUserId))))}setFooterType(){this.footerType=this.otherMember?this.otherMember.isblocked?"blocked":this.requestContactReceived?"requestReceived":this.otherMember.canmessage?"message":this.requestContactSent?"requestSent":this.otherMember.requirescontact?"requiresContact":"unable":"message"}blockUser(){return Object(i.a)(this,void 0,void 0,(function*(){if(!this.otherMember)throw new z.a("No member selected to be blocked.");if(this.otherMember.canmessageevenifblocked)return r.a.showErrorModal(g.I.instant("addon.messages.cantblockuser",{$a:this.otherMember.fullname})),void 0;const e=g.I.instant("addon.messages.blockuserconfirm",{$a:this.otherMember.fullname}),s=g.I.instant("addon.messages.blockuser");try{yield r.a.showConfirm(e,void 0,s),this.blockIcon=j.a.ICON_LOADING;const n=yield r.a.showModalLoading("core.sending",!0);this.showLoadingModal=!0;try{try{yield c.a.blockContact(this.otherMember.id)}finally{n.dismiss(),this.showLoadingModal=!1}}catch(e){r.a.showErrorModalDefault(e,"core.error",!0)}finally{this.blockIcon=this.otherMember.isblocked?"fas-user-check":"fas-user-lock"}}catch(e){}}))}deleteConversation(e){return Object(i.a)(this,void 0,void 0,(function*(){if(!this.conversation)return;const s="addon.messages."+(this.isSelf?"deleteallselfconfirm":"deleteallconfirm");try{yield r.a.showDeleteConfirm(s),this.deleteIcon=j.a.ICON_LOADING;try{try{yield c.a.deleteConversation(this.conversation.id),l.b.trigger(c.b.UPDATE_CONVERSATION_LIST_EVENT,{conversationId:this.conversation.id,action:"delete"},this.siteId),this.messages=[]}finally{e&&e()}}catch(e){r.a.showErrorModalDefault(e,"Error deleting conversation.")}finally{this.deleteIcon="fas-trash"}}catch(e){}}))}unblockUser(){return Object(i.a)(this,void 0,void 0,(function*(){if(!this.otherMember)throw new z.a("No member selected to be unblocked.");const e=g.I.instant("addon.messages.unblockuserconfirm",{$a:this.otherMember.fullname}),s=g.I.instant("addon.messages.unblockuser");try{yield r.a.showConfirm(e,void 0,s),this.blockIcon=j.a.ICON_LOADING;const n=yield r.a.showModalLoading("core.sending",!0);this.showLoadingModal=!0;try{try{yield c.a.unblockContact(this.otherMember.id)}finally{n.dismiss(),this.showLoadingModal=!1}}catch(e){r.a.showErrorModalDefault(e,"core.error",!0)}finally{this.blockIcon=this.otherMember.isblocked?"fas-user-check":"fas-user-lock"}}catch(e){}}))}createContactRequest(){return Object(i.a)(this,void 0,void 0,(function*(){if(!this.otherMember)throw new z.a("No member selected to be requested.");const e=g.I.instant("addon.messages.addcontactconfirm",{$a:this.otherMember.fullname}),s=g.I.instant("core.add");try{yield r.a.showConfirm(e,void 0,s),this.addRemoveIcon=j.a.ICON_LOADING;const n=yield r.a.showModalLoading("core.sending",!0);this.showLoadingModal=!0;try{try{yield c.a.createContactRequest(this.otherMember.id)}finally{n.dismiss(),this.showLoadingModal=!1}}catch(e){r.a.showErrorModalDefault(e,"core.error",!0)}finally{this.addRemoveIcon="fas-user-plus"}}catch(e){}}))}confirmContactRequest(){return Object(i.a)(this,void 0,void 0,(function*(){if(!this.otherMember)throw new z.a("No member selected to be confirmed.");const e=yield r.a.showModalLoading("core.sending",!0);this.showLoadingModal=!0;try{try{yield c.a.confirmContactRequest(this.otherMember.id)}finally{e.dismiss(),this.showLoadingModal=!1}}catch(e){r.a.showErrorModalDefault(e,"core.error",!0)}}))}declineContactRequest(){return Object(i.a)(this,void 0,void 0,(function*(){if(!this.otherMember)throw new z.a("No member selected to be declined.");const e=yield r.a.showModalLoading("core.sending",!0);this.showLoadingModal=!0;try{try{yield c.a.declineContactRequest(this.otherMember.id)}finally{e.dismiss(),this.showLoadingModal=!1}}catch(e){r.a.showErrorModalDefault(e,"core.error",!0)}}))}removeContact(){return Object(i.a)(this,void 0,void 0,(function*(){if(!this.otherMember)throw new z.a("No member selected to be removed.");const e=g.I.instant("addon.messages.removecontactconfirm",{$a:this.otherMember.fullname}),s=g.I.instant("core.remove");try{yield r.a.showConfirm(e,void 0,s),this.addRemoveIcon=j.a.ICON_LOADING;const n=yield r.a.showModalLoading("core.sending",!0);this.showLoadingModal=!0;try{try{yield c.a.removeContact(this.otherMember.id)}finally{n.dismiss(),this.showLoadingModal=!1}}catch(e){r.a.showErrorModalDefault(e,"core.error",!0)}finally{this.addRemoveIcon="fas-user-plus"}}catch(e){}}))}ngOnDestroy(){var e,s;this.unsetPolling(),null===(e=this.syncObserver)||void 0===e||e.off(),null===(s=this.memberInfoObserver)||void 0===s||s.off(),this.viewDestroyed=!0}}return AddonMessagesDiscussionPage.ɵfac=function AddonMessagesDiscussionPage_Factory(e){return new(e||AddonMessagesDiscussionPage)(h.yc(f.a),h.yc(h.r))},AddonMessagesDiscussionPage.ɵcmp=h.sc({type:AddonMessagesDiscussionPage,selectors:[["page-addon-messages-discussion"]],viewQuery:function AddonMessagesDiscussionPage_Query(e,s){var n;(1&e&&(h.ud(p.v,!0),h.ud(w.a,!0)),2&e)&&(h.dd(n=h.Nc())&&(s.content=n.first),h.dd(n=h.Nc())&&(s.infinite=n.first))},decls:47,vars:87,consts:[["slot","start"],[3,"text"],["class","core-bar-button-image","alt","","onError","this.src='assets/img/group-avatar.svg'","core-external-content","","role","presentation",3,"src","siteId",4,"ngIf"],["class","core-bar-button-image",3,"user","linkProfile","checkOnline",4,"ngIf"],["contextLevel","system",3,"text","contextInstanceId"],["name","fas-star",4,"ngIf"],["name","fas-bell-slash",4,"ngIf"],["slot","end"],["iconAction","fas-circle-info",3,"hidden","priority","content","action"],[3,"hidden","priority","closeOnClick","content","iconAction","iconSlash","action"],[3,"hidden","priority","content","iconAction","action"],[3,"hidden","priority","closeOnClick","content","iconAction","action"],["iconAction","toggle",3,"hidden","priority","content","toggle","toggleChange"],[3,"hidden","priority","content","closeOnClick","iconAction","action"],[3,"hidden","priority","content","iconAction","iconSlash","action"],[3,"ionScroll"],[3,"hideUntil"],["position","top",3,"enabled","error","action"],[4,"ngIf"],[1,"sr-only"],[1,"addon-messages-discussion-container"],[4,"ngFor","ngForOf"],["icon","far-comments",3,"message",4,"ngIf"],["slot","fixed","core-fab","","vertical","bottom","horizontal","end",4,"ngIf"],["class","footer-adjustable",4,"ngIf"],["alt","","onError","this.src='assets/img/group-avatar.svg'","core-external-content","","role","presentation",1,"core-bar-button-image",3,"src","siteId"],[1,"core-bar-button-image",3,"user","linkProfile","checkOnline"],["name","fas-star"],["name","fas-bell-slash"],[1,"ion-text-center"],["class","ion-text-center addon-messages-date",4,"ngIf"],["class","addon-messages-unreadfrom","color","light",4,"ngIf"],[3,"message","user","text","showDelete","time","afterRender","onDeleteMessage"],[1,"ion-text-center","addon-messages-date"],["color","light",1,"addon-messages-unreadfrom"],["name","fas-arrow-down","aria-hidden","true"],["icon","far-comments",3,"message"],["slot","fixed","core-fab","","vertical","bottom","horizontal","end"],["size","small","color","light",3,"click"],[1,"core-discussion-messages-badge"],[1,"footer-adjustable"],[3,"color"],["class","ion-text-center ion-margin-horizontal",4,"ngIf"],["class","ion-padding-horizontal",4,"ngIf"],[3,"showKeyboard","placeholder","onSubmit",4,"ngIf"],[1,"ion-text-center","ion-margin-horizontal"],[1,"ion-padding-horizontal"],["expand","block",1,"ion-text-wrap","ion-margin-bottom",3,"click"],["expand","block","fill","outline",1,"ion-text-wrap","ion-margin-bottom",3,"click"],["class","ion-text-center",4,"ngIf"],[3,"showKeyboard","placeholder","onSubmit"]],template:function AddonMessagesDiscussionPage_Template(e,s){1&e&&(h.Ec(0,"ion-header"),h.Ec(1,"ion-toolbar"),h.Ec(2,"ion-buttons",0),h.zc(3,"ion-back-button",1),h.Pc(4,"translate"),h.Dc(),h.Ec(5,"ion-title"),h.Ec(6,"h1"),h.nd(7,AddonMessagesDiscussionPage_img_7_Template,1,2,"img",2),h.nd(8,AddonMessagesDiscussionPage_core_user_avatar_8_Template,1,3,"core-user-avatar",3),h.zc(9,"core-format-text",4),h.nd(10,AddonMessagesDiscussionPage_ion_icon_10_Template,2,3,"ion-icon",5),h.nd(11,AddonMessagesDiscussionPage_ion_icon_11_Template,2,3,"ion-icon",6),h.Dc(),h.Dc(),h.zc(12,"ion-buttons",7),h.Dc(),h.Ec(13,"core-navbar-buttons",7),h.Ec(14,"core-context-menu"),h.Pc(15,"translate"),h.Ec(16,"core-context-menu-item",8),h.Mc("action",(function AddonMessagesDiscussionPage_Template_core_context_menu_item_action_16_listener(){return s.viewInfo()})),h.Pc(17,"translate"),h.Dc(),h.Ec(18,"core-context-menu-item",8),h.Mc("action",(function AddonMessagesDiscussionPage_Template_core_context_menu_item_action_18_listener(){return s.viewInfo()})),h.Pc(19,"translate"),h.Dc(),h.Ec(20,"core-context-menu-item",9),h.Mc("action",(function AddonMessagesDiscussionPage_Template_core_context_menu_item_action_20_listener(e){return s.changeFavourite(e)})),h.Pc(21,"translate"),h.Dc(),h.Ec(22,"core-context-menu-item",10),h.Mc("action",(function AddonMessagesDiscussionPage_Template_core_context_menu_item_action_22_listener(){return s.blockUser()})),h.Pc(23,"translate"),h.Dc(),h.Ec(24,"core-context-menu-item",10),h.Mc("action",(function AddonMessagesDiscussionPage_Template_core_context_menu_item_action_24_listener(){return s.unblockUser()})),h.Pc(25,"translate"),h.Dc(),h.Ec(26,"core-context-menu-item",11),h.Mc("action",(function AddonMessagesDiscussionPage_Template_core_context_menu_item_action_26_listener(e){return s.changeMute(e)})),h.Pc(27,"translate"),h.Dc(),h.Ec(28,"core-context-menu-item",12),h.Mc("toggleChange",(function AddonMessagesDiscussionPage_Template_core_context_menu_item_toggleChange_28_listener(e){return s.showDelete=e})),h.Pc(29,"translate"),h.Dc(),h.Ec(30,"core-context-menu-item",13),h.Mc("action",(function AddonMessagesDiscussionPage_Template_core_context_menu_item_action_30_listener(e){return s.deleteConversation(e)})),h.Pc(31,"translate"),h.Dc(),h.Ec(32,"core-context-menu-item",10),h.Mc("action",(function AddonMessagesDiscussionPage_Template_core_context_menu_item_action_32_listener(){return s.createContactRequest()})),h.Pc(33,"translate"),h.Dc(),h.Ec(34,"core-context-menu-item",14),h.Mc("action",(function AddonMessagesDiscussionPage_Template_core_context_menu_item_action_34_listener(){return s.removeContact()})),h.Pc(35,"translate"),h.Dc(),h.Dc(),h.Dc(),h.Dc(),h.Ec(36,"ion-content",15),h.Mc("ionScroll",(function AddonMessagesDiscussionPage_Template_ion_content_ionScroll_36_listener(){return s.scrollFunction()})),h.Ec(37,"core-loading",16),h.Ec(38,"core-infinite-loading",17),h.Mc("action",(function AddonMessagesDiscussionPage_Template_core_infinite_loading_action_38_listener(e){return s.loadPrevious(e)})),h.Dc(),h.nd(39,AddonMessagesDiscussionPage_ng_container_39_Template,8,6,"ng-container",18),h.Ec(40,"h2",19),h.pd(41),h.Dc(),h.Ec(42,"ion-list",20),h.nd(43,AddonMessagesDiscussionPage_ng_container_43_Template,4,7,"ng-container",21),h.Dc(),h.nd(44,AddonMessagesDiscussionPage_core_empty_box_44_Template,2,3,"core-empty-box",22),h.Dc(),h.nd(45,AddonMessagesDiscussionPage_ion_fab_45_Template,9,7,"ion-fab",23),h.Dc(),h.nd(46,AddonMessagesDiscussionPage_ion_footer_46_Template,8,7,"ion-footer",24)),2&e&&(h.lc(3),h.Vc("text",h.Qc(4,63,"core.back")),h.lc(4),h.Vc("ngIf",s.loaded&&!s.otherMember&&s.conversationImage),h.lc(1),h.Vc("ngIf",s.loaded&&s.otherMember),h.lc(1),h.Vc("text",s.title)("contextInstanceId",0),h.lc(1),h.Vc("ngIf",s.conversation&&s.conversation.isfavourite),h.lc(1),h.Vc("ngIf",s.conversation&&s.conversation.ismuted),h.lc(3),h.mc("aria-label",h.Qc(15,65,"addon.messages.conversationactions")),h.lc(2),h.Vc("hidden",s.isSelf||!s.showInfo||s.isGroup)("priority",1e3)("content",h.Qc(17,67,"addon.messages.info")),h.lc(2),h.Vc("hidden",s.isSelf||!s.showInfo||!s.isGroup)("priority",1e3)("content",h.Qc(19,69,"addon.messages.groupinfo")),h.lc(2),h.Vc("hidden",!s.groupMessagingEnabled||!s.conversation)("priority",800)("closeOnClick",!1)("content",h.Qc(21,71,s.conversation&&s.conversation.isfavourite?"addon.messages.removefromfavourites":"addon.messages.addtofavourites"))("iconAction",s.favouriteIcon)("iconSlash",s.favouriteIconSlash),h.lc(2),h.Vc("hidden",s.isSelf||!s.otherMember||s.otherMember.isblocked)("priority",700)("content",h.Qc(23,73,"addon.messages.blockuser"))("iconAction",s.blockIcon),h.lc(2),h.Vc("hidden",s.isSelf||!s.otherMember||!s.otherMember.isblocked)("priority",700)("content",h.Qc(25,75,"addon.messages.unblockuser"))("iconAction",s.blockIcon),h.lc(2),h.Vc("hidden",s.isSelf||!s.muteEnabled||!s.conversation)("priority",600)("closeOnClick",!1)("content",h.Qc(27,77,s.conversation&&s.conversation.ismuted?"addon.messages.unmuteconversation":"addon.messages.muteconversation"))("iconAction",s.muteIcon),h.lc(2),h.Vc("hidden",!s.canDelete||!s.messages||!s.messages.length)("priority",400)("content",h.Qc(29,79,"addon.messages.showdeletemessages"))("toggle",s.showDelete),h.lc(2),h.Vc("hidden",!s.groupMessagingEnabled||!s.conversationId||s.isGroup||!s.messages||!s.messages.length)("priority",200)("content",h.Qc(31,81,"addon.messages.deleteconversation"))("closeOnClick",!1)("iconAction",s.deleteIcon),h.lc(2),h.Vc("hidden",s.isSelf||!s.otherMember||s.otherMember.iscontact||s.requestContactSent||s.requestContactReceived)("priority",100)("content",h.Qc(33,83,"addon.messages.addtoyourcontacts"))("iconAction",s.addRemoveIcon),h.lc(2),h.Vc("hidden",s.isSelf||!s.otherMember||!s.otherMember.iscontact)("priority",100)("content",h.Qc(35,85,"addon.messages.removefromyourcontacts"))("iconAction",s.addRemoveIcon)("iconSlash",!0),h.lc(3),h.Vc("hideUntil",s.loaded),h.lc(1),h.Vc("enabled",s.canLoadMore)("error",s.loadMoreError),h.lc(1),h.Vc("ngIf",s.isSelf&&!s.canLoadMore),h.lc(2),h.qd(s.title),h.lc(1),h.qc("addon-messages-discussion-group",s.isGroup),h.mc("aria-live","polite"),h.lc(1),h.Vc("ngForOf",s.messages),h.lc(1),h.Vc("ngIf",!s.messages||s.messages.length<=0),h.lc(1),h.Vc("ngIf",s.loaded&&s.newMessages>0),h.lc(1),h.Vc("ngIf",s.loaded&&(!s.conversationId||s.conversation)))},directives:[p.C,p.Ab,p.m,p.h,p.i,p.yb,b.t,k.a,$.a,M.a,H.a,v.a,p.v,C.a,w.a,p.P,b.s,Y.a,I.a,p.D,A.a,W.a,p.t,p.O,O.a,p.x,K.a,p.y,p.k,p.A,y.a,p.l,J.a],pipes:[D.d,X.a],styles:[".ios[_nghost-%COMP%]   ion-footer[_ngcontent-%COMP%]   .toolbar[_ngcontent-%COMP%]:last-child, .ios   [_nghost-%COMP%]   ion-footer[_ngcontent-%COMP%]   .toolbar[_ngcontent-%COMP%]:last-child{padding-bottom:4px;min-height:0}ion-content[_ngcontent-%COMP%]{--content-background:var(--background-alternative);--background:var(--content-background)}ion-content[_ngcontent-%COMP%]::part(scroll){padding-bottom:0!important}.addon-messages-discussion-container[_ngcontent-%COMP%]{display:flex;flex-direction:column;padding-bottom:16px!important;background:var(--content-background)}.addon-messages-date[_ngcontent-%COMP%]{font-weight:400;font-size:.9rem}[_nghost-%COMP%]   .addon-messages-unreadfrom[_ngcontent-%COMP%]{margin-top:6px;margin-left:auto;margin-right:auto}[_nghost-%COMP%]   .addon-messages-unreadfrom[_ngcontent-%COMP%], [_nghost-%COMP%]   .addon-messages-unreadfrom[_ngcontent-%COMP%]   ion-icon[_ngcontent-%COMP%]{color:var(--primary);background-color:initial}[_nghost-%COMP%]   .has-fab[_ngcontent-%COMP%]   .scroll-content[_ngcontent-%COMP%]{padding-bottom:0}[_nghost-%COMP%]   ion-fab[_ngcontent-%COMP%]   .core-discussion-messages-badge[_ngcontent-%COMP%]{position:absolute;color:var(--addon-messages-discussion-badge-text);background-color:var(--addon-messages-discussion-badge);display:block;right:0;top:0}[dir=rtl][_nghost-%COMP%]   ion-fab[_ngcontent-%COMP%]   .core-discussion-messages-badge[_ngcontent-%COMP%], [dir=rtl]   [_nghost-%COMP%]   ion-fab[_ngcontent-%COMP%]   .core-discussion-messages-badge[_ngcontent-%COMP%]{left:unset;right:unset;left:0}[_nghost-%COMP%]   ion-header[_ngcontent-%COMP%]   ion-toolbar[_ngcontent-%COMP%]   ion-title[_ngcontent-%COMP%]{padding:0}[_nghost-%COMP%]   ion-header[_ngcontent-%COMP%]   ion-toolbar[_ngcontent-%COMP%]   ion-title[_ngcontent-%COMP%]   h1[_ngcontent-%COMP%]{display:flex;align-items:center;padding:0}[_nghost-%COMP%]   ion-header[_ngcontent-%COMP%]   ion-toolbar[_ngcontent-%COMP%]   ion-title[_ngcontent-%COMP%]   h1[_ngcontent-%COMP%]   .core-bar-button-image[_ngcontent-%COMP%]{margin-right:6px}@supports ((-webkit-margin-start:0) or (margin-inline-start:0)) or (-webkit-margin-start:0){[_nghost-%COMP%]   ion-header[_ngcontent-%COMP%]   ion-toolbar[_ngcontent-%COMP%]   ion-title[_ngcontent-%COMP%]   h1[_ngcontent-%COMP%]   .core-bar-button-image[_ngcontent-%COMP%]{margin-right:unset;-webkit-margin-end:6px;margin-inline-end:6px}}[_nghost-%COMP%]   ion-header[_ngcontent-%COMP%]   ion-toolbar[_ngcontent-%COMP%]   ion-title[_ngcontent-%COMP%]   h1[_ngcontent-%COMP%]   core-format-text[_ngcontent-%COMP%]{overflow:hidden;text-overflow:ellipsis;white-space:nowrap;flex-shrink:1;display:block}[_nghost-%COMP%]   ion-header[_ngcontent-%COMP%]   ion-toolbar[_ngcontent-%COMP%]   ion-title[_ngcontent-%COMP%]   h1[_ngcontent-%COMP%]   ion-icon[_ngcontent-%COMP%]{margin-left:6px}@supports ((-webkit-margin-start:0) or (margin-inline-start:0)) or (-webkit-margin-start:0){[_nghost-%COMP%]   ion-header[_ngcontent-%COMP%]   ion-toolbar[_ngcontent-%COMP%]   ion-title[_ngcontent-%COMP%]   h1[_ngcontent-%COMP%]   ion-icon[_ngcontent-%COMP%]{margin-left:unset;-webkit-margin-start:6px;margin-inline-start:6px}}.ios[_nghost-%COMP%]   ion-header[_ngcontent-%COMP%]   ion-toolbar[_ngcontent-%COMP%]   h1[_ngcontent-%COMP%], .ios   [_nghost-%COMP%]   ion-header[_ngcontent-%COMP%]   ion-toolbar[_ngcontent-%COMP%]   h1[_ngcontent-%COMP%]{justify-content:center}"]}),AddonMessagesDiscussionPage})();var ee=n("2eZG"),se=n("YyYz"),ne=n("r2Z7"),te=n("C1x5"),oe=n("Cg42");function AddonMessagesDiscussions35Page_ng_container_28_ion_item_9_Template(e,s){if(1&e){const e=h.Fc();h.Ec(0,"ion-item",16),h.Mc("click",(function AddonMessagesDiscussions35Page_ng_container_28_ion_item_9_Template_ion_item_click_0_listener(){h.fd(e);const n=s.$implicit;return h.Oc(2).gotoDiscussion(n.userid,n.messageid)})),h.zc(1,"core-user-avatar",17),h.Ec(2,"ion-label"),h.Ec(3,"p",10),h.pd(4),h.Dc(),h.Ec(5,"p"),h.zc(6,"core-format-text",18),h.Dc(),h.Dc(),h.Dc()}if(2&e){const e=s.$implicit,n=h.Oc(2);h.mc("aria-label",e.fullname)("aria-current",e.userid==n.discussionUserId?"page":"false"),h.lc(1),h.Vc("user",e)("checkOnline",e.showonlinestatus),h.lc(3),h.qd(e.fullname),h.lc(2),h.Vc("text",e.lastmessage)("contextInstanceId",0)}}function AddonMessagesDiscussions35Page_ng_container_28_Template(e,s){if(1&e&&(h.Cc(0),h.Ec(1,"ion-item-divider"),h.Ec(2,"ion-label"),h.Ec(3,"h2"),h.pd(4),h.Pc(5,"translate"),h.Dc(),h.Dc(),h.Ec(6,"ion-note",14),h.Ec(7,"ion-badge"),h.pd(8),h.Dc(),h.Dc(),h.Dc(),h.nd(9,AddonMessagesDiscussions35Page_ng_container_28_ion_item_9_Template,7,7,"ion-item",15),h.Bc()),2&e){const e=h.Oc();h.lc(4),h.qd(h.Qc(5,3,"core.searchresults")),h.lc(4),h.qd(e.search.results.length),h.lc(1),h.Vc("ngForOf",e.search.results)}}function AddonMessagesDiscussions35Page_ng_container_29_ion_item_1_ion_note_6_span_1_Template(e,s){if(1&e&&(h.Ec(0,"span",24),h.pd(1),h.Pc(2,"coreDateDayOrTime"),h.Dc()),2&e){const e=h.Oc(2).$implicit;h.lc(1),h.rd(" ",h.Qc(2,1,e.message.timecreated/1e3)," ")}}function AddonMessagesDiscussions35Page_ng_container_29_ion_item_1_ion_note_6_ion_icon_2_Template(e,s){1&e&&h.zc(0,"ion-icon",25)}function AddonMessagesDiscussions35Page_ng_container_29_ion_item_1_ion_note_6_span_3_Template(e,s){1&e&&(h.Ec(0,"span",26),h.pd(1),h.Pc(2,"translate"),h.Dc()),2&e&&(h.lc(1),h.rd(" ",h.Qc(2,1,"addon.messages.unreadmessages")," "))}function AddonMessagesDiscussions35Page_ng_container_29_ion_item_1_ion_note_6_Template(e,s){if(1&e&&(h.Ec(0,"ion-note"),h.nd(1,AddonMessagesDiscussions35Page_ng_container_29_ion_item_1_ion_note_6_span_1_Template,3,3,"span",21),h.nd(2,AddonMessagesDiscussions35Page_ng_container_29_ion_item_1_ion_note_6_ion_icon_2_Template,1,0,"ion-icon",22),h.nd(3,AddonMessagesDiscussions35Page_ng_container_29_ion_item_1_ion_note_6_span_3_Template,3,3,"span",23),h.Dc()),2&e){const e=h.Oc().$implicit;h.lc(1),h.Vc("ngIf",e.message.timecreated>0),h.lc(1),h.Vc("ngIf",e.unread),h.lc(1),h.Vc("ngIf",e.unread)}}function AddonMessagesDiscussions35Page_ng_container_29_ion_item_1_Template(e,s){if(1&e){const e=h.Fc();h.Ec(0,"ion-item",16),h.Mc("click",(function AddonMessagesDiscussions35Page_ng_container_29_ion_item_1_Template_ion_item_click_0_listener(){h.fd(e);const n=s.$implicit;return h.Oc(2).gotoDiscussion(n.message.user)})),h.zc(1,"core-user-avatar",19),h.Ec(2,"ion-label"),h.Ec(3,"div",20),h.Ec(4,"p",10),h.pd(5),h.Dc(),h.nd(6,AddonMessagesDiscussions35Page_ng_container_29_ion_item_1_ion_note_6_Template,4,3,"ion-note",11),h.Dc(),h.Ec(7,"p"),h.zc(8,"core-format-text",18),h.Dc(),h.Dc(),h.Dc()}if(2&e){const e=s.$implicit,n=h.Oc(2);h.mc("aria-label",e.fullname)("aria-current",e.message.user==n.discussionUserId?"page":"false"),h.lc(1),h.Vc("user",e),h.lc(4),h.qd(e.fullname),h.lc(1),h.Vc("ngIf",e.message.timecreated>0||e.unread),h.lc(2),h.Vc("text",e.message.message)("contextInstanceId",0)}}function AddonMessagesDiscussions35Page_ng_container_29_Template(e,s){if(1&e&&(h.Cc(0),h.nd(1,AddonMessagesDiscussions35Page_ng_container_29_ion_item_1_Template,9,7,"ion-item",15),h.Bc()),2&e){const e=h.Oc();h.lc(1),h.Vc("ngForOf",e.discussions)}}function AddonMessagesDiscussions35Page_core_empty_box_30_Template(e,s){1&e&&(h.zc(0,"core-empty-box",27),h.Pc(1,"translate")),2&e&&h.Vc("message",h.Qc(1,1,"addon.messages.nomessagesfound"))}function AddonMessagesDiscussions35Page_core_empty_box_31_Template(e,s){1&e&&(h.zc(0,"core-empty-box",28),h.Pc(1,"translate")),2&e&&h.Vc("message",h.Qc(1,1,"core.noresults"))}let ie=(()=>{class AddonMessagesDiscussions35Page{constructor(e){this.route=e,this.loaded=!1,this.loadingMessage="",this.discussions=[],this.search={showResults:!1,results:[],loading:"",text:""},this.search.loading=g.I.instant("core.searching"),this.loadingMessages=g.I.instant("core.loading"),this.siteId=a.b.getCurrentSiteId(),this.newMessagesObserver=l.b.on(c.b.NEW_MESSAGE_EVENT,(e=>{if(e.userId&&this.discussions){const s=this.discussions.find((s=>{var n;return(null===(n=s.message)||void 0===n?void 0:n.user)===e.userId}));void 0===s?(this.loaded=!1,this.refreshData().finally((()=>{this.loaded=!0}))):s.message&&(s.message.message=e.message,s.message.timecreated=e.timecreated)}}),this.siteId),this.readChangedObserver=l.b.on(c.b.READ_CHANGED_EVENT,(e=>{if(e.userId&&this.discussions){const s=this.discussions.find((s=>{var n;return(null===(n=s.message)||void 0===n?void 0:n.user)===e.userId}));void 0!==s&&(s.unread=!1,c.a.invalidateConversations(this.siteId),c.a.refreshUnreadConversationCounts(this.siteId))}}),this.siteId),this.appResumeSubscription=ne.a.resume.subscribe((()=>{this.loaded&&(this.loaded=!1,this.refreshData())})),this.pushObserver=ee.a.on("receive").subscribe((e=>{R.a.isFalseOrZero(e.notif)&&e.site==this.siteId&&this.refreshData(void 0,!1)}))}ngOnInit(){return Object(i.a)(this,void 0,void 0,(function*(){this.route.queryParams.subscribe((e=>Object(i.a)(this,void 0,void 0,(function*(){var s;this.discussionUserId=null!==(s=u.a.getRouteNumberParam("userId",{params:e}))&&void 0!==s?s:this.discussionUserId}))));const e=new se.a;yield this.fetchData(),!this.discussionUserId&&this.discussions.length>0&&_.a.isTablet&&this.discussions[0].message&&(yield this.gotoDiscussion(this.discussions[0].message.user)),e.treatLink()}))}refreshData(e,s=!0){return Object(i.a)(this,void 0,void 0,(function*(){const n=[];n.push(c.a.invalidateDiscussionsCache(this.siteId)),s&&n.push(c.a.invalidateUnreadConversationCounts(this.siteId)),yield R.a.allPromises(n).finally((()=>this.fetchData().finally((()=>{e&&(null==e?void 0:e.complete())}))))}))}fetchData(){return Object(i.a)(this,void 0,void 0,(function*(){this.loadingMessage=this.loadingMessages;const e=[];e.push(c.a.getDiscussions(this.siteId).then((e=>{const s=[];for(const n in e)e[n].unread=!!e[n].unread,s.push(e[n]);this.discussions=s.sort(((e,s)=>{var n,t;return((null===(n=s.message)||void 0===n?void 0:n.timecreated)||0)-((null===(t=e.message)||void 0===t?void 0:t.timecreated)||0)}))}))),e.push(c.a.getUnreadConversationCounts(this.siteId));try{yield Promise.all(e)}catch(e){r.a.showErrorModalDefault(e,"addon.messages.errorwhileretrievingdiscussions",!0)}this.loaded=!0}))}clearSearch(){this.loaded=!1,this.search.showResults=!1,this.search.text="",this.fetchData().finally((()=>{this.loaded=!0}))}searchMessage(e){return Object(i.a)(this,void 0,void 0,(function*(){d.a.closeKeyboard(),this.loaded=!1,this.loadingMessage=this.search.loading;try{const s=yield c.a.searchMessages(e,void 0,void 0,void 0,this.siteId);this.search.showResults=!0,this.search.results=s.messages}catch(e){r.a.showErrorModalDefault(e,"addon.messages.errorwhileretrievingmessages",!0)}this.loaded=!0}))}gotoDiscussion(e,s){return Object(i.a)(this,void 0,void 0,(function*(){this.discussionUserId=e;const n={};s&&(n.message=s);const t=u.a.getRelativePathToParent("/messages/index")+`discussion/user/${e}`;yield u.a.navigate(t,{params:n,reset:_.a.isTablet&&!!this.splitView&&!this.splitView.isNested})}))}gotoContacts(){const e={};_.a.isTablet&&this.discussionUserId&&(e.discussionUserId=this.discussionUserId),u.a.navigateToSitePath("contacts-35",{params:e})}ngOnDestroy(){var e,s,n,t;null===(e=this.newMessagesObserver)||void 0===e?void 0:e.off(),null===(s=this.readChangedObserver)||void 0===s||s.off(),null===(n=this.appResumeSubscription)||void 0===n||n.unsubscribe(),null===(t=this.pushObserver)||void 0===t||t.unsubscribe()}}return AddonMessagesDiscussions35Page.ɵfac=function AddonMessagesDiscussions35Page_Factory(e){return new(e||AddonMessagesDiscussions35Page)(h.yc(f.a))},AddonMessagesDiscussions35Page.ɵcmp=h.sc({type:AddonMessagesDiscussions35Page,selectors:[["addon-messages-discussions"]],viewQuery:function AddonMessagesDiscussions35Page_Query(e,s){var n;(1&e&&h.ud(m.a,!0),2&e)&&(h.dd(n=h.Nc())&&(s.splitView=n.first))},decls:32,vars:27,consts:[["slot","start"],[3,"text"],["slot","end"],["slot","fixed",3,"disabled","ionRefresh"],[3,"pullingText"],["autocorrect","off","spellcheck","false","lengthCheck","2","searchArea","AddonMessagesDiscussions",3,"placeholder","disabled","autoFocus","onSubmit","onClear"],[3,"hideUntil","message"],[1,"ion-no-margin"],["detail","true","button","",1,"ion-text-wrap","addon-message-discussion",3,"click"],["name","fas-address-book","slot","start","aria-hidden","true"],[1,"item-heading"],[4,"ngIf"],["icon","far-comments",3,"message",4,"ngIf"],["icon","fas-magnifying-glass",3,"message",4,"ngIf"],["slot","end",1,"ion-padding-end"],["class","ion-text-wrap addon-message-discussion","button","","detail","false",3,"click",4,"ngFor","ngForOf"],["button","","detail","false",1,"ion-text-wrap","addon-message-discussion",3,"click"],["slot","start",3,"user","checkOnline"],["clean","true","singleLine","true","contextLevel","system",3,"text","contextInstanceId"],["slot","start","checkOnline","false",3,"user"],[1,"flex-row","ion-justify-content-between"],["class","addon-message-last-message-date",4,"ngIf"],["name","fas-circle","color","primary","aria-hidden","true",4,"ngIf"],["class","sr-only",4,"ngIf"],[1,"addon-message-last-message-date"],["name","fas-circle","color","primary","aria-hidden","true"],[1,"sr-only"],["icon","far-comments",3,"message"],["icon","fas-magnifying-glass",3,"message"]],template:function AddonMessagesDiscussions35Page_Template(e,s){1&e&&(h.Ec(0,"ion-header"),h.Ec(1,"ion-toolbar"),h.Ec(2,"ion-buttons",0),h.zc(3,"ion-back-button",1),h.Pc(4,"translate"),h.Dc(),h.Ec(5,"ion-title"),h.Ec(6,"h1"),h.pd(7),h.Pc(8,"translate"),h.Dc(),h.Dc(),h.Ec(9,"ion-buttons",2),h.zc(10,"core-context-menu"),h.zc(11,"core-user-menu-button"),h.Dc(),h.Dc(),h.Dc(),h.Ec(12,"ion-content"),h.Ec(13,"core-split-view"),h.Ec(14,"ion-refresher",3),h.Mc("ionRefresh",(function AddonMessagesDiscussions35Page_Template_ion_refresher_ionRefresh_14_listener(e){return s.refreshData(e.target)})),h.zc(15,"ion-refresher-content",4),h.Pc(16,"translate"),h.Dc(),h.Ec(17,"core-search-box",5),h.Mc("onSubmit",(function AddonMessagesDiscussions35Page_Template_core_search_box_onSubmit_17_listener(e){return s.searchMessage(e)}))("onClear",(function AddonMessagesDiscussions35Page_Template_core_search_box_onClear_17_listener(){return s.clearSearch()})),h.Pc(18,"translate"),h.Dc(),h.Ec(19,"core-loading",6),h.Ec(20,"ion-list",7),h.Ec(21,"ion-item",8),h.Mc("click",(function AddonMessagesDiscussions35Page_Template_ion_item_click_21_listener(){return s.gotoContacts()})),h.Pc(22,"translate"),h.zc(23,"ion-icon",9),h.Ec(24,"ion-label"),h.Ec(25,"p",10),h.pd(26),h.Pc(27,"translate"),h.Dc(),h.Dc(),h.Dc(),h.nd(28,AddonMessagesDiscussions35Page_ng_container_28_Template,10,5,"ng-container",11),h.nd(29,AddonMessagesDiscussions35Page_ng_container_29_Template,2,1,"ng-container",11),h.Dc(),h.nd(30,AddonMessagesDiscussions35Page_core_empty_box_30_Template,2,3,"core-empty-box",12),h.nd(31,AddonMessagesDiscussions35Page_core_empty_box_31_Template,2,3,"core-empty-box",13),h.Dc(),h.Dc(),h.Dc()),2&e&&(h.lc(3),h.Vc("text",h.Qc(4,15,"core.back")),h.lc(4),h.qd(h.Qc(8,17,"addon.messages.messages")),h.lc(7),h.Vc("disabled",!s.loaded),h.lc(1),h.Wc("pullingText",h.Qc(16,19,"core.pulltorefresh")),h.lc(2),h.Vc("placeholder",h.Qc(18,21,"addon.messages.message"))("disabled",!s.loaded)("autoFocus",!1),h.lc(2),h.Vc("hideUntil",s.loaded)("message",s.loadingMessage),h.lc(2),h.mc("aria-label",h.Qc(22,23,"addon.messages.contacts")),h.lc(5),h.qd(h.Qc(27,25,"addon.messages.contacts")),h.lc(2),h.Vc("ngIf",s.search.showResults),h.lc(1),h.Vc("ngIf",!s.search.showResults),h.lc(1),h.Vc("ngIf",(!s.discussions||s.discussions.length<=0)&&!s.search.showResults),h.lc(1),h.Vc("ngIf",(!s.search.results||s.search.results.length<=0)&&s.search.showResults))},directives:[p.C,p.Ab,p.m,p.h,p.i,p.yb,M.a,te.a,v.a,p.v,m.a,p.bb,p.cb,P.a,C.a,p.P,p.I,p.D,A.a,p.O,b.t,p.J,p.W,p.k,b.s,I.a,k.a,O.a],pipes:[D.d,oe.a],styles:["[_nghost-%COMP%]   .addon-message-discussion[_ngcontent-%COMP%]   ion-label[_ngcontent-%COMP%], [_nghost-%COMP%]   .addon-messages-conversation-item[_ngcontent-%COMP%]   ion-label[_ngcontent-%COMP%]{margin-right:0;margin-left:0}[_nghost-%COMP%]   .addon-message-discussion[_ngcontent-%COMP%]   .item-heading[_ngcontent-%COMP%]   core-format-text[_ngcontent-%COMP%], [_nghost-%COMP%]   .addon-messages-conversation-item[_ngcontent-%COMP%]   .item-heading[_ngcontent-%COMP%]   core-format-text[_ngcontent-%COMP%]{font-weight:700}[_nghost-%COMP%]   .addon-message-discussion[_ngcontent-%COMP%]   .item-heading[_ngcontent-%COMP%]   ion-icon[_ngcontent-%COMP%], [_nghost-%COMP%]   .addon-messages-conversation-item[_ngcontent-%COMP%]   .item-heading[_ngcontent-%COMP%]   ion-icon[_ngcontent-%COMP%]{margin-left:2px}@supports ((-webkit-margin-start:0) or (margin-inline-start:0)) or (-webkit-margin-start:0){[_nghost-%COMP%]   .addon-message-discussion[_ngcontent-%COMP%]   .item-heading[_ngcontent-%COMP%]   ion-icon[_ngcontent-%COMP%], [_nghost-%COMP%]   .addon-messages-conversation-item[_ngcontent-%COMP%]   .item-heading[_ngcontent-%COMP%]   ion-icon[_ngcontent-%COMP%]{margin-left:unset;-webkit-margin-start:2px;margin-inline-start:2px}}[_nghost-%COMP%]   .addon-message-discussion[_ngcontent-%COMP%]   ion-note[_ngcontent-%COMP%], [_nghost-%COMP%]   .addon-messages-conversation-item[_ngcontent-%COMP%]   ion-note[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-self:flex-start;margin-left:2px}@supports ((-webkit-margin-start:0) or (margin-inline-start:0)) or (-webkit-margin-start:0){[_nghost-%COMP%]   .addon-message-discussion[_ngcontent-%COMP%]   ion-note[_ngcontent-%COMP%], [_nghost-%COMP%]   .addon-messages-conversation-item[_ngcontent-%COMP%]   ion-note[_ngcontent-%COMP%]{margin-left:unset;-webkit-margin-start:2px;margin-inline-start:2px}}[_nghost-%COMP%]   .addon-message-discussion[_ngcontent-%COMP%]   ion-note[_ngcontent-%COMP%]   ion-badge[_ngcontent-%COMP%], [_nghost-%COMP%]   .addon-message-discussion[_ngcontent-%COMP%]   ion-note[_ngcontent-%COMP%]   ion-icon[_ngcontent-%COMP%], [_nghost-%COMP%]   .addon-messages-conversation-item[_ngcontent-%COMP%]   ion-note[_ngcontent-%COMP%]   ion-badge[_ngcontent-%COMP%], [_nghost-%COMP%]   .addon-messages-conversation-item[_ngcontent-%COMP%]   ion-note[_ngcontent-%COMP%]   ion-icon[_ngcontent-%COMP%]{margin-top:3px;align-self:flex-end}[_nghost-%COMP%]   .addon-message-discussion[_ngcontent-%COMP%]   ion-note[_ngcontent-%COMP%]   .addon-message-last-message-date[_ngcontent-%COMP%], [_nghost-%COMP%]   .addon-messages-conversation-item[_ngcontent-%COMP%]   ion-note[_ngcontent-%COMP%]   .addon-message-last-message-date[_ngcontent-%COMP%]{white-space:nowrap;font-size:11px}[_nghost-%COMP%]   .addon-message-discussion[_ngcontent-%COMP%]   .addon-message-last-message[_ngcontent-%COMP%], [_nghost-%COMP%]   .addon-messages-conversation-item[_ngcontent-%COMP%]   .addon-message-last-message[_ngcontent-%COMP%]{display:flex;justify-content:flex-start}[_nghost-%COMP%]   .addon-message-discussion[_ngcontent-%COMP%]   .addon-message-last-message-user[_ngcontent-%COMP%], [_nghost-%COMP%]   .addon-messages-conversation-item[_ngcontent-%COMP%]   .addon-message-last-message-user[_ngcontent-%COMP%]{white-space:nowrap;color:var(--ion-text-color);margin-right:2px}@supports ((-webkit-margin-start:0) or (margin-inline-start:0)) or (-webkit-margin-start:0){[_nghost-%COMP%]   .addon-message-discussion[_ngcontent-%COMP%]   .addon-message-last-message-user[_ngcontent-%COMP%], [_nghost-%COMP%]   .addon-messages-conversation-item[_ngcontent-%COMP%]   .addon-message-last-message-user[_ngcontent-%COMP%]{margin-right:unset;-webkit-margin-end:2px;margin-inline-end:2px}}[_nghost-%COMP%]   .addon-message-discussion[_ngcontent-%COMP%]   .addon-message-last-message-text[_ngcontent-%COMP%], [_nghost-%COMP%]   .addon-messages-conversation-item[_ngcontent-%COMP%]   .addon-message-last-message-text[_ngcontent-%COMP%]{overflow:hidden;text-overflow:ellipsis;white-space:nowrap;flex-shrink:1}[_nghost-%COMP%]   .addon-message-discussion[_ngcontent-%COMP%]   .item-heading[_ngcontent-%COMP%]{margin-top:10px}[_nghost-%COMP%]   ion-item-divider[_ngcontent-%COMP%]   ion-badge[_ngcontent-%COMP%]{margin-left:16px;margin-right:16px}"]}),AddonMessagesDiscussions35Page})();const ae=["favlist"],ce=["grouplist"],re=["indlist"];function AddonMessagesGroupConversationsPage_ion_badge_31_Template(e,s){if(1&e&&(h.Ec(0,"ion-badge",29),h.pd(1),h.Dc()),2&e){const e=h.Oc();h.lc(1),h.qd(e.contactRequestsCount)}}const _c3=function(e){return{$a:e}};function AddonMessagesGroupConversationsPage_span_32_Template(e,s){if(1&e&&(h.Ec(0,"span",30),h.pd(1),h.Pc(2,"translate"),h.Dc()),2&e){const e=h.Oc();h.lc(1),h.rd(" ",h.Rc(2,1,"addon.messages.pendingcontactrequests",h.ad(4,_c3,e.contactRequestsCount))," ")}}function AddonMessagesGroupConversationsPage_ion_badge_40_Template(e,s){if(1&e&&(h.Ec(0,"ion-badge",29),h.pd(1),h.Dc()),2&e){const e=h.Oc();h.lc(1),h.qd(e.favourites.unread)}}function AddonMessagesGroupConversationsPage_span_41_Template(e,s){if(1&e&&(h.Ec(0,"span",30),h.pd(1),h.Pc(2,"translate"),h.Dc()),2&e){const e=h.Oc();h.lc(1),h.rd(" ",h.Rc(2,1,"addon.messages.unreadconversations",h.ad(4,_c3,e.favourites.unread))," ")}}function AddonMessagesGroupConversationsPage_ng_container_44_Template(e,s){1&e&&h.Ac(0)}function AddonMessagesGroupConversationsPage_ion_item_46_Template(e,s){1&e&&(h.Ec(0,"ion-item",31),h.Ec(1,"ion-label"),h.Ec(2,"p"),h.pd(3),h.Pc(4,"translate"),h.Dc(),h.Dc(),h.Dc()),2&e&&(h.lc(3),h.qd(h.Qc(4,1,"addon.messages.nofavourites")))}function AddonMessagesGroupConversationsPage_ion_item_47_Template(e,s){1&e&&(h.Ec(0,"ion-item",32),h.Ec(1,"ion-label"),h.zc(2,"ion-spinner"),h.Pc(3,"translate"),h.Dc(),h.Dc()),2&e&&(h.lc(2),h.mc("aria-label",h.Qc(3,1,"core.loading")))}function AddonMessagesGroupConversationsPage_ion_badge_55_Template(e,s){if(1&e&&(h.Ec(0,"ion-badge",29),h.pd(1),h.Dc()),2&e){const e=h.Oc();h.lc(1),h.qd(e.group.unread)}}function AddonMessagesGroupConversationsPage_span_56_Template(e,s){if(1&e&&(h.Ec(0,"span",30),h.pd(1),h.Pc(2,"translate"),h.Dc()),2&e){const e=h.Oc();h.lc(1),h.rd(" ",h.Rc(2,1,"addon.messages.unreadconversations",h.ad(4,_c3,e.group.unread))," ")}}function AddonMessagesGroupConversationsPage_ng_container_59_Template(e,s){1&e&&h.Ac(0)}function AddonMessagesGroupConversationsPage_ion_item_61_Template(e,s){1&e&&(h.Ec(0,"ion-item",31),h.Ec(1,"ion-label"),h.Ec(2,"p"),h.pd(3),h.Pc(4,"translate"),h.Dc(),h.Dc(),h.Dc()),2&e&&(h.lc(3),h.qd(h.Qc(4,1,"addon.messages.nogroupconversations")))}function AddonMessagesGroupConversationsPage_ion_item_62_Template(e,s){1&e&&(h.Ec(0,"ion-item",32),h.Ec(1,"ion-label"),h.zc(2,"ion-spinner"),h.Pc(3,"translate"),h.Dc(),h.Dc()),2&e&&(h.lc(2),h.mc("aria-label",h.Qc(3,1,"core.loading")))}function AddonMessagesGroupConversationsPage_ion_badge_70_Template(e,s){if(1&e&&(h.Ec(0,"ion-badge",29),h.pd(1),h.Dc()),2&e){const e=h.Oc();h.lc(1),h.qd(e.individual.unread)}}function AddonMessagesGroupConversationsPage_span_71_Template(e,s){if(1&e&&(h.Ec(0,"span",30),h.pd(1),h.Pc(2,"translate"),h.Dc()),2&e){const e=h.Oc();h.lc(1),h.rd(" ",h.Rc(2,1,"addon.messages.unreadconversations",h.ad(4,_c3,e.individual.unread))," ")}}function AddonMessagesGroupConversationsPage_ng_container_74_Template(e,s){1&e&&h.Ac(0)}function AddonMessagesGroupConversationsPage_ion_item_76_Template(e,s){1&e&&(h.Ec(0,"ion-item",31),h.Ec(1,"ion-label"),h.Ec(2,"p"),h.pd(3),h.Pc(4,"translate"),h.Dc(),h.Dc(),h.Dc()),2&e&&(h.lc(3),h.qd(h.Qc(4,1,"addon.messages.noindividualconversations")))}function AddonMessagesGroupConversationsPage_ion_item_77_Template(e,s){1&e&&(h.Ec(0,"ion-item",32),h.Ec(1,"ion-label"),h.zc(2,"ion-spinner"),h.Pc(3,"translate"),h.Dc(),h.Dc()),2&e&&(h.lc(2),h.mc("aria-label",h.Qc(3,1,"core.loading")))}function AddonMessagesGroupConversationsPage_ng_template_78_ion_item_0_ion_avatar_1_Template(e,s){if(1&e&&(h.Ec(0,"ion-avatar",0),h.zc(1,"img",46),h.Dc()),2&e){const e=h.Oc().$implicit;h.lc(1),h.Vc("src",e.imageurl,h.id)("alt",e.name)}}function AddonMessagesGroupConversationsPage_ng_template_78_ion_item_0_core_user_avatar_2_Template(e,s){if(1&e&&h.zc(0,"core-user-avatar",47),2&e){const e=h.Oc().$implicit;h.Vc("user",e.otherUser)("linkProfile",!1)("checkOnline",e.showonlinestatus)}}function AddonMessagesGroupConversationsPage_ng_template_78_ion_item_0_ion_icon_7_Template(e,s){1&e&&(h.zc(0,"ion-icon",48),h.Pc(1,"translate")),2&e&&h.Vc("title",h.Qc(1,1,"addon.messages.contactblocked"))}function AddonMessagesGroupConversationsPage_ng_template_78_ion_item_0_ion_icon_8_Template(e,s){1&e&&(h.zc(0,"ion-icon",49),h.Pc(1,"translate")),2&e&&h.Vc("title",h.Qc(1,1,"addon.messages.mutedconversation"))}function AddonMessagesGroupConversationsPage_ng_template_78_ion_item_0_ion_note_9_span_1_Template(e,s){if(1&e&&(h.Ec(0,"span",52),h.pd(1),h.Pc(2,"coreDateDayOrTime"),h.Dc()),2&e){const e=h.Oc(2).$implicit;h.lc(1),h.rd(" ",h.Qc(2,1,e.lastmessagedate)," ")}}function AddonMessagesGroupConversationsPage_ng_template_78_ion_item_0_ion_note_9_ion_badge_2_Template(e,s){if(1&e&&(h.Ec(0,"ion-badge",53),h.pd(1),h.Dc()),2&e){const e=h.Oc(2).$implicit;h.lc(1),h.qd(e.unreadcount)}}function AddonMessagesGroupConversationsPage_ng_template_78_ion_item_0_ion_note_9_span_3_Template(e,s){if(1&e&&(h.Ec(0,"span",30),h.pd(1),h.Pc(2,"translate"),h.Dc()),2&e){const e=h.Oc(2).$implicit;h.lc(1),h.rd(" ",h.Rc(2,1,"addon.messages.unreadmessages",h.ad(4,_c3,e.unreadcount))," ")}}function AddonMessagesGroupConversationsPage_ng_template_78_ion_item_0_ion_note_9_Template(e,s){if(1&e&&(h.Ec(0,"ion-note"),h.nd(1,AddonMessagesGroupConversationsPage_ng_template_78_ion_item_0_ion_note_9_span_1_Template,3,3,"span",50),h.nd(2,AddonMessagesGroupConversationsPage_ng_template_78_ion_item_0_ion_note_9_ion_badge_2_Template,2,1,"ion-badge",51),h.nd(3,AddonMessagesGroupConversationsPage_ng_template_78_ion_item_0_ion_note_9_span_3_Template,3,6,"span",13),h.Dc()),2&e){const e=h.Oc().$implicit;h.lc(1),h.Vc("ngIf",e.lastmessagedate>0),h.lc(1),h.Vc("ngIf",e.unreadcount>0),h.lc(1),h.Vc("ngIf",e.unreadcount>0)}}function AddonMessagesGroupConversationsPage_ng_template_78_ion_item_0_p_10_Template(e,s){if(1&e&&(h.Ec(0,"p"),h.zc(1,"core-format-text",39),h.Dc()),2&e){const e=h.Oc().$implicit;h.lc(1),h.Vc("text",e.subname)("contextInstanceId",0)}}function AddonMessagesGroupConversationsPage_ng_template_78_ion_item_0_span_12_Template(e,s){1&e&&(h.Ec(0,"span",54),h.pd(1),h.Pc(2,"translate"),h.Dc()),2&e&&(h.lc(1),h.rd(" ",h.Qc(2,1,"addon.messages.you")," "))}function AddonMessagesGroupConversationsPage_ng_template_78_ion_item_0_span_13_Template(e,s){if(1&e&&(h.Ec(0,"span",54),h.pd(1),h.Dc()),2&e){const e=h.Oc().$implicit;h.lc(1),h.qd(e.members[0].fullname+":")}}function AddonMessagesGroupConversationsPage_ng_template_78_ion_item_0_Template(e,s){if(1&e){const e=h.Fc();h.Ec(0,"ion-item",34),h.Mc("click",(function AddonMessagesGroupConversationsPage_ng_template_78_ion_item_0_Template_ion_item_click_0_listener(){h.fd(e);const n=s.$implicit;return h.Oc(2).gotoConversation(n.id,n.userid)})),h.nd(1,AddonMessagesGroupConversationsPage_ng_template_78_ion_item_0_ion_avatar_1_Template,2,2,"ion-avatar",35),h.nd(2,AddonMessagesGroupConversationsPage_ng_template_78_ion_item_0_core_user_avatar_2_Template,1,3,"core-user-avatar",36),h.Ec(3,"ion-label"),h.Ec(4,"div",37),h.Ec(5,"p",38),h.zc(6,"core-format-text",39),h.nd(7,AddonMessagesGroupConversationsPage_ng_template_78_ion_item_0_ion_icon_7_Template,2,3,"ion-icon",40),h.nd(8,AddonMessagesGroupConversationsPage_ng_template_78_ion_item_0_ion_icon_8_Template,2,3,"ion-icon",41),h.Dc(),h.nd(9,AddonMessagesGroupConversationsPage_ng_template_78_ion_item_0_ion_note_9_Template,4,3,"ion-note",42),h.Dc(),h.nd(10,AddonMessagesGroupConversationsPage_ng_template_78_ion_item_0_p_10_Template,2,2,"p",42),h.Ec(11,"p",43),h.nd(12,AddonMessagesGroupConversationsPage_ng_template_78_ion_item_0_span_12_Template,3,3,"span",44),h.nd(13,AddonMessagesGroupConversationsPage_ng_template_78_ion_item_0_span_13_Template,2,1,"span",44),h.zc(14,"core-format-text",45),h.Dc(),h.Dc(),h.Dc()}if(2&e){const e=s.$implicit,n=h.Oc(2);h.Xc("id","addon-message-conversation-",e.id?e.id:"user-"+e.userid,""),h.mc("aria-current",e.id&&e.id==n.selectedConversationId||e.userid&&e.userid==n.selectedUserId?"page":"false")("aria-label",e.name),h.lc(1),h.Vc("ngIf",e.type==n.typeGroup),h.lc(1),h.Vc("ngIf",e.type!=n.typeGroup),h.lc(4),h.Vc("text",e.name)("contextInstanceId",0),h.lc(1),h.Vc("ngIf",e.isblocked),h.lc(1),h.Vc("ngIf",e.ismuted),h.lc(1),h.Vc("ngIf",e.lastmessagedate>0||e.unreadcount),h.lc(1),h.Vc("ngIf",e.subname),h.lc(2),h.Vc("ngIf",e.sentfromcurrentuser),h.lc(1),h.Vc("ngIf",!e.sentfromcurrentuser&&e.type==n.typeGroup&&e.members[0]),h.lc(1),h.Vc("text",e.lastmessage)("contextInstanceId",0)}}function AddonMessagesGroupConversationsPage_ng_template_78_Template(e,s){if(1&e&&h.nd(0,AddonMessagesGroupConversationsPage_ng_template_78_ion_item_0_Template,15,15,"ion-item",33),2&e){h.Vc("ngForOf",s.conversations)}}const _c4=function(e){return{conversations:e}};let de=(()=>{class AddonMessagesGroupConversationsPage{constructor(e){this.route=e,this.loaded=!1,this.contactRequestsCount=0,this.favourites={type:void 0,favourites:!0,count:0,unread:0,conversations:[]},this.group={type:c.b.MESSAGE_CONVERSATION_TYPE_GROUP,favourites:!1,count:0,unread:0,conversations:[]},this.individual={type:c.b.MESSAGE_CONVERSATION_TYPE_INDIVIDUAL,favourites:!1,count:0,unread:0,conversations:[]},this.typeGroup=c.b.MESSAGE_CONVERSATION_TYPE_GROUP,this.loadingMessage=g.I.instant("core.loading"),this.siteId=a.b.getCurrentSiteId(),this.currentUserId=a.b.getCurrentSiteUserId(),this.newMessagesObserver=l.b.on(c.b.NEW_MESSAGE_EVENT,(e=>{var s;const n=this.getExpandedOption();if(n!=this.getConversationOption(e))return;const t=this.findConversation(e.conversationId,e.userId,n);if(void 0===t)return this.loaded=!1,this.refreshData().finally((()=>{this.loaded=!0})),void 0;if(t.lastmessage!=e.message||t.lastmessagedate!=e.timecreated/1e3){const n=e.timecreated/1e3>(t.lastmessagedate||0);t.lastmessage=e.message,t.lastmessagedate=e.timecreated/1e3;const o=this.getConversationOption(t);o.conversations=c.a.sortConversations(o.conversations||[]),n&&(null===(s=this.content)||void 0===s||s.scrollToTop())}}),this.siteId),this.readChangedObserver=l.b.on(c.b.READ_CHANGED_EVENT,(e=>{if(e.conversationId){const s=this.findConversation(e.conversationId);void 0!==s&&(s.unreadcount=0,c.a.invalidateConversations(this.siteId),c.a.refreshUnreadConversationCounts(this.siteId))}}),this.siteId),this.openConversationObserver=l.b.on(c.b.OPEN_CONVERSATION_EVENT,(e=>{(e.conversationId||e.userId)&&this.gotoConversation(e.conversationId,e.userId)}),this.siteId),this.appResumeSubscription=ne.a.resume.subscribe((()=>{this.loaded&&(this.loaded=!1,this.refreshData().finally((()=>{this.loaded=!0})))})),this.updateConversationListObserver=l.b.on(c.b.UPDATE_CONVERSATION_LIST_EVENT,(e=>{if(e&&"mute"==e.action){const s=this.getExpandedOption();if(s&&s.conversations){const n=this.findConversation(e.conversationId,void 0,s);n&&(n.ismuted=!!e.value)}}else this.refreshData()}),this.siteId),this.pushObserver=ee.a.on("receive").subscribe((e=>{R.a.isFalseOrZero(e.notif)&&e.site==this.siteId&&this.refreshData(void 0,!1)})),this.cronObserver=l.b.on(c.b.UNREAD_CONVERSATION_COUNTS_EVENT,(e=>{this.favourites.unread=e.favourites,this.individual.unread=e.individual+e.self,this.group.unread=e.group}),this.siteId),this.contactRequestsCountObserver=l.b.on(c.b.CONTACT_REQUESTS_COUNT_EVENT,(e=>{this.contactRequestsCount=e.count}),this.siteId),this.memberInfoObserver=l.b.on(c.b.MEMBER_INFO_CHANGED_EVENT,(e=>{if(!e.userBlocked&&!e.userUnblocked)return;const s=this.getExpandedOption();if(s==this.individual||s==this.favourites){if(!s.conversations||s.conversations.length<=0)return;const n=this.findConversation(void 0,e.userId,s);n&&(n.isblocked=e.userBlocked)}}),this.siteId)}ngOnInit(){return Object(i.a)(this,void 0,void 0,(function*(){this.route.queryParams.subscribe((e=>Object(i.a)(this,void 0,void 0,(function*(){const s=u.a.getRouteNumberParam("conversationId",{params:e}),n=u.a.getRouteNumberParam("userId",{params:e});(s||n)&&(this.selectedConversationId=s,this.selectedUserId=n)}))));const e=new se.a;if(yield this.fetchData(),!this.selectedConversationId&&!this.selectedUserId&&_.a.isTablet){let e;const s=this.getExpandedOption();s&&s.conversations.length&&(e=s.conversations[0],e&&(yield this.gotoConversation(e.id)))}e.treatLink()}))}fetchData(e=!0){return Object(i.a)(this,void 0,void 0,(function*(){const s=[];s.push(this.fetchConversationCounts()),s.push(c.a.getContactRequestsCount(this.siteId)),e&&s.push(c.a.refreshUnreadConversationCounts(this.siteId));try{if(yield Promise.all(s),void 0===this.favourites.expanded&&(this.selectedConversationId||this.selectedUserId)){const e=[];e.push(this.fetchDataForOption(this.favourites,!1)),e.push(this.fetchDataForOption(this.group,!1)),e.push(this.fetchDataForOption(this.individual,!1)),yield Promise.all(e);const s=this.findConversation(this.selectedConversationId,this.selectedUserId);if(s){const e=this.getConversationOption(s);return yield this.expandOption(e),this.loaded=!0,void 0}}yield this.fetchDataForExpandedOption()}catch(e){r.a.showErrorModalDefault(e,"addon.messages.errorwhileretrievingdiscussions",!0)}this.loaded=!0}))}fetchDataForExpandedOption(){return Object(i.a)(this,void 0,void 0,(function*(){void 0===this.favourites.expanded&&(this.favourites.expanded=0!=this.favourites.count&&!this.group.unread&&!this.individual.unread,this.group.expanded=!this.favourites.expanded&&0!=this.group.count&&!this.individual.unread,this.individual.expanded=!this.favourites.expanded&&!this.group.expanded),this.loadCurrentListElement();const e=this.getExpandedOption();e&&(yield this.fetchDataForOption(e,!1))}))}fetchDataForOption(e,s=!1,n=!1){return Object(i.a)(this,void 0,void 0,(function*(){e.loadMoreError=!1;const t=s?e.conversations.length:0,o=[];let a={conversations:[],canLoadMore:!1},r=[];o.push(c.a.invalidateConversations(this.siteId).then((()=>Object(i.a)(this,void 0,void 0,(function*(){a=yield c.a.getConversations(e.type,e.favourites,t,this.siteId)}))))),s||o.push(V.a.getAllMessages().then((e=>{r=e}))),n&&(o.push(this.fetchConversationCounts()),o.push(c.a.refreshUnreadConversationCounts(this.siteId))),yield Promise.all(o),s?(e.conversations=e.conversations.concat(a.conversations),e.canLoadMore=a.canLoadMore):(e.conversations=a.conversations,e.canLoadMore=a.canLoadMore,r&&r.length&&(yield this.loadOfflineMessages(e,r),e.conversations=c.a.sortConversations(e.conversations)))}))}fetchConversationCounts(){return Object(i.a)(this,void 0,void 0,(function*(){yield c.a.invalidateConversationCounts(this.siteId);const e=yield c.a.getConversationCounts(this.siteId);this.favourites.count=e.favourites,this.individual.count=e.individual+e.self,this.group.count=e.group}))}findConversation(e,s,n){if(e){return(n?n.conversations:this.favourites.conversations.concat(this.group.conversations).concat(this.individual.conversations)).find((s=>s.id==e))}return(n?n.conversations:this.favourites.conversations.concat(this.individual.conversations)).find((e=>e.userid==s))}getExpandedOption(){return this.favourites.expanded?this.favourites:this.group.expanded?this.group:this.individual.expanded?this.individual:void 0}gotoContacts(){u.a.navigateToSitePath("contacts")}gotoConversation(e,s,n){return Object(i.a)(this,void 0,void 0,(function*(){this.selectedConversationId=e,this.selectedUserId=s;const t={};n&&(t.message=n);const o=u.a.getRelativePathToParent("/messages/group-conversations")+"discussion/"+(e||`user/${s}`);yield u.a.navigate(o,{params:t,reset:_.a.isTablet&&!!this.splitView&&!this.splitView.isNested})}))}gotoSettings(){u.a.navigateToSitePath("message-settings")}loadMoreConversations(e,s){return Object(i.a)(this,void 0,void 0,(function*(){try{yield this.fetchDataForOption(e,!0)}catch(s){r.a.showErrorModalDefault(s,"addon.messages.errorwhileretrievingdiscussions",!0),e.loadMoreError=!0}s&&s()}))}loadOfflineMessages(e,s){return Object(i.a)(this,void 0,void 0,(function*(){const n=[];s.forEach((s=>{var t,o,i,a,r,d,l,g,_,u;if("conversationid"in s){let n=this.findConversation(s.conversationid,void 0,e);n?(null==n.lastmessage||!n.lastmessagepending||(n.lastmessagedate||0)<=s.timecreated/1e3)&&this.addLastOfflineMessage(n,s):(n={id:s.conversationid,type:(null===(t=s.conversation)||void 0===t?void 0:t.type)||c.b.MESSAGE_CONVERSATION_TYPE_INDIVIDUAL,membercount:(null===(o=s.conversation)||void 0===o?void 0:o.membercount)||0,ismuted:(null===(i=s.conversation)||void 0===i?void 0:i.ismuted)||!1,isfavourite:(null===(a=s.conversation)||void 0===a?void 0:a.isfavourite)||!1,isread:(null===(r=s.conversation)||void 0===r?void 0:r.isread)||!1,members:(null===(d=s.conversation)||void 0===d?void 0:d.members)||[],messages:(null===(l=s.conversation)||void 0===l?void 0:l.messages)||[],candeletemessagesforallusers:(null===(g=s.conversation)||void 0===g?void 0:g.candeletemessagesforallusers)||!1,userid:0,name:null===(_=s.conversation)||void 0===_?void 0:_.name,imageurl:(null===(u=s.conversation)||void 0===u?void 0:u.imageurl)||""},this.getConversationOption(n)==e&&(this.addLastOfflineMessage(n,s),this.addOfflineConversation(n)))}else if(e.type==c.b.MESSAGE_CONVERSATION_TYPE_INDIVIDUAL){const t=this.findConversation(void 0,s.touserid,e);s.text=s.smallmessage,t?(t.lastmessagedate||0)<=s.timecreated/1e3&&this.addLastOfflineMessage(t,s):n.push(q.a.getProfile(s.touserid,void 0,!0).catch((()=>{})).then((e=>{const n={id:0,type:c.b.MESSAGE_CONVERSATION_TYPE_INDIVIDUAL,membercount:0,ismuted:!1,isfavourite:!1,isread:!1,members:[],messages:[],candeletemessagesforallusers:!1,userid:s.touserid,name:e?e.fullname:String(s.touserid),imageurl:e?e.profileimageurl:""};this.addLastOfflineMessage(n,s),this.addOfflineConversation(n)})))}})),yield Promise.all(n)}))}addOfflineConversation(e){this.getConversationOption(e).conversations.unshift(e)}addLastOfflineMessage(e,s){e.lastmessage=s.text,e.lastmessagedate=s.timecreated/1e3,e.lastmessagepending=!0,e.sentfromcurrentuser=!0}getConversationOption(e){return e.isfavourite?this.favourites:e.type==c.b.MESSAGE_CONVERSATION_TYPE_GROUP?this.group:this.individual}refreshData(e,s=!0){return Object(i.a)(this,void 0,void 0,(function*(){try{yield c.a.invalidateContactRequestsCountCache(this.siteId)}finally{try{yield this.fetchData(s)}finally{e&&(null==e?void 0:e.complete())}}}))}toggle(e){e.expanded?(e.expanded=!1,this.loadCurrentListElement()):this.expandOption(e,!0).catch((e=>{r.a.showErrorModalDefault(e,"addon.messages.errorwhileretrievingdiscussions",!0)}))}expandOption(e,s=!1){return Object(i.a)(this,void 0,void 0,(function*(){this.favourites.expanded=!1,this.group.expanded=!1,this.individual.expanded=!1,e.expanded=!0,e.loading=!0;try{yield this.fetchDataForOption(e,!1,s),this.loadCurrentListElement()}catch(s){throw e.expanded=!1,s}finally{e.loading=!1}}))}loadCurrentListElement(){this.currentListEl=this.favourites.expanded?this.favListEl&&this.favListEl.nativeElement:this.group.expanded?this.groupListEl&&this.groupListEl.nativeElement:this.individual.expanded?this.indListEl&&this.indListEl.nativeElement:void 0}gotoSearch(){u.a.navigateToSitePath("search")}ngOnDestroy(){var e,s,n,t,o,i,a,c,r;null===(e=this.newMessagesObserver)||void 0===e?void 0:e.off(),null===(s=this.appResumeSubscription)||void 0===s||s.unsubscribe(),null===(n=this.pushObserver)||void 0===n||n.unsubscribe(),null===(t=this.readChangedObserver)||void 0===t||t.off(),null===(o=this.cronObserver)||void 0===o||o.off(),null===(i=this.openConversationObserver)||void 0===i||i.off(),null===(a=this.updateConversationListObserver)||void 0===a||a.off(),null===(c=this.contactRequestsCountObserver)||void 0===c||c.off(),null===(r=this.memberInfoObserver)||void 0===r||r.off()}}return AddonMessagesGroupConversationsPage.ɵfac=function AddonMessagesGroupConversationsPage_Factory(e){return new(e||AddonMessagesGroupConversationsPage)(h.yc(f.a))},AddonMessagesGroupConversationsPage.ɵcmp=h.sc({type:AddonMessagesGroupConversationsPage,selectors:[["page-addon-messages-group-conversations"]],viewQuery:function AddonMessagesGroupConversationsPage_Query(e,s){var n;(1&e&&(h.ud(m.a,!0),h.ud(p.v,!0),h.ud(ae,!0),h.ud(ce,!0),h.ud(re,!0)),2&e)&&(h.dd(n=h.Nc())&&(s.splitView=n.first),h.dd(n=h.Nc())&&(s.content=n.first),h.dd(n=h.Nc())&&(s.favListEl=n.first),h.dd(n=h.Nc())&&(s.groupListEl=n.first),h.dd(n=h.Nc())&&(s.indListEl=n.first))},decls:80,vars:86,consts:[["slot","start"],[3,"text"],["slot","end"],["fill","clear",3,"click"],["name","fas-magnifying-glass","slot","icon-only","aria-hidden","true"],[3,"click"],["name","fas-gear","slot","icon-only","aria-hidden","true"],["slot","fixed",3,"disabled","ionRefresh"],[3,"pullingText"],[3,"hideUntil","message"],["detail","true","button","",1,"ion-text-wrap","addon-message-discussion",3,"click"],["name","fas-address-book","slot","start","aria-hidden","true"],["slot","end","aria-hidden","true",4,"ngIf"],["class","sr-only",4,"ngIf"],["button","","sticky","true","aria-controls","addon-messages-groupconversations-favourite","role","heading","detail","false",1,"ion-text-wrap","divider",3,"click"],["name","fas-chevron-right","flip-rtl","","slot","start","aria-hidden","true",1,"expandable-status-icon"],["id","addon-messages-groupconversations-favourite",3,"hidden"],["favlist",""],[4,"ngTemplateOutlet","ngTemplateOutletContext"],[3,"enabled","error","action"],["class","ion-text-wrap",4,"ngIf"],["class","ion-text-center",4,"ngIf"],["button","","sticky","true","aria-controls","addon-messages-groupconversations-group","role","heading","detail","false",1,"divider","ion-text-wrap",3,"click"],["id","addon-messages-groupconversations-group",3,"hidden"],["grouplist",""],["button","","sticky","true","aria-controls","addon-messages-groupconversations-individual","role","heading","detail","false",1,"divider","ion-text-wrap",3,"click"],["id","addon-messages-groupconversations-individual",3,"hidden"],["indlist",""],["conversationsTemplate",""],["slot","end","aria-hidden","true"],[1,"sr-only"],[1,"ion-text-wrap"],[1,"ion-text-center"],["class","ion-text-wrap addon-message-discussion","button","","detail","false",3,"id","click",4,"ngFor","ngForOf"],["button","","detail","false",1,"ion-text-wrap","addon-message-discussion",3,"id","click"],["slot","start",4,"ngIf"],["core-user-avatar","","slot","start",3,"user","linkProfile","checkOnline",4,"ngIf"],[1,"flex-row","ion-justify-content-between"],[1,"item-heading"],["contextLevel","system",3,"text","contextInstanceId"],["name","fas-user-slash",3,"title",4,"ngIf"],["name","fas-volume-xmark",3,"title",4,"ngIf"],[4,"ngIf"],[1,"addon-message-last-message"],["class","addon-message-last-message-user",4,"ngIf"],["clean","true","singleLine","true","contextLevel","system",1,"addon-message-last-message-text",3,"text","contextInstanceId"],["core-external-content","","onError","this.src='assets/img/group-avatar.svg'",3,"src","alt"],["core-user-avatar","","slot","start",3,"user","linkProfile","checkOnline"],["name","fas-user-slash",3,"title"],["name","fas-volume-xmark",3,"title"],["class","addon-message-last-message-date",4,"ngIf"],["aria-label","true",4,"ngIf"],[1,"addon-message-last-message-date"],["aria-label","true"],[1,"addon-message-last-message-user"]],template:function AddonMessagesGroupConversationsPage_Template(e,s){if(1&e&&(h.Ec(0,"ion-header"),h.Ec(1,"ion-toolbar"),h.Ec(2,"ion-buttons",0),h.zc(3,"ion-back-button",1),h.Pc(4,"translate"),h.Dc(),h.Ec(5,"ion-title"),h.Ec(6,"h1"),h.pd(7),h.Pc(8,"translate"),h.Dc(),h.Dc(),h.Ec(9,"ion-buttons",2),h.Ec(10,"ion-button",3),h.Mc("click",(function AddonMessagesGroupConversationsPage_Template_ion_button_click_10_listener(){return s.gotoSearch()})),h.Pc(11,"translate"),h.zc(12,"ion-icon",4),h.Dc(),h.Ec(13,"ion-button",5),h.Mc("click",(function AddonMessagesGroupConversationsPage_Template_ion_button_click_13_listener(){return s.gotoSettings()})),h.Pc(14,"translate"),h.zc(15,"ion-icon",6),h.Dc(),h.zc(16,"core-context-menu"),h.zc(17,"core-user-menu-button"),h.Dc(),h.Dc(),h.Dc(),h.Ec(18,"ion-content"),h.Ec(19,"core-split-view"),h.Ec(20,"ion-refresher",7),h.Mc("ionRefresh",(function AddonMessagesGroupConversationsPage_Template_ion_refresher_ionRefresh_20_listener(e){return s.refreshData(e.target)})),h.zc(21,"ion-refresher-content",8),h.Pc(22,"translate"),h.Dc(),h.Ec(23,"core-loading",9),h.Ec(24,"ion-list"),h.Ec(25,"ion-item",10),h.Mc("click",(function AddonMessagesGroupConversationsPage_Template_ion_item_click_25_listener(){return s.gotoContacts()})),h.zc(26,"ion-icon",11),h.Ec(27,"ion-label"),h.Ec(28,"h2"),h.pd(29),h.Pc(30,"translate"),h.Dc(),h.Dc(),h.nd(31,AddonMessagesGroupConversationsPage_ion_badge_31_Template,2,1,"ion-badge",12),h.nd(32,AddonMessagesGroupConversationsPage_span_32_Template,3,6,"span",13),h.Dc(),h.Ec(33,"ion-item",14),h.Mc("click",(function AddonMessagesGroupConversationsPage_Template_ion_item_click_33_listener(){return s.toggle(s.favourites)})),h.Pc(34,"translate"),h.zc(35,"ion-icon",15),h.Ec(36,"ion-label"),h.Ec(37,"h2"),h.pd(38),h.Pc(39,"translate"),h.Dc(),h.Dc(),h.nd(40,AddonMessagesGroupConversationsPage_ion_badge_40_Template,2,1,"ion-badge",12),h.nd(41,AddonMessagesGroupConversationsPage_span_41_Template,3,6,"span",13),h.Dc(),h.Ec(42,"div",16,17),h.nd(44,AddonMessagesGroupConversationsPage_ng_container_44_Template,1,0,"ng-container",18),h.Ec(45,"core-infinite-loading",19),h.Mc("action",(function AddonMessagesGroupConversationsPage_Template_core_infinite_loading_action_45_listener(e){return s.loadMoreConversations(s.favourites,e)})),h.Dc(),h.nd(46,AddonMessagesGroupConversationsPage_ion_item_46_Template,5,3,"ion-item",20),h.Dc(),h.nd(47,AddonMessagesGroupConversationsPage_ion_item_47_Template,4,3,"ion-item",21),h.Ec(48,"ion-item",22),h.Mc("click",(function AddonMessagesGroupConversationsPage_Template_ion_item_click_48_listener(){return s.toggle(s.group)})),h.Pc(49,"translate"),h.zc(50,"ion-icon",15),h.Ec(51,"ion-label"),h.Ec(52,"h2"),h.pd(53),h.Pc(54,"translate"),h.Dc(),h.Dc(),h.nd(55,AddonMessagesGroupConversationsPage_ion_badge_55_Template,2,1,"ion-badge",12),h.nd(56,AddonMessagesGroupConversationsPage_span_56_Template,3,6,"span",13),h.Dc(),h.Ec(57,"div",23,24),h.nd(59,AddonMessagesGroupConversationsPage_ng_container_59_Template,1,0,"ng-container",18),h.Ec(60,"core-infinite-loading",19),h.Mc("action",(function AddonMessagesGroupConversationsPage_Template_core_infinite_loading_action_60_listener(e){return s.loadMoreConversations(s.group,e)})),h.Dc(),h.nd(61,AddonMessagesGroupConversationsPage_ion_item_61_Template,5,3,"ion-item",20),h.Dc(),h.nd(62,AddonMessagesGroupConversationsPage_ion_item_62_Template,4,3,"ion-item",21),h.Ec(63,"ion-item",25),h.Mc("click",(function AddonMessagesGroupConversationsPage_Template_ion_item_click_63_listener(){return s.toggle(s.individual)})),h.Pc(64,"translate"),h.zc(65,"ion-icon",15),h.Ec(66,"ion-label"),h.Ec(67,"h2"),h.pd(68),h.Pc(69,"translate"),h.Dc(),h.Dc(),h.nd(70,AddonMessagesGroupConversationsPage_ion_badge_70_Template,2,1,"ion-badge",12),h.nd(71,AddonMessagesGroupConversationsPage_span_71_Template,3,6,"span",13),h.Dc(),h.Ec(72,"div",26,27),h.nd(74,AddonMessagesGroupConversationsPage_ng_container_74_Template,1,0,"ng-container",18),h.Ec(75,"core-infinite-loading",19),h.Mc("action",(function AddonMessagesGroupConversationsPage_Template_core_infinite_loading_action_75_listener(e){return s.loadMoreConversations(s.individual,e)})),h.Dc(),h.nd(76,AddonMessagesGroupConversationsPage_ion_item_76_Template,5,3,"ion-item",20),h.Dc(),h.nd(77,AddonMessagesGroupConversationsPage_ion_item_77_Template,4,3,"ion-item",21),h.Dc(),h.Dc(),h.Dc(),h.Dc(),h.nd(78,AddonMessagesGroupConversationsPage_ng_template_78_Template,1,1,"ng-template",null,28,h.od)),2&e){const e=h.ed(79);h.lc(3),h.Vc("text",h.Qc(4,56,"core.back")),h.lc(4),h.qd(h.Qc(8,58,"addon.messages.messages")),h.lc(3),h.mc("aria-label",h.Qc(11,60,"addon.messages.searchcombined")),h.lc(3),h.mc("aria-label",h.Qc(14,62,"addon.messages.messagepreferences")),h.lc(7),h.Vc("disabled",!s.loaded||!s.currentListEl),h.lc(1),h.Wc("pullingText",h.Qc(22,64,"core.pulltorefresh")),h.lc(2),h.Vc("hideUntil",s.loaded)("message",s.loadingMessage),h.lc(6),h.qd(h.Qc(30,66,"addon.messages.contacts")),h.lc(2),h.Vc("ngIf",s.contactRequestsCount>0),h.lc(1),h.Vc("ngIf",s.contactRequestsCount>0),h.lc(1),h.mc("aria-label",h.Qc(34,68,s.favourites.expanded?"core.collapse":"core.expand"))("aria-expanded",s.favourites.expanded),h.lc(2),h.qc("expandable-status-icon-expanded",s.favourites.expanded),h.lc(3),h.sd("",h.Qc(39,70,"core.favourites")," (",s.favourites.count,")"),h.lc(2),h.Vc("ngIf",s.favourites.unread),h.lc(1),h.Vc("ngIf",s.favourites.unread),h.lc(1),h.Vc("hidden",!s.favourites.conversations||!s.favourites.expanded||s.favourites.loading),h.lc(2),h.Vc("ngTemplateOutlet",e)("ngTemplateOutletContext",h.ad(80,_c4,s.favourites.conversations)),h.lc(1),h.Vc("enabled",s.favourites.canLoadMore)("error",s.favourites.loadMoreError),h.lc(1),h.Vc("ngIf",s.favourites.conversations&&0==s.favourites.conversations.length),h.lc(1),h.Vc("ngIf",s.favourites.loading),h.lc(1),h.mc("aria-label",h.Qc(49,72,s.group.expanded?"core.collapse":"core.expand"))("aria-expanded",s.group.expanded),h.lc(2),h.qc("expandable-status-icon-expanded",s.group.expanded),h.lc(3),h.sd("",h.Qc(54,74,"addon.messages.groupconversations")," (",s.group.count,")"),h.lc(2),h.Vc("ngIf",s.group.unread),h.lc(1),h.Vc("ngIf",s.group.unread),h.lc(1),h.Vc("hidden",!s.group.conversations||!s.group.expanded||s.group.loading),h.lc(2),h.Vc("ngTemplateOutlet",e)("ngTemplateOutletContext",h.ad(82,_c4,s.group.conversations)),h.lc(1),h.Vc("enabled",s.group.canLoadMore)("error",s.group.loadMoreError),h.lc(1),h.Vc("ngIf",s.group.conversations&&0==s.group.conversations.length),h.lc(1),h.Vc("ngIf",s.group.loading),h.lc(1),h.mc("aria-label",h.Qc(64,76,s.individual.expanded?"core.collapse":"core.expand"))("aria-expanded",s.individual.expanded),h.lc(2),h.qc("expandable-status-icon-expanded",s.individual.expanded),h.lc(3),h.sd("",h.Qc(69,78,"addon.messages.individualconversations")," (",s.individual.count,")"),h.lc(2),h.Vc("ngIf",s.individual.unread),h.lc(1),h.Vc("ngIf",s.individual.unread),h.lc(1),h.Vc("hidden",!s.individual.conversations||!s.individual.expanded||s.individual.loading),h.lc(2),h.Vc("ngTemplateOutlet",e)("ngTemplateOutletContext",h.ad(84,_c4,s.individual.conversations)),h.lc(1),h.Vc("enabled",s.individual.canLoadMore)("error",s.individual.loadMoreError),h.lc(1),h.Vc("ngIf",s.individual.conversations&&0==s.individual.conversations.length),h.lc(1),h.Vc("ngIf",s.individual.loading)}},directives:[p.C,p.Ab,p.m,p.h,p.i,p.yb,y.a,p.l,p.D,A.a,M.a,te.a,v.a,p.v,m.a,p.bb,p.cb,C.a,p.P,p.I,p.O,b.t,b.A,w.a,p.k,p.qb,b.s,k.a,p.g,Y.a,I.a,p.W],pipes:[D.d,oe.a],styles:["[_nghost-%COMP%]   .addon-message-discussion[_ngcontent-%COMP%]   ion-label[_ngcontent-%COMP%], [_nghost-%COMP%]   .addon-messages-conversation-item[_ngcontent-%COMP%]   ion-label[_ngcontent-%COMP%]{margin-right:0;margin-left:0}[_nghost-%COMP%]   .addon-message-discussion[_ngcontent-%COMP%]   .item-heading[_ngcontent-%COMP%]   core-format-text[_ngcontent-%COMP%], [_nghost-%COMP%]   .addon-messages-conversation-item[_ngcontent-%COMP%]   .item-heading[_ngcontent-%COMP%]   core-format-text[_ngcontent-%COMP%]{font-weight:700}[_nghost-%COMP%]   .addon-message-discussion[_ngcontent-%COMP%]   .item-heading[_ngcontent-%COMP%]   ion-icon[_ngcontent-%COMP%], [_nghost-%COMP%]   .addon-messages-conversation-item[_ngcontent-%COMP%]   .item-heading[_ngcontent-%COMP%]   ion-icon[_ngcontent-%COMP%]{margin-left:2px}@supports ((-webkit-margin-start:0) or (margin-inline-start:0)) or (-webkit-margin-start:0){[_nghost-%COMP%]   .addon-message-discussion[_ngcontent-%COMP%]   .item-heading[_ngcontent-%COMP%]   ion-icon[_ngcontent-%COMP%], [_nghost-%COMP%]   .addon-messages-conversation-item[_ngcontent-%COMP%]   .item-heading[_ngcontent-%COMP%]   ion-icon[_ngcontent-%COMP%]{margin-left:unset;-webkit-margin-start:2px;margin-inline-start:2px}}[_nghost-%COMP%]   .addon-message-discussion[_ngcontent-%COMP%]   ion-note[_ngcontent-%COMP%], [_nghost-%COMP%]   .addon-messages-conversation-item[_ngcontent-%COMP%]   ion-note[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-self:flex-start;margin-left:2px}@supports ((-webkit-margin-start:0) or (margin-inline-start:0)) or (-webkit-margin-start:0){[_nghost-%COMP%]   .addon-message-discussion[_ngcontent-%COMP%]   ion-note[_ngcontent-%COMP%], [_nghost-%COMP%]   .addon-messages-conversation-item[_ngcontent-%COMP%]   ion-note[_ngcontent-%COMP%]{margin-left:unset;-webkit-margin-start:2px;margin-inline-start:2px}}[_nghost-%COMP%]   .addon-message-discussion[_ngcontent-%COMP%]   ion-note[_ngcontent-%COMP%]   ion-badge[_ngcontent-%COMP%], [_nghost-%COMP%]   .addon-message-discussion[_ngcontent-%COMP%]   ion-note[_ngcontent-%COMP%]   ion-icon[_ngcontent-%COMP%], [_nghost-%COMP%]   .addon-messages-conversation-item[_ngcontent-%COMP%]   ion-note[_ngcontent-%COMP%]   ion-badge[_ngcontent-%COMP%], [_nghost-%COMP%]   .addon-messages-conversation-item[_ngcontent-%COMP%]   ion-note[_ngcontent-%COMP%]   ion-icon[_ngcontent-%COMP%]{margin-top:3px;align-self:flex-end}[_nghost-%COMP%]   .addon-message-discussion[_ngcontent-%COMP%]   ion-note[_ngcontent-%COMP%]   .addon-message-last-message-date[_ngcontent-%COMP%], [_nghost-%COMP%]   .addon-messages-conversation-item[_ngcontent-%COMP%]   ion-note[_ngcontent-%COMP%]   .addon-message-last-message-date[_ngcontent-%COMP%]{white-space:nowrap;font-size:11px}[_nghost-%COMP%]   .addon-message-discussion[_ngcontent-%COMP%]   .addon-message-last-message[_ngcontent-%COMP%], [_nghost-%COMP%]   .addon-messages-conversation-item[_ngcontent-%COMP%]   .addon-message-last-message[_ngcontent-%COMP%]{display:flex;justify-content:flex-start}[_nghost-%COMP%]   .addon-message-discussion[_ngcontent-%COMP%]   .addon-message-last-message-user[_ngcontent-%COMP%], [_nghost-%COMP%]   .addon-messages-conversation-item[_ngcontent-%COMP%]   .addon-message-last-message-user[_ngcontent-%COMP%]{white-space:nowrap;color:var(--ion-text-color);margin-right:2px}@supports ((-webkit-margin-start:0) or (margin-inline-start:0)) or (-webkit-margin-start:0){[_nghost-%COMP%]   .addon-message-discussion[_ngcontent-%COMP%]   .addon-message-last-message-user[_ngcontent-%COMP%], [_nghost-%COMP%]   .addon-messages-conversation-item[_ngcontent-%COMP%]   .addon-message-last-message-user[_ngcontent-%COMP%]{margin-right:unset;-webkit-margin-end:2px;margin-inline-end:2px}}[_nghost-%COMP%]   .addon-message-discussion[_ngcontent-%COMP%]   .addon-message-last-message-text[_ngcontent-%COMP%], [_nghost-%COMP%]   .addon-messages-conversation-item[_ngcontent-%COMP%]   .addon-message-last-message-text[_ngcontent-%COMP%]{overflow:hidden;text-overflow:ellipsis;white-space:nowrap;flex-shrink:1}[_nghost-%COMP%]   .addon-message-discussion[_ngcontent-%COMP%]   .item-heading[_ngcontent-%COMP%]{margin-top:10px}[_nghost-%COMP%]   ion-item-divider[_ngcontent-%COMP%]   ion-badge[_ngcontent-%COMP%]{margin-left:16px;margin-right:16px}"]}),AddonMessagesGroupConversationsPage})();function AddonMessagesSearchPage_ion_list_16_ng_container_1_Template(e,s){1&e&&h.Ac(0)}function AddonMessagesSearchPage_ion_list_16_ng_container_2_Template(e,s){1&e&&h.Ac(0)}function AddonMessagesSearchPage_ion_list_16_ng_container_3_Template(e,s){1&e&&h.Ac(0)}const search_c0=function(e){return{item:e}};function AddonMessagesSearchPage_ion_list_16_Template(e,s){if(1&e){const e=h.Fc();h.Ec(0,"ion-list"),h.nd(1,AddonMessagesSearchPage_ion_list_16_ng_container_1_Template,1,0,"ng-container",8),h.nd(2,AddonMessagesSearchPage_ion_list_16_ng_container_2_Template,1,0,"ng-container",8),h.nd(3,AddonMessagesSearchPage_ion_list_16_ng_container_3_Template,1,0,"ng-container",8),h.Ec(4,"core-infinite-loading",9),h.Mc("action",(function AddonMessagesSearchPage_ion_list_16_Template_core_infinite_loading_action_4_listener(s){h.fd(e);const n=h.Oc();return n.search(n.query,"messages",s)})),h.Dc(),h.Dc()}if(2&e){const e=h.Oc(),s=h.ed(19);h.lc(1),h.Vc("ngTemplateOutlet",s)("ngTemplateOutletContext",h.ad(8,search_c0,e.contacts)),h.lc(1),h.Vc("ngTemplateOutlet",s)("ngTemplateOutletContext",h.ad(10,search_c0,e.nonContacts)),h.lc(1),h.Vc("ngTemplateOutlet",s)("ngTemplateOutletContext",h.ad(12,search_c0,e.messages)),h.lc(1),h.Vc("enabled",e.messages.canLoadMore)("error",e.messages.loadMoreError)}}function AddonMessagesSearchPage_core_empty_box_17_Template(e,s){1&e&&(h.zc(0,"core-empty-box",10),h.Pc(1,"translate")),2&e&&h.Vc("message",h.Qc(1,1,"core.noresults"))}function AddonMessagesSearchPage_ng_template_18_ng_container_0_ion_item_6_ion_icon_5_Template(e,s){1&e&&(h.zc(0,"ion-icon",21),h.Pc(1,"translate")),2&e&&h.mc("aria-label",h.Qc(1,1,"addon.messages.contactblocked"))}function AddonMessagesSearchPage_ng_template_18_ng_container_0_ion_item_6_ion_note_6_Template(e,s){if(1&e&&(h.Ec(0,"ion-note"),h.pd(1),h.Pc(2,"coreDateDayOrTime"),h.Dc()),2&e){const e=h.Oc().$implicit;h.lc(1),h.rd(" ",h.Qc(2,1,e.lastmessagedate)," ")}}function AddonMessagesSearchPage_ng_template_18_ng_container_0_ion_item_6_span_8_Template(e,s){1&e&&(h.Ec(0,"span",22),h.pd(1),h.Pc(2,"translate"),h.Dc()),2&e&&(h.lc(1),h.rd(" ",h.Qc(2,1,"addon.messages.you")," "))}function AddonMessagesSearchPage_ng_template_18_ng_container_0_ion_item_6_Template(e,s){if(1&e){const e=h.Fc();h.Ec(0,"ion-item",13),h.Mc("click",(function AddonMessagesSearchPage_ng_template_18_ng_container_0_ion_item_6_Template_ion_item_click_0_listener(){h.fd(e);const n=s.$implicit;return h.Oc(3).openConversation(n)})),h.zc(1,"core-user-avatar",14),h.Ec(2,"ion-label"),h.Ec(3,"p",15),h.zc(4,"core-format-text",16),h.nd(5,AddonMessagesSearchPage_ng_template_18_ng_container_0_ion_item_6_ion_icon_5_Template,2,3,"ion-icon",17),h.Dc(),h.nd(6,AddonMessagesSearchPage_ng_template_18_ng_container_0_ion_item_6_ion_note_6_Template,3,3,"ion-note",5),h.Ec(7,"p",18),h.nd(8,AddonMessagesSearchPage_ng_template_18_ng_container_0_ion_item_6_span_8_Template,3,3,"span",19),h.zc(9,"core-format-text",20),h.Dc(),h.Dc(),h.Dc()}if(2&e){const e=s.$implicit,n=h.Oc(3);h.mc("aria-label",e.fullname)("aria-current",e==n.selectedResult?"page":"false"),h.lc(1),h.Vc("user",e)("checkOnline",!0)("linkProfile",!1),h.lc(3),h.Vc("text",e.fullname)("highlight",e.highlightName)("filter",!1),h.lc(1),h.Vc("ngIf",e.isblocked),h.lc(1),h.Vc("ngIf",e.lastmessagedate>0),h.lc(2),h.Vc("ngIf",e.sentfromcurrentuser),h.lc(1),h.Vc("text",e.lastmessage)("highlight",e.highlightMessage)("contextInstanceId",0)}}function AddonMessagesSearchPage_ng_template_18_ng_container_0_ng_container_7_div_1_Template(e,s){if(1&e){const e=h.Fc();h.Ec(0,"div",25),h.Ec(1,"ion-button",26),h.Mc("click",(function AddonMessagesSearchPage_ng_template_18_ng_container_0_ng_container_7_div_1_Template_ion_button_click_1_listener(){h.fd(e);const s=h.Oc(3).item,n=h.Oc();return n.search(n.query,s.type)})),h.pd(2),h.Pc(3,"translate"),h.Dc(),h.Dc()}2&e&&(h.lc(2),h.rd(" ",h.Qc(3,1,"core.loadmore")," "))}function AddonMessagesSearchPage_ng_template_18_ng_container_0_ng_container_7_div_2_Template(e,s){1&e&&(h.Ec(0,"div",27),h.zc(1,"ion-spinner"),h.Pc(2,"translate"),h.Dc()),2&e&&(h.lc(1),h.mc("aria-label",h.Qc(2,1,"core.loading")))}function AddonMessagesSearchPage_ng_template_18_ng_container_0_ng_container_7_Template(e,s){if(1&e&&(h.Cc(0),h.nd(1,AddonMessagesSearchPage_ng_template_18_ng_container_0_ng_container_7_div_1_Template,4,3,"div",23),h.nd(2,AddonMessagesSearchPage_ng_template_18_ng_container_0_ng_container_7_div_2_Template,3,3,"div",24),h.Bc()),2&e){const e=h.Oc(2).item;h.lc(1),h.Vc("ngIf",e.canLoadMore&&!e.loadingMore),h.lc(1),h.Vc("ngIf",e.loadingMore)}}function AddonMessagesSearchPage_ng_template_18_ng_container_0_Template(e,s){if(1&e&&(h.Cc(0),h.Ec(1,"ion-item-divider",11),h.Ec(2,"ion-label"),h.Ec(3,"h2"),h.pd(4),h.Pc(5,"translate"),h.Dc(),h.Dc(),h.Dc(),h.nd(6,AddonMessagesSearchPage_ng_template_18_ng_container_0_ion_item_6_Template,10,14,"ion-item",12),h.nd(7,AddonMessagesSearchPage_ng_template_18_ng_container_0_ng_container_7_Template,3,2,"ng-container",5),h.Bc()),2&e){const e=h.Oc().item;h.lc(4),h.qd(h.Qc(5,3,e.titleString)),h.lc(2),h.Vc("ngForOf",e.results),h.lc(1),h.Vc("ngIf","messages"!=e.type)}}function AddonMessagesSearchPage_ng_template_18_Template(e,s){if(1&e&&h.nd(0,AddonMessagesSearchPage_ng_template_18_ng_container_0_Template,8,5,"ng-container",5),2&e){h.Vc("ngIf",s.item.results.length>0)}}let le=(()=>{class AddonMessagesSearchPage{constructor(){this.disableSearch=!1,this.displaySearching=!1,this.displayResults=!1,this.query="",this.contacts={type:"contacts",titleString:"addon.messages.contacts",results:[],canLoadMore:!1,loadingMore:!1},this.nonContacts={type:"noncontacts",titleString:"addon.messages.noncontacts",results:[],canLoadMore:!1,loadingMore:!1},this.messages={type:"messages",titleString:"addon.messages.messages",results:[],canLoadMore:!1,loadingMore:!1,loadMoreError:!1},this.memberInfoObserver=l.b.on(c.b.MEMBER_INFO_CHANGED_EVENT,(e=>{if(!e.userBlocked&&!e.userUnblocked)return;const s=this.contacts.results.find((s=>s.id==e.userId));if(s)s.isblocked=!!e.userBlocked;else{const s=this.nonContacts.results.find((s=>s.id==e.userId));s&&(s.isblocked=!!e.userBlocked)}this.messages.results.forEach((s=>{s.userid==e.userId&&(s.isblocked=!!e.userBlocked)}))}),a.b.getCurrentSiteId())}clearSearch(){this.query="",this.displayResults=!1;const e=u.a.getRelativePathToParent("/messages/search");e&&u.a.navigate(e)}search(e,s,n){return Object(i.a)(this,void 0,void 0,(function*(){d.a.closeKeyboard(),this.query=e,this.disableSearch=!0,this.displaySearching=!s;const t=[];let o=[],i=[],a=[],l=!1,g=!1,_=!1;if(!s||"contacts"==s||"noncontacts"==s){const n=s?c.b.LIMIT_SEARCH:c.b.LIMIT_INITIAL_USER_SEARCH;let a=0;"contacts"==s?(a=this.contacts.results.length,this.contacts.loadingMore=!0):"noncontacts"==s&&(a=this.nonContacts.results.length,this.nonContacts.loadingMore=!0),t.push(c.a.searchUsers(e,a,n).then((e=>{s&&"contacts"!=s||(o=e.contacts,l=e.canLoadMoreContacts),s&&"noncontacts"!=s||(i=e.nonContacts,g=e.canLoadMoreNonContacts)})))}if(!s||"messages"==s){let n=0;"messages"==s&&(n=this.messages.results.length,this.messages.loadingMore=!0),t.push(c.a.searchMessages(e,void 0,n).then((e=>{a=e.messages,_=e.canLoadMore})))}try{yield Promise.all(t),s||(this.contacts.results=[],this.nonContacts.results=[],this.messages.results=[]),this.displayResults=!0,s&&"contacts"!=s||(this.contacts.results.push(...o),this.contacts.canLoadMore=l,this.setHighlight(o,!0)),s&&"noncontacts"!=s||(this.nonContacts.results.push(...i),this.nonContacts.canLoadMore=g,this.setHighlight(i,!0)),s&&"messages"!=s||(this.messages.results.push(...a),this.messages.canLoadMore=_,this.messages.loadMoreError=!1,this.setHighlight(a,!1)),s||(this.contacts.results.length>0?this.openConversation(this.contacts.results[0],!0):this.nonContacts.results.length>0?this.openConversation(this.nonContacts.results[0],!0):this.messages.results.length>0&&this.openConversation(this.messages.results[0],!0))}catch(e){r.a.showErrorModalDefault(e,"addon.messages.errorwhileretrievingusers",!0),"messages"==s&&(this.messages.loadMoreError=!0)}finally{this.disableSearch=!1,this.displaySearching=!1,"contacts"==s?this.contacts.loadingMore=!1:"noncontacts"==s?this.nonContacts.loadingMore=!1:"messages"==s&&(this.messages.loadingMore=!1),n&&n()}}))}openConversation(e,s=!1){if(!s||_.a.isTablet){let s,n;this.selectedResult=e,"conversationid"in e?s=e.conversationid:n=e.id;const t=u.a.getRelativePathToParent("/messages/search")+"discussion/"+(s||`user/${n}`);u.a.navigate(t,{reset:_.a.isTablet&&!!this.splitView&&!this.splitView.isNested})}}setHighlight(e,s=!1){e.forEach((e=>{e.highlightName=s?this.query:void 0,e.highlightMessage=s?void 0:this.query}))}ngOnDestroy(){var e;null===(e=this.memberInfoObserver)||void 0===e?void 0:e.off()}}return AddonMessagesSearchPage.ɵfac=function AddonMessagesSearchPage_Factory(e){return new(e||AddonMessagesSearchPage)},AddonMessagesSearchPage.ɵcmp=h.sc({type:AddonMessagesSearchPage,selectors:[["page-addon-messages-search"]],viewQuery:function AddonMessagesSearchPage_Query(e,s){var n;(1&e&&h.ud(m.a,!0),2&e)&&(h.dd(n=h.Nc())&&(s.splitView=n.first))},decls:20,vars:16,consts:[["slot","start"],[3,"text"],["slot","end"],["autocorrect","off","searchArea","AddonMessagesSearch",3,"disabled","spellcheck","autoFocus","lengthCheck","onSubmit","onClear"],[3,"hideUntil","message"],[4,"ngIf"],["icon","fas-magnifying-glass",3,"message",4,"ngIf"],["resultsTemplate",""],[4,"ngTemplateOutlet","ngTemplateOutletContext"],[3,"enabled","error","action"],["icon","fas-magnifying-glass",3,"message"],[1,"ion-text-wrap"],["class","addon-message-discussion ion-text-wrap","detail","true","button","",3,"click",4,"ngFor","ngForOf"],["detail","true","button","",1,"addon-message-discussion","ion-text-wrap",3,"click"],["slot","start",3,"user","checkOnline","linkProfile"],[1,"item-heading"],[3,"text","highlight","filter"],["name","fas-ban",4,"ngIf"],[1,"addon-message-last-message"],["class","addon-message-last-message-user",4,"ngIf"],["clean","true","singleLine","true","contextLevel","system",1,"addon-message-last-message-text",3,"text","highlight","contextInstanceId"],["name","fas-ban"],[1,"addon-message-last-message-user"],["class","ion-padding-horizontal",4,"ngIf"],["class","ion-padding ion-text-center",4,"ngIf"],[1,"ion-padding-horizontal"],["expand","block","fill","outline",3,"click"],[1,"ion-padding","ion-text-center"]],template:function AddonMessagesSearchPage_Template(e,s){1&e&&(h.Ec(0,"ion-header"),h.Ec(1,"ion-toolbar"),h.Ec(2,"ion-buttons",0),h.zc(3,"ion-back-button",1),h.Pc(4,"translate"),h.Dc(),h.Ec(5,"ion-title"),h.Ec(6,"h1"),h.pd(7),h.Pc(8,"translate"),h.Dc(),h.Dc(),h.Ec(9,"ion-buttons",2),h.zc(10,"core-context-menu"),h.Dc(),h.Dc(),h.Dc(),h.Ec(11,"ion-content"),h.Ec(12,"core-split-view"),h.Ec(13,"core-search-box",3),h.Mc("onSubmit",(function AddonMessagesSearchPage_Template_core_search_box_onSubmit_13_listener(e){return s.search(e)}))("onClear",(function AddonMessagesSearchPage_Template_core_search_box_onClear_13_listener(){return s.clearSearch()})),h.Dc(),h.Ec(14,"core-loading",4),h.Pc(15,"translate"),h.nd(16,AddonMessagesSearchPage_ion_list_16_Template,5,14,"ion-list",5),h.nd(17,AddonMessagesSearchPage_core_empty_box_17_Template,2,3,"core-empty-box",6),h.Dc(),h.Dc(),h.Dc(),h.nd(18,AddonMessagesSearchPage_ng_template_18_Template,1,1,"ng-template",null,7,h.od)),2&e&&(h.lc(3),h.Vc("text",h.Qc(4,10,"core.back")),h.lc(4),h.qd(h.Qc(8,12,"addon.messages.searchcombined")),h.lc(6),h.Vc("disabled",s.disableSearch)("spellcheck",!1)("autoFocus",!0)("lengthCheck",1),h.lc(1),h.Vc("hideUntil",!s.displaySearching)("message",h.Qc(15,14,"core.searching")),h.lc(2),h.Vc("ngIf",s.displayResults),h.lc(1),h.Vc("ngIf",s.displayResults&&!s.contacts.results.length&&!s.nonContacts.results.length&&!s.messages.results.length))},directives:[p.C,p.Ab,p.m,p.h,p.i,p.yb,M.a,v.a,p.v,m.a,P.a,C.a,b.t,p.P,b.A,w.a,O.a,p.J,p.O,b.s,p.I,I.a,k.a,p.D,A.a,p.W,y.a,p.l,p.qb],pipes:[D.d,oe.a],encapsulation:2}),AddonMessagesSearchPage})();var ge=n("OQOI"),_e=n("dQ3M"),ue=n("wG2S"),me=n("PM4H");let he=(()=>{class AddonMessagesIndexGuard{canActivate(e){return this.guard(e)}guard(e){const s=c.a.isGroupMessagingEnabled(),n=g.D.parseUrl(`/main/${ge.b.PAGE_NAME}/`+(s?"group-conversations":"index"));return n.queryParams=e.queryParams,n}}return AddonMessagesIndexGuard.ɵfac=function AddonMessagesIndexGuard_Factory(e){return new(e||AddonMessagesIndexGuard)},AddonMessagesIndexGuard.ɵprov=h.uc({token:AddonMessagesIndexGuard,factory:AddonMessagesIndexGuard.ɵfac,providedIn:"root"}),AddonMessagesIndexGuard})();function buildRoutes(e){const s=[{path:"discussion/user/:userId",component:Z},{path:"discussion/:conversationId",component:Z}],o=[{path:"contacts",component:S},{path:"index",data:{mainMenuTabRoot:ge.b.PAGE_NAME},component:ie},{path:"contacts-35",component:E},{path:"group-conversations",data:{mainMenuTabRoot:ge.b.PAGE_NAME},component:de},{path:"search",component:le}].reduce(((e,n)=>[...e,n,...s.map((e=>Object.assign(Object.assign({},e),{path:`${n.path}/${e.path}`})))]),[]),i=[{path:"contacts",component:S,children:s},{path:"index",data:{mainMenuTabRoot:ge.b.PAGE_NAME},component:ie,children:s},{path:"contacts-35",component:E,children:s},{path:"group-conversations",data:{mainMenuTabRoot:ge.b.PAGE_NAME},component:de,children:s},{path:"search",component:le,children:s}];return[...Object(t.c)(o,(()=>_.a.isMobile)),...Object(t.c)(i,(()=>_.a.isTablet)),...s,{path:"message-settings",loadChildren:()=>n.e(17).then(n.bind(null,"f1ir")).then((e=>e.AddonMessagesSettingsLazyModule))},...Object(ue.b)(e,{canActivate:[he]})]}let fe=(()=>{class AddonMessagesLazyModule{}return AddonMessagesLazyModule.ɵmod=h.wc({type:AddonMessagesLazyModule}),AddonMessagesLazyModule.ɵinj=h.vc({factory:function AddonMessagesLazyModule_Factory(e){return new(e||AddonMessagesLazyModule)},providers:[{provide:f.g,multi:!0,deps:[h.x],useFactory:buildRoutes}],imports:[[o.a,me.a,_e.a],f.m]}),AddonMessagesLazyModule})();void(("undefined"==typeof ngJitMode||ngJitMode)&&h.kd(fe,{declarations:[E,S,Z,ie,de,le],imports:[o.a,me.a,_e.a],exports:[f.m]}))}}]);