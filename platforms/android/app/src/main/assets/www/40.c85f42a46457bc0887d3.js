(window.webpackJsonp=window.webpackJsonp||[]).push([[40],{eoiU:function(t,i,n){"use strict";n.d(i,"a",(function(){return CoreSwipeNavigationItemsManager}));var o=n("mrSG"),e=n("pHTc"),a=n("CtbY");class CoreSwipeNavigationItemsManager extends a.a{start(){return Object(o.a)(this,void 0,void 0,(function*(){this.updateSelectedItem()}))}navigateToNextItem(){return Object(o.a)(this,void 0,void 0,(function*(){yield this.navigateToItemBy(1,"forward")}))}navigateToPreviousItem(){return Object(o.a)(this,void 0,void 0,(function*(){yield this.navigateToItemBy(-1,"back")}))}hasNextItem(){return Object(o.a)(this,void 0,void 0,(function*(){return!!(yield this.getItemBy(1))}))}hasPreviousItem(){return Object(o.a)(this,void 0,void 0,(function*(){return!!(yield this.getItemBy(-1))}))}getCurrentPageRoute(){return e.a.getCurrentRoute()}getSelectedItemPathFromRoute(t){const i=[];for(;t&&(i.push(...t.url),t.firstChild);)t=t.firstChild;return i.map((t=>t.path)).join("/").replace(/\/+/,"/").trim()||null}navigateToItemBy(t,i){return Object(o.a)(this,void 0,void 0,(function*(){const n=yield this.getItemBy(t);n&&(yield this.navigateToItem(n,{animationDirection:i,replace:!0}))}))}getItemBy(t){var i;return Object(o.a)(this,void 0,void 0,(function*(){const n=this.getSource().getItems(),o=null!==(i=this.selectedItem&&(null==n?void 0:n.indexOf(this.selectedItem)))&&void 0!==i?i:-1;if(-1===o||null===n)return null;const e=t>0?1:-1;let a=o,c=0;for(;c!==t;){if(a+=e,a<0)return null;if(a>=n.length)break;this.skipItemInSwipe(n[a])||(c+=e)}return c===t?n[a]:this.getSource().isCompleted()?null:(yield this.getSource().load(),this.getItemBy(t))}))}skipItemInSwipe(t){return!1}}},iGeg:function(t,i,n){"use strict";n.r(i),n.d(i,"AddonNotificationsLazyModule",(function(){return W}));var o=n("vY5A"),e=n("L3Fv"),a=n("mrSG"),c=n("3LXp"),r=n("bFG1"),s=n("fjkH"),d=n("yjU1"),l=n("pHTc"),f=n("46ml"),g=n("baaQ"),_=n("2eZG"),m=n("9+EE"),u=n("YyYz"),p=n("Q98t"),h=n("CvRw");class notifications_source_AddonNotificationsNotificationsSource extends h.a{constructor(){super(...arguments),this.totals={}}getItemPath(t){return t.id.toString()}reset(){this.totals={},super.reset()}loadPageItems(t){return Object(a.a)(this,void 0,void 0,(function*(){const i=yield this.loadNotifications(d.b.BOTH,t*this.getPageLength());return{items:i.notifications,hasMoreItems:i.hasMoreNotifications}}))}loadNotifications(t,i,n){var o;return Object(a.a)(this,void 0,void 0,(function*(){if(n=null!=n?n:this.getPageLength(),t in this.totals&&this.totals[t]<=i)return{notifications:[],hasMoreNotifications:!1};const e=yield d.a.getNotificationsWithStatus(t,{offset:i,limit:n});return e.length<n&&(this.totals[t]=i+e.length),{notifications:e,hasMoreNotifications:(null!==(o=this.totals[t])&&void 0!==o?o:Number.MAX_VALUE)>i+n}}))}setItems(t,i){const n=t.slice(0);n.sort(((t,i)=>t.timecreated<i.timecreated?1:-1)),super.setItems(n,i)}getPageLength(){return d.c.LIST_LIMIT}}var v=n("EoRH");class legacy_notifications_source_AddonLegacyNotificationsNotificationsSource extends notifications_source_AddonNotificationsNotificationsSource{loadPageItems(t){return Object(a.a)(this,void 0,void 0,(function*(){let i=[],n=!1,o=0;const e=this.getPageLength(),totalUnread=()=>{var t;return null!==(t=this.totals[d.b.UNREAD])&&void 0!==t?t:Number.MAX_VALUE};if(totalUnread()>t*e){const a=yield this.loadNotifications(d.b.UNREAD,t*e);i=i.concat(a.notifications),n=a.hasMoreNotifications,o=a.notifications.length}if(totalUnread()<(t+1)*e){const a=Math.max(0,t*e-totalUnread()),c=yield this.loadNotifications(d.b.READ,a,e-o);i=i.concat(c.notifications),n=c.hasMoreNotifications}return{items:i,hasMoreItems:n}}))}}var P=n("fXoL"),b=n("TEn/"),O=n("C1x5"),N=n("nt/U"),M=n("PgjG"),x=n("ofXK"),C=n("xpMl"),A=n("3jOR"),y=n("hMzs"),I=n("FeAf"),w=n("NcPy"),k=n("3CSS"),T=n("r8G5"),E=n("sYmb"),L=n("lAaw");function AddonNotificationsListPage_ion_item_17_core_user_avatar_2_div_1_Template(t,i){if(1&t&&(P.Ec(0,"div",19),P.zc(1,"img",20),P.Dc()),2&t){const t=P.Oc(2).$implicit;P.lc(1),P.Vc("src",t.iconurl,P.id)}}function AddonNotificationsListPage_ion_item_17_core_user_avatar_2_Template(t,i){if(1&t&&(P.Ec(0,"core-user-avatar",17),P.nd(1,AddonNotificationsListPage_ion_item_17_core_user_avatar_2_div_1_Template,2,1,"div",18),P.Dc()),2&t){const t=P.Oc().$implicit;P.Vc("user",t)("profileUrl",t.profileimageurlfrom)("fullname",t.userfromfullname)("userId",t.useridfrom),P.lc(1),P.Vc("ngIf",t.iconurl)}}function AddonNotificationsListPage_ion_item_17_ng_container_3_img_1_Template(t,i){if(1&t&&P.zc(0,"img",23),2&t){const t=P.Oc(2).$implicit;P.Vc("src",t.imgUrl,P.id)}}function AddonNotificationsListPage_ion_item_17_ng_container_3_div_2_img_1_Template(t,i){if(1&t&&P.zc(0,"img",27),2&t){const t=P.Oc(3).$implicit;P.Vc("src",t.iconurl,P.id)}}function AddonNotificationsListPage_ion_item_17_ng_container_3_div_2_ion_icon_2_Template(t,i){1&t&&P.zc(0,"ion-icon",28)}function AddonNotificationsListPage_ion_item_17_ng_container_3_div_2_Template(t,i){if(1&t&&(P.Ec(0,"div",24),P.nd(1,AddonNotificationsListPage_ion_item_17_ng_container_3_div_2_img_1_Template,1,1,"img",25),P.nd(2,AddonNotificationsListPage_ion_item_17_ng_container_3_div_2_ion_icon_2_Template,1,0,"ion-icon",26),P.Dc()),2&t){const t=P.Oc(2).$implicit;P.lc(1),P.Vc("ngIf",t.iconurl),P.lc(1),P.Vc("ngIf",!t.iconurl)}}function AddonNotificationsListPage_ion_item_17_ng_container_3_Template(t,i){if(1&t&&(P.Cc(0),P.nd(1,AddonNotificationsListPage_ion_item_17_ng_container_3_img_1_Template,1,1,"img",21),P.nd(2,AddonNotificationsListPage_ion_item_17_ng_container_3_div_2_Template,3,2,"div",22),P.Bc()),2&t){const t=P.Oc().$implicit;P.lc(1),P.Vc("ngIf",t.imgUrl),P.lc(1),P.Vc("ngIf",!t.imgUrl)}}function AddonNotificationsListPage_ion_item_17_ng_container_10_Template(t,i){if(1&t&&(P.Cc(0),P.pd(1),P.Bc()),2&t){const t=P.Oc().$implicit;P.lc(1),P.rd(" · ",t.userfromfullname,"")}}function AddonNotificationsListPage_ion_item_17_ion_note_11_Template(t,i){1&t&&(P.Ec(0,"ion-note",2),P.zc(1,"ion-icon",29),P.Dc())}const _c0=function(t){return{$a:t}};function AddonNotificationsListPage_ion_item_17_Template(t,i){if(1&t){const t=P.Fc();P.Ec(0,"ion-item",11),P.Mc("click",(function AddonNotificationsListPage_ion_item_17_Template_ion_item_click_0_listener(){P.fd(t);const n=i.$implicit;return P.Oc().notifications.select(n)})),P.Pc(1,"translate"),P.nd(2,AddonNotificationsListPage_ion_item_17_core_user_avatar_2_Template,2,5,"core-user-avatar",12),P.nd(3,AddonNotificationsListPage_ion_item_17_ng_container_3_Template,3,2,"ng-container",13),P.Ec(4,"ion-label"),P.Ec(5,"p",14),P.zc(6,"core-format-text",15),P.Dc(),P.Ec(7,"p"),P.pd(8),P.Pc(9,"coreTimeAgo"),P.nd(10,AddonNotificationsListPage_ion_item_17_ng_container_10_Template,2,1,"ng-container",13),P.Dc(),P.Dc(),P.nd(11,AddonNotificationsListPage_ion_item_17_ion_note_11_Template,2,0,"ion-note",16),P.Dc()}if(2&t){const t=i.$implicit,n=P.Oc();P.Vc("detail",!1),P.mc("aria-current",n.notifications.getItemAriaCurrent(t))("aria-label",t.timeread?t.subject:P.Rc(1,11,"addon.notifications.unreadnotification",P.ad(16,_c0,t.subject))),P.lc(2),P.Vc("ngIf",t.useridfrom>0),P.lc(1),P.Vc("ngIf",t.useridfrom<=0),P.lc(3),P.Vc("text",t.subject)("contextInstanceId",0)("wsNotFiltered",!0),P.lc(2),P.qd(P.Qc(9,14,t.timecreated)),P.lc(2),P.Vc("ngIf",t.useridfrom>0),P.lc(1),P.Vc("ngIf",!t.timeread)}}function AddonNotificationsListPage_core_empty_box_18_Template(t,i){1&t&&(P.zc(0,"core-empty-box",30),P.Pc(1,"translate")),2&t&&P.Vc("message",P.Qc(1,1,"addon.notifications.therearentnotificationsyet"))}function AddonNotificationsListPage_ion_chip_21_ion_icon_1_Template(t,i){1&t&&P.zc(0,"ion-icon",33)}function AddonNotificationsListPage_ion_chip_21_ion_spinner_2_Template(t,i){1&t&&(P.zc(0,"ion-spinner"),P.Pc(1,"translate")),2&t&&P.mc("aria-label",P.Qc(1,1,"core.loading"))}function AddonNotificationsListPage_ion_chip_21_Template(t,i){if(1&t){const t=P.Fc();P.Ec(0,"ion-chip",31),P.Mc("click",(function AddonNotificationsListPage_ion_chip_21_Template_ion_chip_click_0_listener(){P.fd(t);return P.Oc().markAllNotificationsAsRead()})),P.nd(1,AddonNotificationsListPage_ion_chip_21_ion_icon_1_Template,1,0,"ion-icon",32),P.nd(2,AddonNotificationsListPage_ion_chip_21_ion_spinner_2_Template,2,3,"ion-spinner",13),P.pd(3),P.Pc(4,"translate"),P.Dc()}if(2&t){const t=P.Oc();P.Vc("disabled",t.loadingMarkAllNotificationsAsRead),P.lc(1),P.Vc("ngIf",!t.loadingMarkAllNotificationsAsRead),P.lc(1),P.Vc("ngIf",t.loadingMarkAllNotificationsAsRead),P.lc(1),P.rd(" ",P.Qc(4,4,"addon.notifications.markallread")," ")}}let z=(()=>{class AddonNotificationsListPage{constructor(){this.fetchMoreNotificationsFailed=!1,this.canMarkAllNotificationsAsRead=!1,this.loadingMarkAllNotificationsAsRead=!1,this.pendingRefresh=!1;try{const t=g.a.getOrCreateSource(m.b.getRequiredCurrentSite().isVersionGreaterEqualThan("4.0")?notifications_source_AddonNotificationsNotificationsSource:legacy_notifications_source_AddonLegacyNotificationsNotificationsSource,[]);this.notifications=new v.a(t,AddonNotificationsListPage)}catch(t){c.a.showErrorModal(t),l.a.back()}}ngAfterViewInit(){return Object(a.a)(this,void 0,void 0,(function*(){yield this.fetchInitialNotifications(),this.notifications.start(this.splitView),this.cronObserver=s.b.on(d.c.READ_CRON_EVENT,(()=>{this.isCurrentView&&this.refreshNotifications()}),m.b.getCurrentSiteId()),this.pushObserver=_.a.on("receive").subscribe((t=>{if(!this.isCurrentView)return this.pendingRefresh=!0,void 0;r.a.isTrueOrOne(t.notif)&&m.b.isCurrentSite(t.site)&&this.refreshNotifications()})),this.readObserver=s.b.on(d.c.READ_CHANGED_EVENT,(t=>{if(!t.id)return;const i=this.notifications.items.find((i=>i.id===t.id));i&&(i.read=!0,i.timeread=t.time,this.loadMarkAllAsReadButton())}));(new u.a).treatLink()}))}fetchNotifications(t){return Object(a.a)(this,void 0,void 0,(function*(){t?yield this.notifications.reload():yield this.notifications.load(),this.fetchMoreNotificationsFailed=!1,this.loadMarkAllAsReadButton()}))}fetchInitialNotifications(){return Object(a.a)(this,void 0,void 0,(function*(){try{yield this.fetchNotifications(!0)}catch(t){c.a.showErrorModalDefault(t,"Error loading notifications"),this.notifications.reset()}}))}fetchMoreNotifications(t){return Object(a.a)(this,void 0,void 0,(function*(){try{yield this.fetchNotifications(!1)}catch(t){c.a.showErrorModalDefault(t,"Error loading more notifications"),this.fetchMoreNotificationsFailed=!0}t()}))}markAllNotificationsAsRead(){return Object(a.a)(this,void 0,void 0,(function*(){this.loadingMarkAllNotificationsAsRead=!0,yield r.a.ignoreErrors(d.a.markAllNotificationsAsRead()),s.b.trigger(d.c.READ_CHANGED_EVENT,{time:p.a.timestamp()},m.b.getCurrentSiteId()),yield this.refreshNotifications()}))}loadMarkAllAsReadButton(){return Object(a.a)(this,void 0,void 0,(function*(){try{this.loadingMarkAllNotificationsAsRead=!0;const t=yield d.a.getUnreadNotificationsCount();this.canMarkAllNotificationsAsRead=t.count>0}finally{this.loadingMarkAllNotificationsAsRead=!1}}))}refreshNotifications(t){return Object(a.a)(this,void 0,void 0,(function*(){yield r.a.ignoreErrors(d.a.invalidateNotificationsList()),yield r.a.ignoreErrors(this.fetchNotifications(!0)),null==t||t.complete()}))}ionViewDidEnter(){this.isCurrentView=!0,this.pendingRefresh&&(this.pendingRefresh=!1,this.refreshNotifications())}ionViewDidLeave(){this.isCurrentView=!1}ngOnDestroy(){var t,i,n,o;null===(t=this.cronObserver)||void 0===t?void 0:t.off(),null===(i=this.readObserver)||void 0===i||i.off(),null===(n=this.pushObserver)||void 0===n||n.unsubscribe(),null===(o=this.notifications)||void 0===o||o.destroy()}}return AddonNotificationsListPage.ɵfac=function AddonNotificationsListPage_Factory(t){return new(t||AddonNotificationsListPage)},AddonNotificationsListPage.ɵcmp=P.sc({type:AddonNotificationsListPage,selectors:[["page-addon-notifications-list"]],viewQuery:function AddonNotificationsListPage_Query(t,i){var n;(1&t&&P.ud(f.a,!0),2&t)&&(P.dd(n=P.Nc())&&(i.splitView=n.first))},decls:22,vars:16,consts:[["slot","start"],[3,"text"],["slot","end"],["slot","fixed",3,"disabled","ionRefresh"],[3,"pullingText"],[3,"hideUntil"],["class","ion-text-wrap","button","","lines","full",3,"detail","click",4,"ngFor","ngForOf"],["icon","far-bell",3,"message",4,"ngIf"],[3,"enabled","error","action"],["slot","fixed","collapsible-footer","","appearOnBottom","",1,"mark-all-as-read"],["color","info","class","clickable fab-chip",3,"disabled","click",4,"ngIf"],["button","","lines","full",1,"ion-text-wrap",3,"detail","click"],["slot","start",3,"user","profileUrl","fullname","userId",4,"ngIf"],[4,"ngIf"],[1,"item-heading"],["contextLevel","system",3,"text","contextInstanceId","wsNotFiltered"],["slot","end",4,"ngIf"],["slot","start",3,"user","profileUrl","fullname","userId"],["class","core-avatar-extra-img",4,"ngIf"],[1,"core-avatar-extra-img"],["alt","","role","presentation",3,"src"],["class","core-notification-img","core-external-content","","alt","","role","presentation","slot","start",3,"src",4,"ngIf"],["class","core-notification-icon","slot","start",4,"ngIf"],["core-external-content","","alt","","role","presentation","slot","start",1,"core-notification-img",3,"src"],["slot","start",1,"core-notification-icon"],["core-external-content","","alt","","role","presentation",3,"src",4,"ngIf"],["name","fas-bell","aria-hidden","true",4,"ngIf"],["core-external-content","","alt","","role","presentation",3,"src"],["name","fas-bell","aria-hidden","true"],["name","fas-circle","color","primary","aria-hidden","true"],["icon","far-bell",3,"message"],["color","info",1,"clickable","fab-chip",3,"disabled","click"],["name","fas-eye","aria-hidden","true",4,"ngIf"],["name","fas-eye","aria-hidden","true"]],template:function AddonNotificationsListPage_Template(t,i){1&t&&(P.Ec(0,"ion-header"),P.Ec(1,"ion-toolbar"),P.Ec(2,"ion-buttons",0),P.zc(3,"ion-back-button",1),P.Pc(4,"translate"),P.Dc(),P.Ec(5,"ion-title"),P.Ec(6,"h1"),P.pd(7),P.Pc(8,"translate"),P.Dc(),P.Dc(),P.Ec(9,"ion-buttons",2),P.zc(10,"core-user-menu-button"),P.Dc(),P.Dc(),P.Dc(),P.Ec(11,"ion-content"),P.Ec(12,"core-split-view"),P.Ec(13,"ion-refresher",3),P.Mc("ionRefresh",(function AddonNotificationsListPage_Template_ion_refresher_ionRefresh_13_listener(t){return i.refreshNotifications(t.target)})),P.zc(14,"ion-refresher-content",4),P.Pc(15,"translate"),P.Dc(),P.Ec(16,"core-loading",5),P.nd(17,AddonNotificationsListPage_ion_item_17_Template,12,18,"ion-item",6),P.nd(18,AddonNotificationsListPage_core_empty_box_18_Template,2,3,"core-empty-box",7),P.Ec(19,"core-infinite-loading",8),P.Mc("action",(function AddonNotificationsListPage_Template_core_infinite_loading_action_19_listener(t){return i.fetchMoreNotifications(t)})),P.Dc(),P.Dc(),P.Ec(20,"div",9),P.nd(21,AddonNotificationsListPage_ion_chip_21_Template,5,6,"ion-chip",10),P.Dc(),P.Dc(),P.Dc()),2&t&&(P.lc(3),P.Vc("text",P.Qc(4,10,"core.back")),P.lc(4),P.qd(P.Qc(8,12,"addon.notifications.notifications")),P.lc(6),P.Vc("disabled",!i.notifications.loaded),P.lc(1),P.Wc("pullingText",P.Qc(15,14,"core.pulltorefresh")),P.lc(2),P.Vc("hideUntil",i.notifications.loaded),P.lc(1),P.Vc("ngForOf",i.notifications.items),P.lc(1),P.Vc("ngIf",!i.notifications||i.notifications.empty),P.lc(1),P.Vc("enabled",i.notifications.loaded&&!i.notifications.completed)("error",i.fetchMoreNotificationsFailed),P.lc(2),P.Vc("ngIf",i.notifications.loaded&&i.canMarkAllNotificationsAsRead))},directives:[b.C,b.Ab,b.m,b.h,b.i,b.yb,O.a,N.a,b.v,f.a,b.bb,b.cb,M.a,x.s,x.t,C.a,A.a,b.I,b.O,y.a,I.a,w.a,b.D,k.a,b.W,T.a,b.t,b.qb],pipes:[E.d,L.a],styles:["ion-item[_ngcontent-%COMP%]{--icon-size:16px;--extra-icon-size:12px;--core-avatar-size:32px}ion-item[_ngcontent-%COMP%]   ion-label[_ngcontent-%COMP%]{margin-top:8px;margin-bottom:8px}ion-item[_ngcontent-%COMP%]   ion-label[_ngcontent-%COMP%]   p.item-heading[_ngcontent-%COMP%]{font-size:var(--text-size);-webkit-line-clamp:3;overflow:hidden;text-overflow:ellipsis;-webkit-box-orient:vertical;display:-webkit-box}ion-item[_ngcontent-%COMP%]   ion-label[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{font-size:12px}ion-item[_ngcontent-%COMP%]   ion-note[_ngcontent-%COMP%]{margin:0;padding-left:8px;padding-right:0;padding-top:12px}@supports ((-webkit-margin-start:0) or (margin-inline-start:0)) or (-webkit-margin-start:0){ion-item[_ngcontent-%COMP%]   ion-note[_ngcontent-%COMP%]{padding-left:unset;padding-right:unset;-webkit-padding-start:8px;padding-inline-start:8px;-webkit-padding-end:0;padding-inline-end:0}}ion-item[_ngcontent-%COMP%]   ion-note[_ngcontent-%COMP%]   ion-icon[_ngcontent-%COMP%]{font-size:6px;vertical-align:middle}ion-item[_ngcontent-%COMP%]   [slot=start][_ngcontent-%COMP%]{align-self:start;margin-top:16px}ion-item[_ngcontent-%COMP%]   core-mod-icon.core-notification-icon[_ngcontent-%COMP%], ion-item[_ngcontent-%COMP%]   div.core-notification-icon[_ngcontent-%COMP%]{padding:8px;max-width:var(--core-avatar-size);max-height:var(--core-avatar-size)}.mark-all-as-read[_ngcontent-%COMP%]{padding-bottom:16px;bottom:0;left:0;right:0;display:flex;background:transparent;box-shadow:none;pointer-events:none}.mark-all-as-read[_ngcontent-%COMP%]   ion-chip.ion-color[_ngcontent-%COMP%]{margin:0 auto}.mark-all-as-read[_ngcontent-%COMP%]   ion-chip.ion-color[_ngcontent-%COMP%]   ion-spinner[_ngcontent-%COMP%]{width:16px;height:16px;margin-left:0;margin-right:8px}@supports ((-webkit-margin-start:0) or (margin-inline-start:0)) or (-webkit-margin-start:0){.mark-all-as-read[_ngcontent-%COMP%]   ion-chip.ion-color[_ngcontent-%COMP%]   ion-spinner[_ngcontent-%COMP%]{margin-left:unset;margin-right:unset;-webkit-margin-start:0;margin-inline-start:0;-webkit-margin-end:8px;margin-inline-end:8px}}ion-content[_ngcontent-%COMP%]::part(scroll){padding-bottom:44px}","[_nghost-%COMP%]{--extra-icon-size:16px;--icon-size:24px}[_nghost-%COMP%]     core-user-avatar .core-avatar-extra-img, [_nghost-%COMP%]     core-user-avatar core-mod-icon{margin:0!important;position:absolute;right:-4px;bottom:-4px;padding:.2rem}[_nghost-%COMP%]     core-user-avatar .core-avatar-extra-img{background:var(--background-color);border-radius:var(--medium-radius)}[_nghost-%COMP%]     core-user-avatar .core-avatar-extra-img img{max-width:var(--extra-icon-size);max-height:var(--extra-icon-size);display:block}[_nghost-%COMP%]     core-user-avatar core-mod-icon{--size:var(--extra-icon-size)}[_nghost-%COMP%]   div.core-notification-icon[_ngcontent-%COMP%]{padding:.7rem;background:var(--background-color);border-radius:var(--small-radius)}[_nghost-%COMP%]   div.core-notification-icon[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{width:var(--icon-size);height:var(--icon-size)}[_nghost-%COMP%]   div.core-notification-icon[_ngcontent-%COMP%]   ion-icon[_ngcontent-%COMP%]{font-size:var(--icon-size)}[_nghost-%COMP%]   .core-notification-icon[_ngcontent-%COMP%]{--module-icon-size:var(--icon-size);margin:6px 8px 6px 0}@supports ((-webkit-margin-start:0) or (margin-inline-start:0)) or (-webkit-margin-start:0){[_nghost-%COMP%]   .core-notification-icon[_ngcontent-%COMP%]{margin-left:unset;margin-right:unset;-webkit-margin-start:0;margin-inline-start:0;-webkit-margin-end:8px;margin-inline-end:8px}}[_nghost-%COMP%]   .core-notification-img[_ngcontent-%COMP%]{margin:6px 8px 6px 0;width:var(--core-avatar-size);height:var(--core-avatar-size);object-fit:cover}@supports ((-webkit-margin-start:0) or (margin-inline-start:0)) or (-webkit-margin-start:0){[_nghost-%COMP%]   .core-notification-img[_ngcontent-%COMP%]{margin-left:unset;margin-right:unset;-webkit-margin-start:0;margin-inline-start:0;-webkit-margin-end:8px;margin-inline-end:8px}}"]}),AddonNotificationsListPage})();var D=n("ssuw"),V=n("eoiU"),R=n("mbU7"),j=n("D7J2"),S=n("j3ag"),U=n("OZH1"),F=n("ACYt"),B=n("dne1");function AddonNotificationsNotificationPage_div_11_core_user_avatar_2_div_1_Template(t,i){if(1&t&&(P.Ec(0,"div",16),P.zc(1,"img",17),P.Dc()),2&t){const t=P.Oc(3);P.lc(1),P.Vc("src",t.notification.iconurl,P.id)}}function AddonNotificationsNotificationPage_div_11_core_user_avatar_2_Template(t,i){if(1&t&&(P.Ec(0,"core-user-avatar",14),P.nd(1,AddonNotificationsNotificationPage_div_11_core_user_avatar_2_div_1_Template,2,1,"div",15),P.Dc()),2&t){const t=P.Oc(2);P.Vc("userId",t.notification.useridfrom)("profileUrl",t.notification.profileimageurlfrom)("fullname",t.notification.userfromfullname),P.lc(1),P.Vc("ngIf",t.notification.iconurl)}}function AddonNotificationsNotificationPage_div_11_ng_container_3_img_1_Template(t,i){if(1&t&&P.zc(0,"img",20),2&t){const t=P.Oc(3);P.Vc("src",t.notification.imgUrl,P.id)}}function AddonNotificationsNotificationPage_div_11_ng_container_3_div_2_img_1_Template(t,i){if(1&t&&P.zc(0,"img",24),2&t){const t=P.Oc(4);P.Vc("src",t.notification.iconurl,P.id)}}function AddonNotificationsNotificationPage_div_11_ng_container_3_div_2_ion_icon_2_Template(t,i){1&t&&P.zc(0,"ion-icon",25)}function AddonNotificationsNotificationPage_div_11_ng_container_3_div_2_Template(t,i){if(1&t&&(P.Ec(0,"div",21),P.nd(1,AddonNotificationsNotificationPage_div_11_ng_container_3_div_2_img_1_Template,1,1,"img",22),P.nd(2,AddonNotificationsNotificationPage_div_11_ng_container_3_div_2_ion_icon_2_Template,1,0,"ion-icon",23),P.Dc()),2&t){const t=P.Oc(3);P.lc(1),P.Vc("ngIf",t.notification.iconurl),P.lc(1),P.Vc("ngIf",!t.notification.iconurl)}}function AddonNotificationsNotificationPage_div_11_ng_container_3_Template(t,i){if(1&t&&(P.Cc(0),P.nd(1,AddonNotificationsNotificationPage_div_11_ng_container_3_img_1_Template,1,1,"img",18),P.nd(2,AddonNotificationsNotificationPage_div_11_ng_container_3_div_2_Template,3,2,"div",19),P.Bc()),2&t){const t=P.Oc(2);P.lc(1),P.Vc("ngIf",t.notification.imgUrl),P.lc(1),P.Vc("ngIf",!t.notification.imgUrl)}}function AddonNotificationsNotificationPage_div_11_p_7_ng_container_3_Template(t,i){if(1&t&&(P.Cc(0),P.pd(1),P.Bc()),2&t){const t=P.Oc(3);P.lc(1),P.rd(" · ",t.notification.userfromfullname,"")}}function AddonNotificationsNotificationPage_div_11_p_7_Template(t,i){if(1&t&&(P.Ec(0,"p"),P.pd(1),P.Pc(2,"coreTimeAgo"),P.nd(3,AddonNotificationsNotificationPage_div_11_p_7_ng_container_3_Template,2,1,"ng-container",9),P.Dc()),2&t){const t=P.Oc(2);P.lc(1),P.rd(" ",P.Qc(2,2,t.notification.timecreated)," "),P.lc(2),P.Vc("ngIf",t.notification.useridfrom>0)}}function AddonNotificationsNotificationPage_div_11_Template(t,i){if(1&t&&(P.Ec(0,"div",6),P.Ec(1,"ion-item",7),P.nd(2,AddonNotificationsNotificationPage_div_11_core_user_avatar_2_Template,2,4,"core-user-avatar",8),P.nd(3,AddonNotificationsNotificationPage_div_11_ng_container_3_Template,3,2,"ng-container",9),P.Ec(4,"ion-label"),P.Ec(5,"p",10),P.zc(6,"core-format-text",11),P.Dc(),P.nd(7,AddonNotificationsNotificationPage_div_11_p_7_Template,4,4,"p",9),P.Dc(),P.Dc(),P.Ec(8,"ion-item",12),P.Ec(9,"ion-label"),P.zc(10,"core-format-text",13),P.Pc(11,"coreCreateLinks"),P.Dc(),P.Dc(),P.Dc()),2&t){const t=P.Oc();P.lc(2),P.Vc("ngIf",t.notification.useridfrom>0),P.lc(1),P.Vc("ngIf",t.notification.useridfrom<=0),P.lc(3),P.Vc("text",t.notification.subject)("contextInstanceId",0)("wsNotFiltered",!0),P.lc(1),P.Vc("ngIf",t.notification.timecreated>0),P.lc(3),P.Vc("text",P.Qc(11,8,t.notification.mobiletext))("contextInstanceId",0)}}function AddonNotificationsNotificationPage_div_12_ion_button_2_Template(t,i){if(1&t&&(P.Ec(0,"ion-button",29),P.Mc("click",(function AddonNotificationsNotificationPage_div_12_ion_button_2_Template_ion_button_click_0_listener(){return i.$implicit.action()})),P.zc(1,"ion-icon",30),P.pd(2),P.Pc(3,"translate"),P.Dc()),2&t){const t=i.$implicit;P.lc(1),P.Wc("name",t.icon),P.lc(1),P.rd(" ",P.Qc(3,2,t.message)," ")}}function AddonNotificationsNotificationPage_div_12_Template(t,i){if(1&t&&(P.Ec(0,"div",26),P.Ec(1,"div",27),P.nd(2,AddonNotificationsNotificationPage_div_12_ion_button_2_Template,4,4,"ion-button",28),P.Dc(),P.Dc()),2&t){const t=P.Oc();P.lc(2),P.Vc("ngForOf",t.actions)}}let Q=(()=>{class AddonNotificationsNotificationPage{constructor(){this.loaded=!1,this.actions=[]}ngOnInit(){return Object(a.a)(this,void 0,void 0,(function*(){let t;try{t=this.getNotification()}catch(t){return c.a.showErrorModal(t),l.a.back(),void 0}this.notification="subject"in t?t:yield d.a.convertPushToMessage(t),yield this.loadActions(this.notification),D.a.markNotificationAsRead(t),this.loaded=!0,t.id&&j.a.logEvent({type:j.b.VIEW_ITEM,ws:"core_message_get_messages",name:S.I.instant("addon.notifications.notifications"),data:{id:t.id,category:"notifications"},url:`/message/output/popup/notifications.php?notificationid=${t.id}&offset=0`})}))}getNotification(){const t=l.a.getRouteNumberParam("id"),i=t?this.getNotificationById(t):void 0;return null!=i?i:l.a.getRequiredRouteParam("notification")}getNotificationById(t){var i;const n=g.a.getOrCreateSource(m.b.getRequiredCurrentSite().isVersionGreaterEqualThan("4.0")?notifications_source_AddonNotificationsNotificationsSource:legacy_notifications_source_AddonLegacyNotificationsNotificationsSource,[]),o=null===(i=n.getItems())||void 0===i?void 0:i.find((({id:i})=>i===t));if(o)return this.loadNotifications(n),o}loadNotifications(t){return Object(a.a)(this,void 0,void 0,(function*(){this.notifications=new notification_AddonNotificationSwipeItemsManager(t),yield this.notifications.start()}))}loadActions(t){var i;return Object(a.a)(this,void 0,void 0,(function*(){if(!(t.contexturl||t.customdata&&t.customdata.appurl))return;let n=[];this.actionsData=t.customdata,this.contextUrl=t.contexturl||void 0,this.courseId="courseid"in t?t.courseid:void 0,(null===(i=this.actionsData)||void 0===i?void 0:i.appurl)&&(n=yield R.a.getActionsFor(this.actionsData.appurl,this.courseId,void 0,this.actionsData)),!n.length&&this.contextUrl&&(n=yield R.a.getActionsFor(this.contextUrl,this.courseId,void 0,this.actionsData)),n.length||n.push({message:"core.view",icon:"fas-eye",action:t=>this.openInBrowser(t)}),this.actions=n}))}openInBrowser(t){var i;return Object(a.a)(this,void 0,void 0,(function*(){const n=(null===(i=this.actionsData)||void 0===i?void 0:i.appurl)||this.contextUrl;if(!n)return;(yield m.b.getSite(t)).openInBrowserWithAutoLogin(n)}))}ngOnDestroy(){var t;null===(t=this.notifications)||void 0===t?void 0:t.destroy()}}return AddonNotificationsNotificationPage.ɵfac=function AddonNotificationsNotificationPage_Factory(t){return new(t||AddonNotificationsNotificationPage)},AddonNotificationsNotificationPage.ɵcmp=P.sc({type:AddonNotificationsNotificationPage,selectors:[["page-addon-notifications-notification"]],decls:13,vars:10,consts:[["slot","start"],[3,"text"],[3,"core-swipe-navigation"],[3,"hideUntil"],["class","list-item-limited-width",4,"ngIf"],["collapsible-footer","","appearOnBottom","","slot","fixed",4,"ngIf"],[1,"list-item-limited-width"],["lines","full",1,"ion-text-wrap","core-notification-title"],["slot","start",3,"userId","profileUrl","fullname",4,"ngIf"],[4,"ngIf"],[1,"item-heading"],["contextLevel","system",3,"text","contextInstanceId","wsNotFiltered"],[1,"ion-text-wrap","core-notification-body"],["contextLevel","system",3,"text","contextInstanceId"],["slot","start",3,"userId","profileUrl","fullname"],["class","core-avatar-extra-img",4,"ngIf"],[1,"core-avatar-extra-img"],["alt","","role","presentation",3,"src"],["class","core-notification-img","core-external-content","","alt","","role","presentation","slot","start",3,"src",4,"ngIf"],["class","core-notification-icon","slot","start",4,"ngIf"],["core-external-content","","alt","","role","presentation","slot","start",1,"core-notification-img",3,"src"],["slot","start",1,"core-notification-icon"],["core-external-content","","alt","","role","presentation",3,"src",4,"ngIf"],["name","fas-bell","aria-hidden","true",4,"ngIf"],["core-external-content","","alt","","role","presentation",3,"src"],["name","fas-bell","aria-hidden","true"],["collapsible-footer","","appearOnBottom","","slot","fixed"],[1,"list-item-limited-width","adaptable-buttons-row"],["expand","block",3,"click",4,"ngFor","ngForOf"],["expand","block",3,"click"],["slot","start","aria-hidden","true",3,"name"]],template:function AddonNotificationsNotificationPage_Template(t,i){1&t&&(P.Ec(0,"ion-header"),P.Ec(1,"ion-toolbar"),P.Ec(2,"ion-buttons",0),P.zc(3,"ion-back-button",1),P.Pc(4,"translate"),P.Dc(),P.Ec(5,"ion-title"),P.Ec(6,"h1"),P.pd(7),P.Pc(8,"translate"),P.Dc(),P.Dc(),P.Dc(),P.Dc(),P.Ec(9,"ion-content",2),P.Ec(10,"core-loading",3),P.nd(11,AddonNotificationsNotificationPage_div_11_Template,12,10,"div",4),P.nd(12,AddonNotificationsNotificationPage_div_12_Template,3,1,"div",5),P.Dc(),P.Dc()),2&t&&(P.lc(3),P.Vc("text",P.Qc(4,6,"core.back")),P.lc(4),P.qd(P.Qc(8,8,"addon.notifications.notifications")),P.lc(2),P.Vc("core-swipe-navigation",i.notifications),P.lc(1),P.Vc("hideUntil",i.loaded),P.lc(1),P.Vc("ngIf",i.notification),P.lc(1),P.Vc("ngIf",i.loaded&&i.actions&&i.actions.length>0))},directives:[b.C,b.Ab,b.m,b.h,b.i,b.yb,N.a,b.v,U.a,M.a,x.t,b.I,b.O,y.a,I.a,w.a,b.D,k.a,A.a,x.s,F.a,b.l],pipes:[E.d,B.a,L.a],styles:["[_nghost-%COMP%]{--extra-icon-size:16px;--icon-size:24px}[_nghost-%COMP%]     core-user-avatar .core-avatar-extra-img, [_nghost-%COMP%]     core-user-avatar core-mod-icon{margin:0!important;position:absolute;right:-4px;bottom:-4px;padding:.2rem}[_nghost-%COMP%]     core-user-avatar .core-avatar-extra-img{background:var(--background-color);border-radius:var(--medium-radius)}[_nghost-%COMP%]     core-user-avatar .core-avatar-extra-img img{max-width:var(--extra-icon-size);max-height:var(--extra-icon-size);display:block}[_nghost-%COMP%]     core-user-avatar core-mod-icon{--size:var(--extra-icon-size)}[_nghost-%COMP%]   div.core-notification-icon[_ngcontent-%COMP%]{padding:.7rem;background:var(--background-color);border-radius:var(--small-radius)}[_nghost-%COMP%]   div.core-notification-icon[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{width:var(--icon-size);height:var(--icon-size)}[_nghost-%COMP%]   div.core-notification-icon[_ngcontent-%COMP%]   ion-icon[_ngcontent-%COMP%]{font-size:var(--icon-size)}[_nghost-%COMP%]   .core-notification-icon[_ngcontent-%COMP%]{--module-icon-size:var(--icon-size);margin:6px 8px 6px 0}@supports ((-webkit-margin-start:0) or (margin-inline-start:0)) or (-webkit-margin-start:0){[_nghost-%COMP%]   .core-notification-icon[_ngcontent-%COMP%]{margin-left:unset;margin-right:unset;-webkit-margin-start:0;margin-inline-start:0;-webkit-margin-end:8px;margin-inline-end:8px}}[_nghost-%COMP%]   .core-notification-img[_ngcontent-%COMP%]{margin:6px 8px 6px 0;width:var(--core-avatar-size);height:var(--core-avatar-size);object-fit:cover}@supports ((-webkit-margin-start:0) or (margin-inline-start:0)) or (-webkit-margin-start:0){[_nghost-%COMP%]   .core-notification-img[_ngcontent-%COMP%]{margin-left:unset;margin-right:unset;-webkit-margin-start:0;margin-inline-start:0;-webkit-margin-end:8px;margin-inline-end:8px}}","[_nghost-%COMP%]   .core-notification-title[_ngcontent-%COMP%]   [slot=start][_ngcontent-%COMP%]{align-self:start;margin-top:16px}[_nghost-%COMP%]   .core-notification-title[_ngcontent-%COMP%]   p.item-heading[_ngcontent-%COMP%]{font-size:16px}[_nghost-%COMP%]   .core-notification-title[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{font-size:12px}[_nghost-%COMP%]   .core-notification-body[_ngcontent-%COMP%]   core-format-text[_ngcontent-%COMP%]{font-size:var(--text-size)}[_nghost-%COMP%]   .core-notification-body[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{font-weight:700}[_nghost-%COMP%]   .core-notification-body[_ngcontent-%COMP%]   core-format-text[_ngcontent-%COMP%]     .forumpost{border:1px solid var(--gray-200);width:100%;margin:0 0 1em}[_nghost-%COMP%]   .core-notification-body[_ngcontent-%COMP%]   core-format-text[_ngcontent-%COMP%]     .forumpost td{padding:10px}[_nghost-%COMP%]   .core-notification-body[_ngcontent-%COMP%]   core-format-text[_ngcontent-%COMP%]     .forumpost .header{background-color:var(--light)}[_nghost-%COMP%]   .core-notification-body[_ngcontent-%COMP%]   core-format-text[_ngcontent-%COMP%]     .forumpost .header .picture{width:48px;text-align:center;padding-left:4px;padding-right:0;padding-top:8px}@supports ((-webkit-margin-start:0) or (margin-inline-start:0)) or (-webkit-margin-start:0){[_nghost-%COMP%]   .core-notification-body[_ngcontent-%COMP%]   core-format-text[_ngcontent-%COMP%]     .forumpost .header .picture{padding-left:unset;padding-right:unset;-webkit-padding-start:4px;padding-inline-start:4px;-webkit-padding-end:0;padding-inline-end:0}}[_nghost-%COMP%]   .core-notification-body[_ngcontent-%COMP%]   core-format-text[_ngcontent-%COMP%]     .forumpost .header .picture img{width:44px!important}[_nghost-%COMP%]   .core-notification-body[_ngcontent-%COMP%]   core-format-text[_ngcontent-%COMP%]     .forumpost .subject{font-weight:700;margin-bottom:1rem}[_nghost-%COMP%]   .core-notification-body[_ngcontent-%COMP%]   core-format-text[_ngcontent-%COMP%]     a{text-decoration:none}[_nghost-%COMP%]   .core-notification-body[_ngcontent-%COMP%]   core-format-text[_ngcontent-%COMP%]     .userpicture{border-radius:50%}[_nghost-%COMP%]   .core-notification-body[_ngcontent-%COMP%]   core-format-text[_ngcontent-%COMP%]     .mdl-right{text-align:end}[_nghost-%COMP%]   .core-notification-body[_ngcontent-%COMP%]   core-format-text[_ngcontent-%COMP%]     .mdl-right a{display:none}[_nghost-%COMP%]   .core-notification-body[_ngcontent-%COMP%]   core-format-text[_ngcontent-%COMP%]     .mdl-right font{font-size:.9em}[_nghost-%COMP%]   .core-notification-body[_ngcontent-%COMP%]   core-format-text[_ngcontent-%COMP%]     .commands{display:none}[_nghost-%COMP%]   .core-notification-body[_ngcontent-%COMP%]   core-format-text[_ngcontent-%COMP%]     hr{margin-top:1.5rem;margin-bottom:1.5rem;background-color:var(--gray-200)}"]}),AddonNotificationsNotificationPage})();class notification_AddonNotificationSwipeItemsManager extends V.a{getSelectedItemPathFromRoute(t){return t.params.id}}var G=n("tyNb"),$=n("dQ3M"),q=n("wG2S"),H=n("Y+03"),Y=n("ZKOL");function buildRoutes(t){return[{path:"list",data:{mainMenuTabRoot:Y.b.PAGE_NAME},component:z,children:Object(o.c)([{path:":id",component:Q}],(()=>H.a.isTablet))},...Object(o.c)([{path:"list/:id",component:Q}],(()=>H.a.isMobile)),{path:"notification",component:Q},...Object(q.b)(t,{redirectTo:"list",pathMatch:"full"})]}let W=(()=>{class AddonNotificationsLazyModule{}return AddonNotificationsLazyModule.ɵmod=P.wc({type:AddonNotificationsLazyModule}),AddonNotificationsLazyModule.ɵinj=P.vc({factory:function AddonNotificationsLazyModule_Factory(t){return new(t||AddonNotificationsLazyModule)},providers:[{provide:G.g,multi:!0,deps:[P.x],useFactory:buildRoutes}],imports:[[e.a,$.a],G.m]}),AddonNotificationsLazyModule})();void(("undefined"==typeof ngJitMode||ngJitMode)&&P.kd(W,{declarations:[z,Q],imports:[e.a,$.a],exports:[G.m]}))}}]);