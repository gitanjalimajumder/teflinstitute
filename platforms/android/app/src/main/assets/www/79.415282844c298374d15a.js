(window.webpackJsonp=window.webpackJsonp||[]).push([[79],{Bg0Z:function(e,o,s){"use strict";s.r(o),s.d(o,"CoreCoursesLazyModule",(function(){return U}));var t=s("L3Fv"),r=s("fXoL"),c=s("tyNb"),a=s("oV7r"),n=s("mrSG"),i=s("9+EE"),l=s("3LXp"),d=s("bFG1"),u=s("Xzvb"),h=s("j3ag"),g=s("pHTc"),_=s("fjkH"),C=s("D7J2"),m=s("8vmT"),f=s("TEn/"),b=s("hMzs"),p=s("fQ68"),E=s("ofXK"),y=s("8/N+"),w=s("nt/U"),D=s("PgjG"),P=s("3CSS"),I=s("edOc"),T=s("Y7jA"),O=s("r8G5"),x=s("sYmb");function CoreCoursesCategoriesPage_core_context_menu_item_10_Template(e,o){if(1&e){const e=r.Fc();r.Ec(0,"core-context-menu-item",5),r.Mc("action",(function CoreCoursesCategoriesPage_core_context_menu_item_10_Template_core_context_menu_item_action_0_listener(){r.fd(e);return r.Oc().toggleDownload()}))("toggleChange",(function CoreCoursesCategoriesPage_core_context_menu_item_10_Template_core_context_menu_item_toggleChange_0_listener(o){r.fd(e);return r.Oc().downloadEnabled=o})),r.Pc(1,"translate"),r.Dc()}if(2&e){const e=r.Oc();r.Vc("priority",1e3)("content",r.Qc(1,3,"core.settings.showdownloadoptions"))("toggle",e.downloadEnabled)}}function CoreCoursesCategoriesPage_ion_item_19_p_6_Template(e,o){if(1&e&&(r.Ec(0,"p"),r.zc(1,"core-format-text",16),r.Dc()),2&e){const e=r.Oc(2);r.lc(1),r.Vc("text",e.currentCategory.description)("contextInstanceId",e.currentCategory.id)}}function CoreCoursesCategoriesPage_ion_item_19_Template(e,o){if(1&e&&(r.Ec(0,"ion-item",13),r.zc(1,"ion-icon",14),r.Pc(2,"translate"),r.Ec(3,"ion-label"),r.Ec(4,"p",15),r.zc(5,"core-format-text",2),r.Dc(),r.nd(6,CoreCoursesCategoriesPage_ion_item_19_p_6_Template,2,2,"p",11),r.Dc(),r.Dc()),2&e){const e=r.Oc();r.lc(1),r.mc("aria-label",r.Qc(2,4,"core.category")),r.lc(4),r.Vc("text",e.currentCategory.name)("contextInstanceId",e.currentCategory.id),r.lc(1),r.Vc("ngIf",e.currentCategory.description)}}const _c0=function(e){return{$a:e}};function CoreCoursesCategoriesPage_ng_container_20_ion_card_6_ion_badge_7_Template(e,o){if(1&e&&(r.Ec(0,"ion-badge",21),r.Ec(1,"span",22),r.pd(2),r.Dc(),r.Ec(3,"span",23),r.pd(4),r.Pc(5,"translate"),r.Dc(),r.Dc()),2&e){const e=r.Oc().$implicit;r.lc(2),r.qd(e.coursecount),r.lc(2),r.qd(r.Rc(5,2,"core.courses.therearecourses",r.ad(5,_c0,e.coursecount)))}}function CoreCoursesCategoriesPage_ng_container_20_ion_card_6_Template(e,o){if(1&e){const e=r.Fc();r.Ec(0,"ion-card"),r.Ec(1,"ion-item",19),r.Mc("click",(function CoreCoursesCategoriesPage_ng_container_20_ion_card_6_Template_ion_item_click_1_listener(){r.fd(e);const s=o.$implicit;return r.Oc(2).openCategory(s.id)})),r.zc(2,"ion-icon",14),r.Pc(3,"translate"),r.Ec(4,"ion-label"),r.Ec(5,"p",15),r.zc(6,"core-format-text",2),r.Dc(),r.Dc(),r.nd(7,CoreCoursesCategoriesPage_ng_container_20_ion_card_6_ion_badge_7_Template,6,7,"ion-badge",20),r.Dc(),r.Dc()}if(2&e){const e=o.$implicit,s=r.Oc(2);r.lc(1),r.mc("aria-label",e.name),r.lc(1),r.mc("aria-label",r.Qc(3,5,"core.category")),r.lc(4),r.Vc("text",e.name)("contextInstanceId",e.id),r.lc(1),r.Vc("ngIf",!s.showOnlyEnrolled&&e.coursecount>0)}}function CoreCoursesCategoriesPage_ng_container_20_Template(e,o){if(1&e&&(r.Cc(0),r.Ec(1,"ion-item-divider"),r.Ec(2,"ion-label"),r.Ec(3,"h2",17),r.pd(4),r.Pc(5,"translate"),r.Dc(),r.Dc(),r.Dc(),r.nd(6,CoreCoursesCategoriesPage_ng_container_20_ion_card_6_Template,8,7,"ion-card",18),r.Bc()),2&e){const e=r.Oc();r.lc(4),r.qd(r.Qc(5,2,"core.courses.categories")),r.lc(2),r.Vc("ngForOf",e.categories)}}function CoreCoursesCategoriesPage_ng_container_21_h2_3_Template(e,o){1&e&&(r.Ec(0,"h2",17),r.pd(1),r.Pc(2,"translate"),r.Dc()),2&e&&(r.lc(1),r.qd(r.Qc(2,1,"core.courses.courses")))}function CoreCoursesCategoriesPage_ng_container_21_h2_4_Template(e,o){1&e&&(r.Ec(0,"h2",17),r.pd(1),r.Pc(2,"translate"),r.Dc()),2&e&&(r.lc(1),r.qd(r.Qc(2,1,"core.courses.mycourses")))}function CoreCoursesCategoriesPage_ng_container_21_core_courses_course_list_item_5_Template(e,o){if(1&e&&r.zc(0,"core-courses-course-list-item",26),2&e){const e=o.$implicit,s=r.Oc(2);r.Vc("course",e)("showDownload",s.downloadEnabled)}}function CoreCoursesCategoriesPage_ng_container_21_Template(e,o){if(1&e&&(r.Cc(0),r.Ec(1,"ion-item-divider"),r.Ec(2,"ion-label"),r.nd(3,CoreCoursesCategoriesPage_ng_container_21_h2_3_Template,3,3,"h2",24),r.nd(4,CoreCoursesCategoriesPage_ng_container_21_h2_4_Template,3,3,"h2",24),r.Dc(),r.Dc(),r.nd(5,CoreCoursesCategoriesPage_ng_container_21_core_courses_course_list_item_5_Template,1,2,"core-courses-course-list-item",25),r.Bc()),2&e){const e=r.Oc();r.lc(3),r.Vc("ngIf",!e.showOnlyEnrolled),r.lc(1),r.Vc("ngIf",e.showOnlyEnrolled),r.lc(1),r.Vc("ngForOf",e.courses)}}function CoreCoursesCategoriesPage_core_empty_box_22_Template(e,o){1&e&&(r.zc(0,"core-empty-box",27),r.Pc(1,"translate")),2&e&&r.Vc("message",r.Qc(1,1,"core.courses.nocoursesyet"))}let v=(()=>{class CoreCoursesCategoriesPage{constructor(){this.categories=[],this.courses=[],this.categoriesLoaded=!1,this.showOnlyEnrolled=!1,this.downloadEnabled=!1,this.downloadCourseEnabled=!1,this.downloadCoursesEnabled=!1,this.categoryCourses=[],this.categoryId=0,this.isDestroyed=!1,this.title=h.I.instant("core.courses.categories"),this.currentSiteId=i.b.getRequiredCurrentSite().getId(),this.myCoursesObserver=_.b.on(u.b.EVENT_MY_COURSES_UPDATED,(e=>{e.action==u.b.ACTION_ENROL&&this.fetchCategories()}),this.currentSiteId),this.siteUpdatedObserver=_.b.on(_.b.SITE_UPDATED,(()=>{this.downloadCourseEnabled=!u.a.isDownloadCourseDisabledInSite(),this.downloadCoursesEnabled=!u.a.isDownloadCoursesDisabledInSite(),this.downloadEnabled=(this.downloadCourseEnabled||this.downloadCoursesEnabled)&&this.downloadEnabled}),this.currentSiteId),this.downloadEnabledObserver=_.b.on(u.b.EVENT_DASHBOARD_DOWNLOAD_ENABLED_CHANGED,(e=>{this.downloadEnabled=(this.downloadCourseEnabled||this.downloadCoursesEnabled)&&e.enabled})),this.logView=m.a.once((()=>{C.a.logEvent({type:C.b.VIEW_ITEM_LIST,ws:"core_course_get_categories",name:this.title,data:{categoryid:this.categoryId,category:"course"},url:"/course/index.php"+(this.categoryId>0?`?categoryid=${this.categoryId}`:"")})}))}ngOnInit(){this.categoryId=g.a.getRouteNumberParam("id")||0,this.showOnlyEnrolled=g.a.getRouteBooleanParam("enrolled")||this.showOnlyEnrolled,this.downloadCourseEnabled=!u.a.isDownloadCourseDisabledInSite(),this.downloadCoursesEnabled=!u.a.isDownloadCoursesDisabledInSite(),this.downloadEnabled=(this.downloadCourseEnabled||this.downloadCoursesEnabled)&&u.a.getCourseDownloadOptionsEnabled(),this.fetchCategories().finally((()=>{this.categoriesLoaded=!0}))}fetchCategories(){return Object(n.a)(this,void 0,void 0,(function*(){try{const e=yield u.a.getCategories(this.categoryId,!0);this.currentCategory=void 0;const o=e.findIndex((e=>e.id==this.categoryId));if(o>=0&&(this.currentCategory=e[o],delete e[o]),e.sort(((e,o)=>e.depth==o.depth?e.sortorder>o.sortorder?1:o.sortorder>e.sortorder?-1:0:e.depth>o.depth?1:-1)),this.categories=d.a.formatTree(e,"parent","id",this.categoryId),this.currentCategory){this.title=this.currentCategory.name;try{this.categoryCourses=yield u.a.getCoursesByField("category",this.categoryId),yield this.filterEnrolled()}catch(e){!this.isDestroyed&&l.a.showErrorModalDefault(e,"core.courses.errorloadcourses",!0)}}this.logView()}catch(e){!this.isDestroyed&&l.a.showErrorModalDefault(e,"core.courses.errorloadcategories",!0)}}))}refreshCategories(e){const o=[];o.push(u.a.invalidateUserCourses()),o.push(u.a.invalidateCategories(this.categoryId,!0)),o.push(u.a.invalidateCoursesByField("category",this.categoryId)),o.push(i.b.getRequiredCurrentSite().invalidateConfig()),Promise.all(o).finally((()=>{this.fetchCategories().finally((()=>{null==e?void 0:e.complete()}))}))}openCategory(e){g.a.navigateToSitePath("courses/categories/"+e,{params:{enrolled:this.showOnlyEnrolled}})}filterEnrolled(){return Object(n.a)(this,void 0,void 0,(function*(){this.showOnlyEnrolled?(yield Promise.all(this.categoryCourses.map((e=>Object(n.a)(this,void 0,void 0,(function*(){if(!(void 0!==e.progress))try{const o=yield u.a.getUserCourse(e.id);e.progress=o.progress,e.completionusertracked=o.completionusertracked}catch(e){}}))))),this.courses=this.categoryCourses.filter((e=>"progress"in e))):this.courses=this.categoryCourses}))}toggleDownload(){u.a.setCourseDownloadOptionsEnabled(this.downloadEnabled)}ngOnDestroy(){this.myCoursesObserver.off(),this.siteUpdatedObserver.off(),this.downloadEnabledObserver.off(),this.isDestroyed=!0}}return CoreCoursesCategoriesPage.ɵfac=function CoreCoursesCategoriesPage_Factory(e){return new(e||CoreCoursesCategoriesPage)},CoreCoursesCategoriesPage.ɵcmp=r.sc({type:CoreCoursesCategoriesPage,selectors:[["page-core-courses-categories"]],decls:23,vars:20,consts:[["slot","start"],[3,"text"],["contextLevel","coursecat",3,"text","contextInstanceId"],["slot","end"],["iconAction","toggle",3,"priority","content","toggle","action","toggleChange",4,"ngIf"],["iconAction","toggle",3,"priority","content","toggle","action","toggleChange"],["slot","fixed",3,"disabled","ionRefresh"],[3,"pullingText"],[3,"hideUntil"],[1,"list-item-limited-width"],["class","ion-text-wrap",4,"ngIf"],[4,"ngIf"],["icon","fas-graduation-cap",3,"message",4,"ngIf"],[1,"ion-text-wrap"],["name","fas-folder","slot","start"],[1,"item-heading"],["collapsible-item","","contextLevel","coursecat",3,"text","contextInstanceId"],[1,"big"],[4,"ngFor","ngForOf"],["button","","detail","true",1,"ion-text-wrap",3,"click"],["slot","end","color","light",4,"ngIf"],["slot","end","color","light"],["aria-hidden","true"],[1,"sr-only"],["class","big",4,"ngIf"],[3,"course","showDownload",4,"ngFor","ngForOf"],[3,"course","showDownload"],["icon","fas-graduation-cap",3,"message"]],template:function CoreCoursesCategoriesPage_Template(e,o){1&e&&(r.Ec(0,"ion-header"),r.Ec(1,"ion-toolbar"),r.Ec(2,"ion-buttons",0),r.zc(3,"ion-back-button",1),r.Pc(4,"translate"),r.Dc(),r.Ec(5,"ion-title"),r.Ec(6,"h1"),r.zc(7,"core-format-text",2),r.Dc(),r.Dc(),r.Ec(8,"ion-buttons",3),r.Ec(9,"core-context-menu"),r.nd(10,CoreCoursesCategoriesPage_core_context_menu_item_10_Template,2,5,"core-context-menu-item",4),r.Ec(11,"core-context-menu-item",5),r.Mc("action",(function CoreCoursesCategoriesPage_Template_core_context_menu_item_action_11_listener(){return o.filterEnrolled()}))("toggleChange",(function CoreCoursesCategoriesPage_Template_core_context_menu_item_toggleChange_11_listener(e){return o.showOnlyEnrolled=e})),r.Pc(12,"translate"),r.Dc(),r.Dc(),r.Dc(),r.Dc(),r.Dc(),r.Ec(13,"ion-content"),r.Ec(14,"ion-refresher",6),r.Mc("ionRefresh",(function CoreCoursesCategoriesPage_Template_ion_refresher_ionRefresh_14_listener(e){return o.refreshCategories(e.target)})),r.zc(15,"ion-refresher-content",7),r.Pc(16,"translate"),r.Dc(),r.Ec(17,"core-loading",8),r.Ec(18,"ion-list",9),r.nd(19,CoreCoursesCategoriesPage_ion_item_19_Template,7,6,"ion-item",10),r.nd(20,CoreCoursesCategoriesPage_ng_container_20_Template,7,4,"ng-container",11),r.nd(21,CoreCoursesCategoriesPage_ng_container_21_Template,6,3,"ng-container",11),r.Dc(),r.nd(22,CoreCoursesCategoriesPage_core_empty_box_22_Template,2,3,"core-empty-box",12),r.Dc(),r.Dc()),2&e&&(r.lc(3),r.Vc("text",r.Qc(4,14,"core.back")),r.lc(4),r.Vc("text",o.title)("contextInstanceId",o.currentCategory&&o.currentCategory.id),r.lc(3),r.Vc("ngIf",o.downloadCourseEnabled||o.downloadCoursesEnabled),r.lc(1),r.Vc("priority",900)("content",r.Qc(12,16,"core.courses.showonlyenrolled"))("toggle",o.showOnlyEnrolled),r.lc(3),r.Vc("disabled",!o.categoriesLoaded),r.lc(1),r.Wc("pullingText",r.Qc(16,18,"core.pulltorefresh")),r.lc(2),r.Vc("hideUntil",o.categoriesLoaded),r.lc(2),r.Vc("ngIf",o.currentCategory),r.lc(1),r.Vc("ngIf",o.categories.length>0),r.lc(1),r.Vc("ngIf",o.courses.length>0),r.lc(1),r.Vc("ngIf",!o.categories.length&&!o.courses.length))},directives:[f.C,f.Ab,f.m,f.h,f.i,f.yb,b.a,p.a,E.t,y.a,w.a,f.v,f.bb,f.cb,D.a,f.P,f.I,f.D,P.a,f.O,I.a,f.J,E.s,f.n,f.k,T.a,O.a],pipes:[x.d],encapsulation:2}),CoreCoursesCategoriesPage})();var L=s("ZSwf"),M=s("C1x5"),S=s("xpMl"),V=s("9zps");function CoreCoursesListPage_h1_6_Template(e,o){1&e&&(r.Ec(0,"h1"),r.pd(1),r.Pc(2,"translate"),r.Dc()),2&e&&(r.lc(1),r.qd(r.Qc(2,1,"core.courses.availablecourses")))}function CoreCoursesListPage_h1_7_Template(e,o){1&e&&(r.Ec(0,"h1"),r.pd(1),r.Pc(2,"translate"),r.Dc()),2&e&&(r.lc(1),r.qd(r.Qc(2,1,"core.courses.mycourses")))}function CoreCoursesListPage_core_context_menu_item_10_Template(e,o){if(1&e){const e=r.Fc();r.Ec(0,"core-context-menu-item",5),r.Mc("action",(function CoreCoursesListPage_core_context_menu_item_10_Template_core_context_menu_item_action_0_listener(){r.fd(e);return r.Oc().toggleDownload()}))("toggleChange",(function CoreCoursesListPage_core_context_menu_item_10_Template_core_context_menu_item_toggleChange_0_listener(o){r.fd(e);return r.Oc().downloadEnabled=o})),r.Pc(1,"translate"),r.Dc()}if(2&e){const e=r.Oc();r.Vc("priority",1e3)("content",r.Qc(1,3,"core.settings.showdownloadoptions"))("toggle",e.downloadEnabled)}}function CoreCoursesListPage_core_search_box_18_Template(e,o){if(1&e){const e=r.Fc();r.Ec(0,"core-search-box",15),r.Mc("onSubmit",(function CoreCoursesListPage_core_search_box_18_Template_core_search_box_onSubmit_0_listener(o){r.fd(e);return r.Oc().search(o)}))("onClear",(function CoreCoursesListPage_core_search_box_18_Template_core_search_box_onClear_0_listener(){r.fd(e);return r.Oc().clearSearch()})),r.Pc(1,"translate"),r.Pc(2,"translate"),r.Dc()}if(2&e){const e=r.Oc();r.Vc("placeholder",r.Qc(1,3,"core.courses.search"))("searchLabel",r.Qc(2,5,"core.courses.search"))("autoFocus",e.searchMode)}}const list_c0=function(e){return{$a:e}};function CoreCoursesListPage_ng_container_20_Template(e,o){if(1&e&&(r.Cc(0),r.Ec(1,"ion-item-divider"),r.Ec(2,"ion-label"),r.Ec(3,"h2"),r.pd(4),r.Pc(5,"translate"),r.Dc(),r.Dc(),r.Dc(),r.Bc()),2&e){const e=r.Oc();r.lc(4),r.qd(r.Rc(5,1,"core.courses.totalcoursesearchresults",r.ad(4,list_c0,e.searchTotal)))}}function CoreCoursesListPage_core_courses_course_list_item_22_Template(e,o){if(1&e&&r.zc(0,"core-courses-course-list-item",16),2&e){const e=o.$implicit,s=r.Oc();r.Vc("course",e)("showDownload",s.downloadEnabled)}}function CoreCoursesListPage_core_empty_box_24_Template(e,o){1&e&&(r.zc(0,"core-empty-box",17),r.Pc(1,"translate")),2&e&&r.Vc("message",r.Qc(1,1,"core.courses.nosearchresults"))}function CoreCoursesListPage_core_empty_box_25_Template(e,o){1&e&&(r.zc(0,"core-empty-box",18),r.Pc(1,"translate")),2&e&&r.Vc("message",r.Qc(1,1,"core.courses.nocourses"))}let z=(()=>{class CoreCoursesListPage{constructor(){this.downloadAllCoursesEnabled=!1,this.searchEnabled=!1,this.searchMode=!1,this.searchTotal=0,this.downloadEnabled=!1,this.downloadCourseEnabled=!1,this.downloadCoursesEnabled=!1,this.courses=[],this.loaded=!1,this.coursesLoaded=0,this.canLoadMore=!1,this.loadMoreError=!1,this.showOnlyEnrolled=!1,this.loadedCourses=[],this.loadCoursesPerPage=20,this.searchPage=0,this.searchText="",this.courseIds="",this.isDestroyed=!1,this.currentSiteId=i.b.getRequiredCurrentSite().getId(),this.frontpageCourseId=i.b.getRequiredCurrentSite().getSiteHomeId(),this.myCoursesObserver=_.b.on(u.b.EVENT_MY_COURSES_UPDATED,(e=>{e.action==u.b.ACTION_ENROL&&this.fetchCourses()}),this.currentSiteId),this.siteUpdatedObserver=_.b.on(_.b.SITE_UPDATED,(()=>{this.searchEnabled=!u.a.isSearchCoursesDisabledInSite(),this.downloadCourseEnabled=!u.a.isDownloadCourseDisabledInSite(),this.downloadCoursesEnabled=!u.a.isDownloadCoursesDisabledInSite(),this.downloadEnabled=(this.downloadCourseEnabled||this.downloadCoursesEnabled)&&this.downloadEnabled,!this.searchEnabled&&this.searchMode&&(this.searchMode=!1,this.fetchCourses())}),this.currentSiteId),this.downloadEnabledObserver=_.b.on(u.b.EVENT_DASHBOARD_DOWNLOAD_ENABLED_CHANGED,(e=>{this.downloadEnabled=(this.downloadCourseEnabled||this.downloadCoursesEnabled)&&e.enabled})),this.logView=m.a.once((()=>Object(n.a)(this,void 0,void 0,(function*(){C.a.logEvent(this.showOnlyEnrolled?{type:C.b.VIEW_ITEM_LIST,ws:"core_enrol_get_users_courses",name:h.I.instant("core.courses.mycourses"),data:{category:"course"},url:"/my/courses.php"}:{type:C.b.VIEW_ITEM_LIST,ws:"core_course_get_courses_by_field",name:h.I.instant("core.courses.availablecourses"),data:{category:"course"},url:"/course/index.php"})}))))}ngOnInit(){this.downloadCourseEnabled=!u.a.isDownloadCourseDisabledInSite(),this.downloadCoursesEnabled=!u.a.isDownloadCoursesDisabledInSite(),this.downloadEnabled=(this.downloadCourseEnabled||this.downloadCoursesEnabled)&&u.a.getCourseDownloadOptionsEnabled();const e=g.a.getRouteParam("mode")||"my";"search"==e&&(this.searchMode=!0),"my"==e&&(this.showOnlyEnrolled=!0),this.searchEnabled=!u.a.isSearchCoursesDisabledInSite(),this.searchEnabled||(this.searchMode=!1),this.fetchCourses()}fetchCourses(){return Object(n.a)(this,void 0,void 0,(function*(){try{this.searchMode?this.searchText&&(yield this.searchCourses()):yield this.loadCourses(!0)}finally{this.loaded=!0}}))}loadCourses(e=!1){return Object(n.a)(this,void 0,void 0,(function*(){this.loadMoreError=!1;try{if(e){if(this.showOnlyEnrolled)this.loadedCourses=yield u.a.getUserCourses();else{const e=yield u.a.getCoursesByField();this.loadedCourses=e.filter((e=>e.id!=this.frontpageCourseId))}this.coursesLoaded=0,this.courses=[]}const o=this.loadedCourses.slice(this.coursesLoaded,this.coursesLoaded+this.loadCoursesPerPage);yield L.b.loadCoursesExtraInfo(o,!0),this.courses=this.courses.concat(o),this.courseIds=this.courses.map((e=>e.id)).join(","),this.coursesLoaded=this.courses.length,this.canLoadMore=this.loadedCourses.length>this.courses.length,this.logView()}catch(e){this.loadMoreError=!0,!this.isDestroyed&&l.a.showErrorModalDefault(e,"core.courses.errorloadcourses",!0)}}))}refreshCourses(e){const o=[];this.searchMode||(o.push(this.showOnlyEnrolled?u.a.invalidateUserCourses():u.a.invalidateCoursesByField()),this.courseIds&&o.push(u.a.invalidateCoursesByField("ids",this.courseIds))),Promise.all(o).finally((()=>{this.fetchCourses().finally((()=>{null==e?void 0:e.complete()}))}))}search(e){return Object(n.a)(this,void 0,void 0,(function*(){this.searchMode=!0,this.searchText=e,this.courses=[],this.searchPage=0,this.searchTotal=0,this.logSearch=m.a.once((()=>this.performLogSearch()));const o=yield l.a.showModalLoading("core.searching",!0);yield this.searchCourses().finally((()=>{o.dismiss()}))}))}clearSearch(){this.searchText="",this.courses=[],this.searchPage=0,this.searchTotal=0,this.searchMode=!1,this.loaded=!1,this.fetchCourses()}performLogSearch(){return Object(n.a)(this,void 0,void 0,(function*(){this.searchMode&&C.a.logEvent({type:C.b.VIEW_ITEM_LIST,ws:"core_course_search_courses",name:h.I.instant("core.courses.availablecourses"),data:{search:this.searchText,category:"course"},url:`/course/search.php?search=${this.searchText}`})}))}loadMoreCourses(e){return Object(n.a)(this,void 0,void 0,(function*(){try{this.searchMode?yield this.searchCourses():yield this.loadCourses()}finally{e&&e()}}))}searchCourses(){var e;return Object(n.a)(this,void 0,void 0,(function*(){this.loadMoreError=!1;try{const o=yield u.a.search(this.searchText,this.searchPage,void 0,this.showOnlyEnrolled);this.courses=0===this.searchPage?o.courses:this.courses.concat(o.courses),this.searchTotal=o.total,this.searchPage++,this.canLoadMore=this.courses.length<this.searchTotal,null===(e=this.logSearch)||void 0===e||e.call(this)}catch(e){this.loadMoreError=!0,!this.isDestroyed&&l.a.showErrorModalDefault(e,"core.courses.errorsearching",!0)}}))}toggleEnrolled(){this.loaded=!1,this.fetchCourses()}toggleDownload(){u.a.setCourseDownloadOptionsEnabled(this.downloadEnabled)}ngOnDestroy(){this.myCoursesObserver.off(),this.siteUpdatedObserver.off(),this.downloadEnabledObserver.off(),this.isDestroyed=!0}}return CoreCoursesListPage.ɵfac=function CoreCoursesListPage_Factory(e){return new(e||CoreCoursesListPage)},CoreCoursesListPage.ɵcmp=r.sc({type:CoreCoursesListPage,selectors:[["page-core-courses-list"]],decls:26,vars:23,consts:[["slot","start"],[3,"text"],[4,"ngIf"],["slot","end"],["iconAction","toggle",3,"priority","content","toggle","action","toggleChange",4,"ngIf"],["iconAction","toggle",3,"priority","content","toggle","action","toggleChange"],["slot","fixed",3,"disabled","ionRefresh"],[3,"pullingText"],["searchArea","CoreCoursesSearch",3,"placeholder","searchLabel","autoFocus","onSubmit","onClear",4,"ngIf"],[3,"hideUntil"],[1,"list-item-limited-width"],[3,"course","showDownload",4,"ngFor","ngForOf"],[3,"enabled","error","action"],["icon","fas-magnifying-glass",3,"message",4,"ngIf"],["icon","fas-graduation-cap",3,"message",4,"ngIf"],["searchArea","CoreCoursesSearch",3,"placeholder","searchLabel","autoFocus","onSubmit","onClear"],[3,"course","showDownload"],["icon","fas-magnifying-glass",3,"message"],["icon","fas-graduation-cap",3,"message"]],template:function CoreCoursesListPage_Template(e,o){1&e&&(r.Ec(0,"ion-header"),r.Ec(1,"ion-toolbar"),r.Ec(2,"ion-buttons",0),r.zc(3,"ion-back-button",1),r.Pc(4,"translate"),r.Dc(),r.Ec(5,"ion-title"),r.nd(6,CoreCoursesListPage_h1_6_Template,3,3,"h1",2),r.nd(7,CoreCoursesListPage_h1_7_Template,3,3,"h1",2),r.Dc(),r.Ec(8,"ion-buttons",3),r.Ec(9,"core-context-menu"),r.nd(10,CoreCoursesListPage_core_context_menu_item_10_Template,2,5,"core-context-menu-item",4),r.Ec(11,"core-context-menu-item",5),r.Mc("action",(function CoreCoursesListPage_Template_core_context_menu_item_action_11_listener(){return o.toggleEnrolled()}))("toggleChange",(function CoreCoursesListPage_Template_core_context_menu_item_toggleChange_11_listener(e){return o.showOnlyEnrolled=e})),r.Pc(12,"translate"),r.Dc(),r.Dc(),r.zc(13,"core-user-menu-button"),r.Dc(),r.Dc(),r.Dc(),r.Ec(14,"ion-content"),r.Ec(15,"ion-refresher",6),r.Mc("ionRefresh",(function CoreCoursesListPage_Template_ion_refresher_ionRefresh_15_listener(e){return o.refreshCourses(e.target)})),r.zc(16,"ion-refresher-content",7),r.Pc(17,"translate"),r.Dc(),r.nd(18,CoreCoursesListPage_core_search_box_18_Template,3,7,"core-search-box",8),r.Ec(19,"core-loading",9),r.nd(20,CoreCoursesListPage_ng_container_20_Template,6,6,"ng-container",2),r.Ec(21,"ion-list",10),r.nd(22,CoreCoursesListPage_core_courses_course_list_item_22_Template,1,2,"core-courses-course-list-item",11),r.Dc(),r.Ec(23,"core-infinite-loading",12),r.Mc("action",(function CoreCoursesListPage_Template_core_infinite_loading_action_23_listener(e){return o.loadMoreCourses(e)})),r.Dc(),r.nd(24,CoreCoursesListPage_core_empty_box_24_Template,2,3,"core-empty-box",13),r.nd(25,CoreCoursesListPage_core_empty_box_25_Template,2,3,"core-empty-box",14),r.Dc(),r.Dc()),2&e&&(r.lc(3),r.Vc("text",r.Qc(4,17,"core.back")),r.lc(3),r.Vc("ngIf",!o.showOnlyEnrolled),r.lc(1),r.Vc("ngIf",o.showOnlyEnrolled),r.lc(3),r.Vc("ngIf",o.downloadCourseEnabled||o.downloadCoursesEnabled),r.lc(1),r.Vc("priority",900)("content",r.Qc(12,19,"core.courses.showonlyenrolled"))("toggle",o.showOnlyEnrolled),r.lc(4),r.Vc("disabled",!o.loaded),r.lc(1),r.Wc("pullingText",r.Qc(17,21,"core.pulltorefresh")),r.lc(2),r.Vc("ngIf",o.searchEnabled),r.lc(1),r.Vc("hideUntil",o.loaded),r.lc(1),r.Vc("ngIf",o.searchMode&&o.searchTotal>0),r.lc(2),r.Vc("ngForOf",o.courses),r.lc(1),r.Vc("enabled",o.canLoadMore)("error",o.loadMoreError),r.lc(1),r.Vc("ngIf",o.searchMode&&!o.courses.length),r.lc(1),r.Vc("ngIf",!o.searchMode&&!o.courses.length))},directives:[f.C,f.Ab,f.m,f.h,f.i,f.yb,E.t,p.a,y.a,M.a,w.a,f.v,f.bb,f.cb,D.a,f.P,E.s,S.a,V.a,f.J,f.O,T.a,O.a],pipes:[x.d],encapsulation:2}),CoreCoursesListPage})();var A=s("dQ3M"),F=s("wG2S"),R=s("PM4H"),Q=s("lzQd");function buildRoutes(e){return[{path:"my",data:{mainMenuTabRoot:Q.b.PAGE_NAME},loadChildren:()=>L.b.getMyRouteModule()},{path:"categories",redirectTo:"categories/root",pathMatch:"full"},{path:"categories/:id",component:v},{path:"list",component:z},...Object(F.b)(e,{redirectTo:"my",pathMatch:"full"})]}let U=(()=>{class CoreCoursesLazyModule{}return CoreCoursesLazyModule.ɵmod=r.wc({type:CoreCoursesLazyModule}),CoreCoursesLazyModule.ɵinj=r.vc({factory:function CoreCoursesLazyModule_Factory(e){return new(e||CoreCoursesLazyModule)},providers:[{provide:c.g,multi:!0,deps:[r.x],useFactory:buildRoutes}],imports:[[t.a,a.a,A.a,R.a],c.m]}),CoreCoursesLazyModule})();void(("undefined"==typeof ngJitMode||ngJitMode)&&r.kd(U,{declarations:[v,z],imports:[t.a,a.a,A.a,R.a],exports:[c.m]}))}}]);